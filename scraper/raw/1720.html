<html dir="ltr" lang="en-GB" xmlns="http://www.w3.org/1999/xhtml" xmlns:b="http://www.google.com/2005/gml/b" xmlns:data="http://www.google.com/2005/gml/data" xmlns:expr="http://www.google.com/2005/gml/expr"><head>
<meta content="@splinter_code" name="twitter:site"><meta content="summary_large_image" name="twitter:card">
<style class="singleton-element" type="text/css">.cookie-choices-info { position:fixed;width:100%;background-color:#666;margin:0;left:0;top:0;padding:0;z-index:4000;text-align:center;color:#fff;line-height:140%;padding:10px 0;font-family:roboto,Arial; } .cookie-choices-info .cookie-choices-inner { position:relative;width:initial;margin:0;left:0;top:0; } .cookie-choices-info .cookie-choices-text { display:inline-block;vertical-align:middle;font-size:16px;margin:10px 20px;color:#ccc;max-width:800px;text-align:left; }.cookie-choices-info .cookie-choices-buttons { display:inline-block;vertical-align:middle;white-space:nowrap;margin:0 10px; } .cookie-choices-info .cookie-choices-button:hover {  color: #fff; } .cookie-choices-info .cookie-choices-button { font-weight:bold;text-transform:UPPERCASE;white-space:nowrap;color:#eee;margin-left:8px;padding:0 6px; text-decoration:none; }</style></head><body class="item-view no-sidebar-widget" data-js-state="loaded"><a href="https://infosec.exchange/@splinter_code" rel="me"></a>
<meta content="Bypassing UAC with SSPI Datagram Contexts" name="twitter:title">
<meta content="by splinter_code - 14 September 2023 Recently i had the opportunity to read through some of my old repos because i wanted to reuse some code..." name="twitter:description">
<meta content="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHatC0V08ZrzJ89M8WsX2LRa6VB8h63QM9_2Nv_YEUthJjL1B2FUMMRjSJLUDfIJnvvlG3htwHNXGYrD4_id9CXc0vCYiknSl_mNjAwDTHCAtL1fbbGGQNjyonPDrpLgr8Cd8hMRZC9b5s4vimx0b2mLTLm8w63lHIoVOm9EWpeTaSuscXgfODPuikkVw/w1200-h630-p-k-no-nu/spiderman.jpg" property="og:image">
<meta content="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHatC0V08ZrzJ89M8WsX2LRa6VB8h63QM9_2Nv_YEUthJjL1B2FUMMRjSJLUDfIJnvvlG3htwHNXGYrD4_id9CXc0vCYiknSl_mNjAwDTHCAtL1fbbGGQNjyonPDrpLgr8Cd8hMRZC9b5s4vimx0b2mLTLm8w63lHIoVOm9EWpeTaSuscXgfODPuikkVw/w1200-h630-p-k-no-nu/spiderman.jpg" name="twitter:image">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Bypassing UAC with SSPI Datagram Contexts</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<!-- Chrome, Firefox OS and Opera -->
<meta content="#f4f4f4" name="theme-color">
<!-- Windows Phone -->
<meta content="#f4f4f4" name="msapplication-navbutton-color">
<meta content="blogger" name="generator">
<link href="https://splintercod3.blogspot.com/favicon.ico" rel="icon" type="image/x-icon">
<link href="https://splintercod3.blogspot.com/p/bypassing-uac-with-sspi-datagram.html" rel="canonical">
<!--Can't find substitution for tag [blog.ieCssRetrofitLinks]-->
<meta content="https://splintercod3.blogspot.com/p/bypassing-uac-with-sspi-datagram.html" property="og:url">
<meta content="Bypassing UAC with SSPI Datagram Contexts" property="og:title">
<meta content="by splinter_code - 14 September 2023 Recently i had the opportunity to read through some of my old repos because i wanted to reuse some code..." property="og:description">
<meta content="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHatC0V08ZrzJ89M8WsX2LRa6VB8h63QM9_2Nv_YEUthJjL1B2FUMMRjSJLUDfIJnvvlG3htwHNXGYrD4_id9CXc0vCYiknSl_mNjAwDTHCAtL1fbbGGQNjyonPDrpLgr8Cd8hMRZC9b5s4vimx0b2mLTLm8w63lHIoVOm9EWpeTaSuscXgfODPuikkVw/w1200-h630-p-k-no-nu/spiderman.jpg" property="og:image">
<style type="text/css">@font-face{font-family:'Damion';font-style:normal;font-weight:400;font-display:swap;src:url(//fonts.gstatic.com/s/damion/v15/hv-XlzJ3KEUe_YZkZGw2ATE.woff2)format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF;}@font-face{font-family:'Damion';font-style:normal;font-weight:400;font-display:swap;src:url(//fonts.gstatic.com/s/damion/v15/hv-XlzJ3KEUe_YZkamw2.woff2)format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;}@font-face{font-family:'Playfair Display';font-style:normal;font-weight:900;font-display:swap;src:url(//fonts.gstatic.com/s/playfairdisplay/v37/nuFvD-vYSZviVYUb_rj3ij__anPXJzDwcbmjWBN2PKfsunDTbtPY_Q.woff2)format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;}@font-face{font-family:'Playfair Display';font-style:normal;font-weight:900;font-display:swap;src:url(//fonts.gstatic.com/s/playfairdisplay/v37/nuFvD-vYSZviVYUb_rj3ij__anPXJzDwcbmjWBN2PKfsunDYbtPY_Q.woff2)format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;}@font-face{font-family:'Playfair Display';font-style:normal;font-weight:900;font-display:swap;src:url(//fonts.gstatic.com/s/playfairdisplay/v37/nuFvD-vYSZviVYUb_rj3ij__anPXJzDwcbmjWBN2PKfsunDZbtPY_Q.woff2)format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF;}@font-face{font-family:'Playfair Display';font-style:normal;font-weight:900;font-display:swap;src:url(//fonts.gstatic.com/s/playfairdisplay/v37/nuFvD-vYSZviVYUb_rj3ij__anPXJzDwcbmjWBN2PKfsunDXbtM.woff2)format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;}@font-face{font-family:'Roboto';font-style:italic;font-weight:300;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOjCnqEu92Fr1Mu51TjASc3CsTKlA.woff2)format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;}@font-face{font-family:'Roboto';font-style:italic;font-weight:300;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOjCnqEu92Fr1Mu51TjASc-CsTKlA.woff2)format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;}@font-face{font-family:'Roboto';font-style:italic;font-weight:300;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOjCnqEu92Fr1Mu51TjASc2CsTKlA.woff2)format('woff2');unicode-range:U+1F00-1FFF;}@font-face{font-family:'Roboto';font-style:italic;font-weight:300;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOjCnqEu92Fr1Mu51TjASc5CsTKlA.woff2)format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF;}@font-face{font-family:'Roboto';font-style:italic;font-weight:300;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOjCnqEu92Fr1Mu51TjASc1CsTKlA.woff2)format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;}@font-face{font-family:'Roboto';font-style:italic;font-weight:300;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOjCnqEu92Fr1Mu51TjASc0CsTKlA.woff2)format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF;}@font-face{font-family:'Roboto';font-style:italic;font-weight:300;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOjCnqEu92Fr1Mu51TjASc6CsQ.woff2)format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu72xKOzY.woff2)format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu5mxKOzY.woff2)format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu7mxKOzY.woff2)format('woff2');unicode-range:U+1F00-1FFF;}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4WxKOzY.woff2)format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF;}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu7WxKOzY.woff2)format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu7GxKOzY.woff2)format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF;}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxK.woff2)format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfCRc4EsA.woff2)format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfABc4EsA.woff2)format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfCBc4EsA.woff2)format('woff2');unicode-range:U+1F00-1FFF;}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfBxc4EsA.woff2)format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF;}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfCxc4EsA.woff2)format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfChc4EsA.woff2)format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF;}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(//fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfBBc4.woff2)format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;}</style>
<style id="page-skin-1" type="text/css"><!--
/*! normalize.css v8.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px}[type="search"]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}
/*!************************************************
* Blogger Template Style
* Name: Essential
**************************************************/
body{
overflow-wrap:break-word;
word-break:break-word;
word-wrap:break-word
}
.hidden{
display:none
}
.invisible{
visibility:hidden
}
.container:after,.float-container:after{
clear:both;
content:"";
display:table
}
.clearboth{
clear:both
}
#comments .comment .comment-actions,.subscribe-popup .FollowByEmail .follow-by-email-submit,.widget.Profile .profile-link,.widget.Profile .profile-link.visit-profile{
background:transparent;
border:0;
box-shadow:none;
color:#2196f3;
cursor:pointer;
font-size:14px;
font-weight:700;
outline:none;
text-decoration:none;
text-transform:uppercase;
width:auto
}
.dim-overlay{
height:100vh;
left:0;
position:fixed;
top:0;
width:100%
}
#sharing-dim-overlay{
background-color:transparent
}
input::-ms-clear{
display:none
}
.blogger-logo,.svg-icon-24.blogger-logo{
fill:#ff9800;
opacity:1
}
.loading-spinner-large{
-webkit-animation:mspin-rotate 1568.63ms linear infinite;
animation:mspin-rotate 1568.63ms linear infinite;
height:48px;
overflow:hidden;
position:absolute;
width:48px;
z-index:200
}
.loading-spinner-large>div{
-webkit-animation:mspin-revrot 5332ms steps(4) infinite;
animation:mspin-revrot 5332ms steps(4) infinite
}
.loading-spinner-large>div>div{
-webkit-animation:mspin-singlecolor-large-film 1333ms steps(81) infinite;
animation:mspin-singlecolor-large-film 1333ms steps(81) infinite;
background-size:100%;
height:48px;
width:3888px
}
.mspin-black-large>div>div,.mspin-grey_54-large>div>div{
background-image:url(https://www.blogblog.com/indie/mspin_black_large.svg)
}
.mspin-white-large>div>div{
background-image:url(https://www.blogblog.com/indie/mspin_white_large.svg)
}
.mspin-grey_54-large{
opacity:.54
}
@-webkit-keyframes mspin-singlecolor-large-film{
0%{
-webkit-transform:translateX(0);
transform:translateX(0)
}
to{
-webkit-transform:translateX(-3888px);
transform:translateX(-3888px)
}
}
@keyframes mspin-singlecolor-large-film{
0%{
-webkit-transform:translateX(0);
transform:translateX(0)
}
to{
-webkit-transform:translateX(-3888px);
transform:translateX(-3888px)
}
}
@-webkit-keyframes mspin-rotate{
0%{
-webkit-transform:rotate(0deg);
transform:rotate(0deg)
}
to{
-webkit-transform:rotate(1turn);
transform:rotate(1turn)
}
}
@keyframes mspin-rotate{
0%{
-webkit-transform:rotate(0deg);
transform:rotate(0deg)
}
to{
-webkit-transform:rotate(1turn);
transform:rotate(1turn)
}
}
@-webkit-keyframes mspin-revrot{
0%{
-webkit-transform:rotate(0deg);
transform:rotate(0deg)
}
to{
-webkit-transform:rotate(-1turn);
transform:rotate(-1turn)
}
}
@keyframes mspin-revrot{
0%{
-webkit-transform:rotate(0deg);
transform:rotate(0deg)
}
to{
-webkit-transform:rotate(-1turn);
transform:rotate(-1turn)
}
}
.skip-navigation{
background-color:#fff;
box-sizing:border-box;
color:#000;
display:block;
height:0;
left:0;
line-height:50px;
overflow:hidden;
padding-top:0;
position:fixed;
text-align:center;
top:0;
-webkit-transition:box-shadow .3s,height .3s,padding-top .3s;
transition:box-shadow .3s,height .3s,padding-top .3s;
width:100%;
z-index:900
}
.skip-navigation:focus{
box-shadow:0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12),0 2px 4px -1px rgba(0,0,0,.2);
height:50px
}
#main{
outline:none
}
.main-heading{
position:absolute;
clip:rect(1px,1px,1px,1px);
padding:0;
border:0;
height:1px;
width:1px;
overflow:hidden
}
.Attribution{
margin-top:1em;
text-align:center
}
.Attribution .blogger img,.Attribution .blogger svg{
vertical-align:bottom
}
.Attribution .blogger img{
margin-right:.5em
}
.Attribution div{
line-height:24px;
margin-top:.5em
}
.Attribution .copyright,.Attribution .image-attribution{
font-size:.7em;
margin-top:1.5em
}
.BLOG_mobile_video_class{
display:none
}
.bg-photo{
background-attachment:scroll!important
}
body .CSS_LIGHTBOX{
z-index:900
}
.extendable .show-less,.extendable .show-more{
border-color:#2196f3;
color:#2196f3;
margin-top:8px
}
.extendable .show-less.hidden,.extendable .show-more.hidden,.inline-ad{
display:none
}
.inline-ad{
max-width:100%;
overflow:hidden
}
.adsbygoogle{
display:block
}
#cookieChoiceInfo{
bottom:0;
top:auto
}
iframe.b-hbp-video{
border:0
}
.post-body iframe,.post-body img{
max-width:100%
}
.post-body a[imageanchor=\31]{
display:inline-block
}
.byline{
margin-right:1em
}
.byline:last-child{
margin-right:0
}
.link-copied-dialog{
max-width:520px;
outline:0
}
.link-copied-dialog .modal-dialog-buttons{
margin-top:8px
}
.link-copied-dialog .goog-buttonset-default{
background:transparent;
border:0
}
.link-copied-dialog .goog-buttonset-default:focus{
outline:0
}
.paging-control-container{
margin-bottom:16px
}
.paging-control-container .paging-control{
display:inline-block
}
.paging-control-container .comment-range-text:after,.paging-control-container .paging-control{
color:#2196f3
}
.paging-control-container .comment-range-text,.paging-control-container .paging-control{
margin-right:8px
}
.paging-control-container .comment-range-text:after,.paging-control-container .paging-control:after{
content:"\b7";
cursor:default;
padding-left:8px;
pointer-events:none
}
.paging-control-container .comment-range-text:last-child:after,.paging-control-container .paging-control:last-child:after{
content:none
}
.byline.reactions iframe{
height:20px
}
.b-notification{
color:#000;
background-color:#fff;
border-bottom:1px solid #000;
box-sizing:border-box;
padding:16px 32px;
text-align:center
}
.b-notification.visible{
-webkit-transition:margin-top .3s cubic-bezier(.4,0,.2,1);
transition:margin-top .3s cubic-bezier(.4,0,.2,1)
}
.b-notification.invisible{
position:absolute
}
.b-notification-close{
position:absolute;
right:8px;
top:8px
}
.no-posts-message{
line-height:40px;
text-align:center
}
@media screen and (max-width:800px){
body.item-view .post-body a[imageanchor=\31][style*=float\:\ left\;],body.item-view .post-body a[imageanchor=\31][style*=float\:\ right\;]{
float:none!important;
clear:none!important
}
body.item-view .post-body a[imageanchor=\31] img{
display:block;
height:auto;
margin:0 auto
}
body.item-view .post-body>.separator:first-child>a[imageanchor=\31]:first-child{
margin-top:20px
}
.post-body a[imageanchor]{
display:block
}
body.item-view .post-body a[imageanchor=\31]{
margin-left:0!important;
margin-right:0!important
}
body.item-view .post-body a[imageanchor=\31]+a[imageanchor=\31]{
margin-top:16px
}
}
.item-control{
display:none
}
#comments{
border-top:1px dashed rgba(0,0,0,.54);
margin-top:20px;
padding:20px
}
#comments .comment-thread ol{
margin:0;
padding-left:0;
padding-left:0
}
#comments .comment-thread .comment-replies,#comments .comment .comment-replybox-single{
margin-left:60px
}
#comments .comment-thread .thread-count{
display:none
}
#comments .comment{
list-style-type:none;
padding:0 0 30px;
position:relative
}
#comments .comment .comment{
padding-bottom:8px
}
.comment .avatar-image-container{
position:absolute
}
.comment .avatar-image-container img{
border-radius:50%
}
.avatar-image-container svg,.comment .avatar-image-container .avatar-icon{
border-radius:50%;
border:1px solid #707070;
box-sizing:border-box;
fill:#707070;
height:35px;
margin:0;
padding:7px;
width:35px
}
.comment .comment-block{
margin-top:10px;
margin-left:60px;
padding-bottom:0
}
#comments .comment-author-header-wrapper{
margin-left:40px
}
#comments .comment .thread-expanded .comment-block{
padding-bottom:20px
}
#comments .comment .comment-header .user,#comments .comment .comment-header .user a{
color:#424242;
font-style:normal;
font-weight:700
}
#comments .comment .comment-actions{
bottom:0;
margin-bottom:15px;
position:absolute
}
#comments .comment .comment-actions>*{
margin-right:8px
}
#comments .comment .comment-header .datetime{
bottom:0;
display:inline-block;
font-size:13px;
font-style:italic;
margin-left:8px
}
#comments .comment .comment-footer .comment-timestamp a,#comments .comment .comment-header .datetime,#comments .comment .comment-header .datetime a{
color:rgba(66,66,66,.54)
}
#comments .comment .comment-content,.comment .comment-body{
margin-top:12px;
word-break:break-word
}
.comment-body{
margin-bottom:12px
}
#comments.embed[data-num-comments=\30]{
border:0;
margin-top:0;
padding-top:0
}
#comment-editor-src,#comments.embed[data-num-comments=\30] #comment-post-message,#comments.embed[data-num-comments=\30] div.comment-form>p,#comments.embed[data-num-comments=\30] p.comment-footer{
display:none
}
.comments .comments-content .loadmore.loaded{
max-height:0;
opacity:0;
overflow:hidden
}
.extendable .remaining-items{
height:0;
overflow:hidden;
-webkit-transition:height .3s cubic-bezier(.4,0,.2,1);
transition:height .3s cubic-bezier(.4,0,.2,1)
}
.extendable .remaining-items.expanded{
height:auto
}
.svg-icon-24,.svg-icon-24-button{
cursor:pointer;
height:24px;
width:24px;
min-width:24px
}
.touch-icon{
margin:-12px;
padding:12px
}
.touch-icon:active,.touch-icon:focus{
background-color:hsla(0,0%,60%,.4);
border-radius:50%
}
svg:not(:root).touch-icon{
overflow:visible
}
html[dir=rtl] .rtl-reversible-icon{
-webkit-transform:scaleX(-1);
transform:scaleX(-1)
}
.svg-icon-24-button,.touch-icon-button{
background:transparent;
border:0;
margin:0;
outline:none;
padding:0
}
.touch-icon-button .touch-icon:active,.touch-icon-button .touch-icon:focus{
background-color:transparent
}
.touch-icon-button:active .touch-icon,.touch-icon-button:focus .touch-icon{
background-color:hsla(0,0%,60%,.4);
border-radius:50%
}
.Profile .default-avatar-wrapper .avatar-icon{
border-radius:50%;
border:1px solid #707070;
box-sizing:border-box;
fill:#707070;
margin:0
}
.Profile .individual .default-avatar-wrapper .avatar-icon{
padding:25px
}
.Profile .individual .avatar-icon,.Profile .individual .profile-img{
height:120px;
width:120px
}
.Profile .team .default-avatar-wrapper .avatar-icon{
padding:8px
}
.Profile .team .avatar-icon,.Profile .team .default-avatar-wrapper,.Profile .team .profile-img{
height:40px;
width:40px
}
.snippet-container{
margin:0;
position:relative;
overflow:hidden
}
.snippet-fade{
bottom:0;
box-sizing:border-box;
position:absolute;
width:96px;
right:0
}
.snippet-fade:after{
content:"\2026";
float:right
}
.post-bottom{
-webkit-box-align:center;
align-items:center;
display:-webkit-box;
display:flex;
flex-wrap:wrap
}
.post-footer{
-webkit-box-flex:1;
flex:1 1 auto;
flex-wrap:wrap;
-webkit-box-ordinal-group:2;
order:1
}
.post-footer>*{
-webkit-box-flex:0;
flex:0 1 auto
}
.post-footer .byline:last-child{
margin-right:1em
}
.jump-link{
-webkit-box-flex:0;
flex:0 0 auto;
-webkit-box-ordinal-group:3;
order:2
}
.centered-top-container.sticky{
left:0;
position:fixed;
right:0;
top:0;
width:auto;
z-index:50;
-webkit-transition-property:opacity,-webkit-transform;
transition-property:opacity,-webkit-transform;
transition-property:transform,opacity;
transition-property:transform,opacity,-webkit-transform;
-webkit-transition-duration:.2s;
transition-duration:.2s;
-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);
transition-timing-function:cubic-bezier(.4,0,.2,1)
}
.centered-top-placeholder{
display:none
}
.collapsed-header .centered-top-placeholder{
display:block
}
.centered-top-container .Header .replaced h1,.centered-top-placeholder .Header .replaced h1{
display:none
}
.centered-top-container.sticky .Header .replaced h1{
display:block
}
.centered-top-container.sticky .Header .header-widget{
background:none
}
.centered-top-container.sticky .Header .header-image-wrapper{
display:none
}
.centered-top-container img,.centered-top-placeholder img{
max-width:100%
}
.collapsible{
-webkit-transition:height .3s cubic-bezier(.4,0,.2,1);
transition:height .3s cubic-bezier(.4,0,.2,1)
}
.collapsible,.collapsible>summary{
display:block;
overflow:hidden
}
.collapsible>:not(summary){
display:none
}
.collapsible[open]>:not(summary){
display:block
}
.collapsible:focus,.collapsible>summary:focus{
outline:none
}
.collapsible>summary{
cursor:pointer;
display:block;
padding:0
}
.collapsible:focus>summary,.collapsible>summary:focus{
background-color:transparent
}
.collapsible>summary::-webkit-details-marker{
display:none
}
.collapsible-title{
-webkit-box-align:center;
align-items:center;
display:-webkit-box;
display:flex
}
.collapsible-title .title{
-webkit-box-flex:1;
flex:1 1 auto;
-webkit-box-ordinal-group:1;
order:0;
overflow:hidden;
text-overflow:ellipsis;
white-space:nowrap
}
.collapsible-title .chevron-down,.collapsible[open] .collapsible-title .chevron-up{
display:block
}
.collapsible-title .chevron-up,.collapsible[open] .collapsible-title .chevron-down{
display:none
}
.flat-button{
font-weight:700;
text-transform:uppercase;
border-radius:2px;
padding:8px;
margin:-8px
}
.flat-button,.flat-icon-button{
cursor:pointer;
display:inline-block
}
.flat-icon-button{
background:transparent;
border:0;
outline:none;
margin:-12px;
padding:12px;
box-sizing:content-box;
line-height:0
}
.flat-icon-button,.flat-icon-button .splash-wrapper{
border-radius:50%
}
.flat-icon-button .splash.animate{
-webkit-animation-duration:.3s;
animation-duration:.3s
}
.overflowable-container{
max-height:46px;
overflow:hidden;
position:relative
}
.overflow-button{
cursor:pointer
}
#overflowable-dim-overlay{
background:transparent
}
.overflow-popup{
box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12);
background-color:#ffffff;
left:0;
max-width:calc(100% - 32px);
position:absolute;
top:0;
visibility:hidden;
z-index:101
}
.overflow-popup ul{
list-style:none
}
.overflow-popup .tabs li,.overflow-popup li{
display:block;
height:auto
}
.overflow-popup .tabs li{
padding-left:0;
padding-right:0
}
.overflow-button.hidden,.overflow-popup .tabs li.hidden,.overflow-popup li.hidden{
display:none
}
.pill-button{
background:transparent;
border:1px solid;
border-radius:12px;
cursor:pointer;
display:inline-block;
padding:4px 16px;
text-transform:uppercase
}
.ripple{
position:relative
}
.ripple>*{
z-index:1
}
.splash-wrapper{
bottom:0;
left:0;
overflow:hidden;
pointer-events:none;
position:absolute;
right:0;
top:0;
z-index:0
}
.splash{
background:#ccc;
border-radius:100%;
display:block;
opacity:.6;
position:absolute;
-webkit-transform:scale(0);
transform:scale(0)
}
.splash.animate{
-webkit-animation:ripple-effect .4s linear;
animation:ripple-effect .4s linear
}
@-webkit-keyframes ripple-effect{
to{
opacity:0;
-webkit-transform:scale(2.5);
transform:scale(2.5)
}
}
@keyframes ripple-effect{
to{
opacity:0;
-webkit-transform:scale(2.5);
transform:scale(2.5)
}
}
.search{
display:-webkit-box;
display:flex;
line-height:24px;
width:24px
}
.search.focused,.search.focused .section{
width:100%
}
.search form{
z-index:101
}
.search h3{
display:none
}
.search form{
display:-webkit-box;
display:flex;
-webkit-box-flex:1;
flex:1 0 0;
border-bottom:1px solid transparent;
padding-bottom:8px
}
.search form>*{
display:none
}
.search.focused form>*{
display:block
}
.search .search-input label{
display:none
}
.collapsed-header .centered-top-container .search.focused form{
border-bottom-color:transparent
}
.search-expand{
-webkit-box-flex:0;
flex:0 0 auto
}
.search-expand-text{
display:none
}
.search-close{
display:inline;
vertical-align:middle
}
.search-input{
-webkit-box-flex:1;
flex:1 0 1px
}
.search-input input{
background:none;
border:0;
box-sizing:border-box;
color:#424242;
display:inline-block;
outline:none;
width:calc(100% - 48px)
}
.search-input input.no-cursor{
color:transparent;
text-shadow:0 0 0 #424242
}
.collapsed-header .centered-top-container .search-action,.collapsed-header .centered-top-container .search-input input{
color:#424242
}
.collapsed-header .centered-top-container .search-input input.no-cursor{
color:transparent;
text-shadow:0 0 0 #424242
}
.collapsed-header .centered-top-container .search-input input.no-cursor:focus,.search-input input.no-cursor:focus{
outline:none
}
.search-focused>*{
visibility:hidden
}
.search-focused .search,.search-focused .search-icon{
visibility:visible
}
.widget.Sharing .sharing-button{
display:none
}
.widget.Sharing .sharing-buttons li{
padding:0
}
.widget.Sharing .sharing-buttons li span{
display:none
}
.post-share-buttons{
position:relative
}
.sharing-open.touch-icon-button:active .touch-icon,.sharing-open.touch-icon-button:focus .touch-icon{
background-color:transparent
}
.share-buttons{
background-color:#ffffff;
border-radius:2px;
box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12);
color:#424242;
list-style:none;
margin:0;
padding:8px 0;
position:absolute;
top:-11px;
min-width:200px;
z-index:101
}
.share-buttons.hidden{
display:none
}
.sharing-button{
background:transparent;
border:0;
margin:0;
outline:none;
padding:0;
cursor:pointer
}
.share-buttons li{
margin:0;
height:48px
}
.share-buttons li:last-child{
margin-bottom:0
}
.share-buttons li .sharing-platform-button{
box-sizing:border-box;
cursor:pointer;
display:block;
height:100%;
margin-bottom:0;
padding:0 16px;
position:relative;
width:100%
}
.share-buttons li .sharing-platform-button:focus,.share-buttons li .sharing-platform-button:hover{
background-color:hsla(0,0%,50.2%,.1);
outline:none
}
.share-buttons li svg[class*=sharing-],.share-buttons li svg[class^=sharing-]{
position:absolute;
top:10px
}
.share-buttons li span.sharing-platform-button{
position:relative;
top:0
}
.share-buttons li .platform-sharing-text{
display:block;
font-size:16px;
line-height:48px;
white-space:nowrap;
margin-left:56px
}
.sidebar-container{
background-color:#ffffff;
max-width:284px;
overflow-y:auto;
-webkit-transition-property:-webkit-transform;
transition-property:-webkit-transform;
transition-property:transform;
transition-property:transform,-webkit-transform;
-webkit-transition-duration:.3s;
transition-duration:.3s;
-webkit-transition-timing-function:cubic-bezier(0,0,.2,1);
transition-timing-function:cubic-bezier(0,0,.2,1);
width:284px;
z-index:101;
-webkit-overflow-scrolling:touch
}
.sidebar-container .navigation{
line-height:0;
padding:16px
}
.sidebar-container .sidebar-back{
cursor:pointer
}
.sidebar-container .widget{
background:none;
margin:0 16px;
padding:16px 0
}
.sidebar-container .widget .title{
color:#424242;
margin:0
}
.sidebar-container .widget ul{
list-style:none;
margin:0;
padding:0
}
.sidebar-container .widget ul ul{
margin-left:1em
}
.sidebar-container .widget li{
font-size:16px;
line-height:normal
}
.sidebar-container .widget+.widget{
border-top:1px dashed #cccccc
}
.BlogArchive li{
margin:16px 0
}
.BlogArchive li:last-child{
margin-bottom:0
}
.Label li a{
display:inline-block
}
.BlogArchive .post-count,.Label .label-count{
float:right;
margin-left:.25em
}
.BlogArchive .post-count:before,.Label .label-count:before{
content:"("
}
.BlogArchive .post-count:after,.Label .label-count:after{
content:")"
}
.widget.Translate .skiptranslate>div{
display:block!important
}
.widget.Profile .profile-link{
display:-webkit-box;
display:flex
}
.widget.Profile .team-member .default-avatar-wrapper,.widget.Profile .team-member .profile-img{
-webkit-box-flex:0;
flex:0 0 auto;
margin-right:1em
}
.widget.Profile .individual .profile-link{
-webkit-box-orient:vertical;
-webkit-box-direction:normal;
flex-direction:column
}
.widget.Profile .team .profile-link .profile-name{
align-self:center;
display:block;
-webkit-box-flex:1;
flex:1 1 auto
}
.dim-overlay{
background-color:rgba(0,0,0,.54);
z-index:100
}
body.sidebar-visible{
overflow-y:hidden
}
@media screen and (max-width:1439px){
.sidebar-container{
bottom:0;
position:fixed;
top:0;
left:0;
right:auto
}
.sidebar-container.sidebar-invisible{
-webkit-transition-timing-function:cubic-bezier(.4,0,.6,1);
transition-timing-function:cubic-bezier(.4,0,.6,1);
-webkit-transform:translateX(-284px);
transform:translateX(-284px)
}
}
@media screen and (min-width:1440px){
.sidebar-container{
position:absolute;
top:0;
left:0;
right:auto
}
.sidebar-container .navigation{
display:none
}
}
.dialog{
box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12);
background:#ffffff;
box-sizing:border-box;
color:#757575;
padding:30px;
position:fixed;
text-align:center;
width:calc(100% - 24px);
z-index:101
}
.dialog input[type=email],.dialog input[type=text]{
background-color:transparent;
border:0;
border-bottom:1px solid rgba(117,117,117,.12);
color:#757575;
display:block;
font-family:Roboto, sans-serif;
font-size:16px;
line-height:24px;
margin:auto;
padding-bottom:7px;
outline:none;
text-align:center;
width:100%
}
.dialog input[type=email]::-webkit-input-placeholder,.dialog input[type=text]::-webkit-input-placeholder{
color:#757575
}
.dialog input[type=email]::-moz-placeholder,.dialog input[type=text]::-moz-placeholder{
color:#757575
}
.dialog input[type=email]:-ms-input-placeholder,.dialog input[type=text]:-ms-input-placeholder{
color:#757575
}
.dialog input[type=email]::-ms-input-placeholder,.dialog input[type=text]::-ms-input-placeholder{
color:#757575
}
.dialog input[type=email]::placeholder,.dialog input[type=text]::placeholder{
color:#757575
}
.dialog input[type=email]:focus,.dialog input[type=text]:focus{
border-bottom:2px solid #2196f3;
padding-bottom:6px
}
.dialog input.no-cursor{
color:transparent;
text-shadow:0 0 0 #757575
}
.dialog input.no-cursor:focus{
outline:none
}
.dialog input[type=submit]{
font-family:Roboto, sans-serif
}
.dialog .goog-buttonset-default{
color:#2196f3
}
.subscribe-popup{
max-width:364px
}
.subscribe-popup h3{
color:#424242;
font-size:1.8em;
margin-top:0
}
.subscribe-popup .FollowByEmail h3{
display:none
}
.subscribe-popup .FollowByEmail .follow-by-email-submit{
color:#2196f3;
display:inline-block;
margin:24px auto 0;
width:auto;
white-space:normal
}
.subscribe-popup .FollowByEmail .follow-by-email-submit:disabled{
cursor:default;
opacity:.3
}
@media (max-width:800px){
.blog-name div.widget.Subscribe{
margin-bottom:16px
}
body.item-view .blog-name div.widget.Subscribe{
margin:8px auto 16px;
width:100%
}
}
.tabs{
list-style:none
}
.tabs li,.tabs li a{
display:inline-block
}
.tabs li a{
cursor:pointer;
font-weight:700;
text-transform:uppercase;
padding:12px 8px
}
.tabs .selected{
border-bottom:4px solid #424242
}
.tabs .selected a{
color:#424242
}
body#layout .bg-photo,body#layout .bg-photo-overlay{
display:none
}
body#layout .page_body{
padding:0;
position:relative;
top:0
}
body#layout .page{
display:inline-block;
left:inherit;
position:relative;
vertical-align:top;
width:540px
}
body#layout .centered{
max-width:954px
}
body#layout .navigation{
display:none
}
body#layout .sidebar-container{
display:inline-block;
width:40%
}
body#layout .hamburger-menu,body#layout .search{
display:none
}
.centered-top-container .svg-icon-24,body.collapsed-header .centered-top-placeholder .svg-icon-24{
fill:#424242
}
.sidebar-container .svg-icon-24{
fill:#707070
}
.centered-bottom .svg-icon-24,body.collapsed-header .centered-top-container .svg-icon-24{
fill:#707070
}
.centered-bottom .share-buttons .svg-icon-24,.share-buttons .svg-icon-24{
fill:#424242
}
body{
background-color:#f4f4f4;
color:#757575;
font:15px Roboto, sans-serif;
margin:0;
min-height:100vh
}
img{
max-width:100%
}
h3{
color:#757575;
font-size:16px
}
a{
text-decoration:none;
color:#2196f3
}
a:visited{
color:#2196f3
}
a:hover{
color:#2196f3
}
blockquote{
color:#444444;
font:italic 300 15px Roboto, sans-serif;
font-size:x-large;
text-align:center
}
.pill-button{
font-size:12px
}
.bg-photo-container{
height:480px;
overflow:hidden;
position:absolute;
width:100%;
z-index:1
}
.bg-photo{
background:#f4f4f4 none repeat scroll top left;
background-attachment:scroll;
background-size:cover;
-webkit-filter:blur(0px);
filter:blur(0px);
height:calc(100% + 2 * 0px);
left:0px;
position:absolute;
top:0px;
width:calc(100% + 2 * 0px)
}
.bg-photo-overlay{
background:rgba(0, 0, 0 ,0);
background-size:cover;
height:480px;
position:absolute;
width:100%;
z-index:2
}
.hamburger-menu{
float:left;
margin-top:0
}
.sticky .hamburger-menu{
float:none;
position:absolute
}
.no-sidebar-widget .hamburger-menu{
display:none
}
.footer .widget .title{
margin:0;
line-height:24px
}
.search{
border-bottom:1px solid rgba(66, 66, 66, 0);
float:right;
position:relative;
-webkit-transition-property:width;
transition-property:width;
-webkit-transition-duration:.5s;
transition-duration:.5s;
-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);
transition-timing-function:cubic-bezier(.4,0,.2,1);
z-index:101
}
.search .dim-overlay{
background-color:transparent
}
.search form{
height:36px;
-webkit-transition:border-color .2s cubic-bezier(.4,0,.2,1) .5s;
transition:border-color .2s cubic-bezier(.4,0,.2,1) .5s
}
.search.focused{
width:calc(100% - 48px)
}
.search.focused form{
display:-webkit-box;
display:flex;
-webkit-box-flex:1;
flex:1 0 1px;
border-color:#424242;
margin-left:-24px;
padding-left:36px;
position:relative;
width:auto
}
.item-view .search,.sticky .search{
right:0;
float:none;
margin-left:0;
position:absolute
}
.item-view .search.focused,.sticky .search.focused{
width:calc(100% - 50px)
}
.item-view .search.focused form,.sticky .search.focused form{
border-bottom-color:#757575
}
.centered-top-placeholder.cloned .search form{
z-index:30
}
.search_button{
-webkit-box-flex:0;
flex:0 0 24px;
-webkit-box-orient:vertical;
-webkit-box-direction:normal;
flex-direction:column
}
.search_button svg{
margin-top:0
}
.search-input{
height:48px
}
.search-input input{
display:block;
color:#424242;
font:16px Roboto, sans-serif;
height:48px;
line-height:48px;
padding:0;
width:100%
}
.search-input input::-webkit-input-placeholder{
color:#424242;
opacity:.3
}
.search-input input::-moz-placeholder{
color:#424242;
opacity:.3
}
.search-input input:-ms-input-placeholder{
color:#424242;
opacity:.3
}
.search-input input::-ms-input-placeholder{
color:#424242;
opacity:.3
}
.search-input input::placeholder{
color:#424242;
opacity:.3
}
.search-action{
background:transparent;
border:0;
color:#424242;
cursor:pointer;
display:none;
height:48px;
margin-top:0
}
.sticky .search-action{
color:#757575
}
.search.focused .search-action{
display:block
}
.search.focused .search-action:disabled{
opacity:.3
}
.page_body{
position:relative;
z-index:20
}
.page_body .widget{
margin-bottom:16px
}
.page_body .centered{
box-sizing:border-box;
display:-webkit-box;
display:flex;
-webkit-box-orient:vertical;
-webkit-box-direction:normal;
flex-direction:column;
margin:0 auto;
max-width:922px;
min-height:100vh;
padding:24px 0
}
.page_body .centered>*{
-webkit-box-flex:0;
flex:0 0 auto
}
.page_body .centered>.footer{
margin-top:auto;
text-align:center
}
.blog-name{
margin:32px 0 16px
}
.item-view .blog-name,.sticky .blog-name{
box-sizing:border-box;
margin-left:36px;
min-height:48px;
opacity:1;
padding-top:12px
}
.blog-name .subscribe-section-container{
margin-bottom:32px;
text-align:center;
-webkit-transition-property:opacity;
transition-property:opacity;
-webkit-transition-duration:.5s;
transition-duration:.5s
}
.item-view .blog-name .subscribe-section-container,.sticky .blog-name .subscribe-section-container{
margin:0 0 8px
}
.blog-name .subscribe-empty-placeholder{
margin-bottom:48px
}
.blog-name .PageList{
margin-top:16px;
padding-top:8px;
text-align:center
}
.blog-name .PageList .overflowable-contents{
width:100%
}
.blog-name .PageList h3.title{
color:#424242;
margin:8px auto;
text-align:center;
width:100%
}
.centered-top-container .blog-name{
-webkit-transition-property:opacity;
transition-property:opacity;
-webkit-transition-duration:.5s;
transition-duration:.5s
}
.item-view .return_link{
margin-bottom:12px;
margin-top:12px;
position:absolute
}
.item-view .blog-name{
display:-webkit-box;
display:flex;
flex-wrap:wrap;
margin:0 48px 27px
}
.item-view .subscribe-section-container{
-webkit-box-flex:0;
flex:0 0 auto
}
.item-view #header,.item-view .Header{
margin-bottom:5px;
margin-right:15px
}
.item-view .sticky .Header{
margin-bottom:0
}
.item-view .Header p{
margin:10px 0 0;
text-align:left
}
.item-view .post-share-buttons-bottom{
margin-right:16px
}
.sticky{
background:#ffffff;
box-shadow:0 0 20px 0 rgba(0,0,0,.7);
box-sizing:border-box;
margin-left:0
}
.sticky #header{
margin-bottom:8px;
margin-right:8px
}
.sticky .centered-top{
margin:4px auto;
max-width:890px;
min-height:48px
}
.sticky .blog-name{
display:-webkit-box;
display:flex;
margin:0 48px
}
.sticky .blog-name #header{
-webkit-box-flex:0;
flex:0 1 auto;
-webkit-box-ordinal-group:2;
order:1;
overflow:hidden
}
.sticky .blog-name .subscribe-section-container{
-webkit-box-flex:0;
flex:0 0 auto;
-webkit-box-ordinal-group:3;
order:2
}
.sticky .Header h1{
overflow:hidden;
text-overflow:ellipsis;
white-space:nowrap;
margin-right:-10px;
margin-bottom:-10px;
padding-right:10px;
padding-bottom:10px
}
.sticky .Header p,.sticky .PageList{
display:none
}
.search-focused .hamburger-menu,.search-focused>*{
visibility:visible
}
.item-view .search-focused .blog-name,.sticky .search-focused .blog-name{
opacity:0
}
.centered-bottom,.centered-top-container,.centered-top-placeholder{
padding:0 16px
}
.centered-top{
position:relative
}
.item-view .centered-top.search-focused .subscribe-section-container,.sticky .centered-top.search-focused .subscribe-section-container{
opacity:0
}
.page_body.has-vertical-ads .centered .centered-bottom{
display:inline-block;
width:calc(100% - 176px)
}
.Header h1{
font:bold 45px Roboto, sans-serif;
line-height:normal;
margin:0 0 13px;
text-align:center;
width:100%
}
.Header h1,.Header h1 a,.Header h1 a:hover,.Header h1 a:visited{
color:#424242
}
.item-view .Header h1,.sticky .Header h1{
font-size:24px;
line-height:24px;
margin:0;
text-align:left
}
.sticky .Header h1,.sticky .Header h1 a,.sticky .Header h1 a:hover,.sticky .Header h1 a:visited{
color:#757575
}
.Header p{
color:#424242;
margin:0 0 13px;
opacity:.8;
text-align:center
}
.widget .title{
line-height:28px
}
.BlogArchive li{
font-size:16px
}
.BlogArchive .post-count{
color:#757575
}
#page_body .FeaturedPost,.Blog .blog-posts .post-outer-container{
background:#ffffff;
min-height:40px;
padding:30px 40px;
width:auto;
box-shadow:0 1px 4px 0 rgba(60, 64, 67, 0.30)
}
.Blog .blog-posts .post-outer-container:last-child{
margin-bottom:0
}
.Blog .blog-posts .post-outer-container .post-outer{
border:0;
position:relative;
padding-bottom:.25em
}
.post-outer-container{
margin-bottom:16px
}
.post:first-child{
margin-top:0
}
.post .thumb{
float:left;
height:20%;
width:20%
}
.post-share-buttons-bottom,.post-share-buttons-top{
float:right
}
.post-share-buttons-bottom{
margin-right:24px
}
.post-footer,.post-header{
clear:left;
color:rgba(0, 0, 0, 0.54);
margin:0;
width:inherit
}
.blog-pager{
text-align:center
}
.blog-pager a{
color:#2196f3
}
.blog-pager a:visited{
color:#2196f3
}
.blog-pager a:hover{
color:#2196f3
}
.post-title{
font:bold 22px Roboto, sans-serif;
float:left;
margin:0 0 8px;
max-width:calc(100% - 48px)
}
.post-title a{
font:bold 30px Roboto, sans-serif
}
.post-title,.post-title a,.post-title a:hover,.post-title a:visited{
color:#424242
}
.post-body{
color:#757575;
font:15px Roboto, sans-serif;
line-height:1.6em;
margin:1.5em 0 2em;
display:block
}
.post-body img{
height:inherit
}
.post-body .snippet-thumbnail{
float:left;
margin:0;
margin-right:2em;
max-height:128px;
max-width:128px
}
.post-body .snippet-thumbnail img{
max-width:100%
}
.main .FeaturedPost .widget-content{
border:0;
position:relative;
padding-bottom:.25em
}
.FeaturedPost img{
margin-top:2em
}
.FeaturedPost .snippet-container{
margin:2em 0
}
.FeaturedPost .snippet-container p{
margin:0
}
.FeaturedPost .snippet-thumbnail{
float:none;
height:auto;
margin-bottom:2em;
margin-right:0;
overflow:hidden;
max-height:calc(600px + 2em);
max-width:100%;
text-align:center;
width:100%
}
.FeaturedPost .snippet-thumbnail img{
max-width:100%;
width:100%
}
.byline{
color:rgba(0, 0, 0, 0.54);
display:inline-block;
line-height:24px;
margin-top:8px;
vertical-align:top
}
.byline.post-author:first-child{
margin-right:0
}
.byline.reactions .reactions-label{
line-height:22px;
vertical-align:top
}
.byline.post-share-buttons{
position:relative;
display:inline-block;
margin-top:0;
width:100%
}
.byline.post-share-buttons .sharing{
float:right
}
.flat-button.ripple:hover{
background-color:rgba(33,150,243,.12)
}
.flat-button.ripple .splash{
background-color:rgba(33,150,243,.4)
}
a.timestamp-link,a:active.timestamp-link,a:visited.timestamp-link{
color:inherit;
font:inherit;
text-decoration:inherit
}
.post-share-buttons{
margin-left:0
}
.post-share-buttons.invisible{
display:none
}
.clear-sharing{
min-height:24px
}
.comment-link{
color:#2196f3;
position:relative
}
.comment-link .num_comments{
margin-left:8px;
vertical-align:top
}
#comment-holder .continue{
display:none
}
#comment-editor{
margin-bottom:20px;
margin-top:20px
}
#comments .comment-form h4,#comments h3.title{
position:absolute;
clip:rect(1px,1px,1px,1px);
padding:0;
border:0;
height:1px;
width:1px;
overflow:hidden
}
.post-filter-message{
background-color:rgba(0,0,0,.7);
color:#fff;
display:table;
margin-bottom:16px;
width:100%
}
.post-filter-message div{
display:table-cell;
padding:15px 28px
}
.post-filter-message div:last-child{
padding-left:0;
text-align:right
}
.post-filter-message a{
white-space:nowrap
}
.post-filter-message .search-label,.post-filter-message .search-query{
font-weight:700;
color:#2196f3
}
#blog-pager{
margin:2em 0
}
#blog-pager a{
color:#2196f3;
font-size:14px
}
.subscribe-button{
border-color:#424242;
color:#424242
}
.sticky .subscribe-button{
border-color:#757575;
color:#757575
}
.tabs{
margin:0 auto;
padding:0
}
.tabs li{
margin:0 8px;
vertical-align:top
}
.tabs .overflow-button a,.tabs li a{
color:#757575;
font:700 normal 15px Roboto, sans-serif;
line-height:18px
}
.tabs .overflow-button a{
padding:12px 8px
}
.overflow-popup .tabs li{
text-align:left
}
.overflow-popup li a{
color:#757575;
display:block;
padding:8px 20px
}
.overflow-popup li.selected a{
color:#424242
}
.ReportAbuse.widget{
margin-bottom:0
}
.ReportAbuse a.report_abuse{
display:inline-block;
margin-bottom:8px;
font:15px Roboto, sans-serif;
font-weight:400;
line-height:24px
}
.ReportAbuse a.report_abuse,.ReportAbuse a.report_abuse:hover{
color:#888
}
.byline.post-labels a,.Label li,.Label span.label-size{
background-color:#f7f7f7;
border:1px solid #f7f7f7;
border-radius:15px;
display:inline-block;
margin:4px 4px 4px 0;
padding:3px 8px
}
.byline.post-labels a,.Label a{
color:#2196f3
}
.Label ul{
list-style:none;
padding:0
}
.PopularPosts{
background-color:#f4f4f4;
padding:30px 40px
}
.PopularPosts .item-content{
color:#757575;
margin-top:24px
}
.PopularPosts a,.PopularPosts a:hover,.PopularPosts a:visited{
color:#2196f3
}
.PopularPosts .post-title,.PopularPosts .post-title a,.PopularPosts .post-title a:hover,.PopularPosts .post-title a:visited{
color:#424242;
font-size:18px;
font-weight:700;
line-height:24px
}
.PopularPosts,.PopularPosts h3.title a{
color:#757575;
font:15px Roboto, sans-serif
}
.main .PopularPosts{
padding:16px 40px
}
.PopularPosts h3.title{
font-size:14px;
margin:0
}
.PopularPosts h3.post-title{
margin-bottom:0
}
.PopularPosts .byline{
color:rgba(0, 0, 0, 0.54)
}
.PopularPosts .jump-link{
float:right;
margin-top:16px
}
.PopularPosts .post-header .byline{
font-size:.9em;
font-style:italic;
margin-top:6px
}
.PopularPosts ul{
list-style:none;
padding:0;
margin:0
}
.PopularPosts .post{
padding:20px 0
}
.PopularPosts .post+.post{
border-top:1px dashed #cccccc
}
.PopularPosts .item-thumbnail{
float:left;
margin-right:32px
}
.PopularPosts .item-thumbnail img{
height:88px;
padding:0;
width:88px
}
.inline-ad{
margin-bottom:16px
}
.desktop-ad .inline-ad{
display:block
}
.adsbygoogle{
overflow:hidden
}
.vertical-ad-container{
float:right;
margin-right:16px;
width:128px
}
.vertical-ad-container .AdSense+.AdSense{
margin-top:16px
}
.inline-ad-placeholder,.vertical-ad-placeholder{
background:#ffffff;
border:1px solid #000;
opacity:.9;
vertical-align:middle;
text-align:center
}
.inline-ad-placeholder span,.vertical-ad-placeholder span{
margin-top:290px;
display:block;
text-transform:uppercase;
font-weight:700;
color:#424242
}
.vertical-ad-placeholder{
height:600px
}
.vertical-ad-placeholder span{
margin-top:290px;
padding:0 40px
}
.inline-ad-placeholder{
height:90px
}
.inline-ad-placeholder span{
margin-top:36px
}
.Attribution{
display:inline-block;
color:#757575
}
.Attribution a,.Attribution a:hover,.Attribution a:visited{
color:#2196f3
}
.Attribution svg{
display:none
}
.sidebar-container{
box-shadow:1px 1px 3px rgba(0,0,0,.1)
}
.sidebar-container,.sidebar-container .sidebar_bottom{
background-color:#ffffff
}
.sidebar-container .navigation,.sidebar-container .sidebar_top_wrapper{
background-color:#f7f7f7
}
.sidebar-container .sidebar_top{
overflow:auto
}
.sidebar-container .sidebar_bottom{
width:100%;
padding-top:16px
}
.sidebar-container .widget:first-child{
padding-top:0
}
.no-sidebar-widget .sidebar-container,.preview .sidebar-container{
display:none
}
.sidebar_top .widget.Profile{
padding-bottom:16px
}
.widget.Profile{
margin:0;
width:100%
}
.widget.Profile h2{
display:none
}
.widget.Profile h3.title{
color:rgba(0,0,0,0.52);
margin:16px 32px
}
.widget.Profile .individual{
text-align:center
}
.widget.Profile .individual .profile-link{
padding:1em
}
.widget.Profile .individual .default-avatar-wrapper .avatar-icon{
margin:auto
}
.widget.Profile .team{
margin-bottom:32px;
margin-left:32px;
margin-right:32px
}
.widget.Profile ul{
list-style:none;
padding:0
}
.widget.Profile li{
margin:10px 0
}
.widget.Profile .profile-img{
border-radius:50%;
float:none
}
.widget.Profile .profile-link{
color:#424242;
font-size:.9em;
margin-bottom:1em;
opacity:.87;
overflow:hidden
}
.widget.Profile .profile-link.visit-profile{
border-style:solid;
border-width:1px;
border-radius:12px;
cursor:pointer;
font-size:12px;
font-weight:400;
padding:5px 20px;
display:inline-block;
line-height:normal
}
.widget.Profile dd{
color:rgba(0, 0, 0, 0.54);
margin:0 16px
}
.widget.Profile location{
margin-bottom:1em
}
.widget.Profile .profile-textblock{
font-size:14px;
line-height:24px;
position:relative
}
body.sidebar-visible .bg-photo-container,body.sidebar-visible .page_body{
overflow-y:scroll
}
@media screen and (min-width:1440px){
.sidebar-container{
min-height:100%;
overflow:visible;
z-index:32
}
.sidebar-container.show-sidebar-top{
margin-top:480px;
min-height:calc(100% - 480px)
}
.sidebar-container .sidebar_top_wrapper{
background-color:rgba(255, 255, 255, 1);
height:480px;
margin-top:-480px
}
.sidebar-container .sidebar_top{
height:480px;
max-height:480px
}
.sidebar-container .sidebar_bottom{
max-width:284px;
width:284px
}
body.collapsed-header .sidebar-container{
z-index:15
}
.sidebar-container .sidebar_top:empty{
display:none
}
.sidebar-container .sidebar_top>:only-child{
-webkit-box-flex:0;
flex:0 0 auto;
align-self:center;
width:100%
}
.sidebar_top_wrapper.no-items{
display:none
}
}
.post-snippet.snippet-container{
max-height:120px
}
.post-snippet .snippet-item{
line-height:24px
}
.post-snippet .snippet-fade{
background:-webkit-linear-gradient(left,#ffffff 0,#ffffff 20%,rgba(255, 255, 255, 0) 100%);
background:linear-gradient(to left,#ffffff 0,#ffffff 20%,rgba(255, 255, 255, 0) 100%);
color:#757575;
height:24px
}
.popular-posts-snippet.snippet-container{
max-height:72px
}
.popular-posts-snippet .snippet-item{
line-height:24px
}
.PopularPosts .popular-posts-snippet .snippet-fade{
color:#757575;
height:24px
}
.main .popular-posts-snippet .snippet-fade{
background:-webkit-linear-gradient(left,#f4f4f4 0,#f4f4f4 20%,rgba(244, 244, 244, 0) 100%);
background:linear-gradient(to left,#f4f4f4 0,#f4f4f4 20%,rgba(244, 244, 244, 0) 100%)
}
.sidebar_bottom .popular-posts-snippet .snippet-fade{
background:-webkit-linear-gradient(left,#ffffff 0,#ffffff 20%,rgba(255, 255, 255, 0) 100%);
background:linear-gradient(to left,#ffffff 0,#ffffff 20%,rgba(255, 255, 255, 0) 100%)
}
.profile-snippet.snippet-container{
max-height:192px
}
.has-location .profile-snippet.snippet-container{
max-height:144px
}
.profile-snippet .snippet-item{
line-height:24px
}
.profile-snippet .snippet-fade{
background:-webkit-linear-gradient(left,#f7f7f7 0,#f7f7f7 20%,rgba(247, 247, 247, 0) 100%);
background:linear-gradient(to left,#f7f7f7 0,#f7f7f7 20%,rgba(247, 247, 247, 0) 100%);
color:rgba(0, 0, 0, 0.54);
height:24px
}
@media screen and (min-width:1440px){
.profile-snippet .snippet-fade{
background:-webkit-linear-gradient(left,rgba(255, 255, 255, 1) 0,rgba(255, 255, 255, 1) 20%,rgba(255, 255, 255, 0) 100%);
background:linear-gradient(to left,rgba(255, 255, 255, 1) 0,rgba(255, 255, 255, 1) 20%,rgba(255, 255, 255, 0) 100%)
}
}
@media screen and (max-width:800px){
.blog-name{
margin-top:0
}
body.item-view .blog-name{
margin:0 48px
}
.blog-name .subscribe-empty-placeholder{
margin-bottom:0
}
.centered-bottom{
padding:8px
}
body.item-view .centered-bottom{
padding:0
}
body.item-view #header,body.item-view .widget.Header{
margin-right:0
}
body.collapsed-header .centered-top-container .blog-name{
display:block
}
body.collapsed-header .centered-top-container .widget.Header h1{
text-align:center
}
.widget.Header header{
padding:0
}
.widget.Header h1{
font-size:$(blog.title.font.size * 24/45);
line-height:$(blog.title.font.size * 24/45);
margin-bottom:13px
}
body.item-view .widget.Header h1,body.item-view .widget.Header p{
text-align:center
}
.blog-name .widget.PageList{
padding:0
}
body.item-view .centered-top{
margin-bottom:5px
}
.search-action,.search-input{
margin-bottom:-8px
}
.search form{
margin-bottom:8px
}
body.item-view .subscribe-section-container{
margin:5px 0 0;
width:100%
}
#page_body.section div.widget.FeaturedPost,.widget.Blog .blog-posts .post-outer-container,.widget.PopularPosts{
padding:16px
}
.widget.Blog .blog-posts .post-outer-container .post-outer{
padding:0
}
.post:first-child{
margin:0
}
.post-body .snippet-thumbnail{
margin:0 3vw 3vw 0
}
.post-body .snippet-thumbnail img{
height:20vw;
width:20vw;
max-height:128px;
max-width:128px
}
.widget.PopularPosts div.item-thumbnail{
margin:0 3vw 3vw 0
}
.widget.PopularPosts div.item-thumbnail img{
height:20vw;
width:20vw;
max-height:88px;
max-width:88px
}
.post-title{
line-height:1
}
.post-title,.post-title a{
font-size:20px
}
#page_body.section div.widget.FeaturedPost h3 a{
font-size:22px
}
.mobile-ad .inline-ad{
display:block
}
.page_body.has-vertical-ads .vertical-ad-container,.page_body.has-vertical-ads .vertical-ad-container ins{
display:none
}
.page_body.has-vertical-ads .centered .centered-bottom,.page_body.has-vertical-ads .centered .centered-top{
display:block;
width:auto
}
.post-filter-message div{
padding:8px 16px
}
}
@media screen and (min-width:1440px){
body{
position:relative
}
body.item-view .blog-name{
margin-left:48px
}
.no-sidebar-widget .page_body,.preview .page_body{
margin-left:0
}
.page_body{
margin-left:284px
}
.search{
margin-left:0
}
.search.focused{
width:100%
}
.sticky{
padding-left:284px
}
.hamburger-menu{
display:none
}
body.collapsed-header .page_body .centered-top-container{
padding-left:284px;
padding-right:0;
width:100%
}
body.collapsed-header .centered-top-container .search.focused{
width:100%
}
body.collapsed-header .centered-top-container .blog-name{
margin-left:0
}
body.collapsed-header.item-view .centered-top-container .search.focused{
width:calc(100% - 50px)
}
body.collapsed-header.item-view .centered-top-container .blog-name{
margin-left:40px
}
}

--></style>
<style id="template-skin-1" type="text/css"><!--
body#layout .hidden,
body#layout .invisible {
display: inherit;
}
body#layout .navigation {
display: none;
}
body#layout .page,
body#layout .sidebar_top,
body#layout .sidebar_bottom {
display: inline-block;
left: inherit;
position: relative;
vertical-align: top;
}
body#layout .page {
float: right;
margin-left: 20px;
width: 55%;
}
body#layout .sidebar-container {
float: right;
width: 40%;
}
body#layout .hamburger-menu {
display: none;
}
--></style>
<script async="async" src="https://www.gstatic.com/external_hosted/clipboardjs/clipboard.min.js"></script>
<link href="https://www.blogger.com/dyn-css/authorization.css?targetBlogID=1185007328368910714&amp;zx=d2b54125-7010-4adc-9043-d045391de1c7" media="all" onload="if(media!='all')media='all'" rel="stylesheet"><noscript><link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=1185007328368910714&amp;zx=d2b54125-7010-4adc-9043-d045391de1c7' rel='stylesheet'/></noscript>
<meta name="google-adsense-platform-account" content="ca-host-pub-1556223355139109">
<meta name="google-adsense-platform-domain" content="blogspot.com">

<script type="text/javascript" language="javascript">
  // Supply ads personalization default for EEA readers
  // See https://www.blogger.com/go/adspersonalization
  adsbygoogle = window.adsbygoogle || [];
  if (typeof adsbygoogle.requestNonPersonalizedAds === 'undefined') {
    adsbygoogle.requestNonPersonalizedAds = 1;
  }
</script>


<link rel="stylesheet" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Times">

<a class="skip-navigation" href="#main" tabindex="0">
Skip to main content
</a>
<div class="page">
<div class="bg-photo-overlay"></div>
<div class="bg-photo-container">
<div class="bg-photo"></div>
</div>
<div class="page_body">
<div class="centered">
<div class="centered-top-placeholder"></div>
<header class="centered-top-container" role="banner">
<div class="centered-top">
<a class="return_link" href="https://splintercod3.blogspot.com/">
<button class="svg-icon-24-button back-button rtl-reversible-icon flat-icon-button ripple">
<svg class="svg-icon-24">
<use xlink:href="/responsive/sprite_v1_6.css.svg#ic_arrow_back_black_24dp" xmlns:xlink="http://www.w3.org/1999/xlink"></use>
</svg>
</button>
</a>
<div class="clearboth"></div>
<div class="blog-name container">
<div class="container section" id="header" name="Header"><div class="widget Header" data-version="2" id="Header1">
<div class="header-widget">
<div>
<h1>
<a href="https://splintercod3.blogspot.com/">
splinter_code blog
</a>
</h1>
</div>
<p>
</p>
</div>
</div></div>
<div class="subscribe-empty-placeholder"></div>
<nav role="navigation">
<div class="clearboth section" id="page_list_top" name="Page list (top)"><div class="widget PageList" data-version="2" id="PageList1">
<div class="widget-content">
<div class="overflowable-container overflowable-2">
<div class="overflowable-contents">
<div class="container">
<ul class="tabs">
<li class="overflowable-item" aria-hidden="false">
<a href="https://splintercod3.blogspot.com/">Home</a>
</li>
<li class="overflowable-item" aria-hidden="false">
<a href="https://splintercod3.blogspot.com/p/blog-page_7.html">Posts</a>
</li>
<li class="overflowable-item" aria-hidden="false">
<a href="https://splintercod3.blogspot.com/p/talks.html">Talks</a>
</li>
<li class="overflowable-item" aria-hidden="false">
<a href="https://splintercod3.blogspot.com/p/tools.html">Tools</a>
</li>
<li class="overflowable-item" aria-hidden="false">
<a href="https://splintercod3.blogspot.com/p/blog-page.html">whoami</a>
</li>
<li class="overflow-button-container" style="display: none;" aria-hidden="true"><div class="overflow-button">
<a>More…</a>
</div></li><li class="overflowable-item" aria-hidden="false">
<a href="https://raw.githubusercontent.com/antonioCoco/antoniococo.github.io/master/rss.xml">RSS Feed</a>
</li>
</ul>
</div>
</div><div class="overflowable-backup" aria-hidden="true" style="position: absolute; visibility: hidden; inset: 0px;"><div class="overflowable-contents overflowable-backup-content">
<div class="container">
<ul class="tabs">
<li class="overflowable-item">
<a href="https://splintercod3.blogspot.com/">Home</a>
</li>
<li class="overflowable-item">
<a href="https://splintercod3.blogspot.com/p/blog-page_7.html">Posts</a>
</li>
<li class="overflowable-item">
<a href="https://splintercod3.blogspot.com/p/talks.html">Talks</a>
</li>
<li class="overflowable-item">
<a href="https://splintercod3.blogspot.com/p/tools.html">Tools</a>
</li>
<li class="overflowable-item">
<a href="https://splintercod3.blogspot.com/p/blog-page.html">whoami</a>
</li>
<li class="overflowable-item">
<a href="https://raw.githubusercontent.com/antonioCoco/antoniococo.github.io/master/rss.xml">RSS Feed</a>
</li>
</ul>
</div>
</div></div>

</div><div class="overflow-popup" style="display: none;">
<div class="container">
<ul class="tabs">
<li class="overflowable-item">
<a href="https://splintercod3.blogspot.com/">Home</a>
</li>
<li class="overflowable-item">
<a href="https://splintercod3.blogspot.com/p/blog-page_7.html">Posts</a>
</li>
<li class="overflowable-item">
<a href="https://splintercod3.blogspot.com/p/talks.html">Talks</a>
</li>
<li class="overflowable-item">
<a href="https://splintercod3.blogspot.com/p/tools.html">Tools</a>
</li>
<li class="overflowable-item">
<a href="https://splintercod3.blogspot.com/p/blog-page.html">whoami</a>
</li>
<li class="overflowable-item">
<a href="https://raw.githubusercontent.com/antonioCoco/antoniococo.github.io/master/rss.xml">RSS Feed</a>
</li>
</ul>
</div>
</div>
</div>
</div></div>
</nav>
</div>
</div>
</header>
<div>
<div class="vertical-ad-container no-items section" id="ads" name="Ads">
</div>
<main class="centered-bottom" id="main" role="main" tabindex="-1">
<div class="main section" id="page_body" name="Page body">
<div class="widget Blog" data-version="2" id="Blog1">
<div class="blog-posts hfeed container">
<article class="post-outer-container">
<div class="post-outer">
<div class="post">
<script type="application/ld+json">{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://splintercod3.blogspot.com/p/bypassing-uac-with-sspi-datagram.html"
  },
  "headline": "Bypassing UAC with SSPI Datagram Contexts","description": "by splinter_code - 14 September 2023 Recently i had the opportunity to read through some of my old repos because i wanted to reuse some code...","datePublished": "2023-09-14T20:49:00+02:00",
  "dateModified": "2024-01-11T01:25:33+01:00","image": {
    "@type": "ImageObject","url": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHatC0V08ZrzJ89M8WsX2LRa6VB8h63QM9_2Nv_YEUthJjL1B2FUMMRjSJLUDfIJnvvlG3htwHNXGYrD4_id9CXc0vCYiknSl_mNjAwDTHCAtL1fbbGGQNjyonPDrpLgr8Cd8hMRZC9b5s4vimx0b2mLTLm8w63lHIoVOm9EWpeTaSuscXgfODPuikkVw/w1200-h630-p-k-no-nu/spiderman.jpg",
    "height": 630,
    "width": 1200},"publisher": {
    "@type": "Organization",
    "name": "Blogger",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blogger.googleusercontent.com/img/b/U2hvZWJveA/AVvXsEgfMvYAhAbdHksiBA24JKmb2Tav6K0GviwztID3Cq4VpV96HaJfy0viIu8z1SSw_G9n5FQHZWSRao61M3e58ImahqBtr7LiOUS6m_w59IvDYwjmMcbq3fKW4JSbacqkbxTo8B90dWp0Cese92xfLMPe_tg11g/h60/",
      "width": 206,
      "height": 60
    }
  },"author": {
    "@type": "Person",
    "name": "splintercode"
  }
}</script>
<a name="5186984517398909181"></a>
<h3 class="post-title entry-title">
Bypassing UAC with SSPI Datagram Contexts
</h3>
<div class="post-header">
<div class="post-header-line-1">
</div>
</div>
<div class="post-body entry-content float-container" id="post-body-5186984517398909181">
<p><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 14pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">by splinter_code - 14 September 2023</span></p><br><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHatC0V08ZrzJ89M8WsX2LRa6VB8h63QM9_2Nv_YEUthJjL1B2FUMMRjSJLUDfIJnvvlG3htwHNXGYrD4_id9CXc0vCYiknSl_mNjAwDTHCAtL1fbbGGQNjyonPDrpLgr8Cd8hMRZC9b5s4vimx0b2mLTLm8w63lHIoVOm9EWpeTaSuscXgfODPuikkVw/s544/spiderman.jpg" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="500" data-original-width="544" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHatC0V08ZrzJ89M8WsX2LRa6VB8h63QM9_2Nv_YEUthJjL1B2FUMMRjSJLUDfIJnvvlG3htwHNXGYrD4_id9CXc0vCYiknSl_mNjAwDTHCAtL1fbbGGQNjyonPDrpLgr8Cd8hMRZC9b5s4vimx0b2mLTLm8w63lHIoVOm9EWpeTaSuscXgfODPuikkVw/s16000/spiderman.jpg"></a></div><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><br></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Recently i had the opportunity to read through some of my old repos because i wanted to reuse some code i used for a </span><a href="https://download.microsoft.com/download/8/C/D/8CD015BB-081B-49C5-A506-9C9B570B8DD2/UIPI.pptx" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">UIPI</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> </span><a href="https://www.tiraniddo.dev/2019/02/accessing-access-tokens-for-uiaccess.html" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">bypass</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> in the past, aiming to adapt it to a new </span><a href="https://twitter.com/splinter_code/status/1695839278176108735" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">hidden feature of the task manager</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> for a sneaky and </span><a href="https://twitter.com/splinter_code/status/1696339966119268626" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">for-fun UAC bypass</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Luckily, i stumbled upon another UAC related project (a 2 years old project) in which i tried to implement an idea to bypass UAC through some particular </span><a href="https://learn.microsoft.com/en-us/windows-server/security/windows-authentication/security-support-provider-interface-architecture" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">SSPI</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> configurations, but i failed miserably that time.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Upon re-reading the code, a light bulb came to my mind so i tried a different exploitation path and it ended up with a new cool <b>UAC bypass</b>! So let’s jump straight to it 👇

</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 14pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;"></span></p><h2>UAC: User Account Control (formerly LUA - Limited User Account)</h2><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">To provide some context, </span><a href="https://learn.microsoft.com/en-us/windows/security/application-security/application-control/user-account-control/" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">UAC (User Account Control)</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> is an elevation mechanism within Windows designed to trigger a <b>consent</b> prompt when an action requires administrative privileges. This consent prompt is intended to enforce <b>privilege separation</b> by requiring administrator approval.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">While designed to add an extra layer of security against unauthorized OS changes, it has been proven to be a full of holes design. </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">There are many <b>known</b> ways to bypass UAC and perform actions with elevated privileges without any prompt or consent provided interactively by the user.&nbsp;</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">You can consult </span><a href="https://github.com/hfiref0x/UACME" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">UACMe</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> for a curated list and related source code of known UAC bypasses (fixed and unfixed 🙈).&nbsp;</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">I bet you have encountered this screen at some point. Yep, that's the UAC consent prompt for you:</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><br></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjnGkvjKRcsLSsoeadtfygLP4MXGMAY-LyWHx7ZQezx-RyWOHxd_hrts-KnzyT6hoaBPCOxLtip1FHcctu_dsaItjDzuIbFEq8eRJud9goA1cDcuqU6so8ZGvyu5WsFGilicAVw4ea2jRd7_mzVT8DvB_BYkahJyFavn7BDrIAbthuNEq80uU1h-Nfn_xI/s467/uac_prompt.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="332" data-original-width="467" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjnGkvjKRcsLSsoeadtfygLP4MXGMAY-LyWHx7ZQezx-RyWOHxd_hrts-KnzyT6hoaBPCOxLtip1FHcctu_dsaItjDzuIbFEq8eRJud9goA1cDcuqU6so8ZGvyu5WsFGilicAVw4ea2jRd7_mzVT8DvB_BYkahJyFavn7BDrIAbthuNEq80uU1h-Nfn_xI/s16000/uac_prompt.png"></a></div><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><br></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">In this post i’m not going to detail the internal working of UAC, but if you are interested in knowing more there is already a lot of research about it. You can find some comprehensive talks and blog posts in the </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">References</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> section.

</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 14pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;"></span></p><h2>An interesting behavior in NTLM authentications</h2><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">In Windows exists the fantastic concept of “type your password once and authenticate everywhere”. This is the same basic concept as any Single Sign-On system but integrated directly into the operating system.</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">In order for this to work someone has to store your passwords and that’s where the </span><a href="https://learn.microsoft.com/en-us/windows/win32/secauthn/lsa-authentication" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;"><b>LSA</b></span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> comes into play. It provides a layer of abstraction for any related authentication happening on your system.</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Without going into the deep details, what you need to know is that the LSA (implemented in <b>lsass.exe</b>) loads <b>authentication packages</b> DLLs by using configuration information stored in the registry. Loading multiple authentication packages permits the LSA to support multiple security protocols, e.g. </span><a href="https://learn.microsoft.com/en-us/windows/win32/secauthn/msv1-0-authentication-package" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">NTLM</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">, </span><a href="https://learn.microsoft.com/en-us/windows/win32/secauthn/kerberos-ssp-ap" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">Kerberos</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> and so on…&nbsp;</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">When you log on interactively, the LSA creates a new <b>logon session</b>, associates it with your credentials, and creates a <b>token</b> for your process that references this newly created logon session.</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">In this way, when your process tries to access a remote resource, let’s say </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">\\SHARE-SERVER\share1\file.txt</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">, your process can invoke the </span><a href="https://learn.microsoft.com/en-us/windows/win32/secauthn/authentication-functions#context-management" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">SSPI functions</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> to retrieve the <b>security buffers</b> to send over the network wire and the authentication is abstracted from the application logic without the needs of providing explicit credentials. </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">What happens under the hood is that when your application invokes the SSPI functions, it communicates with lsass.exe, which in turn will inspect your process (or thread if impersonating) token and will be able to associate your right <b>credentials</b> and derive the proper authentication buffers that your process can use for the authentication.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">This is an oversimplified explanation, but hopefully you got the point.</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">When <b>network authentication</b> takes place, UAC restrictions don't affect the generated token. </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">There are 2 exceptions to this rule:</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"></span></p><ul style="margin-bottom: 0px; margin-top: 0px; padding-inline-start: 48px;"><li aria-level="1" dir="ltr" style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; list-style-type: disc; vertical-align: baseline; white-space: pre;"><p dir="ltr" role="presentation" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-wrap: wrap; vertical-align: baseline;">if you're authenticating to a remote machine using a <b>shared local administrator</b> account (except built-in Administrator);</span></p></li><li aria-level="1" dir="ltr" style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; list-style-type: disc; vertical-align: baseline; white-space: pre;"><p dir="ltr" role="presentation" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-wrap: wrap; vertical-align: baseline;">if you are doing a <b>loopback authentication</b> without SPPI and using a local administrator user.
You need to know the password or at least the hash of the user.</span></p></li></ul><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Only in these cases </span><a href="https://learn.microsoft.com/en-us/troubleshoot/windows-server/windows-security/user-account-control-and-remote-restriction#how-uac-remote-restrictions-work" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">UAC Remote restrictions</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> kick in. </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">These restrictions will limit also the token generated by the network authentication on the server end if </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">LocalAccountTokenFilterPolicy</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> is set to 0, which is the default configuration.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Instead, if you use a domain user which is also an administrator of the machine, UAC won’t get in the way:</span></p><br><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhVpBv7_QKZ6-5POOGEf2SZ9bX2BewUMsyguCHH0PWw2rw7UEFjN6Z_X3p3gz8fsdumy9XJab1w57xi10r_Z5C1JHjtw8ZGB5wYkpLwH2hKzsDLQNFjo7kvKhWbgRknPRl2Yo3hyphenhyphenxxRBu_v2N8KJcJgG9s3jMmL4jR-GLwcDra-53YCqIlIDW_KUaMsWHY/s936/uac_remote_restrictions.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="177" data-original-width="936" height="122" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhVpBv7_QKZ6-5POOGEf2SZ9bX2BewUMsyguCHH0PWw2rw7UEFjN6Z_X3p3gz8fsdumy9XJab1w57xi10r_Z5C1JHjtw8ZGB5wYkpLwH2hKzsDLQNFjo7kvKhWbgRknPRl2Yo3hyphenhyphenxxRBu_v2N8KJcJgG9s3jMmL4jR-GLwcDra-53YCqIlIDW_KUaMsWHY/w640-h122/uac_remote_restrictions.png" width="640"></a></div><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><a href="https://learn.microsoft.com/en-us/troubleshoot/windows-server/windows-security/user-account-control-and-remote-restriction#how-uac-remote-restrictions-work" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 10pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">UAC Remote restrictions</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 10pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> for domain users</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">The main mechanism that is preventing anyone from getting around UAC locally through SSPI is </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">Local Authentication</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">.</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">To understand it, let’s take out of the equation the local authentication with Kerberos and focus on <b>NTLM</b>. </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">(NOTE: </span><a href="https://twitter.com/tiraniddo" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">James Forshaw</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> already demonstrated how UAC restrictions over Kerberos can be bypassed locally in this </span><a href="https://www.tiraniddo.dev/2022/03/bypassing-uac-in-most-complex-way.html" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">blogpost</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">)</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">If you are familiar with NTLM authentications, you can identify a </span><a href="https://davenport.sourceforge.net/ntlm.html#localAuthentication" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">local authentication</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> by observing these details in the messages exchange:</span></p><ul style="margin-bottom: 0px; margin-top: 0px; padding-inline-start: 48px;"><li aria-level="1" dir="ltr" style="font-family: Arial, sans-serif; font-size: 11pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; list-style-type: disc; vertical-align: baseline; white-space: pre;"><p dir="ltr" role="presentation" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-wrap: wrap; vertical-align: baseline;">The server sets the “<b>Negotiate Local Call</b>” flag in the Challenge message (Type 2);</span></p></li><li aria-level="1" dir="ltr" style="font-family: Arial, sans-serif; font-size: 11pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; list-style-type: disc; vertical-align: baseline; white-space: pre;"><p dir="ltr" role="presentation" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-wrap: wrap; vertical-align: baseline;">The “<b>Reserved</b>” field in the Challenge message is not 0 and contains a number referencing the server context handle;</span></p></li><li aria-level="1" dir="ltr" style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; list-style-type: disc; vertical-align: baseline; white-space: pre;"><p dir="ltr" role="presentation" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-wrap: wrap; vertical-align: baseline;">The generated Authenticate message (Type 3) by the client contains <b>empty </b>security buffers;</span></p></li></ul><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">When this occurs, LSASS is able to associate the calling process's <b>actual token </b>with the server application's security context. As a result, any UAC restrictions on the client side become visible to the server application.</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Ok, enough theory. Let’s see the differences in the token when doing a local vs remote NTLM authentication </span><a href="https://learn.microsoft.com/en-us/windows/win32/secauthn/sample-sspi-code" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">through SSPI</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">:</span></p><br><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEihS9XP2wucP3bxPzBwZxP04lsb6npCU_uEiqdqNLIH3QK9485xHdW3X1VEzwsyuzYONuom-VNQ8V3F_9odR4Lk3MabkVJ6SV0EVUAzGifIAUgvx_32BONjQu3qsCtdhuibSPEgl_P-qv8ry0Py78UgBbdpy3TaoihexMwiw0otjmbheiSMtbB5FpNMBHY/s1142/local_vs_remote_auth_token.PNG" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="569" data-original-width="1142" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEihS9XP2wucP3bxPzBwZxP04lsb6npCU_uEiqdqNLIH3QK9485xHdW3X1VEzwsyuzYONuom-VNQ8V3F_9odR4Lk3MabkVJ6SV0EVUAzGifIAUgvx_32BONjQu3qsCtdhuibSPEgl_P-qv8ry0Py78UgBbdpy3TaoihexMwiw0otjmbheiSMtbB5FpNMBHY/s16000/local_vs_remote_auth_token.PNG"></a><a href="https://systeminformer.sourceforge.io/" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 10pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">System Informer</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 10pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> token views of local auth (left) vs remote auth (right)</span></div><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">The result is that the token returned from the local authentication has the UAC limitations, in fact you can see the <b>IL level</b> is <b>Medium</b> and the <b>Administrators</b> SID is <b>disabled</b>.</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Instead, the remote authentication occurred without UAC limitations and the resulting elevated token is set in <b>High IL</b>.</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">One important difference here is in the </span><a href="https://learn.microsoft.com/en-us/windows/win32/secauthz/well-known-sids" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">logon type SID</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> present in the token, on the filtered token there is the </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">INTERACTIVE SID</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> while in the elevated token there is the </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">NETWORK SID</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">.</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">So the 1 million $ question is: can we fake a network authentication locally with NTLM through SSPI?&nbsp;</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><br></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 14pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;"></span></p><h2>The unexpected bit flag</h2><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">If we want to trick LSASS during local authentications, first we need to understand when and how this decision takes place in the code.</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Let’s reverse </span><a href="https://learn.microsoft.com/en-us/windows/win32/secauthn/msv1-0-authentication-package" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">msv1_0.dll</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> and search for the function which sets the flag 0x4000 (</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">NTLMSSP_NEGOTIATE_LOCAL_CALL</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">):</span></p><br><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjxD4OIzq1ISZ5o0SxVYBWZDGL4Av6h4qhPWwrGhSFrWltXivcIc70gZFyn6z8PO6N3IC9vZ0Z5ZZ6DTjtGsa7_7xYp2qJkAXEPwlyllm1aWfiiLodOWCld5yh06ytCsyBj_0HP4gEIXncvNt5_CETGPvUEuX9yMlb5rWPbfG70i5zZyEk34iLdU_hM65I/s951/ntlm_reversed_code_1.PNG" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="360" data-original-width="951" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjxD4OIzq1ISZ5o0SxVYBWZDGL4Av6h4qhPWwrGhSFrWltXivcIc70gZFyn6z8PO6N3IC9vZ0Z5ZZ6DTjtGsa7_7xYp2qJkAXEPwlyllm1aWfiiLodOWCld5yh06ytCsyBj_0HP4gEIXncvNt5_CETGPvUEuX9yMlb5rWPbfG70i5zZyEk34iLdU_hM65I/s16000/ntlm_reversed_code_1.PNG"></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 10pt; font-style: italic; white-space-collapse: preserve;">SsprHandleNegotiateMessage reversed code that sets the “Negotiate Local Call” flag</span></div><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Without surprise we landed to the function </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">SsprHandleNegotiateMessage</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">. What this function does is to handle the Negotiate message received by the client and generate the proper Challenge. From the code perspective we land here in the first server call to </span><a href="https://learn.microsoft.com/en-us/windows/win32/secauthn/acceptsecuritycontext--ntlm" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">AcceptSecurityContext</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">.</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">The logic of this code for detecting a local authentication is pretty straightforward: if the domain name and machine name provided by the client in the <b>Negotiate</b> message matches with the local machine name and domain, then this is a local authentication case.&nbsp;</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">But how we get into this part in the code? Let’s cross reference the if above that branch:</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><br></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHQ32e4LULa-ef6wbVGzypF44czi0Bb5hoUHXX-Z5_jc6gi7DZLrcmooE-5mL5recJjSXRCjo3TNhh6YOlJFIBb6XeSE7nGPRKMrx3anWZqw3tCSptdhoa8N_eDokuE3m2GJe3lZgz9Qhss16_i709fs7llJ6HB63s2qbJ_KrPlAuJL66_DXQ1g1qbqYA/s1169/ntlm_reversed_code_2.PNG" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="221" data-original-width="1169" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHQ32e4LULa-ef6wbVGzypF44czi0Bb5hoUHXX-Z5_jc6gi7DZLrcmooE-5mL5recJjSXRCjo3TNhh6YOlJFIBb6XeSE7nGPRKMrx3anWZqw3tCSptdhoa8N_eDokuE3m2GJe3lZgz9Qhss16_i709fs7llJ6HB63s2qbJ_KrPlAuJL66_DXQ1g1qbqYA/s16000/ntlm_reversed_code_2.PNG"></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 13.3333px; font-style: italic; white-space-collapse: preserve;">SsprHandleNegotiateMessage reversed code that checks Negotiate flags</span></div><div><div style="text-align: center;"><span style="font-family: Times New Roman, serif;"><span style="font-size: 13.3333px; white-space-collapse: preserve;"><i><br></i></span></span></div><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><br></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">So the function is checking the Negotiate flags supplied by the client and specifically checks if </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">NTLMSSP_NEGOTIATE_OEM_WORKSTATION_SUPPLIED</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> and </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">NTLMSSP_NEGOTIATE_OEM_DOMAIN_SUPPLIED</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> are set, which is always true if you use SSPI in the latest Windows versions.</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">However, what in the hell is the other checked flag </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">NTLMSSP_NEGOTIATE_DATAGRAM </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">?</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Googling around brought me to </span><a href="https://learn.microsoft.com/en-us/windows/win32/secauthn/datagram-contexts" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">Datagram Contexts</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">.</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">I still haven’t understood what is the intended behavior usage for this feature, but all i needed to know is that i can set this “mode” from the client by using the flag </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">ISC_REQ_DATAGRAM</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> in the first </span><a href="https://learn.microsoft.com/en-us/windows/win32/secauthn/initializesecuritycontext--ntlm" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">InitializeSecurityContext</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> client call. Hopefully, by doing so, i would have forced the intended network auth i was aiming for.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">The only thing to take into consideration is that mode is using <b>connection-less context semantics</b> and could be problematic to synchronize with external services. But… for our case we can run the server and client within the <b>same process</b> and we should be good. Even if it sounds very weird, it’s what we need… In the end we just need to <b>trick</b> LSASS to <b>forge</b> the token for us.</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Let’s sort out all of the code and check how the generated security buffers appears while using <b>Datagram Contexts</b>:</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEieZA91Ajew-PrKA1XDJb8G8N_vWf_H1-FPoGzACqBLgZtzd5MHgbmO_YtF2W3Gi-STZ5K2zlVmisZQ4IptLmJvx8nU1zqB_zsASCoaNar_blrL7aYNg9AMx1fCjIE1PvHrsnggMdxeWKr63zRh0FsH5PLhLCX3zazgZq69Unr-i-LY99xcq-zHxBr9zXg/s885/datagram_ntlm_packets.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="885" data-original-width="576" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEieZA91Ajew-PrKA1XDJb8G8N_vWf_H1-FPoGzACqBLgZtzd5MHgbmO_YtF2W3Gi-STZ5K2zlVmisZQ4IptLmJvx8nU1zqB_zsASCoaNar_blrL7aYNg9AMx1fCjIE1PvHrsnggMdxeWKr63zRh0FsH5PLhLCX3zazgZq69Unr-i-LY99xcq-zHxBr9zXg/s16000/datagram_ntlm_packets.png"></a></div><div class="separator" style="clear: both; text-align: center;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 10pt; font-style: italic; text-align: left; white-space-collapse: preserve;">NTLM message exchanges with Datagram Contexts</span></div><p></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Observing the security buffers exchanged, we can see that the “</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">Negotiate Local Flag</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">” is not set and that the “</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">Reserved</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">” bytes are 0, so no context handle has been passed by the server. Moreover, the client also sent the </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">NTLMv2 Response</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> in the Authenticate message. It definitely looks like the client and server are </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">not</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> negotiating a </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">local authentication</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">. </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Note that the Negotiate message (Type 1) generated in </span><a href="https://davenport.sourceforge.net/ntlm.html#datagramAuthentication" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">Datagram-style authentication</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> is </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">empty</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> and this is one of the significant differences compared to “normal” connection-oriented authentications.</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Let’s inspect the token generated by this authentication and specifically if it contains the magic </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">NETWORK SID</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> logon type:</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><a href="https://github.com/googleprojectzero/sandbox-attacksurface-analysis-tools" style="text-decoration-line: none;"></a></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhpRrs4e95ZQU3nHbdUDAPSVt42nZ4-LICHrs050ESm8H2ngAPadFENpbHGltJ_oM0Ec_61D3HR8VI8oookZawUhkToc_Z2g89dTSuwDpzkw1HA0DlGSwDBxKAmA-dkfskAs1G4nA-YI79ycDo1-mfTTYPTuYVD7lsGUM_wyI0swRQfYItIZlqjpoYtybE/s944/network_token_datagram.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="507" data-original-width="944" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhpRrs4e95ZQU3nHbdUDAPSVt42nZ4-LICHrs050ESm8H2ngAPadFENpbHGltJ_oM0Ec_61D3HR8VI8oookZawUhkToc_Z2g89dTSuwDpzkw1HA0DlGSwDBxKAmA-dkfskAs1G4nA-YI79ycDo1-mfTTYPTuYVD7lsGUM_wyI0swRQfYItIZlqjpoYtybE/s16000/network_token_datagram.png"></a><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 10pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-align: left; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;"><a href="https://github.com/googleprojectzero/sandbox-attacksurface-analysis-tools/">TokenViewer</a></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 10pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-align: left; vertical-align: baseline; white-space-collapse: preserve;"> view of the generated token from Datagram-style authentication</span></div><div class="separator" style="clear: both; text-align: center;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 10pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-align: left; vertical-align: baseline; white-space-collapse: preserve;"><br></span></div><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">The </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">good</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> news is that the </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">NETWORK SID</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> has been added in our token, so mission accomplished.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">The very </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">bad</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> news is that somehow the token has been </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">filtered</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> by UAC. As you can see, the IL of the token is </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">Medium</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> and is </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">not</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> even </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">Elevated</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">. </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">My assumption that </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">Local Authentication</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> is the </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">only</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> mechanism to </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">filter</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> tokens is </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">wrong</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">. Probably, LSASS has </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">additional</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> checks in place, which i don’t plan to discover.&nbsp;</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">GAME OVER.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><br></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 14pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;"></span></p><h2>Sharing a logon session a little too much, part 2</h2><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">After almost 2 years from my last defeat against UAC, i decided to look again into this abandoned idea.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">This time instead, i recalled the blog post “</span><a href="https://www.tiraniddo.dev/2020/04/sharing-logon-session-little-too-much.html" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">Sharing a Logon Session a Little Too Much</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">” by </span><a href="https://twitter.com/tiraniddo" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">James Forshaw</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> and it inspired me for a <b>different exploitation path</b>.</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">What stands out from his blogpost is that when you do a <b>loopback network authentication</b> you can exploit a behavior of </span><a href="https://learn.microsoft.com/en-us/windows/win32/secauthn/acquirecredentialshandle--general" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">AcquireCredentialsHandle</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> when used in network redirectors in which would result in LSASS using the first token created in the logon session rather than the caller’s token.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">How that would apply in our case?</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">When we complete a <b>Datagram-style authentication</b>, LSASS creates a new logon session and creates the elevated token. Then, starting from the elevated token will create a new <b>filtered</b> token (LUA token) and the two are </span><a href="https://learn.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-token_linked_token" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">linked</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">. The LUA token is the one actually associated with the security context “sent” to the server.</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgaH8NqrnHYQS8IhrDuyHv4PCAOXbL_RNtbNNvVLa5qpqP_3soXE7EUrQJzyZn0tLhcN4bt1F49O70DdUB-Qc9nOQfmgVlUQK7d4sh-qfZTj6zN1p9fzMtm810Yyv4vt0LMISgN0ObJKpzZ7LxgIjN9rMc13wQHqLm2j0YKM7Q2eXFc9QqwMZ1BMI_TeZE/s942/lua_vs_elevated_token.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="484" data-original-width="942" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgaH8NqrnHYQS8IhrDuyHv4PCAOXbL_RNtbNNvVLa5qpqP_3soXE7EUrQJzyZn0tLhcN4bt1F49O70DdUB-Qc9nOQfmgVlUQK7d4sh-qfZTj6zN1p9fzMtm810Yyv4vt0LMISgN0ObJKpzZ7LxgIjN9rMc13wQHqLm2j0YKM7Q2eXFc9QqwMZ1BMI_TeZE/s16000/lua_vs_elevated_token.png"></a></div><div style="text-align: center;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 13.3333px; font-style: italic; white-space-collapse: preserve;">LUA Token vs. Elevated Token properties differences</span></div><p></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">In the tokens generated in this way, the </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">Logon Session ID</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> (or </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">Authentication ID</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> from the token perspective) are equals and the </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">Token ID</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> values suggest that the Elevated Token is created before and likely is the first token created in that logon session. So according to this “token confusion” bug in LSASS, the server would see our call as it was <b>originating</b> from our <b>elevated</b> token rather than our impersonated limited token.</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">To exploit this bug, we first need to check if we are able to </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">impersonate</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> the generated </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">LUA token</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">. </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">According to Microsoft documentation of </span><a href="https://learn.microsoft.com/en-us/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">ImpersonateLoggedOnUser</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> function we should be fine in impersonating a token as long as “the authenticated identity is same as the caller”, which is our case. However, it’s not entirely true. There are more conditions in place in the kernel function </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">SeTokenCanImpersonate</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> that is performing the checks:</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi0lw5GsKO3XrCazNqS_sKU9fPM8bMjbEd8RAXjSAmyU7sW_KkLo48BtRV3VJkj5LH_eoN94-49yjl_l5x7VRg0XgB3_erd48M54ej-AiPTIhXRsrfJ30PPXcA-eCbWm5UfKPrY4RdMTcw8letZgSRlVMHcwJjQ1-E072h5TCjNF32KYh7gyohR6Wvutcg/s1573/setokencanimpersonate.PNG" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="902" data-original-width="1573" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi0lw5GsKO3XrCazNqS_sKU9fPM8bMjbEd8RAXjSAmyU7sW_KkLo48BtRV3VJkj5LH_eoN94-49yjl_l5x7VRg0XgB3_erd48M54ej-AiPTIhXRsrfJ30PPXcA-eCbWm5UfKPrY4RdMTcw8letZgSRlVMHcwJjQ1-E072h5TCjNF32KYh7gyohR6Wvutcg/s16000/setokencanimpersonate.PNG"></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 10pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">SeTokenCanImpersonate flow for impersonation decisions, from “</span><a href="https://github.com/tyranid/blackhat-usa-2022-demos/blob/main/slides.pdf" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 10pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">Taking Kerberos to The Next Level</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 10pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">”</span></div><p></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Comparing the token properties with our process’s token running under UAC limitations, all conditions appear to be met.</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Cool! So let’s impersonate the token from the Datagram-style authentication and try to write to a named pipe over the <b>loopback interface</b>, e.g. </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">\\127.0.0.1.\pipe\dummypipe</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgGS-SvoTJqjer3PQ_e0eCpwuisrjw9YsKqruYrbh4d9bt-vpUVgv_isOgV3rnL5CHVdCKZEgoeEtJ-i2TW6sbaDmRZMLiI9dMAqf5kXt05NraA76BrFfcfpgFRNd73qtS1inQcFCDcqdNzPN1upfvr7NNzJ8nX3nYdHtidvpusdQR3MpJPD177DRK0U78/s942/pipe_client_vs_server_token.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="484" data-original-width="942" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgGS-SvoTJqjer3PQ_e0eCpwuisrjw9YsKqruYrbh4d9bt-vpUVgv_isOgV3rnL5CHVdCKZEgoeEtJ-i2TW6sbaDmRZMLiI9dMAqf5kXt05NraA76BrFfcfpgFRNd73qtS1inQcFCDcqdNzPN1upfvr7NNzJ8nX3nYdHtidvpusdQR3MpJPD177DRK0U78/s16000/pipe_client_vs_server_token.png"></a></div><div style="text-align: center;"><span style="font-family: Times New Roman, serif;"><span style="font-size: 13.3333px; white-space-collapse: preserve;"><i>Pipe client thread vs. Pipe server thread tokens</i></span></span></div><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Aaand BAM! We are able to <b>authenticate</b> over the loopback interface with our <b>elevated</b> token even if we are <b>impersonating</b> the <b>filtered token</b>! 🎉</span></p><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Of course the pipe server is running with </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">elevated</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> privileges, otherwise the </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">High IL</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> token would have been downgraded to an </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;">Identification</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> token. </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">But what about using this token for authenticating to an already running privileged service? Like the file-sharing service over SMB? It should be as easy as invoking </span><a href="https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-createfilew" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">CreateFile</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> using an <b>UNC path</b>, like </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">\\127.0.0.1\C$\Windows\bypassuac.txt</span></p><br><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjBuso1Q-n9ENZaTA_yKxOR2IQXlCpRn2LaOwwirt399-Z7wZBGvWYIfxSFf4ze4XFBJIj3zd4XO4HdTcKUDcjtEnMygeKFaCTpodTSldW90H-5_cFTDCvfpAoONdRgR2J0-0JeOzRIMAeopZHZ-BhwKy1L40nJlpFbH3V6s0gcNA4UdL0wHuzg1xDPsHE/s1504/privileged_file_write.PNG" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="394" data-original-width="1504" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjBuso1Q-n9ENZaTA_yKxOR2IQXlCpRn2LaOwwirt399-Z7wZBGvWYIfxSFf4ze4XFBJIj3zd4XO4HdTcKUDcjtEnMygeKFaCTpodTSldW90H-5_cFTDCvfpAoONdRgR2J0-0JeOzRIMAeopZHZ-BhwKy1L40nJlpFbH3V6s0gcNA4UdL0wHuzg1xDPsHE/s16000/privileged_file_write.PNG"></a></div><br><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">It worked!&nbsp;</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">So at this point we have a <b>privileged file write</b> primitive that can be combined with any known DLL Hijacking technique to achieve EoP, such as using an</span><a href="https://decoder.cloud/2019/11/13/from-arbitrary-file-overwrite-to-system/" style="text-decoration-line: none;"><span style="color: black; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> </span><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">XPS Print Job</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> or</span><a href="https://itm4n.github.io/windows-server-netman-dll-hijacking/" style="text-decoration-line: none;"><span style="color: black; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> </span><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">NetMan DLL Hijacking</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">.&nbsp;</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><br></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 14pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;"></span></p><h2>Privileged File Write is good but Code Execution is better :D</h2><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 12pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">If you remember, i previously showed you that i’m able to authenticate even to a <b>named pipe</b> with the <b>elevated</b> token. </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Having privileged access to named pipes means we have access to all of the RPC servers running with </span><a href="https://learn.microsoft.com/en-us/windows/win32/midl/ncacn-np" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">ncacn_np</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> configuration, which are a lot!</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">So, why we don’t leverage this bug/feature to achieve <b>code execution</b> instead of our current privileged file write? We have a lot of juicy candidates like </span><a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-scmr/705b624a-13de-43cc-b8a2-99573da3635f" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">Remote SCM</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">, </span><a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-rrp/0fa3191d-bb79-490a-81bd-54c2601b7a78" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">Remote Registry</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">, </span><a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">Remote Task Scheduler</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> and so on…</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 12pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">However, if we try to authenticate to the <b>Remote Registry</b> through a </span><a href="https://learn.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regconnectregistryw" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">RegConnectRegistryW</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> call, it will <b>fail</b> to open handles to privileged regkeys.</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Let’s inspect the behavior:</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 12pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"></span></p><div class="separator" style="clear: both; text-align: center;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiq0w2Box-OhYdkKKYeMZimKSLQ92kDn1-3n12A1i8yygiU4RZar0uTtC81FHUARvhTjpuxKVzEhZKa8p9380hWmOu8w7Mn8MyiAfZdo4_DQlysHYGJuDttv7TbvxxEPBMZ-HU0urOfh9AM28Hk8xsdSGACnFZf6TnbxJ9BeLCCbnvNBp6TSYOPiS_u3fU/s1025/windbg_details_2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="386" data-original-width="1025" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiq0w2Box-OhYdkKKYeMZimKSLQ92kDn1-3n12A1i8yygiU4RZar0uTtC81FHUARvhTjpuxKVzEhZKa8p9380hWmOu8w7Mn8MyiAfZdo4_DQlysHYGJuDttv7TbvxxEPBMZ-HU0urOfh9AM28Hk8xsdSGACnFZf6TnbxJ9BeLCCbnvNBp6TSYOPiS_u3fU/s16000/windbg_details_2.png"></a></span></div><p></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 12pt; text-align: center;"><i style="font-family: &quot;Times New Roman&quot;, serif; font-size: 13.3333px; white-space-collapse: preserve;"></i></p><div class="separator" style="clear: both; text-align: center;"><i style="font-family: &quot;Times New Roman&quot;, serif; font-size: 13.3333px; white-space-collapse: preserve;"><i>&nbsp;WinDbg details of AcquireCredentialsHandle call from RegConnectRegistryW</i></i></div><p></p><div><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">What it turns out is that the RPC runtime library (RPCRT4.dll) uses his <b>own implementation</b> for the authentication. As we can observe, the </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">pvLogonId</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> parameter for </span><a href="https://learn.microsoft.com/en-us/windows/win32/secauthn/acquirecredentialshandle--general" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">AcquireCredentialsHandleW</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;"> </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">is set to 0 which wouldn’t allow to trigger the bug in LSASS and would use the <b>proper limited token</b> for the auth.</span></div><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 12pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Now let’s see the difference when authenticating to the loopback interface with the </span><a href="https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-createfilew" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">CreateFileW</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> function:</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 12pt; text-align: center;"><i style="font-family: &quot;Times New Roman&quot;, serif; font-size: 13.3333px; white-space-collapse: preserve;"></i></p><div class="separator" style="clear: both; text-align: center;"><i style="font-family: &quot;Times New Roman&quot;, serif; font-size: 13.3333px; white-space-collapse: preserve;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhM80Io0ldSt2GGskye1eW4q-uknrPx2AP6bDRsqtiuB94_DvXefHFNUKoQY-ESAR2-nMhyKXXFLfil9V_e1WHzkcvtH-1yhoMIviW8tS_7AU_mWZn29Fc9Fp1QtOzUY-Js4Hk-Em9OUW-XHDlOFIeSSj1QKj3NYAVYdWlO9NzwCms8JMbe-QhiATKUfgs/s849/windbg_mrxsmb20_acquirecredhandle.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="389" data-original-width="849" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhM80Io0ldSt2GGskye1eW4q-uknrPx2AP6bDRsqtiuB94_DvXefHFNUKoQY-ESAR2-nMhyKXXFLfil9V_e1WHzkcvtH-1yhoMIviW8tS_7AU_mWZn29Fc9Fp1QtOzUY-Js4Hk-Em9OUW-XHDlOFIeSSj1QKj3NYAVYdWlO9NzwCms8JMbe-QhiATKUfgs/s16000/windbg_mrxsmb20_acquirecredhandle.png"></a></i></div><i style="font-family: &quot;Times New Roman&quot;, serif; font-size: 13.3333px; white-space-collapse: preserve;"><div style="text-align: center;"><i>WinDbg details of AcquireCredentialsHandle call from CreateFileW</i></div></i><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 12pt;"><span style="font-family: Times New Roman, serif; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">The first difference we see here is that the authentication is implemented in the <b>kernel</b> by the SMB redirector driver <b>mrxsmb20.sys</b>.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 12pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">More important, the </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">pvLogonId</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> parameter for </span><a href="https://learn.microsoft.com/en-us/windows/win32/secauthn/acquirecredentialshandle--general" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">AcquireCredentialsHandleW</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;"> </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">is set to the <b>logon session</b> associated with our user, which is what would fool lsass in <b>using</b> the <b>elevated token</b> from that logon session.</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">According to the documentation, in order to specify the </span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-style: italic; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">pvLogonId</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> you need to have the <b>SeTcbPrivilege</b>, which is not a problem in this case due to the fact that the code is running with <b>kernel privileges</b>.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 12pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">This means, unfortunately, we can’t use the <b>RPC runtime library</b> to authenticate to named pipes associated with RPC services if we want to exploit this bug.</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">However, no one could prohibit us to use our own <b>custom RPC client </b>implementation that leverages the <b>CreateFileW</b> call for authenticating to the RPC service over SMB. But this would require some hard work and i’m too lazy for that.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 12pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">But this time luck seems to have been turned to my side and i found out </span><a href="https://twitter.com/x86matthew" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">@x86matthew</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"> already did this for the <b>service control manager</b> RPC interface in </span><a href="https://www.x86matthew.com/view_post?id=create_svc_rpc" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">CreateSvcRpc</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">!</span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;"><br></span><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">The only change we need to do is to force the usage of <b>SMB</b> instead of <b>ALPC</b>, that technically translates in changing the pipe path from \\.\pipe\ntsvcs to \\127.0.0.1\pipe\ntsvcs</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 12pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">Let’s see the full chain in action 😎&nbsp;
</span></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj6MF93q_k8Og_DqTsbZ86eNwI11YiD-c71SR_CTFX-G8CDuwIq1vpSFz8Z7__zq9O2jLJdOGMw8opy7R2uUK7TWsllR_3DMBy0w44esnwo6kZozFF5l4d0WmTm32cDds_pCD9ZTBoOVR-f0XP89q_2o_y3S1q14KemJuKl4nrtBV6lOoc9KW5yP78LX1E/s1543/demo.PNG" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="779" data-original-width="1543" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj6MF93q_k8Og_DqTsbZ86eNwI11YiD-c71SR_CTFX-G8CDuwIq1vpSFz8Z7__zq9O2jLJdOGMw8opy7R2uUK7TWsllR_3DMBy0w44esnwo6kZozFF5l4d0WmTm32cDds_pCD9ZTBoOVR-f0XP89q_2o_y3S1q14KemJuKl4nrtBV6lOoc9KW5yP78LX1E/s16000/demo.PNG"></a></div><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 12pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">
PoC source code can be found at → </span><a href="https://github.com/antonioCoco/SspiUacBypass" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">https://github.com/antonioCoco/SspiUacBypass</span></a><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space-collapse: preserve;">&nbsp;</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 0pt;"><br></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 14pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;"></span></p><h2>Conclusion</h2><div><span style="font-family: &quot;Times New Roman&quot;, serif; white-space-collapse: preserve;">A couple of years ago, i put this project between the many things i failed, thinking i hit a wall. Now i see the way was always there... I just needed to look at it differently or with a different perspective. It turned out to be a new cool way to get around UAC.</span></div><div><span style="font-family: Times New Roman, serif; white-space-collapse: preserve;"><br></span></div><div><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; white-space-collapse: preserve;">A big shout-out to <a href="https://twitter.com/tiraniddo" style="font-family: &quot;Times New Roman&quot;; font-size: medium; text-decoration-line: none; white-space-collapse: collapse;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">James Forshaw</span></a> and </span><a href="https://twitter.com/x86matthew" style="text-decoration-line: none;"><span style="color: #1155cc; font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; vertical-align: baseline; white-space-collapse: preserve;">@x86matthew</span></a><span style="font-family: Times New Roman, serif;"><span style="font-size: 12pt; white-space-collapse: preserve;"> whose research provided invaluable insights and my friend <a href="https://twitter.com/decoder_it">@</a></span><span style="white-space-collapse: preserve;"><a href="https://twitter.com/decoder_it">decoder_it</a></span><span style="font-size: 12pt; white-space-collapse: preserve;"> for the proofread!</span></span></div><div><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; white-space-collapse: preserve;"><br></span></div><div><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; white-space-collapse: preserve;">That's all folks, see you next time 👋</span></div><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 0pt;"><br></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 12pt; margin-top: 0pt;"><span style="font-family: &quot;Times New Roman&quot;, serif; font-size: 14pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space-collapse: preserve;"></span></p><h2>References</h2><ul style="margin-bottom: 0px; margin-top: 0px; padding-inline-start: 48px;"><li aria-level="1" dir="ltr" style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; list-style-type: disc; vertical-align: baseline; white-space: pre;"><p dir="ltr" role="presentation" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 12pt;"><a href="https://youtu.be/G5HjD4nMbUc" style="text-decoration-line: none;"><span style="color: #1155cc; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; text-wrap: wrap; vertical-align: baseline;">ZeroNights 2017 James Forshaw Abusing Access Tokens for UAC Bypasses</span></a></p></li><li aria-level="1" dir="ltr" style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; list-style-type: disc; vertical-align: baseline; white-space: pre;"><p dir="ltr" role="presentation" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><a href="https://www.tiraniddo.dev/2017/05/reading-your-way-around-uac-part-1.html" style="text-decoration-line: none;"><span style="color: #1155cc; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; text-wrap: wrap; vertical-align: baseline;">Reading Your Way Around UAC (Part 1)</span></a></p></li><li aria-level="1" dir="ltr" style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; list-style-type: disc; vertical-align: baseline; white-space: pre;"><p dir="ltr" role="presentation" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><a href="https://www.tiraniddo.dev/2017/05/reading-your-way-around-uac-part-2.html" style="text-decoration-line: none;"><span style="color: #1155cc; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; text-wrap: wrap; vertical-align: baseline;">Reading Your Way Around UAC (Part 2)</span></a></p></li><li aria-level="1" dir="ltr" style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; list-style-type: disc; vertical-align: baseline; white-space: pre;"><p dir="ltr" role="presentation" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><a href="https://www.tiraniddo.dev/2017/05/reading-your-way-around-uac-part-3.html" style="text-decoration-line: none;"><span style="color: #1155cc; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; text-wrap: wrap; vertical-align: baseline;">Reading Your Way Around UAC (Part 3)</span></a></p></li><li aria-level="1" dir="ltr" style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; list-style-type: disc; vertical-align: baseline; white-space: pre;"><p dir="ltr" role="presentation" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><a href="https://www.tiraniddo.dev/2018/10/farewell-to-token-stealing-uac-bypass.html" style="text-decoration-line: none;"><span style="color: #1155cc; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; text-wrap: wrap; vertical-align: baseline;">Farewell to the Token Stealing UAC Bypass</span></a></p></li><li aria-level="1" dir="ltr" style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; list-style-type: disc; vertical-align: baseline; white-space: pre;"><p dir="ltr" role="presentation" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><a href="https://www.tiraniddo.dev/2019/02/accessing-access-tokens-for-uiaccess.html" style="text-decoration-line: none;"><span style="color: #1155cc; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; text-wrap: wrap; vertical-align: baseline;">Accessing Access Tokens for UIAccess</span></a></p></li><li aria-level="1" dir="ltr" style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; list-style-type: disc; vertical-align: baseline; white-space: pre;"><p dir="ltr" role="presentation" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><a href="https://www.tiraniddo.dev/2022/03/bypassing-uac-in-most-complex-way.html" style="text-decoration-line: none;"><span style="color: #1155cc; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; text-wrap: wrap; vertical-align: baseline;">Bypassing UAC in the most Complex Way Possible!</span></a></p></li><li aria-level="1" dir="ltr" style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; list-style-type: disc; vertical-align: baseline; white-space: pre;"><p dir="ltr" role="presentation" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><a href="https://www.tiraniddo.dev/2020/04/sharing-logon-session-little-too-much.html" style="font-size: 12pt; text-decoration-line: none;"><span style="color: #1155cc; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; text-wrap: wrap; vertical-align: baseline;">Sharing a Logon Session a Little Too Much</span></a></p></li><li aria-level="1" dir="ltr" style="font-family: &quot;Times New Roman&quot;, serif; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; list-style-type: disc; vertical-align: baseline; white-space: pre;"><p dir="ltr" role="presentation" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><a href="https://www.x86matthew.com/view_post?id=create_svc_rpc" style="font-size: 12pt; text-decoration-line: none;"><span style="color: #1155cc; font-size: 12pt; font-variant-alternates: normal; font-variant-east-asian: normal; font-variant-numeric: normal; text-decoration-line: underline; text-decoration-skip-ink: none; text-wrap: wrap; vertical-align: baseline;">CreateSvcRpc - A custom RPC client to execute programs as the SYSTEM user</span></a></p></li></ul></div>
</div>
<div class="post-bottom">
<div class="post-footer float-container">
</div>
</div>
</div>
</div>
<section class="comments" data-num-comments="0" id="comments">
<a name="comments"></a>
</section>
</article>
</div>
</div>
</div>
</main>
</div>
<footer class="footer section" id="footer" name="Footer"><div class="widget Attribution" data-version="2" id="Attribution1">
<div class="widget-content">
<div class="blogger">
<a href="https://www.blogger.com" rel="nofollow">
<svg class="svg-icon-24">
<use xlink:href="/responsive/sprite_v1_6.css.svg#ic_post_blogger_black_24dp" xmlns:xlink="http://www.w3.org/1999/xlink"></use>
</svg>
Powered by Blogger
</a>
</div>
</div>
</div>
</footer>
</div>
</div>
</div>
<aside class="sidebar-container container sidebar-invisible" role="complementary">
<div class="navigation">
<button class="svg-icon-24-button flat-icon-button ripple sidebar-back">
<svg class="svg-icon-24">
<use xlink:href="/responsive/sprite_v1_6.css.svg#ic_arrow_back_black_24dp" xmlns:xlink="http://www.w3.org/1999/xlink"></use>
</svg>
</button>
</div>
<div class="sidebar_top_wrapper no-items">
<div class="sidebar_top no-items section" id="sidebar_top" name="Sidebar (top)">
</div>
</div>
<div class="sidebar_bottom no-items section" id="sidebar_bottom" name="Sidebar (bottom)"></div>
</aside>
<script type="text/javascript" src="https://resources.blogblog.com/blogblog/data/res/378685591-strm_compiled.js" async="true"></script>
<!--To Ty odpowiadasz za poinformowanie u\u017cytkownik\xf3w o\xa0u\u017cywaniu plik\xf3w cookie i\xa0zbieraniu danych na blogu. Blogger udost\u0119pnia standardowe powiadomienie, kt\xf3rego mo\u017cesz u\u017cywa\u0107 na swoim blogu. Mo\u017cesz je dostosowa\u0107 do swoich potrzeb lub zast\u0105pi\u0107 w\u0142asnym. Tu znajdziesz wi\u0119cej informacji: http://www.blogger.com/go/cookiechoices.-->
<script defer="" src="/js/cookienotice.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function(event) {
      window.cookieChoices && cookieChoices.showCookieConsentBar && cookieChoices.showCookieConsentBar(
          (window.cookieOptions && cookieOptions.msg) || 'W\xa0tej witrynie s\u0105 wykorzystywane pliki cookie, kt\xf3rych Google u\u017cywa do \u015bwiadczenia swoich us\u0142ug i\xa0analizowania ruchu. Tw\xf3j adres\xa0IP i\xa0nazwa klienta u\u017cytkownika oraz dane dotycz\u0105ce wydajno\u015bci i\xa0bezpiecze\u0144stwa s\u0105 udost\u0119pniane firmie Google, by zapewni\u0107 odpowiedni\u0105 jako\u015b\u0107 us\u0142ug, generowa\u0107 statystyki u\u017cytkowania oraz wykrywa\u0107 nadu\u017cycia i\xa0na nie reagowa\u0107.',
          (window.cookieOptions && cookieOptions.close) || 'Rozumiem',
          (window.cookieOptions && cookieOptions.learn) || 'Dowiedz si\u0119 wi\u0119cej',
          (window.cookieOptions && cookieOptions.link) || 'https://www.blogger.com/go/blogspot-cookies');
    });
  </script>

<script type="text/javascript" src="https://www.blogger.com/static/v1/widgets/922809059-widgets.js"></script>
<script type="text/javascript">
window['__wavt'] = 'AOuZoY4QAR-M-ryd3mGItjpWFYf59DJVqg:1718453570833';_WidgetManager._Init('//www.blogger.com/rearrange?blogID\x3d1185007328368910714','//splintercod3.blogspot.com/p/bypassing-uac-with-sspi-datagram.html','1185007328368910714');
_WidgetManager._SetDataContext([{'name': 'blog', 'data': {'blogId': '1185007328368910714', 'title': 'splinter_code blog', 'url': 'https://splintercod3.blogspot.com/p/bypassing-uac-with-sspi-datagram.html', 'canonicalUrl': 'https://splintercod3.blogspot.com/p/bypassing-uac-with-sspi-datagram.html', 'homepageUrl': 'https://splintercod3.blogspot.com/', 'searchUrl': 'https://splintercod3.blogspot.com/search', 'canonicalHomepageUrl': 'https://splintercod3.blogspot.com/', 'blogspotFaviconUrl': 'https://splintercod3.blogspot.com/favicon.ico', 'bloggerUrl': 'https://www.blogger.com', 'hasCustomDomain': false, 'httpsEnabled': true, 'enabledCommentProfileImages': true, 'gPlusViewType': 'FILTERED_POSTMOD', 'adultContent': false, 'analyticsAccountNumber': '', 'encoding': 'UTF-8', 'locale': 'en-GB', 'localeUnderscoreDelimited': 'en_gb', 'languageDirection': 'ltr', 'isPrivate': false, 'isMobile': false, 'isMobileRequest': true, 'mobileClass': '', 'isPrivateBlog': false, 'isDynamicViewsAvailable': false, 'feedLinks': '', 'meTag': '', 'adsenseHostId': 'ca-host-pub-1556223355139109', 'adsenseHasAds': false, 'adsenseAutoAds': false, 'boqCommentIframeForm': true, 'loginRedirectParam': '', 'view': '', 'dynamicViewsCommentsSrc': '//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js', 'dynamicViewsScriptSrc': '//www.blogblog.com/dynamicviews/1156f5042d12a8cd', 'plusOneApiSrc': 'https://apis.google.com/js/platform.js', 'disableGComments': true, 'interstitialAccepted': false, 'sharing': {'platforms': [{'name': 'Get link', 'key': 'link', 'shareMessage': 'Get link', 'target': ''}, {'name': 'Facebook', 'key': 'facebook', 'shareMessage': 'Share to Facebook', 'target': 'facebook'}, {'name': 'BlogThis!', 'key': 'blogThis', 'shareMessage': 'BlogThis!', 'target': 'blog'}, {'name': 'Twitter', 'key': 'twitter', 'shareMessage': 'Share to Twitter', 'target': 'twitter'}, {'name': 'Pinterest', 'key': 'pinterest', 'shareMessage': 'Share to Pinterest', 'target': 'pinterest'}, {'name': 'Email', 'key': 'email', 'shareMessage': 'Email', 'target': 'email'}], 'disableGooglePlus': true, 'googlePlusShareButtonWidth': 0, 'googlePlusBootstrap': '\x3cscript type\x3d\x22text/javascript\x22\x3ewindow.___gcfg \x3d {\x27lang\x27: \x27en_GB\x27};\x3c/script\x3e'}, 'hasCustomJumpLinkMessage': false, 'jumpLinkMessage': 'Read more', 'pageType': 'static_page', 'pageId': '5186984517398909181', 'pageName': 'Bypassing UAC with SSPI Datagram Contexts', 'pageTitle': 'splinter_code blog: Bypassing UAC with SSPI Datagram Contexts'}}, {'name': 'features', 'data': {}}, {'name': 'messages', 'data': {'edit': 'Edit', 'linkCopiedToClipboard': 'Link copied to clipboard', 'ok': 'Ok', 'postLink': 'Post link'}}, {'name': 'template', 'data': {'name': 'custom', 'localizedName': 'Custom', 'isResponsive': true, 'isAlternateRendering': false, 'isCustom': true}}, {'name': 'view', 'data': {'classic': {'name': 'classic', 'url': '?view\x3dclassic'}, 'flipcard': {'name': 'flipcard', 'url': '?view\x3dflipcard'}, 'magazine': {'name': 'magazine', 'url': '?view\x3dmagazine'}, 'mosaic': {'name': 'mosaic', 'url': '?view\x3dmosaic'}, 'sidebar': {'name': 'sidebar', 'url': '?view\x3dsidebar'}, 'snapshot': {'name': 'snapshot', 'url': '?view\x3dsnapshot'}, 'timeslide': {'name': 'timeslide', 'url': '?view\x3dtimeslide'}, 'isMobile': false, 'title': 'Bypassing UAC with SSPI Datagram Contexts', 'description': 'by splinter_code - 14 September 2023 Recently i had the opportunity to read through some of my old repos because i wanted to reuse some code...', 'featuredImage': 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHatC0V08ZrzJ89M8WsX2LRa6VB8h63QM9_2Nv_YEUthJjL1B2FUMMRjSJLUDfIJnvvlG3htwHNXGYrD4_id9CXc0vCYiknSl_mNjAwDTHCAtL1fbbGGQNjyonPDrpLgr8Cd8hMRZC9b5s4vimx0b2mLTLm8w63lHIoVOm9EWpeTaSuscXgfODPuikkVw/s16000/spiderman.jpg', 'url': 'https://splintercod3.blogspot.com/p/bypassing-uac-with-sspi-datagram.html', 'type': 'item', 'isSingleItem': true, 'isMultipleItems': false, 'isError': false, 'isPage': true, 'isPost': false, 'isHomepage': false, 'isArchive': false, 'isLabelSearch': false, 'pageId': 5186984517398909181}}, {'name': 'widgets', 'data': [{'title': 'splinter_code blog (Header)', 'type': 'Header', 'sectionId': 'header', 'id': 'Header1'}, {'title': '', 'type': 'PageList', 'sectionId': 'page_list_top', 'id': 'PageList1'}, {'title': 'Blog Posts', 'type': 'Blog', 'sectionId': 'page_body', 'id': 'Blog1', 'posts': [{'id': '5186984517398909181', 'title': 'Bypassing UAC with SSPI Datagram Contexts', 'featuredImage': 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgHatC0V08ZrzJ89M8WsX2LRa6VB8h63QM9_2Nv_YEUthJjL1B2FUMMRjSJLUDfIJnvvlG3htwHNXGYrD4_id9CXc0vCYiknSl_mNjAwDTHCAtL1fbbGGQNjyonPDrpLgr8Cd8hMRZC9b5s4vimx0b2mLTLm8w63lHIoVOm9EWpeTaSuscXgfODPuikkVw/s16000/spiderman.jpg', 'showInlineAds': false}], 'headerByline': {'regionName': 'header1', 'items': [{'name': 'timestamp', 'label': ''}]}, 'footerBylines': [], 'allBylineItems': [{'name': 'timestamp', 'label': ''}]}, {'type': 'Attribution', 'sectionId': 'footer', 'id': 'Attribution1'}]}]);
_WidgetManager._RegisterWidget('_HeaderView', new _WidgetInfo('Header1', 'header', document.getElementById('Header1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_PageListView', new _WidgetInfo('PageList1', 'page_list_top', document.getElementById('PageList1'), {'title': '', 'links': [{'isCurrentPage': false, 'href': 'https://splintercod3.blogspot.com/', 'id': '0', 'title': 'Home'}, {'isCurrentPage': false, 'href': 'https://splintercod3.blogspot.com/p/blog-page_7.html', 'id': '6673137936683211398', 'title': 'Posts'}, {'isCurrentPage': false, 'href': 'https://splintercod3.blogspot.com/p/talks.html', 'id': '1577870669508631884', 'title': 'Talks'}, {'isCurrentPage': false, 'href': 'https://splintercod3.blogspot.com/p/tools.html', 'id': '3892375272354079997', 'title': 'Tools'}, {'isCurrentPage': false, 'href': 'https://splintercod3.blogspot.com/p/blog-page.html', 'id': '1493070280279402778', 'title': 'whoami'}, {'isCurrentPage': false, 'href': 'https://raw.githubusercontent.com/antonioCoco/antoniococo.github.io/master/rss.xml', 'title': 'RSS Feed'}], 'mobile': false, 'showPlaceholder': true, 'hasCurrentPage': false}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogView', new _WidgetInfo('Blog1', 'page_body', document.getElementById('Blog1'), {'cmtInteractionsEnabled': false, 'lightboxEnabled': true, 'lightboxModuleUrl': 'https://www.blogger.com/static/v1/jsbin/2113428944-lbx__en_gb.js', 'lightboxCssUrl': 'https://www.blogger.com/static/v1/v-css/13464135-lightbox_bundle.css'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AttributionView', new _WidgetInfo('Attribution1', 'footer', document.getElementById('Attribution1'), {}, 'displayModeFull'));
</script>

<div id="cookieChoiceInfo" class="cookie-choices-info singleton-element"><div class="cookie-choices-inner"><span class="cookie-choices-text">W&nbsp;tej witrynie są wykorzystywane pliki cookie, których Google używa do świadczenia swoich usług i&nbsp;analizowania ruchu. Twój adres&nbsp;IP i&nbsp;nazwa klienta użytkownika oraz dane dotyczące wydajności i&nbsp;bezpieczeństwa są udostępniane firmie Google, by zapewnić odpowiednią jakość usług, generować statystyki użytkowania oraz wykrywać nadużycia i&nbsp;na nie reagować.</span><span class="cookie-choices-buttons"><a href="https://www.blogger.com/go/blogspot-cookies" target="_blank" class="cookie-choices-button">Dowiedz się więcej</a><a id="cookieChoiceDismiss" href="#" class="cookie-choices-button">Rozumiem</a></span></div></div><div class="dim-overlay hidden" id="subscribe-dim-overlay"></div><div class="dim-overlay hidden"></div><link type="text/css" rel="stylesheet" href="https://www.blogger.com/static/v1/v-css/13464135-lightbox_bundle.css"><script type="text/javascript" src="https://www.blogger.com/static/v1/jsbin/2113428944-lbx__en_gb.js"></script></body></html>