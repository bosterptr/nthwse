<html lang="en" data-rh="lang"><head><title>Azure AD Pass The Certificate. Intro | by Mor | Medium</title><meta data-rh="true" charset="utf-8"><meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=1"><meta data-rh="true" name="theme-color" content="#000000"><meta data-rh="true" name="twitter:app:name:iphone" content="Medium"><meta data-rh="true" name="twitter:app:id:iphone" content="828256236"><meta data-rh="true" property="al:ios:app_name" content="Medium"><meta data-rh="true" property="al:ios:app_store_id" content="828256236"><meta data-rh="true" property="al:android:package" content="com.medium.reader"><meta data-rh="true" property="fb:app_id" content="542599432471018"><meta data-rh="true" property="og:site_name" content="Medium"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2020-08-19T13:57:19.115Z"><meta data-rh="true" name="title" content="Azure AD Pass The Certificate. Intro | by Mor | Medium"><meta data-rh="true" property="og:title" content="Azure AD Pass The Certificate"><meta data-rh="true" property="al:android:url" content="medium://p/d0c5de624597"><meta data-rh="true" property="al:ios:url" content="medium://p/d0c5de624597"><meta data-rh="true" property="al:android:app_name" content="Medium"><meta data-rh="true" name="description" content="With the evolvement of Azure and Pass-Through authentication, many organizations are connecting devices to Azure AD, making the authentication and management easier. Azure AD devices can be connected…"><meta data-rh="true" property="og:description" content="Intro"><meta data-rh="true" property="og:url" content="https://medium.com/@mor2464/azure-ad-pass-the-certificate-d0c5de624597"><meta data-rh="true" property="al:web:url" content="https://medium.com/@mor2464/azure-ad-pass-the-certificate-d0c5de624597"><meta data-rh="true" property="og:image" content="https://miro.medium.com/v2/resize:fit:755/1*63wq7BNs0ud47Xkxmj8EEA.png"><meta data-rh="true" property="article:author" content="https://medium.com/@mor2464"><meta data-rh="true" name="author" content="Mor"><meta data-rh="true" name="robots" content="index,follow,max-image-preview:large"><meta data-rh="true" name="referrer" content="unsafe-url"><meta data-rh="true" property="twitter:title" content="Azure AD Pass The Certificate"><meta data-rh="true" name="twitter:site" content="@Medium"><meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/d0c5de624597"><meta data-rh="true" property="twitter:description" content="Intro"><meta data-rh="true" name="twitter:image:src" content="https://miro.medium.com/v2/resize:fit:755/1*63wq7BNs0ud47Xkxmj8EEA.png"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="twitter:label1" content="Reading time"><meta data-rh="true" name="twitter:data1" content="12 min read"><link data-rh="true" rel="icon" href="https://miro.medium.com/v2/1*m-R_BkNf1Qjr1YbyOIJY2w.png"><link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium" href="/osd.xml"><link data-rh="true" rel="apple-touch-icon" sizes="152x152" href="https://miro.medium.com/v2/resize:fill:152:152/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"><link data-rh="true" rel="apple-touch-icon" sizes="120x120" href="https://miro.medium.com/v2/resize:fill:120:120/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"><link data-rh="true" rel="apple-touch-icon" sizes="76x76" href="https://miro.medium.com/v2/resize:fill:76:76/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"><link data-rh="true" rel="apple-touch-icon" sizes="60x60" href="https://miro.medium.com/v2/resize:fill:60:60/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"><link data-rh="true" rel="mask-icon" href="https://cdn-static-1.medium.com/_/fp/icons/Medium-Avatar-500x500.svg" color="#171717"><link data-rh="true" rel="preconnect" href="https://glyph.medium.com" crossorigin=""><link data-rh="true" id="glyph_preload_link" rel="preload" as="style" type="text/css" href="https://glyph.medium.com/css/unbound.css"><link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css" href="https://glyph.medium.com/css/unbound.css"><link data-rh="true" rel="author" href="https://medium.com/@mor2464"><link data-rh="true" rel="canonical" href="https://medium.com/@mor2464/azure-ad-pass-the-certificate-d0c5de624597"><link data-rh="true" rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/d0c5de624597"><style type="text/css" data-fela-rehydration="562" data-fela-type="STATIC">html{box-sizing:border-box;-webkit-text-size-adjust:100%}*, *:before, *:after{box-sizing:inherit}body{margin:0;padding:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);position:relative;min-height:100vh}h1, h2, h3, h4, h5, h6, dl, dd, ol, ul, menu, figure, blockquote, p, pre, form{margin:0}menu, ol, ul{padding:0;list-style:none;list-style-image:none}main{display:block}a{color:inherit;text-decoration:none}a, button, input{-webkit-tap-highlight-color:transparent}img, svg{vertical-align:middle}button{background:transparent;overflow:visible}button, input, optgroup, select, textarea{margin:0}:root{--reach-tabs:1;--reach-menu-button:1}#speechify-root{font-family:Sohne, sans-serif}div[data-popper-reference-hidden="true"]{visibility:hidden;pointer-events:none}.grecaptcha-badge{visibility:hidden}
/*XCode style (c) Angel Garcia <angelgarcia.mail@gmail.com>*/.hljs {background: #fff;color: black;
}/* Gray DOCTYPE selectors like WebKit */
.xml .hljs-meta {color: #c0c0c0;
}.hljs-comment,
.hljs-quote {color: #007400;
}.hljs-tag,
.hljs-attribute,
.hljs-keyword,
.hljs-selector-tag,
.hljs-literal,
.hljs-name {color: #aa0d91;
}.hljs-variable,
.hljs-template-variable {color: #3F6E74;
}.hljs-code,
.hljs-string,
.hljs-meta .hljs-string {color: #c41a16;
}.hljs-regexp,
.hljs-link {color: #0E0EFF;
}.hljs-title,
.hljs-symbol,
.hljs-bullet,
.hljs-number {color: #1c00cf;
}.hljs-section,
.hljs-meta {color: #643820;
}.hljs-title.class_,
.hljs-class .hljs-title,
.hljs-type,
.hljs-built_in,
.hljs-params {color: #5c2699;
}.hljs-attr {color: #836C28;
}.hljs-subst {color: #000;
}.hljs-formula {background-color: #eee;font-style: italic;
}.hljs-addition {background-color: #baeeba;
}.hljs-deletion {background-color: #ffc8bd;
}.hljs-selector-id,
.hljs-selector-class {color: #9b703f;
}.hljs-doctag,
.hljs-strong {font-weight: bold;
}.hljs-emphasis {font-style: italic;
}
</style><style type="text/css" data-fela-rehydration="562" data-fela-type="KEYFRAME">@-webkit-keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@-moz-keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}</style><style type="text/css" data-fela-rehydration="562" data-fela-type="RULE">.a{font-family:medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif}.b{font-weight:400}.c{background-color:rgba(255, 255, 255, 1)}.l{display:block}.m{position:sticky}.n{top:0}.o{z-index:500}.p{padding:0 24px}.q{align-items:center}.r{border-bottom:solid 1px #F2F2F2}.y{height:41px}.z{line-height:20px}.ab{display:flex}.ac{height:57px}.ae{flex:1 0 auto}.af{color:inherit}.ag{fill:inherit}.ah{font-size:inherit}.ai{border:inherit}.aj{font-family:inherit}.ak{letter-spacing:inherit}.al{font-weight:inherit}.am{padding:0}.an{margin:0}.ao{cursor:pointer}.ap:disabled{cursor:not-allowed}.aq:disabled{color:#6B6B6B}.ar:disabled{fill:#6B6B6B}.au{margin-left:16px}.av{border:none}.aw{border-radius:20px}.ax{width:240px}.ay{background:#F9F9F9}.az path{fill:#6B6B6B}.bb{outline:none}.bc{font-family:sohne, "Helvetica Neue", Helvetica, Arial, sans-serif}.bd{font-size:14px}.be{width:100%}.bf{padding:10px 20px 10px 0}.bg{background-color:transparent}.bh{color:#242424}.bi::placeholder{color:#6B6B6B}.bj{display:inline-block}.bk{margin-left:12px}.bl{margin-right:12px}.bm{border-radius:4px}.bn{margin-left:24px}.bo{height:24px}.bu{background-color:#F9F9F9}.bv{border-radius:50%}.bw{height:32px}.bx{width:32px}.by{justify-content:center}.ce{max-width:680px}.cf{min-width:0}.cg{animation:k1 1.2s ease-in-out infinite}.ch{height:100vh}.ci{margin-bottom:16px}.cj{margin-top:48px}.ck{align-items:flex-start}.cl{flex-direction:column}.cm{justify-content:space-between}.cn{margin-bottom:24px}.ct{width:80%}.cu{background-color:#F2F2F2}.da{height:44px}.db{width:44px}.dc{margin:auto 0}.dd{margin-bottom:4px}.de{height:16px}.df{width:120px}.dg{width:80px}.dm{margin-bottom:8px}.dn{width:96%}.do{width:98%}.dp{width:81%}.dq{margin-left:8px}.dr{color:#6B6B6B}.ds{font-size:13px}.dt{height:100%}.el{color:#FFFFFF}.em{fill:#FFFFFF}.eo{background:#1A8917}.ep{border-color:#1A8917}.et:disabled{cursor:inherit !important}.eu:disabled{opacity:0.3}.ev:disabled:hover{background:#1A8917}.ew:disabled:hover{border-color:#1A8917}.ex{border-radius:99em}.ey{border-width:1px}.ez{border-style:solid}.fa{box-sizing:border-box}.fb{text-decoration:none}.fc{text-align:center}.ff{margin-right:32px}.fg{position:relative}.fh{fill:#6B6B6B}.fk{background:transparent}.fl svg{margin-left:4px}.fm svg{fill:#6B6B6B}.fo{box-shadow:inset 0 0 0 1px rgba(0, 0, 0, 0.05)}.fp{position:absolute}.fw{margin:0 24px}.ga{background:rgba(255, 255, 255, 1)}.gb{border:1px solid #F2F2F2}.gc{box-shadow:0 1px 4px #F2F2F2}.gd{max-height:100vh}.ge{overflow-y:auto}.gf{left:0}.gg{top:calc(100vh + 100px)}.gh{bottom:calc(100vh + 100px)}.gi{width:10px}.gj{pointer-events:none}.gk{word-break:break-word}.gl{word-wrap:break-word}.gm:after{display:block}.gn:after{content:""}.go:after{clear:both}.gp{line-height:1.23}.gq{letter-spacing:0}.gr{font-style:normal}.gs{font-weight:700}.hs{@media all and (max-width: 551.98px):8px}.ht{@media all and (min-width: 552px) and (max-width: 727.98px):8px}.hu{@media all and (min-width: 728px) and (max-width: 903.98px):16px}.hv{@media all and (min-width: 904px) and (max-width: 1079.98px):16px}.hw{@media all and (min-width: 1080px):16px}.ic{align-items:baseline}.id{width:48px}.ie{height:48px}.if{border:2px solid rgba(255, 255, 255, 1)}.ig{z-index:0}.ih{box-shadow:none}.ii{border:1px solid rgba(0, 0, 0, 0.05)}.ij{margin-bottom:2px}.ik{flex-wrap:nowrap}.il{font-size:16px}.im{line-height:24px}.io{margin:0 8px}.ip{display:inline}.iq{color:#1A8917}.ir{fill:#1A8917}.iu{flex:0 0 auto}.ix{flex-wrap:wrap}.iy{padding-left:8px}.iz{padding-right:8px}.ka> *{flex-shrink:0}.kb{overflow-x:scroll}.kc::-webkit-scrollbar{display:none}.kd{scrollbar-width:none}.ke{-ms-overflow-style:none}.kf{width:74px}.kg{flex-direction:row}.kh{z-index:2}.ki{margin-right:4px}.kl{-webkit-user-select:none}.km{border:0}.kn{fill:rgba(117, 117, 117, 1)}.kq{outline:0}.kr{user-select:none}.ks> svg{pointer-events:none}.lb{cursor:progress}.lc{opacity:1}.ld{padding:4px 0}.lg{margin-top:0px}.lh{width:16px}.lj{display:inline-flex}.lp{max-width:100%}.lq{padding:8px 2px}.lr svg{color:#6B6B6B}.mi{line-height:1.12}.mj{letter-spacing:-0.022em}.mk{font-weight:600}.nf{margin-bottom:-0.28em}.ng{line-height:1.58}.nh{letter-spacing:-0.004em}.ni{font-family:source-serif-pro, Georgia, Cambria, "Times New Roman", Times, serif}.od{margin-bottom:-0.46em}.oj{text-decoration:underline}.ok{list-style-type:disc}.ol{margin-left:30px}.om{padding-left:0px}.os{margin-top:32px}.ot{margin-bottom:14px}.ou{padding-top:24px}.ov{padding-bottom:10px}.ow{background-color:#000000}.ox{height:3px}.oy{width:3px}.oz{margin-right:20px}.pa{margin-left:auto}.pb{margin-right:auto}.pc{max-width:624px}.pi{clear:both}.pj{height:auto}.pk{margin-top:10px}.pl{max-width:728px}.po{max-width:755px}.pq{cursor:zoom-in}.pr{z-index:auto}.pt{list-style-type:decimal}.pz{max-width:585px}.qa{box-shadow:inset 3px 0 0 0 #242424}.qb{padding-left:23px}.qc{margin-left:-20px}.qd{font-style:italic}.qe{line-height:1.18}.qs{margin-bottom:-0.31em}.qt{max-width:559px}.qu{max-width:552px}.qv{max-width:470px}.qw{max-width:440px}.qx{max-width:468px}.qy{max-width:566px}.qz{max-width:360px}.ra{max-width:627px}.rg{box-shadow:inset 0 0 0 1px #F2F2F2}.rh{padding:0px}.ri{padding:16px 20px}.rj{flex:1 1 auto}.rl{overflow:hidden}.rm{max-height:40px}.rn{text-overflow:ellipsis}.ro{display:-webkit-box}.rp{-webkit-line-clamp:2}.rq{-webkit-box-orient:vertical}.rs{margin-top:8px}.rt{margin-top:12px}.ru{width:160px}.rv{background-image:url(https://miro.medium.com/v2/da:true/resize:fit:320/0*p1zk6kwbStpMfknz)}.rw{background-origin:border-box}.rx{background-size:cover}.ry{height:167px}.rz{background-position:50% 50%}.sa{background-image:url(https://miro.medium.com/v2/da:true/resize:fit:320/0*F0B4arZY1ZPLFap9)}.sb{max-width:656px}.sc{background-image:url(https://miro.medium.com/v2/da:true/resize:fit:320/0*0dGm3kO5bwGFpt2H)}.sd{margin-bottom:26px}.se{margin-top:6px}.sf{margin-right:8px}.sg{padding:8px 16px}.sh{border-radius:100px}.si{transition:background 300ms ease}.sk{white-space:nowrap}.sl{border-top:none}.sr{height:52px}.ss{max-height:52px}.st{box-sizing:content-box}.su{position:static}.sv{z-index:1}.sx{max-width:155px}.ti{align-items:flex-end}.tj{width:76px}.tk{height:76px}.tl{border:2px solid #F9F9F9}.tm{height:72px}.tn{width:72px}.to{width:auto}.tp{stroke:#F2F2F2}.tq{height:36px}.tr{width:36px}.ts{color:#F2F2F2}.tt{fill:#F2F2F2}.tu{background:#F2F2F2}.tv{border-color:#F2F2F2}.ub{font-weight:500}.uc{font-size:24px}.ud{line-height:30px}.ue{letter-spacing:-0.016em}.uf{margin-top:16px}.ug{height:0px}.uh{border-bottom:solid 1px #E5E5E5}.un{margin-top:72px}.uo{padding:24px 0}.up{margin-bottom:0px}.uq{margin-right:16px}.as:hover:not(:disabled){color:rgba(25, 25, 25, 1)}.at:hover:not(:disabled){fill:rgba(25, 25, 25, 1)}.eq:hover{background:#156D12}.er:hover{border-color:#156D12}.es:hover{cursor:pointer}.fi:hover{color:#242424}.fj:hover{fill:#242424}.fn:hover svg{fill:#242424}.fq:hover{background-color:rgba(0, 0, 0, 0.1)}.in:hover{text-decoration:underline}.is:hover:not(:disabled){color:#156D12}.it:hover:not(:disabled){fill:#156D12}.kp:hover{fill:rgba(8, 8, 8, 1)}.le:hover{fill:#000000}.lf:hover p{color:#000000}.li:hover{color:#000000}.ls:hover svg{color:#000000}.sj:hover{background-color:#F2F2F2}.tw:hover{background:#F2F2F2}.tx:hover{border-color:#F2F2F2}.ty:hover{cursor:wait}.tz:hover{color:#F2F2F2}.ua:hover{fill:#F2F2F2}.ba:focus-within path{fill:#242424}.ko:focus{fill:rgba(8, 8, 8, 1)}.lt:focus svg{color:#000000}.ps:focus{transform:scale(1.01)}.kt:active{border-style:none}</style><style type="text/css" data-fela-rehydration="562" data-fela-type="RULE" media="all and (min-width: 1080px)">.d{display:none}.bt{width:64px}.cd{margin:0 64px}.cs{height:48px}.cz{margin-bottom:52px}.dl{margin-bottom:48px}.ec{font-size:14px}.ed{line-height:20px}.ej{font-size:13px}.ek{padding:5px 12px}.fe{display:flex}.fv{margin-bottom:68px}.fz{max-width:680px}.hn{font-size:42px}.ho{margin-top:1.19em}.hp{margin-bottom:32px}.hq{line-height:52px}.hr{letter-spacing:-0.011em}.ib{align-items:center}.jm{border-top:solid 1px #F2F2F2}.jn{border-bottom:solid 1px #F2F2F2}.jo{margin:32px 0 0}.jp{padding:3px 8px}.jy> *{margin-right:24px}.jz> :last-child{margin-right:0}.la{margin-top:0px}.lo{margin:0}.nb{font-size:24px}.nc{margin-top:1.95em}.nd{line-height:30px}.ne{letter-spacing:-0.016em}.nz{font-size:20px}.oa{margin-top:0.94em}.ob{line-height:32px}.oc{letter-spacing:-0.003em}.oi{margin-top:2.14em}.or{margin-top:1.14em}.ph{margin-top:56px}.py{margin-top:1.25em}.qp{margin-top:1.72em}.qq{line-height:24px}.qr{letter-spacing:0}.rf{margin-top:32px}.sq{margin-bottom:88px}.tc{display:inline-block}.th{padding-top:72px}.um{margin-top:40px}</style><style type="text/css" data-fela-rehydration="562" data-fela-type="RULE" media="all and (max-width: 1079.98px)">.e{display:none}.kz{margin-top:0px}.pm{margin-left:auto}.pn{text-align:center}.tb{display:inline-block}</style><style type="text/css" data-fela-rehydration="562" data-fela-type="RULE" media="all and (max-width: 903.98px)">.f{display:none}.ky{margin-top:0px}.ta{display:inline-block}</style><style type="text/css" data-fela-rehydration="562" data-fela-type="RULE" media="all and (max-width: 727.98px)">.g{display:none}.kw{margin-top:0px}.kx{margin-right:0px}.rk{padding:10px 12px 10px}.sz{display:inline-block}</style><style type="text/css" data-fela-rehydration="562" data-fela-type="RULE" media="all and (max-width: 551.98px)">.h{display:none}.s{display:flex}.t{justify-content:space-between}.bp{width:24px}.bz{margin:0 24px}.co{height:40px}.cv{margin-bottom:44px}.dh{margin-bottom:32px}.du{font-size:13px}.dv{line-height:20px}.ee{padding:0px 8px 1px}.fr{margin-bottom:4px}.gt{font-size:32px}.gu{margin-top:1.01em}.gv{margin-bottom:24px}.gw{line-height:38px}.gx{letter-spacing:-0.014em}.hx{align-items:flex-start}.iv{flex-direction:column}.ja{margin:24px -24px 0}.jb{padding:0}.jq> *{margin-right:8px}.jr> :last-child{margin-right:24px}.kj{margin-left:0px}.ku{margin-top:0px}.kv{margin-right:0px}.lk{margin:0}.lu{border:1px solid #F2F2F2}.lv{border-radius:99em}.lw{padding:0px 16px 0px 12px}.lx{height:38px}.ly{align-items:center}.ma svg{margin-right:8px}.ml{font-size:20px}.mm{margin-top:1.2em}.mn{line-height:24px}.mo{letter-spacing:0}.nj{font-size:18px}.nk{margin-top:0.67em}.nl{line-height:28px}.nm{letter-spacing:-0.003em}.oe{margin-top:1.56em}.on{margin-top:1.34em}.pd{margin-top:40px}.pu{margin-top:0.93em}.qf{font-size:16px}.qg{margin-top:1.23em}.rb{margin-top:24px}.sm{margin-bottom:80px}.sy{display:inline-block}.td{padding-top:48px}.ui{margin-top:32px}.lz:hover{border-color:#E5E5E5}</style><style type="text/css" data-fela-rehydration="562" data-fela-type="RULE" media="all and (min-width: 904px) and (max-width: 1079.98px)">.i{display:none}.bs{width:64px}.cc{margin:0 64px}.cr{height:48px}.cy{margin-bottom:52px}.dk{margin-bottom:48px}.ea{font-size:14px}.eb{line-height:20px}.eh{font-size:13px}.ei{padding:5px 12px}.fd{display:flex}.fu{margin-bottom:68px}.fy{max-width:680px}.hi{font-size:42px}.hj{margin-top:1.19em}.hk{margin-bottom:32px}.hl{line-height:52px}.hm{letter-spacing:-0.011em}.ia{align-items:center}.ji{border-top:solid 1px #F2F2F2}.jj{border-bottom:solid 1px #F2F2F2}.jk{margin:32px 0 0}.jl{padding:3px 8px}.jw> *{margin-right:24px}.jx> :last-child{margin-right:0}.ln{margin:0}.mx{font-size:24px}.my{margin-top:1.95em}.mz{line-height:30px}.na{letter-spacing:-0.016em}.nv{font-size:20px}.nw{margin-top:0.94em}.nx{line-height:32px}.ny{letter-spacing:-0.003em}.oh{margin-top:2.14em}.oq{margin-top:1.14em}.pg{margin-top:56px}.px{margin-top:1.25em}.qm{margin-top:1.72em}.qn{line-height:24px}.qo{letter-spacing:0}.re{margin-top:32px}.sp{margin-bottom:88px}.tg{padding-top:72px}.ul{margin-top:40px}</style><style type="text/css" data-fela-rehydration="562" data-fela-type="RULE" media="all and (min-width: 728px) and (max-width: 903.98px)">.j{display:none}.w{display:flex}.x{justify-content:space-between}.br{width:64px}.cb{margin:0 48px}.cq{height:48px}.cx{margin-bottom:52px}.dj{margin-bottom:48px}.dy{font-size:13px}.dz{line-height:20px}.eg{padding:0px 8px 1px}.ft{margin-bottom:68px}.fx{max-width:680px}.hd{font-size:42px}.he{margin-top:1.19em}.hf{margin-bottom:32px}.hg{line-height:52px}.hh{letter-spacing:-0.011em}.hz{align-items:center}.je{border-top:solid 1px #F2F2F2}.jf{border-bottom:solid 1px #F2F2F2}.jg{margin:32px 0 0}.jh{padding:3px 8px}.ju> *{margin-right:24px}.jv> :last-child{margin-right:0}.lm{margin:0}.mt{font-size:24px}.mu{margin-top:1.95em}.mv{line-height:30px}.mw{letter-spacing:-0.016em}.nr{font-size:20px}.ns{margin-top:0.94em}.nt{line-height:32px}.nu{letter-spacing:-0.003em}.og{margin-top:2.14em}.op{margin-top:1.14em}.pf{margin-top:56px}.pw{margin-top:1.25em}.qj{margin-top:1.72em}.qk{line-height:24px}.ql{letter-spacing:0}.rd{margin-top:32px}.so{margin-bottom:88px}.tf{padding-top:72px}.uk{margin-top:40px}</style><style type="text/css" data-fela-rehydration="562" data-fela-type="RULE" media="all and (min-width: 552px) and (max-width: 727.98px)">.k{display:none}.u{display:flex}.v{justify-content:space-between}.bq{width:24px}.ca{margin:0 24px}.cp{height:40px}.cw{margin-bottom:44px}.di{margin-bottom:32px}.dw{font-size:13px}.dx{line-height:20px}.ef{padding:0px 8px 1px}.fs{margin-bottom:4px}.gy{font-size:32px}.gz{margin-top:1.01em}.ha{margin-bottom:24px}.hb{line-height:38px}.hc{letter-spacing:-0.014em}.hy{align-items:flex-start}.iw{flex-direction:column}.jc{margin:24px 0 0}.jd{padding:0}.js> *{margin-right:8px}.jt> :last-child{margin-right:8px}.kk{margin-left:0px}.ll{margin:0}.mb{border:1px solid #F2F2F2}.mc{border-radius:99em}.md{padding:0px 16px 0px 12px}.me{height:38px}.mf{align-items:center}.mh svg{margin-right:8px}.mp{font-size:20px}.mq{margin-top:1.2em}.mr{line-height:24px}.ms{letter-spacing:0}.nn{font-size:18px}.no{margin-top:0.67em}.np{line-height:28px}.nq{letter-spacing:-0.003em}.of{margin-top:1.56em}.oo{margin-top:1.34em}.pe{margin-top:40px}.pv{margin-top:0.93em}.qh{font-size:16px}.qi{margin-top:1.23em}.rc{margin-top:24px}.sn{margin-bottom:80px}.te{padding-top:48px}.uj{margin-top:32px}.mg:hover{border-color:#E5E5E5}</style><style type="text/css" data-fela-rehydration="562" data-fela-type="RULE" media="print">.sw{display:none}</style><style type="text/css" data-fela-rehydration="562" data-fela-type="RULE" media="(prefers-reduced-motion: no-preference)">.pp{transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1)}</style><style type="text/css" data-fela-rehydration="562" data-fela-type="RULE" media="(orientation: landscape) and (max-width: 903.98px)">.rr{max-height:none}</style><script async="" src="https://cdn.branch.io/branch-latest.min.js"></script><script type="application/ld+json" data-rh="true">{"@context":"http:\u002F\u002Fschema.org","@type":"NewsArticle","image":["https:\u002F\u002Fmiro.medium.com\u002Fv2\u002Fresize:fit:1200\u002F1*63wq7BNs0ud47Xkxmj8EEA.png"],"url":"https:\u002F\u002Fmedium.com\u002F@mor2464\u002Fazure-ad-pass-the-certificate-d0c5de624597","dateCreated":"2020-08-19T13:57:19.115Z","datePublished":"2020-08-19T13:57:19.115Z","dateModified":"2021-12-15T15:41:03.933Z","headline":"Azure AD Pass The Certificate - Mor - Medium","name":"Azure AD Pass The Certificate - Mor - Medium","description":"With the evolvement of Azure and Pass-Through authentication, many organizations are connecting devices to Azure AD, making the authentication and management easier. Azure AD devices can be connected…","identifier":"d0c5de624597","author":{"@type":"Person","name":"Mor","url":"https:\u002F\u002Fmedium.com\u002F@mor2464"},"creator":["Mor"],"publisher":{"@type":"Organization","name":"Medium","url":"https:\u002F\u002Fmedium.com\u002F","logo":{"@type":"ImageObject","width":308,"height":60,"url":"https:\u002F\u002Fmiro.medium.com\u002Fv2\u002Fresize:fit:385\u002F1*OMF3fSqH8t4xBJ9-6oZDZw.png"}},"mainEntityOfPage":"https:\u002F\u002Fmedium.com\u002F@mor2464\u002Fazure-ad-pass-the-certificate-d0c5de624597"}</script><script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-7JY7T788PK" data-rh="true"></script><script data-rh="true">window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-7JY7T788PK');</script><script type="text/javascript" data-rh="true">(function(b,r,a,n,c,h,_,s,d,k){if(!b[n]||!b[n]._q){for(;s<_.length;)c(h,_[s++]);d=r.createElement(a);d.async=1;d.src="https://cdn.branch.io/branch-latest.min.js";k=r.getElementsByTagName(a)[0];k.parentNode.insertBefore(d,k);b[n]=h}})(window,document,"script","branch",function(b,r){b[r]=function(){b._q.push([r,arguments])}},{_q:[],_v:1},"addListener applyCode autoAppIndex banner closeBanner closeJourney creditHistory credits data deepview deepviewCta first getCode init link logout redeem referrals removeListener sendSMS setBranchViewData setIdentity track validateCode trackCommerceEvent logEvent".split(" "), 0);
branch.init('key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm', {metadata: {}, 'no_journeys': true, 'disable_exit_animation': true, 'disable_entry_animation': true, 'tracking_disabled': null}, function(err, data) {});</script><script src="https://www.google.com/recaptcha/enterprise.js?render=6Le-uGgpAAAAAPprRaokM8AKthQ9KNGdoxaGUvVp" data-rh="true"></script><style id="googleidentityservice_button_styles">.qJTHM{-moz-user-select:none;color:#202124;direction:ltr;font-family:"Roboto-Regular",arial,sans-serif;font-weight:400;margin:0;overflow:hidden}.ynRLnc{left:-9999px;position:absolute;top:-9999px}.L6cTce{display:none}.bltWBb{word-break:break-all}.hSRGPd{color:#1a73e8;cursor:pointer;font-weight:500;text-decoration:none}.Bz112c-W3lGp{height:16px;width:16px}.Bz112c-E3DyYd{height:20px;width:20px}.Bz112c-r9oPif{height:24px;width:24px}.Bz112c-uaxL4e{-moz-border-radius:10px;border-radius:10px}.LgbsSe-Bz112c{display:block}.S9gUrf-YoZ4jf,.S9gUrf-YoZ4jf *{border:none;margin:0;padding:0}.fFW7wc-ibnC6b>.aZ2wEe>div{border-color:#4285f4}.P1ekSe-ZMv3u>div:nth-child(1){background-color:#1a73e8!important}.P1ekSe-ZMv3u>div:nth-child(2),.P1ekSe-ZMv3u>div:nth-child(3){background-image:linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,#1a73e8,#1a73e8)!important}.haAclf{display:inline-block}.nsm7Bb-HzV7m-LgbsSe{border-radius:4px;box-sizing:border-box;transition:background-color .218s,border-color .218s;-moz-user-select:none;background-color:#fff;background-image:none;border:1px solid #dadce0;color:#3c4043;cursor:pointer;font-family:"Google Sans",arial,sans-serif;font-size:14px;height:40px;letter-spacing:0.25px;outline:none;overflow:hidden;padding:0 12px;position:relative;text-align:center;vertical-align:middle;white-space:nowrap;width:auto}@media screen and (-ms-high-contrast:active){.nsm7Bb-HzV7m-LgbsSe{border:2px solid windowText;color:windowText}}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe{font-size:14px;height:32px;letter-spacing:0.25px;padding:0 10px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe{font-size:11px;height:20px;letter-spacing:0.3px;padding:0 8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe{padding:0;width:40px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe{width:32px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe{width:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK{border-radius:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.pSzOP-SxQuSe{border-radius:16px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.purZT-SxQuSe{border-radius:10px}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc{border:none;color:#fff}.nsm7Bb-HzV7m-LgbsSe.MFS4be-v3pZbf-Ia7Qfc{background-color:#1a73e8}.nsm7Bb-HzV7m-LgbsSe.MFS4be-JaPV2b-Ia7Qfc{background-color:#202124;color:#e8eaed}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:18px;margin-right:8px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:14px;min-width:14px;width:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:10px;min-width:10px;width:10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin-left:8px;margin-right:-4px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:10px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:4px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-top-left-radius:3px;border-bottom-left-radius:3px;display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;justify-content:center;align-items:center;background-color:#fff;height:36px;margin-left:-10px;margin-right:12px;min-width:36px;width:36px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c,.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:28px;margin-left:-8px;margin-right:10px;min-width:28px;width:28px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:16px;margin-left:-6px;margin-right:8px;min-width:16px;width:16px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:3px;margin-left:2px;margin-right:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:8px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-bN97Pc-sM5MNb{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;align-items:center;flex-direction:row;justify-content:space-between;flex-wrap:nowrap;height:100%;position:relative;width:100%}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX{justify-content:center}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{flex-grow:1;font-family:"Google Sans",arial,sans-serif;font-weight:500;overflow:hidden;text-overflow:ellipsis;vertical-align:top}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-weight:300}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX .nsm7Bb-HzV7m-LgbsSe-BPrWId{flex-grow:0}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-MJoBVe{transition:background-color .218s;bottom:0;left:0;position:absolute;right:0;top:0}.nsm7Bb-HzV7m-LgbsSe:hover,.nsm7Bb-HzV7m-LgbsSe:focus{box-shadow:none;border-color:#d2e3fc;outline:none}.nsm7Bb-HzV7m-LgbsSe:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.04)}.nsm7Bb-HzV7m-LgbsSe:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.1)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.24)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.32)}.nsm7Bb-HzV7m-LgbsSe .n1UuX-DkfjY{border-radius:50%;display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;height:20px;margin-left:-4px;margin-right:8px;min-width:20px;width:20px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-family:"Roboto";font-size:12px;text-align:left}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .ssJRIf,.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .fmcmS{overflow:hidden;text-overflow:ellipsis}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;align-items:center;color:#5f6368;fill:#5f6368;font-size:11px;font-weight:400}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.MFS4be-Ia7Qfc .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{color:#e8eaed;fill:#e8eaed}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .Bz112c{height:18px;margin:-3px -3px -3px 2px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:3px;border-bottom-right-radius:3px;margin-left:12px;margin-right:-10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:18px}.L5Fo6c-sM5MNb{border:0;display:block;left:0;position:relative;top:0}.L5Fo6c-bF1uUb{-moz-border-radius:4px;border-radius:4px;bottom:0;cursor:pointer;left:0;position:absolute;right:0;top:0}.L5Fo6c-bF1uUb:focus{border:none;outline:none}sentinel{}</style></head><body><div id="root"><div class="a b c"><div class="d e f g h i j k"></div><script>document.domain = document.domain;</script><div><script>if (window.self !== window.top) window.location = "about:blank"</script></div><div class="l c"><div class="l m n o c" style="transform: translateY(0px);"><div class="p q r s t u v w x i d y z"><a class="dr ag ds bc ak b am an ao ap aq ar as at s u w i d q dt z" href="https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd0c5de624597&amp;%7Efeature=LoOpenInAppButton&amp;%7Echannel=ShowPostUnderUser&amp;source=---two_column_layout_nav----------------------------------" rel="noopener follow">Open in app<svg width="10" height="10" viewBox="0 0 10 10" fill="none" class="dq"><path d="M.98 8.48a.37.37 0 1 0 .54.54l-.54-.54zm7.77-7.23h.38c0-.2-.17-.38-.38-.38v.38zM8.37 6.5a.37.37 0 1 0 .76 0h-.76zM3.5.87a.37.37 0 1 0 0 .76V.88zM1.52 9.03l7.5-7.5-.54-.54-7.5 7.5.54.54zm6.86-7.77V6.5h.74V1.25h-.74zm-4.88.38h5.25V.88H3.5v.74z" fill="currentColor"></path></svg></a><div class="ab q"><p class="bc b du dv dw dx dy dz ea eb ec ed dr"><span><button class="bc b du dv ee dw dx ef dy dz eg eh eb ei ej ed ek el em eo ep eq er es et eu ev ew ex ey ez fa bj fb fc" data-testid="headerSignUpButton">Sign up</button></span></p><div class="au l"><p class="bc b du dv dw dx dy dz ea eb ec ed dr"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSignInButton" rel="noopener follow" href="/m/signin?operation=login&amp;redirect=https%3A%2F%2Fmedium.com%2F%40mor2464%2Fazure-ad-pass-the-certificate-d0c5de624597&amp;source=post_page---two_column_layout_nav-----------------------global_nav-----------">Sign in</a></span></p></div></div></div><div class="p q r ab ac"><div class="ab q ae"><a class="af ag ah ai aj ak al am an ao ap aq ar as at ab" aria-label="Homepage" data-testid="headerMediumLogo" rel="noopener follow" href="/?source=---two_column_layout_nav----------------------------------"><svg width="120" height="27" viewBox="0 0 120 27" fill="none"><mask id="logo-wordmark-pride_svg__a" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="1" y="0" width="119" height="27"><path d="M29.69 2.36h.03v-.29h-7.26L15.7 18.05 8.96 2.07H1.12v.28l.04.01c1.32.3 2 .75 2 2.37v19c0 1.62-.68 2.07-2 2.37h-.04v.29h5.31v-.28H6.4c-1.33-.3-2-.76-2-2.38V5.83l8.67 20.56h.5l8.91-21.13V24.2c-.1 1.28-.78 1.67-1.98 1.95h-.03v.28h9.25v-.27l-.03-.01c-1.2-.28-1.89-.67-2-1.95V4.73c0-1.62.67-2.07 2-2.37zm4.23 12.58c.15-3.41 1.37-5.87 3.4-5.92.64.01 1.17.22 1.58.62.87.86 1.28 2.64 1.22 5.3h-6.2zm-.1.96h10.86v-.04c-.03-2.61-.78-4.64-2.23-6.03a7.3 7.3 0 0 0-5.05-1.87h-.04a7.31 7.31 0 0 0-5.75 2.78 10.4 10.4 0 0 0-2.08 5.72l-.02.2a7.61 7.61 0 0 0-.02.56v.58c.11 5.09 2.84 9.16 7.69 9.16 4.25 0 6.73-3.14 7.35-7.34l-.32-.11c-1.08 2.26-3.03 3.63-5.25 3.46-3.03-.23-5.35-3.32-5.13-7.06m23.12 6.89c-.36.85-1.1 1.32-2.1 1.32s-1.9-.7-2.55-1.94a12.23 12.23 0 0 1-1.06-5.49c0-4.68 1.45-7.7 3.68-7.7.94 0 1.68.47 2.03 1.28V22.8zm7.2 3.33c-1.33-.31-2-.78-2-2.49V.96l-8.07 2.39v.3l.05-.01c1.11-.1 1.87.06 2.3.47.35.32.52.8.52 1.5v3.1a5.18 5.18 0 0 0-2.89-.75c-2.33 0-4.45.98-5.99 2.78-1.6 1.86-2.44 4.42-2.44 7.38 0 5.28 2.58 8.84 6.43 8.84a5.09 5.09 0 0 0 4.89-3.34v2.81h7.23v-.29h-.03zm6.9-22.09c0-1.65-1.23-2.9-2.87-2.9a2.87 2.87 0 0 0-2.9 2.9c0 1.63 1.27 2.9 2.9 2.9a2.82 2.82 0 0 0 2.88-2.9zm1.91 22.1c-1.32-.32-2-.8-2-2.5V8.01l-7.24 2.1v.28h.05c1.56.14 1.99.68 1.99 2.53v13.51H73v-.29h-.04zm18.54 0c-1.33-.32-2-.8-2-2.5V8.01l-6.89 2.02v.29h.04c1.28.14 1.65.71 1.65 2.56v9.88a2.48 2.48 0 0 1-2.2 1.4c-1.57 0-2.43-1.08-2.43-3.02V8.01l-7.24 2.1v.28h.04c1.57.14 2 .68 2 2.53v8.36c0 .58.05 1.16.15 1.74l.13.57c.61 2.21 2.22 3.37 4.73 3.37 2.13 0 4-1.33 4.82-3.4v2.88h7.23v-.3h-.03zm28.1.3v-.3h-.03c-1.44-.34-2-.97-2-2.26V13.25c0-3.31-1.85-5.3-4.95-5.3a5.08 5.08 0 0 0-4.9 3.37c-.58-2.17-2.25-3.36-4.73-3.36a4.7 4.7 0 0 0-4.61 3.1V8.02l-7.23 2v.3h.04c1.55.14 2 .7 2 2.49v13.63h6.74v-.29h-.03c-1.15-.28-1.52-.78-1.52-2.05V11.9c.3-.71.91-1.56 2.13-1.56 1.5 0 2.26 1.05 2.26 3.12v12.97h6.75v-.29h-.03c-1.15-.28-1.52-.78-1.52-2.05V13.25a7 7 0 0 0-.1-1.21c.32-.78.97-1.7 2.23-1.7 1.53 0 2.27 1.02 2.27 3.12v12.97h7.23z" fill="#242424"></path></mask><g filter="url(#logo-wordmark-pride_svg__filter0_f_238_6555)" mask="url(#logo-wordmark-pride_svg__a)"><path d="M42.3-64.7l-15.52-6.74L-24.62 47l15.53 6.74L42.3-64.7z" fill="#000"></path><path d="M53.18-59.98L42.3-64.7-9.1 53.74l10.88 4.72 51.4-118.44z" fill="#603917"></path><path d="M64.96-54.87l-11.78-5.11L1.78 58.46l11.79 5.11 51.4-118.44z" fill="#71E2FD"></path><path d="M75.84-50.15l-10.88-4.72-51.4 118.44 10.89 4.72L75.84-50.15z" fill="#FF9BC9"></path><path d="M86.71-45.43l-10.87-4.72L24.44 68.3l10.88 4.72 51.4-118.44z" fill="#FF472F"></path><path d="M97.6-40.7L86.7-45.44 35.32 73.01l10.88 4.72L97.6-40.7z" fill="#FF8312"></path><path d="M108.47-35.99L97.6-40.7 46.2 77.73l10.88 4.72 51.4-118.44z" fill="#FFCE00"></path><path d="M120.25-30.88l-11.78-5.1-51.4 118.43 11.79 5.11 51.4-118.44z" fill="#48E348"></path><path d="M131.13-26.16l-10.88-4.72L68.86 87.56l10.88 4.72 51.4-118.44z" fill="#008EF0"></path><path d="M148.48-18.63l-17.35-7.53-51.4 118.44 17.35 7.53 51.4-118.44z" fill="#9A50FC"></path></g><defs><filter id="logo-wordmark-pride_svg__filter0_f_238_6555" x="-29.5" y="-76.33" width="182.87" height="181.03" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur stdDeviation="2.45" result="effect1_foregroundBlur_238_6555"></feGaussianBlur></filter></defs></svg></a><div class="au h"><div class="ab av aw ax ay q az ba"><div class="bj" aria-hidden="false" aria-describedby="searchResults" aria-labelledby="searchResults"></div><div class="bk bl ab"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.1 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0zm6.94-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .8-.79l-3.74-3.73A8.05 8.05 0 0 0 11.04 3v.01z" fill="currentColor"></path></svg></div><input role="combobox" aria-controls="searchResults" aria-expanded="false" aria-label="search" data-testid="headerSearchInput" tabindex="0" class="av bb bc bd z be bf bg bh bi" placeholder="Search" value=""></div></div></div><div class="h k w fd fe"><div class="ff ab"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerWriteButton" rel="noopener follow" href="/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fnew-story&amp;source=---two_column_layout_nav-----------------------new_post_topnav-----------"><div class="bc b bd z dr fg fh ab q fi fj"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-label="Write"><path d="M14 4a.5.5 0 0 0 0-1v1zm7 6a.5.5 0 0 0-1 0h1zm-7-7H4v1h10V3zM3 4v16h1V4H3zm1 17h16v-1H4v1zm17-1V10h-1v10h1zm-1 1a1 1 0 0 0 1-1h-1v1zM3 20a1 1 0 0 0 1 1v-1H3zM4 3a1 1 0 0 0-1 1h1V3z" fill="currentColor"></path><path d="M17.5 4.5l-8.46 8.46a.25.25 0 0 0-.06.1l-.82 2.47c-.07.2.12.38.31.31l2.47-.82a.25.25 0 0 0 .1-.06L19.5 6.5m-2-2l2.32-2.32c.1-.1.26-.1.36 0l1.64 1.64c.1.1.1.26 0 .36L19.5 6.5m-2-2l2 2" stroke="currentColor"></path></svg><div class="dq l">Write</div></div></a></span></div></div><div class="k j i d"><div class="ff ab"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSearchButton" rel="noopener follow" href="/search?source=---two_column_layout_nav----------------------------------"><div class="bc b bd z dr fg fh ab q fi fj"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-label="Search"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.1 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0zm6.94-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .8-.79l-3.74-3.73A8.05 8.05 0 0 0 11.04 3v.01z" fill="currentColor"></path></svg></div></a></div></div><div class="ff h k j"><div class="ab q"><p class="bc b du dv dw dx dy dz ea eb ec ed dr"><span><button class="bc b du dv ee dw dx ef dy dz eg eh eb ei ej ed ek el em eo ep eq er es et eu ev ew ex ey ez fa bj fb fc" data-testid="headerSignUpButton">Sign up</button></span></p><div class="au l"><p class="bc b du dv dw dx dy dz ea eb ec ed dr"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSignInButton" rel="noopener follow" href="/m/signin?operation=login&amp;redirect=https%3A%2F%2Fmedium.com%2F%40mor2464%2Fazure-ad-pass-the-certificate-d0c5de624597&amp;source=post_page---two_column_layout_nav-----------------------global_nav-----------">Sign in</a></span></p></div></div></div><div class="l" aria-hidden="false"><button class="av fk am ab q ao fl fm fn" aria-label="user options menu" data-testid="headerUserIcon"><div class="l fg"><img alt="" class="l fa bv bw bx cu" src="https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png" width="32" height="32" loading="lazy" role="presentation"><div class="fo bv l bw bx fp n av fq"></div></div></button></div></div></div><div class="l"><div class="sw" role="dialog" aria-modal="true" tabindex="-1"><div class="xz ya be dt vf yb vb ao yc gj yd" aria-hidden="true" role="presentation"></div><div class="ye vf yf yg yh xz dt fa yi yj yk lc yl ym vg yn yo yp yq yr ys" aria-hidden="true"></div></div><div class="fr fs ft fu fv l"><div class="ab by"><div class="cf be fw fx fy fz"></div></div><article><div class="l"><div class="l"><span class="l"></span><section><div><div class="fp gf gg gh gi gj"></div><div class="gk gl gm gn go"><div class="ab by"><div class="cf be fw fx fy fz"><div><h1 id="7784" class="pw-post-title gp gq gr bc gs gt gu gv gw gx gy gz ha hb hc hd he hf hg hh hi hj hk hl hm hn ho hp hq hr bh" data-testid="storyTitle" data-selectable-paragraph="">Azure AD Pass The Certificate</h1><div class="hs ht hu hv hw"><div class="speechify-ignore ab cm"><div class="speechify-ignore be l"><div class="hx hy hz ia ib ab"><div><div class="ab ic"><a rel="noopener follow" href="/@mor2464?source=post_page-----d0c5de624597--------------------------------"><div><div class="bj" aria-hidden="false" aria-describedby="1" aria-labelledby="1"><div class="l id ie bv if ig"><div class="l fg"><img alt="Mor" class="l fa bv da db cu" src="https://miro.medium.com/v2/resize:fill:88:88/1*dmbNkD5D-u45r44go_cf0g.png" width="44" height="44" loading="lazy" data-testid="authorPhoto"><div class="ih bv l da db fp n ii fq"></div></div></div></div></div></a></div></div><div class="bk be l"><div class="ab"><div style="flex:1"><span class="bc b bd z bh"><div class="ij ab q"><div class="ab q ik"><div class="ab q"><div><div class="bj" aria-hidden="false" aria-describedby="2" aria-labelledby="2"><p class="bc b il im bh"><a class="af ag ah ai aj ak al am an ao ap aq ar in" data-testid="authorName" rel="noopener follow" href="/@mor2464?source=post_page-----d0c5de624597--------------------------------">Mor</a></p></div></div></div><span class="io ip" aria-hidden="true"><span class="bc b bd z dr">·</span></span><p class="bc b il im dr"><span><a class="iq ir ah ai aj ak al am an ao ap aq ar eu is it" rel="noopener follow" href="/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fdec0c9bdedb9&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40mor2464%2Fazure-ad-pass-the-certificate-d0c5de624597&amp;user=Mor&amp;userId=dec0c9bdedb9&amp;source=post_page-dec0c9bdedb9----d0c5de624597---------------------post_header-----------">Follow</a></span></p></div></div></span></div></div><div class="l iu"><span class="bc b bd z dr"><div class="ab ck iv iw ix"><span class="bc b bd z dr"><div class="ab ae"><span data-testid="storyReadTime">12 min read</span><div class="iy iz l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bc b bd z dr">·</span></span></div><span data-testid="storyPublishDate">Aug 19, 2020</span></div></span></div></span></div></div></div><div class="ab cm ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp"><div class="h k w fd fe q"><div class="kf l"><div class="ab q kg kh"><div class="pw-multi-vote-icon fg ki kj kk kl"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerClapButton" rel="noopener follow" href="/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2Fd0c5de624597&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40mor2464%2Fazure-ad-pass-the-certificate-d0c5de624597&amp;user=Mor&amp;userId=dec0c9bdedb9&amp;source=-----d0c5de624597---------------------clap_footer-----------"><div><div class="bj" aria-hidden="false" aria-describedby="3" aria-labelledby="3"><div class="km ao kn ko kp kq am kr ks kt kl"><svg width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.37.83L12 3.28l.63-2.45h-1.26zM13.92 3.95l1.52-2.1-1.18-.4-.34 2.5zM8.59 1.84l1.52 2.11-.34-2.5-1.18.4zM18.52 18.92a4.23 4.23 0 0 1-2.62 1.33l.41-.37c2.39-2.4 2.86-4.95 1.4-7.63l-.91-1.6-.8-1.67c-.25-.56-.19-.98.21-1.29a.7.7 0 0 1 .55-.13c.28.05.54.23.72.5l2.37 4.16c.97 1.62 1.14 4.23-1.33 6.7zm-11-.44l-4.15-4.15a.83.83 0 0 1 1.17-1.17l2.16 2.16a.37.37 0 0 0 .51-.52l-2.15-2.16L3.6 11.2a.83.83 0 0 1 1.17-1.17l3.43 3.44a.36.36 0 0 0 .52 0 .36.36 0 0 0 0-.52L5.29 9.51l-.97-.97a.83.83 0 0 1 0-1.16.84.84 0 0 1 1.17 0l.97.97 3.44 3.43a.36.36 0 0 0 .51 0 .37.37 0 0 0 0-.52L6.98 7.83a.82.82 0 0 1-.18-.9.82.82 0 0 1 .76-.51c.22 0 .43.09.58.24l5.8 5.79a.37.37 0 0 0 .58-.42L13.4 9.67c-.26-.56-.2-.98.2-1.29a.7.7 0 0 1 .55-.13c.28.05.55.23.73.5l2.2 3.86c1.3 2.38.87 4.59-1.29 6.75a4.65 4.65 0 0 1-4.19 1.37 7.73 7.73 0 0 1-4.07-2.25zm3.23-12.5l2.12 2.11c-.41.5-.47 1.17-.13 1.9l.22.46-3.52-3.53a.81.81 0 0 1-.1-.36c0-.23.09-.43.24-.59a.85.85 0 0 1 1.17 0zm7.36 1.7a1.86 1.86 0 0 0-1.23-.84 1.44 1.44 0 0 0-1.12.27c-.3.24-.5.55-.58.89-.25-.25-.57-.4-.91-.47-.28-.04-.56 0-.82.1l-2.18-2.18a1.56 1.56 0 0 0-2.2 0c-.2.2-.33.44-.4.7a1.56 1.56 0 0 0-2.63.75 1.6 1.6 0 0 0-2.23-.04 1.56 1.56 0 0 0 0 2.2c-.24.1-.5.24-.72.45a1.56 1.56 0 0 0 0 2.2l.52.52a1.56 1.56 0 0 0-.75 2.61L7 19a8.46 8.46 0 0 0 4.48 2.45 5.18 5.18 0 0 0 3.36-.5 4.89 4.89 0 0 0 4.2-1.51c2.75-2.77 2.54-5.74 1.43-7.59L18.1 7.68z"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l ku kv kw kx ky kz la"><p class="bc b ds z dr"><span class="lb">--</span></p></div></div></div><div><div class="bj" aria-hidden="false" aria-describedby="4" aria-labelledby="4"><button class="ao km lc ld ab q fh le lf" aria-label="responses"><svg width="24" height="24" viewBox="0 0 24 24" class="lg"><path d="M18 16.8a7.14 7.14 0 0 0 2.24-5.32c0-4.12-3.53-7.48-8.05-7.48C7.67 4 4 7.36 4 11.48c0 4.13 3.67 7.48 8.2 7.48a8.9 8.9 0 0 0 2.38-.32c.23.2.48.39.75.56 1.06.69 2.2 1.04 3.4 1.04.22 0 .4-.11.48-.29a.5.5 0 0 0-.04-.52 6.4 6.4 0 0 1-1.16-2.65v.02zm-3.12 1.06l-.06-.22-.32.1a8 8 0 0 1-2.3.33c-4.03 0-7.3-2.96-7.3-6.59S8.17 4.9 12.2 4.9c4 0 7.1 2.96 7.1 6.6 0 1.8-.6 3.47-2.02 4.72l-.2.16v.26l.02.3a6.74 6.74 0 0 0 .88 2.4 5.27 5.27 0 0 1-2.17-.86c-.28-.17-.72-.38-.94-.59l.01-.02z"></path></svg></button></div></div></div><div class="ab q jq jr js jt ju jv jw jx jy jz ka kb kc kd ke"><div class="lh k j i d"></div><div class="h k"><div><div class="bj" aria-hidden="false" aria-describedby="5" aria-labelledby="5"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerBookmarkButton" rel="noopener follow" href="/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd0c5de624597&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40mor2464%2Fazure-ad-pass-the-certificate-d0c5de624597&amp;source=-----d0c5de624597---------------------bookmark_footer-----------"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="dr li" aria-label="Add to list bookmark button"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="currentColor"></path></svg></a></span></div></div></div><div class="fa lj ck"><div class="l ae"><div class="ab by"><div class="lk ll lm ln lo lp cf be"><div class="ab"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" rel="noopener follow" href="/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2Fplans%3Fdimension%3Dpost_audio_button%26postId%3Dd0c5de624597&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40mor2464%2Fazure-ad-pass-the-certificate-d0c5de624597&amp;source=-----d0c5de624597---------------------post_audio_button-----------"><div><div class="bj" aria-hidden="false" aria-describedby="48" aria-labelledby="48"><button aria-label="Listen" data-testid="audioPlayButton" class="af fh ah ai aj ak al lq an ao ap eu lr ls lf lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0zm9-10a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm3.38 10.42l-4.6 3.06a.5.5 0 0 1-.78-.41V8.93c0-.4.45-.63.78-.41l4.6 3.06c.3.2.3.64 0 .84z" fill="currentColor"></path></svg><div class="j i d"><p class="bc b bd z dr">Listen</p></div></button></div></div></a></span></div></div></div></div></div><div class="bj" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bj" aria-hidden="false" aria-describedby="7" aria-labelledby="7"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af fh ah ai aj ak al lq an ao ap eu lr ls lf lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M15.22 4.93a.42.42 0 0 1-.12.13h.01a.45.45 0 0 1-.29.08.52.52 0 0 1-.3-.13L12.5 3v7.07a.5.5 0 0 1-.5.5.5.5 0 0 1-.5-.5V3.02l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.8a.42.42 0 0 1 .07.5zm-.1.14zm.88 2h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11a2 2 0 0 1-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.14c.1.1.15.22.15.35a.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9V8.96c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1z" fill="currentColor"></path></svg><div class="j i d"><p class="bc b bd z dr">Share</p></div></button></div></div></div></div></div></div></div></div></div><h1 id="a80c" class="mi mj gr bc mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bh" data-selectable-paragraph="">Intro</h1><p id="600a" class="pw-post-body-paragraph ng nh gr ni b nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od gk bh" data-selectable-paragraph="">With the evolvement of Azure and Pass-Through authentication, many organizations are connecting devices to Azure AD, making the authentication and management easier. Azure AD devices can be connected only to Azure AD and no longer to On-Prem AD, raising the question how attackers can get access to those machines.</p><p id="9b49" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">We have already seen the blog post on <a class="af oj" rel="noopener" href="/@talthemaor/lateral-movement-graph-for-azure-ad-7c5e0136e2d8">Azure AD lateral Movement</a> and Mimikatz <a class="af oj" href="https://blog.stealthbits.com/lateral-movement-to-the-cloud-pass-the-prt/" rel="noopener ugc nofollow" target="_blank">“Pass The PRT</a>” attack. Now we only need to find out how to jump between Azure AD joined machines which no longer supports the known authentication protocols.</p><p id="0256" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">In this blog post I’ll provide network <strong class="ni gs">behavior analysis</strong> of the new authentication mechanism between 2 Azure AD joined machines, I’ll also explain what is <strong class="ni gs">Azure AD P2P certificate</strong> and how it is generated.</p><p id="8041" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">After learning the necessary information, we will dive into <strong class="ni gs">“Pass The Certificate”</strong> attack that works against Azure AD joined machines and let you gain access to remote machines. This attack use the PRT from Azure AD machine to gain P2P certificates and by using the certificate, to gain permanent access to any Azure AD joined machine (if sufficient privileges).</p><h1 id="d7e8" class="mi mj gr bc mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bh" data-selectable-paragraph="">Azure AD machine</h1><p id="88cf" class="pw-post-body-paragraph ng nh gr ni b nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od gk bh" data-selectable-paragraph="">There are 3 ways to connect a device to Azure AD:</p><ul class=""><li id="42e3" class="ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od ok ol om bh" data-selectable-paragraph="">Azure AD registered — devices that are registered in Azure but can be accessed using Microsoft account or local account.</li><li id="141f" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Azure AD joined — devices that are joined to Azure and can be accessed only by local user or Azure AD user. Those machines are managed in Azure.</li><li id="27ab" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Hybrid Azure AD joined — devices that are joined both to Azure AD and to On-Prem AD, and can be accessed by Azure AD accounts, On-Prem accounts and local accounts.</li></ul></div></div></div><div class="ab by os ot ou ov" role="separator"><span class="ow bv bj ox oy oz"></span><span class="ow bv bj ox oy oz"></span><span class="ow bv bj ox oy"></span></div><div class="gk gl gm gn go"><div class="ab by"><div class="cf be fw fx fy fz"><p id="441e" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">Azure AD joined machines support only 2 mech types for authentication, NegoEx (1.3.6.1.4.1.311.2.2.30) and NtlmSSP (1.3.6.1.4.1.311.2.2.10). We already know how NTLM protocol works, and it also supported by Azure AD joined machines for local user authentication.</p><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb pc"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*j453dyDiUEORPQUTeFE42A.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*j453dyDiUEORPQUTeFE42A.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*j453dyDiUEORPQUTeFE42A.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*j453dyDiUEORPQUTeFE42A.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*j453dyDiUEORPQUTeFE42A.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*j453dyDiUEORPQUTeFE42A.png 1100w, https://miro.medium.com/v2/resize:fit:1248/format:webp/1*j453dyDiUEORPQUTeFE42A.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*j453dyDiUEORPQUTeFE42A.png 640w, https://miro.medium.com/v2/resize:fit:720/1*j453dyDiUEORPQUTeFE42A.png 720w, https://miro.medium.com/v2/resize:fit:750/1*j453dyDiUEORPQUTeFE42A.png 750w, https://miro.medium.com/v2/resize:fit:786/1*j453dyDiUEORPQUTeFE42A.png 786w, https://miro.medium.com/v2/resize:fit:828/1*j453dyDiUEORPQUTeFE42A.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*j453dyDiUEORPQUTeFE42A.png 1100w, https://miro.medium.com/v2/resize:fit:1248/1*j453dyDiUEORPQUTeFE42A.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px"><img alt="" class="be lp pj c" width="624" height="114" loading="eager" role="presentation" src="https://miro.medium.com/v2/resize:fit:780/1*j453dyDiUEORPQUTeFE42A.png"></picture></div><figcaption class="pk fc pl pa pb pm pn bc b bd z dr" data-selectable-paragraph="">MechTypes</figcaption></figure><p id="b71a" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">let’s look on the authentication process between 2 Azure AD joined machines, where the client in the left, the initiator, try to authenticate and access the client in the right, the acceptor.</p><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div role="button" tabindex="0" class="pp pq fg pr be ps"><div class="pa pb po"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*63wq7BNs0ud47Xkxmj8EEA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*63wq7BNs0ud47Xkxmj8EEA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*63wq7BNs0ud47Xkxmj8EEA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*63wq7BNs0ud47Xkxmj8EEA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*63wq7BNs0ud47Xkxmj8EEA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*63wq7BNs0ud47Xkxmj8EEA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*63wq7BNs0ud47Xkxmj8EEA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*63wq7BNs0ud47Xkxmj8EEA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*63wq7BNs0ud47Xkxmj8EEA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*63wq7BNs0ud47Xkxmj8EEA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*63wq7BNs0ud47Xkxmj8EEA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*63wq7BNs0ud47Xkxmj8EEA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*63wq7BNs0ud47Xkxmj8EEA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*63wq7BNs0ud47Xkxmj8EEA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp pj c" width="700" height="413" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/1*63wq7BNs0ud47Xkxmj8EEA.png"></picture></div></div><figcaption class="pk fc pl pa pb pm pn bc b bd z dr" data-selectable-paragraph="">Authentication process between 2 Azure AD Machines</figcaption></figure><ol class=""><li id="b87a" class="ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od pt ol om bh" data-selectable-paragraph="">This step is simple SMB negotiation. In the end of this step, both sides will agree on SMB dialect and will find out what are the mech types supported by the other client. If both support NegoEx, then we will proceed to step 2, otherwise we will proceed to the known NTLM authentication (or other authentication mechanism if they both support it).</li><li id="bddd" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">If the initiator already has P2P certificate, then we will skip steps 2–4 and proceed to step 5. Otherwise, the initiator will request Nonce from Azure AD that will be used for P2P certificate request.</li><li id="761b" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">Azure AD will generate a Nonce that will be signed by the requestor in the next request, to prove that the second request is not passed from man in the middle attack or reused.</li><li id="0cbe" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">The client will build JWT. They will generate random context and place it in the header. In the JWT message they will provide the CSR (certificate signing request) and the PRT. The JWT will be signed by the derived key generated from the context and the session key.</li><li id="7526" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">Azure AD will validate the JWT using the derived key and if the verification succeeded, it would generate X.509 certificate and send it in the response. This certificate is a P2P (peer-to-peer) certificate and only the client who initiated the request should have the private key associated with the public key.</li><li id="87de" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">The initiator will send multiple NegoEx messages, where the important message is AP request. AP request message is a Kerberos PKU2U request which is the same as Kerberos PKI AS request (TGT request).</li><li id="aaec" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">The acceptor will send back multiple NegoEx messages, where the important message is challenge. This message is a Kerberos PKU2U response which is the same as Kerberos PKI AS response (TGT response).</li><li id="510d" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">The initiator will send 2 NegoEx messages, ap request and verify. The AP request message will be Kerberos AP request to resource using the TGT from the previous stage. Verify message is a checksum message of all the previous NegoEx messages using HMAC_SHA1_96_AES256. The verify message is required, the acceptor will deny the request without it (or with wrong checksum).</li><li id="e9fc" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">The acceptor will validate the checksum and the AP request messages received from the initiator. If the verification succeeded, they would send 2 NegoEx messages, challenge and verify. The challenge message will be Kerberos AP response from the resource, validating that resource is the one you authenticated to. Verify message is a checksum message like in the previous request (8). In this response, the verify message will also contain the checksum of the messages from the previous stage including the challenge.</li></ol></div></div></div><div class="ab by os ot ou ov" role="separator"><span class="ow bv bj ox oy oz"></span><span class="ow bv bj ox oy oz"></span><span class="ow bv bj ox oy"></span></div><div class="gk gl gm gn go"><div class="ab by"><div class="cf be fw fx fy fz"><h1 id="4d9d" class="mi mj gr bc mk ml pu mn mo mp pv mr ms mt pw mv mw mx px mz na nb py nd ne nf bh" data-selectable-paragraph="">PKU2U</h1><p id="d703" class="pw-post-body-paragraph ng nh gr ni b nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od gk bh" data-selectable-paragraph="">Public Key Cryptography Based User-to-User authentication is a Kerberos PKI extension that removes the KDC from the equation and allow peer-to-peer (client to client) authentication. In this protocol, the realm name changed to the constant “WELLKNOWN:PKU2U”. The difference from Kerberos PKI is that the acceptor (the client we try to connect to) is acting as the KDC, the acceptor will issue a Kerberos ticket that later will be used by the initiator (the client want to authenticate to the acceptor) to prove that they can extract the session key associated with the ticket. It’s also important to mention that PKU2U protocol data units (PDUs) can’t be exchanged as usual Kerberos but wrapped as GSS-API context tokens.</p><p id="6387" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">These are the steps to perform PKU2U authentication:</p><ol class=""><li id="9c6c" class="ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od pt ol om bh" data-selectable-paragraph="">The initiator generates Kerberos PKI AS request (with the new realm).</li><li id="14af" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">The acceptor verifies the authenticator and PADATA in the request.</li><li id="0039" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">If the verification succeeded, the acceptor generate ticket that proves the verification of the initiator, and like in Kerberos PKI, encrypt it with the session key (public-key or Diffie-Hellman).</li><li id="c3f2" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">The initiator receives the AS response packet, decrypt the relevant parts, and extract the second session key that will be used for the second request.</li><li id="06f5" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">The initiator generates Kerberos AP request packet using the ticket and the session key from the previous stage and send it to the acceptor.</li><li id="a972" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">The acceptor receives the packet and validates the ticket and the authenticator like in normal AP request.</li><li id="220f" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">If the acceptor succeeded to verify the AP request, it will generate AP response and send it back to the initiator.</li><li id="dbf7" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">The initiator will receive the AP response and validate the authenticator.</li><li id="0b44" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">If the initiator succeeded to verify the AP response, connection is established between the initiator and the acceptor.</li></ol><h1 id="77f4" class="mi mj gr bc mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bh" data-selectable-paragraph="">SPNEGO</h1><p id="c6f2" class="pw-post-body-paragraph ng nh gr ni b nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od gk bh" data-selectable-paragraph="">Simple and Protected GSS-API (Generic Security Service Application Program Interface) Negotiation Mechanism which play a key role in the negotiation process for choosing the security mechanism to use, in our case it will be NTLM or NegoEx. It’s a known negotiation protocol so we will not go into more details.</p><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb pc"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*hruHeY_4KWxq-nKy2Sojhg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*hruHeY_4KWxq-nKy2Sojhg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*hruHeY_4KWxq-nKy2Sojhg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*hruHeY_4KWxq-nKy2Sojhg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*hruHeY_4KWxq-nKy2Sojhg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*hruHeY_4KWxq-nKy2Sojhg.png 1100w, https://miro.medium.com/v2/resize:fit:1248/format:webp/1*hruHeY_4KWxq-nKy2Sojhg.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*hruHeY_4KWxq-nKy2Sojhg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*hruHeY_4KWxq-nKy2Sojhg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*hruHeY_4KWxq-nKy2Sojhg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*hruHeY_4KWxq-nKy2Sojhg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*hruHeY_4KWxq-nKy2Sojhg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*hruHeY_4KWxq-nKy2Sojhg.png 1100w, https://miro.medium.com/v2/resize:fit:1248/1*hruHeY_4KWxq-nKy2Sojhg.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px"><img alt="" class="be lp pj c" width="624" height="91" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:780/1*hruHeY_4KWxq-nKy2Sojhg.png"></picture></div></figure><h1 id="7ba0" class="mi mj gr bc mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bh" data-selectable-paragraph="">NegoEx</h1><p id="54fa" class="pw-post-body-paragraph ng nh gr ni b nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od gk bh" data-selectable-paragraph="">SPNEGO Extended Negotiation security mechanism. When the NEGOEX security mechanism is selected by SPNEGO, it provides a method allowing selection of a common authentication protocol based on factors beyond just the fact that both client and server support a given security mechanism.</p><p id="510f" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">There are 7 types of messages that are used in authentication:</p><ul class=""><li id="b3a3" class="ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od ok ol om bh" data-selectable-paragraph="">Initiator Nego — used for sending the authentication schema, like hello message.</li><li id="2549" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Acceptor Nego — used for sending authentication schema from the acceptor if needed.</li><li id="996f" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Initiator Metadata — used for sending the metadata (GSS-API token) of the initiator if needed.</li><li id="bb87" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Acceptor Metadata — used for sending the metadata (GSS-API token) of the acceptor if needed.</li><li id="6291" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Challenge — used for accepting the initiator AP Request, contains Kerberos response messages.</li><li id="5e24" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">AP Request — used for authenticating to the acceptor, contains Kerberos request messages.</li><li id="b534" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Verify — used for verifying the conversation.</li><li id="7ffd" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Alert — used to notify on errors in the authentication.</li></ul><p id="8605" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">The flow as it described in MS-NEGOEX:</p><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb pz"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*6ROjM0NzWynhM9Mmhi3Liw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*6ROjM0NzWynhM9Mmhi3Liw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*6ROjM0NzWynhM9Mmhi3Liw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*6ROjM0NzWynhM9Mmhi3Liw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*6ROjM0NzWynhM9Mmhi3Liw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*6ROjM0NzWynhM9Mmhi3Liw.png 1100w, https://miro.medium.com/v2/resize:fit:1170/format:webp/1*6ROjM0NzWynhM9Mmhi3Liw.png 1170w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 585px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*6ROjM0NzWynhM9Mmhi3Liw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*6ROjM0NzWynhM9Mmhi3Liw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*6ROjM0NzWynhM9Mmhi3Liw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*6ROjM0NzWynhM9Mmhi3Liw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*6ROjM0NzWynhM9Mmhi3Liw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*6ROjM0NzWynhM9Mmhi3Liw.png 1100w, https://miro.medium.com/v2/resize:fit:1170/1*6ROjM0NzWynhM9Mmhi3Liw.png 1170w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 585px"><img alt="" class="be lp pj c" width="585" height="582" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:731/1*6ROjM0NzWynhM9Mmhi3Liw.png"></picture></div></figure><p id="38a3" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">Let’s quickly go over the message types:</p><p id="1b58" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">First, let’s understand the structure of the MESSAGE_HEADER since it required in every message. It is used to provide metadata about each message. According to the <a class="af oj" href="https://tools.ietf.org/html/draft-zhu-negoex-04" rel="noopener ugc nofollow" target="_blank">RFC</a>, the structure will be</p><p id="b03b" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">struct{</p><p id="7f83" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">ULONG64 Signature; // contains MESSAGE_SIGNATURE</p><p id="d76e" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">MESSAGE_TYPE MessageType;</p><p id="0c36" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">ULONG SequenceNum; // the message sequence number of this,</p><p id="13f9" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">// conversation, starting with 0 and sequentially</p><p id="a5f9" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">// incremented</p><p id="4a22" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">ULONG cbHeaderLength; // the header length of this message,</p><p id="f8ed" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">// including the message specific header, excluding the</p><p id="8742" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">// payload</p><p id="096a" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">ULONG cbMessageLength; // the length of this message</p><p id="96a2" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">CONVERSATION_ID ConversationId;</p><p id="1a0e" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">} MESSAGE_HEADER;</p><p id="8760" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">The fields will be:</p><ol class=""><li id="59ce" class="ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od pt ol om bh" data-selectable-paragraph="">The Signature that will be “NEGOEXTS” as constant.</li><li id="cb71" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">The message type, 1 of the 7 types listed above.</li><li id="ac61" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">The sequence number of the message which will be required for signing the message in the verify message by the order they sent.</li><li id="d8c6" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">The header struct size.</li><li id="568b" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">Length of the message.</li><li id="60ca" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od pt ol om bh" data-selectable-paragraph="">Conversation id that should be the same for every message during the same authentication session.</li></ol><blockquote class="qa qb qc"><p id="febc" class="ng nh qd ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">We will not get into NegoEx details since those are typical GSSAPI messages. It’s important to say that Initiator Nego, Acceptor Nego, Initiator Metadata, Acceptor Metadata and alert messages don’t have any “secret” (they can be generated without the private key or any secret). But, those messages required to generate the verify message which requires checksum over all the previous messages by the order they sent.</p></blockquote><h1 id="5430" class="mi mj gr bc mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bh" data-selectable-paragraph="">Nego messages</h1><p id="7a99" class="pw-post-body-paragraph ng nh gr ni b nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od gk bh" data-selectable-paragraph="">The Nego messages used to begin and exchange negotiation of security mechanisms. First the initiator will send Nego message with message type 0 (INITIATOR_NEGO) and a list of supported security mechanisms (MechTypes) to begin the negotiation. Afterwards, the acceptor will respond with Nego message with message type 1 (ACCEPTOR_NEGO) and the list of supported security mechanisms.</p><h2 id="3664" class="qe mj gr bc mk qf qg dv mo qh qi dx ms nr qj qk ql nv qm qn qo nz qp qq qr qs bh" data-selectable-paragraph="">Initiator Nego</h2><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb qt"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*R_5RRBjAbSrez4pw-n7GzA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*R_5RRBjAbSrez4pw-n7GzA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*R_5RRBjAbSrez4pw-n7GzA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*R_5RRBjAbSrez4pw-n7GzA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*R_5RRBjAbSrez4pw-n7GzA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*R_5RRBjAbSrez4pw-n7GzA.png 1100w, https://miro.medium.com/v2/resize:fit:1118/format:webp/1*R_5RRBjAbSrez4pw-n7GzA.png 1118w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 559px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*R_5RRBjAbSrez4pw-n7GzA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*R_5RRBjAbSrez4pw-n7GzA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*R_5RRBjAbSrez4pw-n7GzA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*R_5RRBjAbSrez4pw-n7GzA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*R_5RRBjAbSrez4pw-n7GzA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*R_5RRBjAbSrez4pw-n7GzA.png 1100w, https://miro.medium.com/v2/resize:fit:1118/1*R_5RRBjAbSrez4pw-n7GzA.png 1118w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 559px"><img alt="" class="be lp pj c" width="559" height="323" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:699/1*R_5RRBjAbSrez4pw-n7GzA.png"></picture></div><figcaption class="pk fc pl pa pb pm pn bc b bd z dr" data-selectable-paragraph="">Initiator Nego message</figcaption></figure><h2 id="1c7f" class="qe mj gr bc mk qf qg dv mo qh qi dx ms nr qj qk ql nv qm qn qo nz qp qq qr qs bh" data-selectable-paragraph="">Acceptor Nego</h2><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb qu"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*7rwNiFwAOZ3EiiDcEC5Wsg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*7rwNiFwAOZ3EiiDcEC5Wsg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*7rwNiFwAOZ3EiiDcEC5Wsg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*7rwNiFwAOZ3EiiDcEC5Wsg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*7rwNiFwAOZ3EiiDcEC5Wsg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*7rwNiFwAOZ3EiiDcEC5Wsg.png 1100w, https://miro.medium.com/v2/resize:fit:1104/format:webp/1*7rwNiFwAOZ3EiiDcEC5Wsg.png 1104w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 552px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*7rwNiFwAOZ3EiiDcEC5Wsg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*7rwNiFwAOZ3EiiDcEC5Wsg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*7rwNiFwAOZ3EiiDcEC5Wsg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*7rwNiFwAOZ3EiiDcEC5Wsg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*7rwNiFwAOZ3EiiDcEC5Wsg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*7rwNiFwAOZ3EiiDcEC5Wsg.png 1100w, https://miro.medium.com/v2/resize:fit:1104/1*7rwNiFwAOZ3EiiDcEC5Wsg.png 1104w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 552px"><img alt="" class="be lp pj c" width="552" height="329" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:690/1*7rwNiFwAOZ3EiiDcEC5Wsg.png"></picture></div><figcaption class="pk fc pl pa pb pm pn bc b bd z dr" data-selectable-paragraph="">Acceptor Nego message</figcaption></figure><h1 id="0a0f" class="mi mj gr bc mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bh" data-selectable-paragraph="">Exchange messages</h1><p id="ec06" class="pw-post-body-paragraph ng nh gr ni b nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od gk bh" data-selectable-paragraph="">Those messages are used to encapsulate context tokens of the negotiated security mechanism.</p><h2 id="1f08" class="qe mj gr bc mk qf qg dv mo qh qi dx ms nr qj qk ql nv qm qn qo nz qp qq qr qs bh" data-selectable-paragraph="">Initiator Metadata</h2><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb pc"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*PssoJ53lGSqZW8vJXKmx9w.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*PssoJ53lGSqZW8vJXKmx9w.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*PssoJ53lGSqZW8vJXKmx9w.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*PssoJ53lGSqZW8vJXKmx9w.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*PssoJ53lGSqZW8vJXKmx9w.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*PssoJ53lGSqZW8vJXKmx9w.png 1100w, https://miro.medium.com/v2/resize:fit:1248/format:webp/1*PssoJ53lGSqZW8vJXKmx9w.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*PssoJ53lGSqZW8vJXKmx9w.png 640w, https://miro.medium.com/v2/resize:fit:720/1*PssoJ53lGSqZW8vJXKmx9w.png 720w, https://miro.medium.com/v2/resize:fit:750/1*PssoJ53lGSqZW8vJXKmx9w.png 750w, https://miro.medium.com/v2/resize:fit:786/1*PssoJ53lGSqZW8vJXKmx9w.png 786w, https://miro.medium.com/v2/resize:fit:828/1*PssoJ53lGSqZW8vJXKmx9w.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*PssoJ53lGSqZW8vJXKmx9w.png 1100w, https://miro.medium.com/v2/resize:fit:1248/1*PssoJ53lGSqZW8vJXKmx9w.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px"><img alt="" class="be lp pj c" width="624" height="211" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:780/1*PssoJ53lGSqZW8vJXKmx9w.png"></picture></div><figcaption class="pk fc pl pa pb pm pn bc b bd z dr" data-selectable-paragraph="">Acceptor Metadata message</figcaption></figure><p id="a845" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">Where the exchange bytes are Asn1 struct and they are the metadata token.</p><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb pc"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*MXHUNedSbe0PAqFrP2WYBA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*MXHUNedSbe0PAqFrP2WYBA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*MXHUNedSbe0PAqFrP2WYBA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*MXHUNedSbe0PAqFrP2WYBA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*MXHUNedSbe0PAqFrP2WYBA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*MXHUNedSbe0PAqFrP2WYBA.png 1100w, https://miro.medium.com/v2/resize:fit:1248/format:webp/1*MXHUNedSbe0PAqFrP2WYBA.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*MXHUNedSbe0PAqFrP2WYBA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*MXHUNedSbe0PAqFrP2WYBA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*MXHUNedSbe0PAqFrP2WYBA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*MXHUNedSbe0PAqFrP2WYBA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*MXHUNedSbe0PAqFrP2WYBA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*MXHUNedSbe0PAqFrP2WYBA.png 1100w, https://miro.medium.com/v2/resize:fit:1248/1*MXHUNedSbe0PAqFrP2WYBA.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px"><img alt="" class="be lp pj c" width="624" height="197" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:780/1*MXHUNedSbe0PAqFrP2WYBA.png"></picture></div></figure><h2 id="ebeb" class="qe mj gr bc mk qf qg dv mo qh qi dx ms nr qj qk ql nv qm qn qo nz qp qq qr qs bh" data-selectable-paragraph="">Acceptor Metadata</h2><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb pc"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*iNKOPsYXOCgCw-LkLfcwlQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*iNKOPsYXOCgCw-LkLfcwlQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*iNKOPsYXOCgCw-LkLfcwlQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*iNKOPsYXOCgCw-LkLfcwlQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*iNKOPsYXOCgCw-LkLfcwlQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*iNKOPsYXOCgCw-LkLfcwlQ.png 1100w, https://miro.medium.com/v2/resize:fit:1248/format:webp/1*iNKOPsYXOCgCw-LkLfcwlQ.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*iNKOPsYXOCgCw-LkLfcwlQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*iNKOPsYXOCgCw-LkLfcwlQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*iNKOPsYXOCgCw-LkLfcwlQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*iNKOPsYXOCgCw-LkLfcwlQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*iNKOPsYXOCgCw-LkLfcwlQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*iNKOPsYXOCgCw-LkLfcwlQ.png 1100w, https://miro.medium.com/v2/resize:fit:1248/1*iNKOPsYXOCgCw-LkLfcwlQ.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px"><img alt="" class="be lp pj c" width="624" height="214" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:780/1*iNKOPsYXOCgCw-LkLfcwlQ.png"></picture></div></figure><p id="1715" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">Where the exchange bytes are Asn1 struct and they are the metadata token.</p><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb pc"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*JeJ87Rjf7bBrBqDDn2GX9g.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*JeJ87Rjf7bBrBqDDn2GX9g.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*JeJ87Rjf7bBrBqDDn2GX9g.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*JeJ87Rjf7bBrBqDDn2GX9g.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*JeJ87Rjf7bBrBqDDn2GX9g.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*JeJ87Rjf7bBrBqDDn2GX9g.png 1100w, https://miro.medium.com/v2/resize:fit:1248/format:webp/1*JeJ87Rjf7bBrBqDDn2GX9g.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*JeJ87Rjf7bBrBqDDn2GX9g.png 640w, https://miro.medium.com/v2/resize:fit:720/1*JeJ87Rjf7bBrBqDDn2GX9g.png 720w, https://miro.medium.com/v2/resize:fit:750/1*JeJ87Rjf7bBrBqDDn2GX9g.png 750w, https://miro.medium.com/v2/resize:fit:786/1*JeJ87Rjf7bBrBqDDn2GX9g.png 786w, https://miro.medium.com/v2/resize:fit:828/1*JeJ87Rjf7bBrBqDDn2GX9g.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*JeJ87Rjf7bBrBqDDn2GX9g.png 1100w, https://miro.medium.com/v2/resize:fit:1248/1*JeJ87Rjf7bBrBqDDn2GX9g.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px"><img alt="" class="be lp pj c" width="624" height="112" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:780/1*JeJ87Rjf7bBrBqDDn2GX9g.png"></picture></div></figure><h2 id="91c6" class="qe mj gr bc mk qf qg dv mo qh qi dx ms nr qj qk ql nv qm qn qo nz qp qq qr qs bh" data-selectable-paragraph="">AP Request</h2><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb qv"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*YZiN61VJG8ze-D9EWcdbeA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*YZiN61VJG8ze-D9EWcdbeA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*YZiN61VJG8ze-D9EWcdbeA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*YZiN61VJG8ze-D9EWcdbeA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*YZiN61VJG8ze-D9EWcdbeA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*YZiN61VJG8ze-D9EWcdbeA.png 1100w, https://miro.medium.com/v2/resize:fit:940/format:webp/1*YZiN61VJG8ze-D9EWcdbeA.png 940w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 470px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*YZiN61VJG8ze-D9EWcdbeA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*YZiN61VJG8ze-D9EWcdbeA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*YZiN61VJG8ze-D9EWcdbeA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*YZiN61VJG8ze-D9EWcdbeA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*YZiN61VJG8ze-D9EWcdbeA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*YZiN61VJG8ze-D9EWcdbeA.png 1100w, https://miro.medium.com/v2/resize:fit:940/1*YZiN61VJG8ze-D9EWcdbeA.png 940w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 470px"><img alt="" class="be lp pj c" width="470" height="240" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:588/1*YZiN61VJG8ze-D9EWcdbeA.png"></picture></div><figcaption class="pk fc pl pa pb pm pn bc b bd z dr" data-selectable-paragraph="">AP request message</figcaption></figure><p id="5e39" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">The challenge is like Kerberos AS/AP request. The exchange bytes contain the PKU2U PDUs.</p><h2 id="62ce" class="qe mj gr bc mk qf qg dv mo qh qi dx ms nr qj qk ql nv qm qn qo nz qp qq qr qs bh" data-selectable-paragraph="">Challenge</h2><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb qw"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*0DmTPac0RDrxBIIR7tv5Ew.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*0DmTPac0RDrxBIIR7tv5Ew.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*0DmTPac0RDrxBIIR7tv5Ew.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*0DmTPac0RDrxBIIR7tv5Ew.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*0DmTPac0RDrxBIIR7tv5Ew.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*0DmTPac0RDrxBIIR7tv5Ew.png 1100w, https://miro.medium.com/v2/resize:fit:880/format:webp/1*0DmTPac0RDrxBIIR7tv5Ew.png 880w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 440px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*0DmTPac0RDrxBIIR7tv5Ew.png 640w, https://miro.medium.com/v2/resize:fit:720/1*0DmTPac0RDrxBIIR7tv5Ew.png 720w, https://miro.medium.com/v2/resize:fit:750/1*0DmTPac0RDrxBIIR7tv5Ew.png 750w, https://miro.medium.com/v2/resize:fit:786/1*0DmTPac0RDrxBIIR7tv5Ew.png 786w, https://miro.medium.com/v2/resize:fit:828/1*0DmTPac0RDrxBIIR7tv5Ew.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*0DmTPac0RDrxBIIR7tv5Ew.png 1100w, https://miro.medium.com/v2/resize:fit:880/1*0DmTPac0RDrxBIIR7tv5Ew.png 880w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 440px"><img alt="" class="be lp pj c" width="440" height="239" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:550/1*0DmTPac0RDrxBIIR7tv5Ew.png"></picture></div><figcaption class="pk fc pl pa pb pm pn bc b bd z dr" data-selectable-paragraph="">Challenge message</figcaption></figure><p id="6cc5" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">The challenge is like Kerberos AS/AP response. The exchange bytes contain the PKU2U PDUs.</p><h2 id="e830" class="qe mj gr bc mk qf qg dv mo qh qi dx ms nr qj qk ql nv qm qn qo nz qp qq qr qs bh" data-selectable-paragraph="">Verify</h2><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb qx"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*fo6ZpH34Mng59TF2cqPCQw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*fo6ZpH34Mng59TF2cqPCQw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*fo6ZpH34Mng59TF2cqPCQw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*fo6ZpH34Mng59TF2cqPCQw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*fo6ZpH34Mng59TF2cqPCQw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*fo6ZpH34Mng59TF2cqPCQw.png 1100w, https://miro.medium.com/v2/resize:fit:936/format:webp/1*fo6ZpH34Mng59TF2cqPCQw.png 936w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 468px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*fo6ZpH34Mng59TF2cqPCQw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*fo6ZpH34Mng59TF2cqPCQw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*fo6ZpH34Mng59TF2cqPCQw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*fo6ZpH34Mng59TF2cqPCQw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*fo6ZpH34Mng59TF2cqPCQw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*fo6ZpH34Mng59TF2cqPCQw.png 1100w, https://miro.medium.com/v2/resize:fit:936/1*fo6ZpH34Mng59TF2cqPCQw.png 936w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 468px"><img alt="" class="be lp pj c" width="468" height="319" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:585/1*fo6ZpH34Mng59TF2cqPCQw.png"></picture></div><figcaption class="pk fc pl pa pb pm pn bc b bd z dr" data-selectable-paragraph="">Verify message</figcaption></figure><p id="7635" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">The verify message is sent by both the initiator and acceptor. This packet ensures that both sides participated in the whole conversation. This message protects from replay attacks by generating a checksum of all the previous NegoEx messages sent in the conversation, those message checksum by the session key which both the initiator and the acceptor agree on during the authentication.</p></div></div></div><div class="ab by os ot ou ov" role="separator"><span class="ow bv bj ox oy oz"></span><span class="ow bv bj ox oy oz"></span><span class="ow bv bj ox oy"></span></div><div class="gk gl gm gn go"><div class="ab by"><div class="cf be fw fx fy fz"><h1 id="2866" class="mi mj gr bc mk ml pu mn mo mp pv mr ms mt pw mv mw mx px mz na nb py nd ne nf bh" data-selectable-paragraph="">Azure AD certificate</h1><p id="cb4b" class="pw-post-body-paragraph ng nh gr ni b nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od gk bh" data-selectable-paragraph="">For client authentication between 2 Azure AD joined machines, certificate must be issued by Azure AD CA for the required user (as the subject). Certificate will be automatically requested by the Windows machine using the function aadcloudap!GetUserCertificate when the negotiated security mechanism is NegoEx.</p><p id="9bd4" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">As you can see bellow, the output will be certificate that can be used using PKU2U for client to client authentication and will be issued by the CA “MS-Organization-P2P-Access [2020]”.</p><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb qy"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*U2DL5S7kdZfLsxyK7DmY4Q.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*U2DL5S7kdZfLsxyK7DmY4Q.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*U2DL5S7kdZfLsxyK7DmY4Q.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*U2DL5S7kdZfLsxyK7DmY4Q.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*U2DL5S7kdZfLsxyK7DmY4Q.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*U2DL5S7kdZfLsxyK7DmY4Q.png 1100w, https://miro.medium.com/v2/resize:fit:1132/format:webp/1*U2DL5S7kdZfLsxyK7DmY4Q.png 1132w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 566px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*U2DL5S7kdZfLsxyK7DmY4Q.png 640w, https://miro.medium.com/v2/resize:fit:720/1*U2DL5S7kdZfLsxyK7DmY4Q.png 720w, https://miro.medium.com/v2/resize:fit:750/1*U2DL5S7kdZfLsxyK7DmY4Q.png 750w, https://miro.medium.com/v2/resize:fit:786/1*U2DL5S7kdZfLsxyK7DmY4Q.png 786w, https://miro.medium.com/v2/resize:fit:828/1*U2DL5S7kdZfLsxyK7DmY4Q.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*U2DL5S7kdZfLsxyK7DmY4Q.png 1100w, https://miro.medium.com/v2/resize:fit:1132/1*U2DL5S7kdZfLsxyK7DmY4Q.png 1132w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 566px"><img alt="" class="be lp pj c" width="566" height="307" loading="eager" role="presentation" src="https://miro.medium.com/v2/resize:fit:708/1*U2DL5S7kdZfLsxyK7DmY4Q.png"></picture></div><figcaption class="pk fc pl pa pb pm pn bc b bd z dr" data-selectable-paragraph="">Azure AD P2P Certificate</figcaption></figure><p id="5c5e" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">The process of requesting certificate is as follow (those are steps 2–5 authentication process between 2 Azure AD machines illustration in the beginning of the post).</p><p id="150a" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">The client must request nonce by sending grant type of srv_challenge to “login.microsoftonline.com” using the tenant id of his organization.</p><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb pc"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*TGOkhBxpKY8Hd8ttwHq83g.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*TGOkhBxpKY8Hd8ttwHq83g.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*TGOkhBxpKY8Hd8ttwHq83g.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*TGOkhBxpKY8Hd8ttwHq83g.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*TGOkhBxpKY8Hd8ttwHq83g.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*TGOkhBxpKY8Hd8ttwHq83g.png 1100w, https://miro.medium.com/v2/resize:fit:1248/format:webp/1*TGOkhBxpKY8Hd8ttwHq83g.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*TGOkhBxpKY8Hd8ttwHq83g.png 640w, https://miro.medium.com/v2/resize:fit:720/1*TGOkhBxpKY8Hd8ttwHq83g.png 720w, https://miro.medium.com/v2/resize:fit:750/1*TGOkhBxpKY8Hd8ttwHq83g.png 750w, https://miro.medium.com/v2/resize:fit:786/1*TGOkhBxpKY8Hd8ttwHq83g.png 786w, https://miro.medium.com/v2/resize:fit:828/1*TGOkhBxpKY8Hd8ttwHq83g.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*TGOkhBxpKY8Hd8ttwHq83g.png 1100w, https://miro.medium.com/v2/resize:fit:1248/1*TGOkhBxpKY8Hd8ttwHq83g.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px"><img alt="" class="be lp pj c" width="624" height="216" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:780/1*TGOkhBxpKY8Hd8ttwHq83g.png"></picture></div><figcaption class="pk fc pl pa pb pm pn bc b bd z dr" data-selectable-paragraph="">Nonce request — Fiddler</figcaption></figure><p id="a66c" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">After receiving the Nonce, a second request should be made to request for certificate using the following parameters:</p><ul class=""><li id="9760" class="ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od ok ol om bh" data-selectable-paragraph="">grant_type of “urn:ietf:params:oauth:grant-type:jwt-bearer”</li><li id="cc17" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">request that will contain the json web token (JWT).</li></ul><p id="467b" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">In the request, the client will have to generate the following:</p><ul class=""><li id="5773" class="ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od ok ol om bh" data-selectable-paragraph="">Security context.</li><li id="ec22" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Certificate signing request (CSR).</li><li id="c8a7" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Derived key using the client session key and the security context.</li></ul><p id="54c8" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">After generating the required information, the client will have to generate json web token (JWT). In the JWT header the client will provide the security context and algorithm (that will be HS256 — HMAC SHA256), and in the message they will provide the following fields:</p><ul class=""><li id="e1ec" class="ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od ok ol om bh" data-selectable-paragraph="">Iss — issuer and signer of the token (it will always be “aad:brokerplugin”).</li><li id="d456" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Grant_type — the token requested (it will always be “refresh_token”).</li><li id="c082" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Aud — the audience, who the token intended for (it will always be “login.microsoftonline.com”).</li><li id="1fe7" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Request_nonce — the Nonce from the first step.</li><li id="a994" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Scope — the requested permissions (it will always be “openid aza ugs”).</li><li id="0a99" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Refresh_token — the client PRT.</li><li id="dd6f" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">client_id — the AAD cloud ap identifier (it will always be “38aa3b87-a06d-4817-b275–7a316988d93b”).</li><li id="a2da" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">cert_token_use — the certificate required (it will always be “user_cert”).</li><li id="07d8" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">csr_type — the certificate signing request type (it will always be “http://schemas.microsoft.com/windows/pki/2009/01/enrollment#PKCS10”).</li><li id="826b" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">csr — the certificate signing request.</li></ul><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb qz"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*um8vD1ZTvr1f2CBXPvprVw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*um8vD1ZTvr1f2CBXPvprVw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*um8vD1ZTvr1f2CBXPvprVw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*um8vD1ZTvr1f2CBXPvprVw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*um8vD1ZTvr1f2CBXPvprVw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*um8vD1ZTvr1f2CBXPvprVw.png 1100w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*um8vD1ZTvr1f2CBXPvprVw.png 720w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 360px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*um8vD1ZTvr1f2CBXPvprVw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*um8vD1ZTvr1f2CBXPvprVw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*um8vD1ZTvr1f2CBXPvprVw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*um8vD1ZTvr1f2CBXPvprVw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*um8vD1ZTvr1f2CBXPvprVw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*um8vD1ZTvr1f2CBXPvprVw.png 1100w, https://miro.medium.com/v2/resize:fit:720/1*um8vD1ZTvr1f2CBXPvprVw.png 720w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 360px"><img alt="" class="be lp pj c" width="360" height="387" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:450/1*um8vD1ZTvr1f2CBXPvprVw.png"></picture></div><figcaption class="pk fc pl pa pb pm pn bc b bd z dr" data-selectable-paragraph="">JWT — jwt.io</figcaption></figure><p id="47ec" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">The client will take the header and the payload (message) and sign them using the derived key, add the signature field to the and send the JWT (header + ”.” +payload + ”.” + signature) to Azure AD.</p><p id="05fc" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">After receiving the request, Azure AD will verify the JWT signature using the client session key and the security context, and will check if the refresh token is valid. If all the checks passed, Azure AD will generate certificate for the user and will send a response with the following fields:</p><ul class=""><li id="0bda" class="ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od ok ol om bh" data-selectable-paragraph="">cert_token_use — the same field from the request (it will always be “user_cert”).</li><li id="0b00" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">expires_in — the duration of time the certificate is valid for.</li><li id="504d" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">expires_on — the date when the certificate is no longer valid.</li><li id="24b5" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">ext_expires_in — value to indicate the extended lifetime of an access token.</li><li id="ce11" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">id_token — token with the identity of the user.</li><li id="b74a" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">refresh_token — new PRT for the user (the previous one is still valid).</li><li id="a960" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">resource — the resource the certificate generated for (it will always be “p2p_cert”).</li><li id="bc2e" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">session_key — new session key for the user (the previous one is still valid).</li><li id="8046" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">x5c — the PEM certificate generated from the CSR.</li><li id="1897" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">x5c_ca — the CA of the certificate.</li></ul><p id="47f3" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">When the client receives the response from Azure AD, they can store the refresh token and the session key for future requests and they will validate the certificate subject against the PEM certificate to make sure this is the requested account. The P2P certificate will be stored in the certificate store and can be used for client authentication if it still valid.</p><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb ra"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*sHoLhk7YkchobAi-50Jnpg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*sHoLhk7YkchobAi-50Jnpg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*sHoLhk7YkchobAi-50Jnpg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*sHoLhk7YkchobAi-50Jnpg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*sHoLhk7YkchobAi-50Jnpg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*sHoLhk7YkchobAi-50Jnpg.png 1100w, https://miro.medium.com/v2/resize:fit:1254/format:webp/1*sHoLhk7YkchobAi-50Jnpg.png 1254w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 627px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*sHoLhk7YkchobAi-50Jnpg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*sHoLhk7YkchobAi-50Jnpg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*sHoLhk7YkchobAi-50Jnpg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*sHoLhk7YkchobAi-50Jnpg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*sHoLhk7YkchobAi-50Jnpg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*sHoLhk7YkchobAi-50Jnpg.png 1100w, https://miro.medium.com/v2/resize:fit:1254/1*sHoLhk7YkchobAi-50Jnpg.png 1254w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 627px"><img alt="" class="be lp pj c" width="627" height="270" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:784/1*sHoLhk7YkchobAi-50Jnpg.png"></picture></div><figcaption class="pk fc pl pa pb pm pn bc b bd z dr" data-selectable-paragraph="">Request for certificate — fiddler</figcaption></figure></div></div></div><div class="ab by os ot ou ov" role="separator"><span class="ow bv bj ox oy oz"></span><span class="ow bv bj ox oy oz"></span><span class="ow bv bj ox oy"></span></div><div class="gk gl gm gn go"><div class="ab by"><div class="cf be fw fx fy fz"><h1 id="1b82" class="mi mj gr bc mk ml pu mn mo mp pv mr ms mt pw mv mw mx px mz na nb py nd ne nf bh" data-selectable-paragraph="">PRT -&gt; Cert -&gt; Pass The Certificate</h1><p id="57e1" class="pw-post-body-paragraph ng nh gr ni b nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od gk bh" data-selectable-paragraph="">Now that were familiar with the protocols, we can implement them and authenticate to Azure AD machine from any machine.</p><p id="56a7" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">We already saw in his <a class="af oj" href="https://twitter.com/gentilkiwi/status/1291537989395505158" rel="noopener ugc nofollow" target="_blank">tweet</a> that Mimikatz is extracting the PRT and session key from Azure AD machine, so we can use Mimikatz function “sekurlsa::cloudap” to get the PRT and the session key. Then, we will use other Mimikatz function, “dpapi::cloudapkd”, to get derived key for security context.</p><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb pc"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*5lIs4f4pmkMfDuuACbWw0w.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*5lIs4f4pmkMfDuuACbWw0w.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*5lIs4f4pmkMfDuuACbWw0w.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*5lIs4f4pmkMfDuuACbWw0w.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*5lIs4f4pmkMfDuuACbWw0w.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*5lIs4f4pmkMfDuuACbWw0w.png 1100w, https://miro.medium.com/v2/resize:fit:1248/format:webp/1*5lIs4f4pmkMfDuuACbWw0w.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*5lIs4f4pmkMfDuuACbWw0w.png 640w, https://miro.medium.com/v2/resize:fit:720/1*5lIs4f4pmkMfDuuACbWw0w.png 720w, https://miro.medium.com/v2/resize:fit:750/1*5lIs4f4pmkMfDuuACbWw0w.png 750w, https://miro.medium.com/v2/resize:fit:786/1*5lIs4f4pmkMfDuuACbWw0w.png 786w, https://miro.medium.com/v2/resize:fit:828/1*5lIs4f4pmkMfDuuACbWw0w.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*5lIs4f4pmkMfDuuACbWw0w.png 1100w, https://miro.medium.com/v2/resize:fit:1248/1*5lIs4f4pmkMfDuuACbWw0w.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px"><img alt="" class="be lp pj c" width="624" height="96" loading="eager" role="presentation" src="https://miro.medium.com/v2/resize:fit:780/1*5lIs4f4pmkMfDuuACbWw0w.png"></picture></div></figure><p id="6c8d" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">Now we have the following:</p><ul class=""><li id="f6c1" class="ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od ok ol om bh" data-selectable-paragraph="">Username</li><li id="3c5e" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Tenant ID</li><li id="c9b1" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">PRT</li><li id="fc96" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Security context</li><li id="6cd2" class="ng nh gr ni b nj on nl nm nn oo np nq nr op nt nu nv oq nx ny nz or ob oc od ok ol om bh" data-selectable-paragraph="">Derived Key</li></ul><p id="fa47" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">It seems that we have everything we need to request P2P certificate for that user. To request certificate, I wrote python tool using the module requests.</p><div class="rb rc rd re rf rg"><a href="https://github.com/morRubin/PrtToCert?source=post_page-----d0c5de624597--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="rh ab iu"><div class="ri ab cl by rj rk"><h2 class="bc gs il z rl rm rn ro rp rq rr gq bh">morRubin/PrtToCert</h2><div class="rs l"><h3 class="bc b il z rl rm rn ro rp rq rr dr">Contribute to morRubin/PrtToCert development by creating an account on GitHub.</h3></div><div class="rt l"><p class="bc b ds z rl rm rn ro rp rq rr dr">github.com</p></div></div><div class="ru l"><div class="rv l rw rx ry ru rz lp rg"></div></div></div></a></div><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb pc"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*1QDjbSk2Kd7soJerIxHb9w.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*1QDjbSk2Kd7soJerIxHb9w.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*1QDjbSk2Kd7soJerIxHb9w.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*1QDjbSk2Kd7soJerIxHb9w.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*1QDjbSk2Kd7soJerIxHb9w.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*1QDjbSk2Kd7soJerIxHb9w.png 1100w, https://miro.medium.com/v2/resize:fit:1248/format:webp/1*1QDjbSk2Kd7soJerIxHb9w.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*1QDjbSk2Kd7soJerIxHb9w.png 640w, https://miro.medium.com/v2/resize:fit:720/1*1QDjbSk2Kd7soJerIxHb9w.png 720w, https://miro.medium.com/v2/resize:fit:750/1*1QDjbSk2Kd7soJerIxHb9w.png 750w, https://miro.medium.com/v2/resize:fit:786/1*1QDjbSk2Kd7soJerIxHb9w.png 786w, https://miro.medium.com/v2/resize:fit:828/1*1QDjbSk2Kd7soJerIxHb9w.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*1QDjbSk2Kd7soJerIxHb9w.png 1100w, https://miro.medium.com/v2/resize:fit:1248/1*1QDjbSk2Kd7soJerIxHb9w.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px"><img alt="" class="be lp pj c" width="624" height="184" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:780/1*1QDjbSk2Kd7soJerIxHb9w.png"></picture></div></figure><p id="125c" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">Now we got certificates for all the PRT lifetime. To use the certificate, I wrote another python tool that will authenticate to the remote machine, run PSEXEC and open a CMD on the victim machine. This will allow us to use Mimikatz again to get the PRT of another user.</p><div class="rb rc rd re rf rg"><a href="https://github.com/morRubin/AzureADJoinedMachinePTC?source=post_page-----d0c5de624597--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="rh ab iu"><div class="ri ab cl by rj rk"><h2 class="bc gs il z rl rm rn ro rp rq rr gq bh">morRubin/AzureADJoinedMachinePTC</h2><div class="rs l"><h3 class="bc b il z rl rm rn ro rp rq rr dr">Contribute to morRubin/AzureADJoinedMachinePTC development by creating an account on GitHub.</h3></div><div class="rt l"><p class="bc b ds z rl rm rn ro rp rq rr dr">github.com</p></div></div><div class="ru l"><div class="sa l rw rx ry ru rz lp rg"></div></div></div></a></div><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb sb"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*4fHCff6yFlPSDt6qlOqG2w.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*4fHCff6yFlPSDt6qlOqG2w.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*4fHCff6yFlPSDt6qlOqG2w.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*4fHCff6yFlPSDt6qlOqG2w.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*4fHCff6yFlPSDt6qlOqG2w.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*4fHCff6yFlPSDt6qlOqG2w.png 1100w, https://miro.medium.com/v2/resize:fit:1312/format:webp/1*4fHCff6yFlPSDt6qlOqG2w.png 1312w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 656px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*4fHCff6yFlPSDt6qlOqG2w.png 640w, https://miro.medium.com/v2/resize:fit:720/1*4fHCff6yFlPSDt6qlOqG2w.png 720w, https://miro.medium.com/v2/resize:fit:750/1*4fHCff6yFlPSDt6qlOqG2w.png 750w, https://miro.medium.com/v2/resize:fit:786/1*4fHCff6yFlPSDt6qlOqG2w.png 786w, https://miro.medium.com/v2/resize:fit:828/1*4fHCff6yFlPSDt6qlOqG2w.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*4fHCff6yFlPSDt6qlOqG2w.png 1100w, https://miro.medium.com/v2/resize:fit:1312/1*4fHCff6yFlPSDt6qlOqG2w.png 1312w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 656px"><img alt="" class="be lp pj c" width="656" height="293" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:820/1*4fHCff6yFlPSDt6qlOqG2w.png"></picture></div></figure><p id="0084" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">And if you are a Wireshark person, I also modified Wireshark and parsed PKU2U PDUs. Its not in Wireshark code yet, but you can download my modified Wireshark version.</p><div class="rb rc rd re rf rg"><a href="https://github.com/morRubin/WiresharkKerberosPKIDissector?source=post_page-----d0c5de624597--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="rh ab iu"><div class="ri ab cl by rj rk"><h2 class="bc gs il z rl rm rn ro rp rq rr gq bh">morRubin/WiresharkKerberosPKIDissector</h2><div class="rs l"><h3 class="bc b il z rl rm rn ro rp rq rr dr">You can't perform that action at this time. You signed in with another tab or window. You signed out in another tab or…</h3></div><div class="rt l"><p class="bc b ds z rl rm rn ro rp rq rr dr">github.com</p></div></div><div class="ru l"><div class="sc l rw rx ry ru rz lp rg"></div></div></div></a></div><figure class="pd pe pf pg ph pi pa pb paragraph-image"><div class="pa pb pc"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*YGh5fT84Wzq1YuBJ3v9oxQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*YGh5fT84Wzq1YuBJ3v9oxQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*YGh5fT84Wzq1YuBJ3v9oxQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*YGh5fT84Wzq1YuBJ3v9oxQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*YGh5fT84Wzq1YuBJ3v9oxQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*YGh5fT84Wzq1YuBJ3v9oxQ.png 1100w, https://miro.medium.com/v2/resize:fit:1248/format:webp/1*YGh5fT84Wzq1YuBJ3v9oxQ.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*YGh5fT84Wzq1YuBJ3v9oxQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*YGh5fT84Wzq1YuBJ3v9oxQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*YGh5fT84Wzq1YuBJ3v9oxQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*YGh5fT84Wzq1YuBJ3v9oxQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*YGh5fT84Wzq1YuBJ3v9oxQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*YGh5fT84Wzq1YuBJ3v9oxQ.png 1100w, https://miro.medium.com/v2/resize:fit:1248/1*YGh5fT84Wzq1YuBJ3v9oxQ.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px"><img alt="" class="be lp pj c" width="624" height="491" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:780/1*YGh5fT84Wzq1YuBJ3v9oxQ.png"></picture></div></figure><p id="a947" class="pw-post-body-paragraph ng nh gr ni b nj oe nl nm nn of np nq nr og nt nu nv oh nx ny nz oi ob oc od gk bh" data-selectable-paragraph="">*right now, the “Pass The Certificate” tool is in python 2.7 and call only PSEXEC, but I’m working to change it to python 3 and add more functionality.</p></div></div></div></div></section></div></div></article><div class="ab by"><div class="cf be fw fx fy fz"></div></div></div><div></div><div class="m vb vc vd"><div class="bu ve vf be yt" style="bottom: 0px;"><div class="vh t vi v vj vk vl vm vn vo ab q cl fg"><div class="vp vq vr vs vt l"><div class="am l fp vu vv"><div class="h k"><div class="l fg n vw"><button class="af ag ah ai aj ak al am an ao ap aq ar as at ab" data-testid="close-button" aria-label="close"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="fh dr fj fi"><path d="M5 5l7 7m7 7l-7-7m0 0l7-7m-7 7l-7 7" stroke="currentColor" stroke-linecap="round"></path></svg></button></div></div><div class="j i d"><div class="l fg n vw"><button class="af ag ah ai aj ak al am an ao ap aq ar as at ab fg vx gn vy vz wa wb" data-testid="close-button" aria-label="close"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="fh dr fj fi"><path d="M5 5l7 7m7 7l-7-7m0 0l7-7m-7 7l-7 7" stroke="currentColor" stroke-linecap="round"></path></svg></button></div></div></div><div class="ab q iv iw wj wk"><img class="fp vc gf wl" src="https://miro.medium.com/v2/da:true/resize:fit:0/5c50caa54067fd622d2f0fac18392213bf92f6e2fae89b691e62bceb40885e74" loading="lazy" role="presentation"><div class="gv wm ha wn dj wo dk wp wq l"><svg viewBox="0 0 3940 610" class="wc wd we wf wg hf wh hk wi hp"><path d="M594.79 308.2c0 163.76-131.85 296.52-294.5 296.52S5.8 472 5.8 308.2 137.65 11.69 300.29 11.69s294.5 132.75 294.5 296.51M917.86 308.2c0 154.16-65.93 279.12-147.25 279.12s-147.25-125-147.25-279.12S689.29 29.08 770.61 29.08s147.25 125 147.25 279.12M1050 308.2c0 138.12-23.19 250.08-51.79 250.08s-51.79-112-51.79-250.08 23.19-250.08 51.8-250.08S1050 170.09 1050 308.2M1862.77 37.4l.82-.18v-6.35h-167.48l-155.51 365.5-155.51-365.5h-180.48v6.35l.81.18c30.57 6.9 46.09 17.19 46.09 54.3v434.45c0 37.11-15.58 47.4-46.15 54.3l-.81.18V587H1327v-6.35l-.81-.18c-30.57-6.9-46.09-17.19-46.09-54.3V116.9L1479.87 587h11.33l205.59-483.21V536.9c-2.62 29.31-18 38.36-45.68 44.61l-.82.19v6.3h213.3v-6.3l-.82-.19c-27.71-6.25-43.46-15.3-46.08-44.61l-.14-445.2h.14c0-37.11 15.52-47.4 46.08-54.3m97.43 287.8c3.49-78.06 31.52-134.4 78.56-135.37 14.51.24 26.68 5 36.14 14.16 20.1 19.51 29.55 60.28 28.09 121.21zm-2.11 22h250v-1.05c-.71-59.69-18-106.12-51.34-138-28.82-27.55-71.49-42.71-116.31-42.71h-1c-23.26 0-51.79 5.64-72.09 15.86-23.11 10.7-43.49 26.7-60.45 47.7-27.3 33.83-43.84 79.55-47.86 130.93-.13 1.54-.24 3.08-.35 4.62s-.18 2.92-.25 4.39a332.64 332.64 0 0 0-.36 21.69C1860.79 507 1923.65 600 2035.3 600c98 0 155.07-71.64 169.3-167.8l-7.19-2.53c-25 51.68-69.9 83-121 79.18-69.76-5.22-123.2-75.95-118.35-161.63m532.69 157.68c-8.2 19.45-25.31 30.15-48.24 30.15s-43.89-15.74-58.78-44.34c-16-30.7-24.42-74.1-24.42-125.51 0-107 33.28-176.21 84.79-176.21 21.57 0 38.55 10.7 46.65 29.37zm165.84 76.28c-30.57-7.23-46.09-18-46.09-57V5.28L2424.77 60v6.7l1.14-.09c25.62-2.07 43 1.47 53.09 10.79 7.9 7.3 11.75 18.5 11.75 34.26v71.14c-18.31-11.69-40.09-17.38-66.52-17.38-53.6 0-102.59 22.57-137.92 63.56-36.83 42.72-56.3 101.1-56.3 168.81C2230 518.72 2289.53 600 2378.13 600c51.83 0 93.53-28.4 112.62-76.3V588h166.65v-6.66zm159.29-505.33c0-37.76-28.47-66.24-66.24-66.24-37.59 0-67 29.1-67 66.24s29.44 66.24 67 66.24c37.77 0 66.24-28.48 66.24-66.24m43.84 505.33c-30.57-7.23-46.09-18-46.09-57h-.13V166.65l-166.66 47.85v6.5l1 .09c36.06 3.21 45.93 15.63 45.93 57.77V588h166.8v-6.66zm427.05 0c-30.57-7.23-46.09-18-46.09-57V166.65L3082 212.92v6.52l.94.1c29.48 3.1 38 16.23 38 58.56v226c-9.83 19.45-28.27 31-50.61 31.78-36.23 0-56.18-24.47-56.18-68.9V166.66l-166.66 47.85V221l1 .09c36.06 3.2 45.94 15.62 45.94 57.77v191.27a214.48 214.48 0 0 0 3.47 39.82l3 13.05c14.11 50.56 51.08 77 109 77 49.06 0 92.06-30.37 111-77.89v66h166.66v-6.66zM3934.2 588v-6.67l-.81-.19c-33.17-7.65-46.09-22.07-46.09-51.43v-243.2c0-75.83-42.59-121.09-113.93-121.09-52 0-95.85 30.05-112.73 76.86-13.41-49.6-52-76.86-109.06-76.86-50.12 0-89.4 26.45-106.25 71.13v-69.87l-166.66 45.89v6.54l1 .09c35.63 3.16 45.93 15.94 45.93 57V588h155.5v-6.66l-.82-.2c-26.46-6.22-35-17.56-35-46.66V255.72c7-16.35 21.11-35.72 49-35.72 34.64 0 52.2 24 52.2 71.28V588h155.54v-6.66l-.82-.2c-26.46-6.22-35-17.56-35-46.66v-248a160.45 160.45 0 0 0-2.2-27.68c7.42-17.77 22.34-38.8 51.37-38.8 35.13 0 52.2 23.31 52.2 71.28V588z"></path></svg><h2 class="wr b nj ws wt nn wu wv mt ww wx mx wy wz nb xa xb xc xd">Sign up to discover human stories that deepen your understanding of the world.</h2></div><div class="ab q iv iw"><div class="xe gb bm gv xf ha xg xh xi xj xk xl xm l c"><div class="ab q"><h2 class="bc ub il z gq bh">Free</h2></div><div class="uf xn l cu"></div><div class="uf ab"><div class="bl l"><svg width="11" height="11" viewBox="0 0 11 11"><path d="M0 6.31l3.7 3.7.9.91.67-1.1 5.3-8.79L8.84 0l-5.3 8.8 1.57-.2-3.7-3.7L0 6.3z"></path></svg></div><p class="bc b bd z bh">Distraction-free reading. No ads.</p></div><div class="uf ab"><div class="bl l"><svg width="11" height="11" viewBox="0 0 11 11"><path d="M0 6.31l3.7 3.7.9.91.67-1.1 5.3-8.79L8.84 0l-5.3 8.8 1.57-.2-3.7-3.7L0 6.3z"></path></svg></div><p class="bc b bd z bh">Organize your knowledge with lists and highlights.</p></div><div class="uf ab"><div class="bl l"><svg width="11" height="11" viewBox="0 0 11 11"><path d="M0 6.31l3.7 3.7.9.91.67-1.1 5.3-8.79L8.84 0l-5.3 8.8 1.57-.2-3.7-3.7L0 6.3z"></path></svg></div><p class="bc b bd z bh">Tell your story. Find your audience.</p></div><div class="ci xo xn l cu"></div><span><button class="bc b bd z xp sg xq xr xs xt xu es et xv xw xx ex be ey ez fa bj fb fc">Sign up for free</button></span></div><div class="xe gb bm xf xg xi xk xm l c"><div class="ab q"><svg width="64" height="64" viewBox="0 0 64 64" fill="none" class="xy sf de lh"><path d="M39.64 40.83L33.87 56.7a1.99 1.99 0 0 1-3.74 0l-5.77-15.87a2.02 2.02 0 0 0-1.2-1.2L7.3 33.88a1.99 1.99 0 0 1 0-3.74l15.87-5.77a2.02 2.02 0 0 0 1.2-1.2L30.12 7.3a1.99 1.99 0 0 1 3.74 0l5.77 15.87a2.02 2.02 0 0 0 1.2 1.2l15.86 5.76a1.99 1.99 0 0 1 0 3.74l-15.87 5.77a2.02 2.02 0 0 0-1.2 1.2z" fill="#FFC017"></path></svg><h2 class="bc ub il z gq bh">Membership</h2></div><div class="uf xn l cu"></div><div class="uf ab"><div class="bl l"><svg width="11" height="11" viewBox="0 0 11 11"><path d="M0 6.31l3.7 3.7.9.91.67-1.1 5.3-8.79L8.84 0l-5.3 8.8 1.57-.2-3.7-3.7L0 6.3z"></path></svg></div><p class="bc b bd z bh">Access the best member-only stories.</p></div><div class="uf ab"><div class="bl l"><svg width="11" height="11" viewBox="0 0 11 11"><path d="M0 6.31l3.7 3.7.9.91.67-1.1 5.3-8.79L8.84 0l-5.3 8.8 1.57-.2-3.7-3.7L0 6.3z"></path></svg></div><p class="bc b bd z bh">Support independent authors.</p></div><div class="uf ab"><div class="bl l"><svg width="11" height="11" viewBox="0 0 11 11"><path d="M0 6.31l3.7 3.7.9.91.67-1.1 5.3-8.79L8.84 0l-5.3 8.8 1.57-.2-3.7-3.7L0 6.3z"></path></svg></div><p class="bc b bd z bh">Listen to audio narrations.</p></div><div class="uf ab"><div class="bl l"><svg width="11" height="11" viewBox="0 0 11 11"><path d="M0 6.31l3.7 3.7.9.91.67-1.1 5.3-8.79L8.84 0l-5.3 8.8 1.57-.2-3.7-3.7L0 6.3z"></path></svg></div><p class="bc b bd z bh">Read offline.</p></div><div class="uf ab"><div class="bl l"><svg width="11" height="11" viewBox="0 0 11 11"><path d="M0 6.31l3.7 3.7.9.91.67-1.1 5.3-8.79L8.84 0l-5.3 8.8 1.57-.2-3.7-3.7L0 6.3z"></path></svg></div><p class="bc b bd z bh">Join the Partner Program and earn for your writing.</p></div><div class="ci xo xn l cu"></div><span><button class="bc b bd z xp sg xq xr xs xt xu es et xv xw xx ex be ey ez fa bj fb fc">Try for 5&nbsp;$/month</button></span></div></div></div></div></div></div></div><div class="ab by"><div class="cf be fw fx fy fz"><div class="sd se ab ix"><div class="rs ab"><a class="sf av am ao" rel="noopener follow" href="/tag/azure-active-directory?source=post_page-----d0c5de624597---------------azure_active_directory-----------------"><div class="sg fg cu sh gb si sj bc b bd z bh sk">Azure Active Directory</div></a></div><div class="rs ab"><a class="sf av am ao" rel="noopener follow" href="/tag/lateral-movement?source=post_page-----d0c5de624597---------------lateral_movement-----------------"><div class="sg fg cu sh gb si sj bc b bd z bh sk">Lateral Movement</div></a></div></div></div></div><div class="l"></div><footer class="sl sm sn so sp sq sr ss st ab q su sv c"><div class="l ae"><div class="ab by"><div class="cf be fw fx fy fz"><div class="ab cm sw"><div class="ab q kg"><div class="sx l"><span class="l sy sz ta e d"><div class="ab q kg kh"><div class="pw-multi-vote-icon fg ki kj kk kl"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerClapButton" rel="noopener follow" href="/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2Fd0c5de624597&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40mor2464%2Fazure-ad-pass-the-certificate-d0c5de624597&amp;user=Mor&amp;userId=dec0c9bdedb9&amp;source=-----d0c5de624597---------------------clap_footer-----------"><div><div class="bj" aria-hidden="false" aria-describedby="8" aria-labelledby="8"><div class="km ao kn ko kp kq am kr ks kt kl"><svg width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.37.83L12 3.28l.63-2.45h-1.26zM13.92 3.95l1.52-2.1-1.18-.4-.34 2.5zM8.59 1.84l1.52 2.11-.34-2.5-1.18.4zM18.52 18.92a4.23 4.23 0 0 1-2.62 1.33l.41-.37c2.39-2.4 2.86-4.95 1.4-7.63l-.91-1.6-.8-1.67c-.25-.56-.19-.98.21-1.29a.7.7 0 0 1 .55-.13c.28.05.54.23.72.5l2.37 4.16c.97 1.62 1.14 4.23-1.33 6.7zm-11-.44l-4.15-4.15a.83.83 0 0 1 1.17-1.17l2.16 2.16a.37.37 0 0 0 .51-.52l-2.15-2.16L3.6 11.2a.83.83 0 0 1 1.17-1.17l3.43 3.44a.36.36 0 0 0 .52 0 .36.36 0 0 0 0-.52L5.29 9.51l-.97-.97a.83.83 0 0 1 0-1.16.84.84 0 0 1 1.17 0l.97.97 3.44 3.43a.36.36 0 0 0 .51 0 .37.37 0 0 0 0-.52L6.98 7.83a.82.82 0 0 1-.18-.9.82.82 0 0 1 .76-.51c.22 0 .43.09.58.24l5.8 5.79a.37.37 0 0 0 .58-.42L13.4 9.67c-.26-.56-.2-.98.2-1.29a.7.7 0 0 1 .55-.13c.28.05.55.23.73.5l2.2 3.86c1.3 2.38.87 4.59-1.29 6.75a4.65 4.65 0 0 1-4.19 1.37 7.73 7.73 0 0 1-4.07-2.25zm3.23-12.5l2.12 2.11c-.41.5-.47 1.17-.13 1.9l.22.46-3.52-3.53a.81.81 0 0 1-.1-.36c0-.23.09-.43.24-.59a.85.85 0 0 1 1.17 0zm7.36 1.7a1.86 1.86 0 0 0-1.23-.84 1.44 1.44 0 0 0-1.12.27c-.3.24-.5.55-.58.89-.25-.25-.57-.4-.91-.47-.28-.04-.56 0-.82.1l-2.18-2.18a1.56 1.56 0 0 0-2.2 0c-.2.2-.33.44-.4.7a1.56 1.56 0 0 0-2.63.75 1.6 1.6 0 0 0-2.23-.04 1.56 1.56 0 0 0 0 2.2c-.24.1-.5.24-.72.45a1.56 1.56 0 0 0 0 2.2l.52.52a1.56 1.56 0 0 0-.75 2.61L7 19a8.46 8.46 0 0 0 4.48 2.45 5.18 5.18 0 0 0 3.36-.5 4.89 4.89 0 0 0 4.2-1.51c2.75-2.77 2.54-5.74 1.43-7.59L18.1 7.68z"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l ku kv kw kx ky kz la"><p class="bc b ds z dr"><span class="lb">--</span></p></div></div></span><span class="l h g f tb tc"><div class="ab q kg kh"><div class="pw-multi-vote-icon fg ki kj kk kl"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerClapButton" rel="noopener follow" href="/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2Fd0c5de624597&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40mor2464%2Fazure-ad-pass-the-certificate-d0c5de624597&amp;user=Mor&amp;userId=dec0c9bdedb9&amp;source=-----d0c5de624597---------------------clap_footer-----------"><div><div class="bj" aria-hidden="false" aria-describedby="9" aria-labelledby="9"><div class="km ao kn ko kp kq am kr ks kt kl"><svg width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.37.83L12 3.28l.63-2.45h-1.26zM13.92 3.95l1.52-2.1-1.18-.4-.34 2.5zM8.59 1.84l1.52 2.11-.34-2.5-1.18.4zM18.52 18.92a4.23 4.23 0 0 1-2.62 1.33l.41-.37c2.39-2.4 2.86-4.95 1.4-7.63l-.91-1.6-.8-1.67c-.25-.56-.19-.98.21-1.29a.7.7 0 0 1 .55-.13c.28.05.54.23.72.5l2.37 4.16c.97 1.62 1.14 4.23-1.33 6.7zm-11-.44l-4.15-4.15a.83.83 0 0 1 1.17-1.17l2.16 2.16a.37.37 0 0 0 .51-.52l-2.15-2.16L3.6 11.2a.83.83 0 0 1 1.17-1.17l3.43 3.44a.36.36 0 0 0 .52 0 .36.36 0 0 0 0-.52L5.29 9.51l-.97-.97a.83.83 0 0 1 0-1.16.84.84 0 0 1 1.17 0l.97.97 3.44 3.43a.36.36 0 0 0 .51 0 .37.37 0 0 0 0-.52L6.98 7.83a.82.82 0 0 1-.18-.9.82.82 0 0 1 .76-.51c.22 0 .43.09.58.24l5.8 5.79a.37.37 0 0 0 .58-.42L13.4 9.67c-.26-.56-.2-.98.2-1.29a.7.7 0 0 1 .55-.13c.28.05.55.23.73.5l2.2 3.86c1.3 2.38.87 4.59-1.29 6.75a4.65 4.65 0 0 1-4.19 1.37 7.73 7.73 0 0 1-4.07-2.25zm3.23-12.5l2.12 2.11c-.41.5-.47 1.17-.13 1.9l.22.46-3.52-3.53a.81.81 0 0 1-.1-.36c0-.23.09-.43.24-.59a.85.85 0 0 1 1.17 0zm7.36 1.7a1.86 1.86 0 0 0-1.23-.84 1.44 1.44 0 0 0-1.12.27c-.3.24-.5.55-.58.89-.25-.25-.57-.4-.91-.47-.28-.04-.56 0-.82.1l-2.18-2.18a1.56 1.56 0 0 0-2.2 0c-.2.2-.33.44-.4.7a1.56 1.56 0 0 0-2.63.75 1.6 1.6 0 0 0-2.23-.04 1.56 1.56 0 0 0 0 2.2c-.24.1-.5.24-.72.45a1.56 1.56 0 0 0 0 2.2l.52.52a1.56 1.56 0 0 0-.75 2.61L7 19a8.46 8.46 0 0 0 4.48 2.45 5.18 5.18 0 0 0 3.36-.5 4.89 4.89 0 0 0 4.2-1.51c2.75-2.77 2.54-5.74 1.43-7.59L18.1 7.68z"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l ku kv kw kx ky kz la"><p class="bc b ds z dr"><span class="lb">--</span></p></div></div></span></div><div class="bn ab"><div><div class="bj" aria-hidden="false" aria-describedby="10" aria-labelledby="10"><button class="ao km lc ld ab q fh le lf" aria-label="responses"><svg width="24" height="24" viewBox="0 0 24 24" class="lg"><path d="M18 16.8a7.14 7.14 0 0 0 2.24-5.32c0-4.12-3.53-7.48-8.05-7.48C7.67 4 4 7.36 4 11.48c0 4.13 3.67 7.48 8.2 7.48a8.9 8.9 0 0 0 2.38-.32c.23.2.48.39.75.56 1.06.69 2.2 1.04 3.4 1.04.22 0 .4-.11.48-.29a.5.5 0 0 0-.04-.52 6.4 6.4 0 0 1-1.16-2.65v.02zm-3.12 1.06l-.06-.22-.32.1a8 8 0 0 1-2.3.33c-4.03 0-7.3-2.96-7.3-6.59S8.17 4.9 12.2 4.9c4 0 7.1 2.96 7.1 6.6 0 1.8-.6 3.47-2.02 4.72l-.2.16v.26l.02.3a6.74 6.74 0 0 0 .88 2.4 5.27 5.27 0 0 1-2.17-.86c-.28-.17-.72-.38-.94-.59l.01-.02z"></path></svg></button></div></div></div></div><div class="ab q"><div class="oz l iu"><div><div class="bj" aria-hidden="false" aria-describedby="11" aria-labelledby="11"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerBookmarkButton" rel="noopener follow" href="/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd0c5de624597&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40mor2464%2Fazure-ad-pass-the-certificate-d0c5de624597&amp;source=--------------------------bookmark_footer-----------"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="dr li" aria-label="Add to list bookmark button"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="currentColor"></path></svg></a></span></div></div></div><div class="oz l iu"><div class="bj" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bj" aria-hidden="false" aria-describedby="12" aria-labelledby="12"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="footerSocialShareButton" class="af fh ah ai aj ak al lq an ao ap eu lr ls lf lt"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M15.22 4.93a.42.42 0 0 1-.12.13h.01a.45.45 0 0 1-.29.08.52.52 0 0 1-.3-.13L12.5 3v7.07a.5.5 0 0 1-.5.5.5.5 0 0 1-.5-.5V3.02l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.8a.42.42 0 0 1 .07.5zm-.1.14zm.88 2h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11a2 2 0 0 1-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.14c.1.1.15.22.15.35a.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9V8.96c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1z" fill="currentColor"></path></svg></button></div></div></div></div></div></div></div></div></div></footer><div class="td te tf tg th l bu"><div class="ab by"><div class="cf be fw fx fy fz"><div class="ci ab ti cm"><div class="ab ic"><a rel="noopener follow" href="/@mor2464?source=post_page-----d0c5de624597--------------------------------"><div class="l tj tk bv tl ig"><div class="l fg"><img alt="Mor" class="l fa bv tm tn cu" src="https://miro.medium.com/v2/resize:fill:144:144/1*dmbNkD5D-u45r44go_cf0g.png" width="72" height="72" loading="lazy"><div class="ih bv l tm tn fp n ii fq"></div></div></div></a></div><div class="j i d"><div class="ab"><span><button class="bc b bd z el sg em eo ep eq er es et eu ev ew ex to ey ez fa bj fb fc">Follow</button></span><div class="dq l"><div><div><div class="bj" aria-hidden="false" aria-describedby="55" aria-labelledby="55"><div class="l"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" rel="noopener follow" href="/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F2b419fe60434&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40mor2464%2Fazure-ad-pass-the-certificate-d0c5de624597&amp;newsletterV3=dec0c9bdedb9&amp;newsletterV3Id=2b419fe60434&amp;user=Mor&amp;userId=dec0c9bdedb9&amp;source=-----d0c5de624597---------------------subscribe_user-----------"><button class="bc b bd z ts am tt tu tv tw tx ty tz ua et eu ev ew ex ey ez fa bj fb fc" aria-label="Subscribe"><svg width="38" height="38" viewBox="0 0 38 38" fill="none" class="tp tq tr"><rect x="26.25" y="9.25" width="0.5" height="6.5" rx="0.25"></rect><rect x="29.75" y="12.25" width="0.5" height="6.5" rx="0.25" transform="rotate(90 29.75 12.25)"></rect><path d="M19.5 12.5h-7a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1v-5"></path><path d="M11.5 14.5L19 20l4-3"></path></svg></button></a></span></div></div></div></div></div></div></div></div><div class="ab ck cm"><div class="l"><div class="ab q"><a class="af ag ah ai aj ak al am an ao ap aq ar as at ab q" rel="noopener follow" href="/@mor2464?source=post_page-----d0c5de624597--------------------------------"><h2 class="pw-author-name bc ub uc ud ue bh"><span class="gk iz">Written by <!-- -->Mor</span></h2></a></div><div class="rs ab"><div class="l iu"><span class="pw-follower-count bc b bd z bh"><a class="af ag ah ai aj ak al am an ao ap aq ar in" rel="noopener follow" href="/@mor2464/followers?source=post_page-----d0c5de624597--------------------------------">29 Followers</a></span></div></div><div class="uf l"></div></div><div class="h k"><div class="ab"><span><button class="bc b bd z el sg em eo ep eq er es et eu ev ew ex to ey ez fa bj fb fc">Follow</button></span><div class="dq l"><div><div><div class="bj" aria-hidden="false" aria-describedby="56" aria-labelledby="56"><div class="l"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" rel="noopener follow" href="/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F2b419fe60434&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40mor2464%2Fazure-ad-pass-the-certificate-d0c5de624597&amp;newsletterV3=dec0c9bdedb9&amp;newsletterV3Id=2b419fe60434&amp;user=Mor&amp;userId=dec0c9bdedb9&amp;source=-----d0c5de624597---------------------subscribe_user-----------"><button class="bc b bd z ts am tt tu tv tw tx ty tz ua et eu ev ew ex ey ez fa bj fb fc" aria-label="Subscribe"><svg width="38" height="38" viewBox="0 0 38 38" fill="none" class="tp tq tr"><rect x="26.25" y="9.25" width="0.5" height="6.5" rx="0.25"></rect><rect x="29.75" y="12.25" width="0.5" height="6.5" rx="0.25" transform="rotate(90 29.75 12.25)"></rect><path d="M19.5 12.5h-7a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1v-5"></path><path d="M11.5 14.5L19 20l4-3"></path></svg></button></a></span></div></div></div></div></div></div></div></div><div class="ug be uh ui uj uk ul um"></div></div></div><div class="h k j"><div class="ug be uh un"></div><div class="ab by"><div class="cf be fw fx fy fz"><div class="uo ab kg ix"><div class="up uq l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://help.medium.com/hc/en-us?source=post_page-----d0c5de624597--------------------------------" rel="noopener follow"><p class="bc b ds z dr">Help</p></a></div><div class="up uq l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.statuspage.io/?source=post_page-----d0c5de624597--------------------------------" rel="noopener follow"><p class="bc b ds z dr">Status</p></a></div><div class="up uq l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" rel="noopener follow" href="/about?autoplay=1&amp;source=post_page-----d0c5de624597--------------------------------"><p class="bc b ds z dr">About</p></a></div><div class="up uq l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" rel="noopener follow" href="/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----d0c5de624597--------------------------------"><p class="bc b ds z dr">Careers</p></a></div><div class="up uq l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="mailto:pressinquiries@medium.com?source=post_page-----d0c5de624597--------------------------------" rel="noopener follow"><p class="bc b ds z dr">Press</p></a></div><div class="up uq l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://blog.medium.com/?source=post_page-----d0c5de624597--------------------------------" rel="noopener follow"><p class="bc b ds z dr">Blog</p></a></div><div class="up uq l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d0c5de624597--------------------------------" rel="noopener follow"><p class="bc b ds z dr">Privacy</p></a></div><div class="up uq l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d0c5de624597--------------------------------" rel="noopener follow"><p class="bc b ds z dr">Terms</p></a></div><div class="up uq l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://speechify.com/medium?source=post_page-----d0c5de624597--------------------------------" rel="noopener follow"><p class="bc b ds z dr">Text to speech</p></a></div><div class="up l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" rel="noopener follow" href="/business?source=post_page-----d0c5de624597--------------------------------"><p class="bc b ds z dr">Teams</p></a></div></div></div></div></div></div></div></div></div></div><script>window.__BUILD_ID__="main-20240614-221838-3ba87a70fa"</script><script>window.__GRAPHQL_URI__ = "https://medium.com/_/graphql"</script><script>window.__PRELOADED_STATE__ = {"algolia":{"queries":{}},"cache":{"experimentGroupSet":true,"reason":"","group":"enabled","tags":["group-edgeCachePosts","post-d0c5de624597","user-dec0c9bdedb9"],"serverVariantState":"44136fa355b3678a1146ad16f7e8649e94fb4fc21fe77e8310c060f61caaff8a","middlewareEnabled":true,"cacheStatus":"DYNAMIC","shouldUseCache":true,"vary":[],"updatedPostPreviewsEnabled":false,"lohpExperimentEnabled":"group_2","prideLogoEnabled":true},"client":{"hydrated":false,"isUs":false,"isNativeMedium":false,"isSafariMobile":false,"isSafari":false,"isFirefox":true,"routingEntity":{"type":"DEFAULT","explicit":false},"viewerIsBot":false},"debug":{"requestId":"1fdf538a-f3cc-4612-a696-52a541478fb8","hybridDevServices":[],"originalSpanCarrier":{"ot-tracer-spanid":"22bbb2cf6ce6bcf1","ot-tracer-traceid":"7cfc934d39b7e48e","ot-tracer-sampled":"true"}},"multiVote":{"clapsPerPost":{}},"navigation":{"branch":{"show":null,"hasRendered":null,"blockedByCTA":false},"hideGoogleOneTap":false,"hasRenderedAlternateUserBanner":null,"currentLocation":"https:\u002F\u002Fmedium.com\u002F@mor2464\u002Fazure-ad-pass-the-certificate-d0c5de624597","host":"medium.com","hostname":"medium.com","referrer":"","hasSetReferrer":false,"susiModal":{"step":null,"operation":"register"},"postRead":false,"partnerProgram":{"selectedCountryCode":null},"queryString":"","currentHash":""},"config":{"nodeEnv":"production","version":"main-20240614-221838-3ba87a70fa","target":"production","productName":"Medium","publicUrl":"https:\u002F\u002Fcdn-client.medium.com\u002Flite","authDomain":"medium.com","authGoogleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","favicon":"production","glyphUrl":"https:\u002F\u002Fglyph.medium.com","branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm","algolia":{"appId":"MQ57UUUQZ2","apiKeySearch":"394474ced050e3911ae2249ecc774921","indexPrefix":"medium_","host":"-dsn.algolia.net"},"recaptchaKey":"6Lfc37IUAAAAAKGGtC6rLS13R1Hrw_BqADfS1LRk","recaptcha3Key":"6Lf8R9wUAAAAABMI_85Wb8melS7Zj6ziuf99Yot5","recaptchaEnterpriseKeyId":"6Le-uGgpAAAAAPprRaokM8AKthQ9KNGdoxaGUvVp","datadog":{"applicationId":"6702d87d-a7e0-42fe-bbcb-95b469547ea0","clientToken":"pub853ea8d17ad6821d9f8f11861d23dfed","rumToken":"pubf9cc52896502b9413b68ba36fc0c7162","context":{"deployment":{"target":"production","tag":"main-20240614-221838-3ba87a70fa","commit":"3ba87a70fa89456c9162015acb3c1797c92f4b41"}},"datacenter":"us"},"googleAnalyticsCode":"G-7JY7T788PK","googlePay":{"apiVersion":"2","apiVersionMinor":"0","merchantId":"BCR2DN6TV7EMTGBM","merchantName":"Medium","instanceMerchantId":"13685562959212738550"},"applePay":{"version":3},"signInWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"mediumMastodonDomainName":"me.dm","mediumOwnedAndOperatedCollectionIds":["8a9336e5bb4","b7e45b22fec3","193b68bd4fba","8d6b8a439e32","54c98c43354d","3f6ecf56618","d944778ce714","92d2092dc598","ae2a65f35510","1285ba81cada","544c7006046e","fc8964313712","40187e704f1c","88d9857e584e","7b6769f2748b","bcc38c8f6edf","cef6983b292","cb8577c9149e","444d13b52878","713d7dbc99b0","ef8e90590e66","191186aaafa0","55760f21cdc5","9dc80918cc93","bdc4052bbdba","8ccfed20cbb2"],"tierOneDomains":["medium.com","thebolditalic.com","arcdigital.media","towardsdatascience.com","uxdesign.cc","codeburst.io","psiloveyou.xyz","writingcooperative.com","entrepreneurshandbook.co","prototypr.io","betterhumans.coach.me","theascent.pub"],"topicsToFollow":["d61cf867d93f","8a146bc21b28","1eca0103fff3","4d562ee63426","aef1078a3ef5","e15e46793f8d","6158eb913466","55f1c20aba7a","3d18b94f6858","4861fee224fd","63c6f1f93ee","1d98b3a9a871","decb52b64abf","ae5d4995e225","830cded25262"],"topicToTagMappings":{"accessibility":"accessibility","addiction":"addiction","android-development":"android-development","art":"art","artificial-intelligence":"artificial-intelligence","astrology":"astrology","basic-income":"basic-income","beauty":"beauty","biotech":"biotech","blockchain":"blockchain","books":"books","business":"business","cannabis":"cannabis","cities":"cities","climate-change":"climate-change","comics":"comics","coronavirus":"coronavirus","creativity":"creativity","cryptocurrency":"cryptocurrency","culture":"culture","cybersecurity":"cybersecurity","data-science":"data-science","design":"design","digital-life":"digital-life","disability":"disability","economy":"economy","education":"education","equality":"equality","family":"family","feminism":"feminism","fiction":"fiction","film":"film","fitness":"fitness","food":"food","freelancing":"freelancing","future":"future","gadgets":"gadgets","gaming":"gaming","gun-control":"gun-control","health":"health","history":"history","humor":"humor","immigration":"immigration","ios-development":"ios-development","javascript":"javascript","justice":"justice","language":"language","leadership":"leadership","lgbtqia":"lgbtqia","lifestyle":"lifestyle","machine-learning":"machine-learning","makers":"makers","marketing":"marketing","math":"math","media":"media","mental-health":"mental-health","mindfulness":"mindfulness","money":"money","music":"music","neuroscience":"neuroscience","nonfiction":"nonfiction","outdoors":"outdoors","parenting":"parenting","pets":"pets","philosophy":"philosophy","photography":"photography","podcasts":"podcast","poetry":"poetry","politics":"politics","privacy":"privacy","product-management":"product-management","productivity":"productivity","programming":"programming","psychedelics":"psychedelics","psychology":"psychology","race":"race","relationships":"relationships","religion":"religion","remote-work":"remote-work","san-francisco":"san-francisco","science":"science","self":"self","self-driving-cars":"self-driving-cars","sexuality":"sexuality","social-media":"social-media","society":"society","software-engineering":"software-engineering","space":"space","spirituality":"spirituality","sports":"sports","startups":"startup","style":"style","technology":"technology","transportation":"transportation","travel":"travel","true-crime":"true-crime","tv":"tv","ux":"ux","venture-capital":"venture-capital","visual-design":"visual-design","work":"work","world":"world","writing":"writing"},"defaultImages":{"avatar":{"imageId":"1*dmbNkD5D-u45r44go_cf0g.png","height":150,"width":150},"orgLogo":{"imageId":"1*OMF3fSqH8t4xBJ9-6oZDZw.png","height":106,"width":545},"postLogo":{"imageId":"1*kFrc4tBFM_tCis-2Ic87WA.png","height":810,"width":1440},"postPreviewImage":{"imageId":"1*hn4v1tCaJy7cWMyb0bpNpQ.png","height":386,"width":579}},"collectionStructuredData":{"8d6b8a439e32":{"name":"Elemental","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F980\u002F1*9ygdqoKprhwuTVKUM0DLPA@2x.png","width":980,"height":159}}},"3f6ecf56618":{"name":"Forge","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F596\u002F1*uULpIlImcO5TDuBZ6lm7Lg@2x.png","width":596,"height":183}}},"ae2a65f35510":{"name":"GEN","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F264\u002F1*RdVZMdvfV3YiZTw6mX7yWA.png","width":264,"height":140}}},"88d9857e584e":{"name":"LEVEL","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*JqYMhNX6KNNb2UlqGqO2WQ.png","width":540,"height":108}}},"7b6769f2748b":{"name":"Marker","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F383\u002F1*haCUs0wF6TgOOvfoY-jEoQ@2x.png","width":383,"height":92}}},"444d13b52878":{"name":"OneZero","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*cw32fIqCbRWzwJaoQw6BUg.png","width":540,"height":123}}},"8ccfed20cbb2":{"name":"Zora","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*tZUQqRcCCZDXjjiZ4bDvgQ.png","width":540,"height":106}}}},"embeddedPostIds":{"coronavirus":"cd3010f9d81f"},"sharedCdcMessaging":{"COVID_APPLICABLE_TAG_SLUGS":[],"COVID_APPLICABLE_TOPIC_NAMES":[],"COVID_APPLICABLE_TOPIC_NAMES_FOR_TOPIC_PAGE":[],"COVID_MESSAGES":{"tierA":{"text":"For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":66,"end":73,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"tierB":{"text":"Anyone can publish on Medium per our Policies, but we don’t fact-check every story. For more info about the coronavirus, see cdc.gov.","markups":[{"start":37,"end":45,"href":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Fcategories\u002F201931128-Policies-Safety"},{"start":125,"end":132,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"paywall":{"text":"This article has been made free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":56,"end":70,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":138,"end":145,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"unbound":{"text":"This article is free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":45,"end":59,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":127,"end":134,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]}},"COVID_BANNER_POST_ID_OVERRIDE_WHITELIST":["3b31a67bff4a"]},"sharedVoteMessaging":{"TAGS":["politics","election-2020","government","us-politics","election","2020-presidential-race","trump","donald-trump","democrats","republicans","congress","republican-party","democratic-party","biden","joe-biden","maga"],"TOPICS":["politics","election"],"MESSAGE":{"text":"Find out more about the U.S. election results here.","markups":[{"start":46,"end":50,"href":"https:\u002F\u002Fcookpolitical.com\u002F2020-national-popular-vote-tracker"}]},"EXCLUDE_POSTS":["397ef29e3ca5"]},"embedPostRules":[],"recircOptions":{"v1":{"limit":3},"v2":{"limit":8}},"braintreeClientKey":"production_zjkj96jm_m56f8fqpf7ngnrd4","braintree":{"enabled":true,"merchantId":"m56f8fqpf7ngnrd4","merchantAccountId":{"usd":"AMediumCorporation_instant","eur":"amediumcorporation_EUR","cad":"amediumcorporation_CAD"},"publicKey":"ds2nn34bg2z7j5gd","braintreeEnvironment":"production","dashboardUrl":"https:\u002F\u002Fwww.braintreegateway.com\u002Fmerchants","gracePeriodDurationInDays":14,"mediumMembershipPlanId":{"monthly":"ce105f8c57a3","monthlyV2":"e8a5e126-792b-4ee6-8fba-d574c1b02fc5","monthlyWithTrial":"d5ee3dbe3db8","monthlyPremium":"fa741a9b47a2","yearly":"a40ad4a43185","yearlyV2":"3815d7d6-b8ca-4224-9b8c-182f9047866e","yearlyStaff":"d74fb811198a","yearlyWithTrial":"b3bc7350e5c7","yearlyPremium":"e21bd2c12166","monthlyOneYearFree":"e6c0637a-2bad-4171-ab4f-3c268633d83c","monthly25PercentOffFirstYear":"235ecc62-0cdb-49ae-9378-726cd21c504b","monthly20PercentOffFirstYear":"ba518864-9c13-4a99-91ca-411bf0cac756","monthly15PercentOffFirstYear":"594c029b-9f89-43d5-88f8-8173af4e070e","monthly10PercentOffFirstYear":"c6c7bc9a-40f2-4b51-8126-e28511d5bdb0","monthlyForStudents":"629ebe51-da7d-41fd-8293-34cd2f2030a8","yearlyOneYearFree":"78ba7be9-0d9f-4ece-aa3e-b54b826f2bf1","yearly25PercentOffFirstYear":"2dbb010d-bb8f-4eeb-ad5c-a08509f42d34","yearly20PercentOffFirstYear":"47565488-435b-47f8-bf93-40d5fbe0ebc8","yearly15PercentOffFirstYear":"8259809b-0881-47d9-acf7-6c001c7f720f","yearly10PercentOffFirstYear":"9dd694fb-96e1-472c-8d9e-3c868d5c1506","yearlyForStudents":"e29345ef-ab1c-4234-95c5-70e50fe6bc23","monthlyCad":"p52orjkaceei","yearlyCad":"h4q9g2up9ktt"},"braintreeDiscountId":{"oneMonthFree":"MONTHS_FREE_01","threeMonthsFree":"MONTHS_FREE_03","sixMonthsFree":"MONTHS_FREE_06","fiftyPercentOffOneYear":"FIFTY_PERCENT_OFF_ONE_YEAR"},"3DSecureVersion":"2","defaultCurrency":"usd","providerPlanIdCurrency":{"4ycw":"usd","rz3b":"usd","3kqm":"usd","jzw6":"usd","c2q2":"usd","nnsw":"usd","q8qw":"usd","d9y6":"usd","fx7w":"cad","nwf2":"cad"}},"paypalClientId":"AXj1G4fotC2GE8KzWX9mSxCH1wmPE3nJglf4Z2ig_amnhvlMVX87otaq58niAg9iuLktVNF_1WCMnN7v","paypal":{"host":"https:\u002F\u002Fapi.paypal.com:443","clientMode":"production","serverMode":"live","webhookId":"4G466076A0294510S","monthlyPlan":{"planId":"P-9WR0658853113943TMU5FDQA","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlan":{"planId":"P-7N8963881P8875835MU5JOPQ","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oneYearGift":{"name":"Medium Membership (1 Year, Digital Gift Code)","description":"Unlimited access to the best and brightest stories on Medium. Gift codes can be redeemed at medium.com\u002Fredeem.","price":"50.00","currency":"USD","sku":"membership-gift-1-yr"},"oldMonthlyPlan":{"planId":"P-96U02458LM656772MJZUVH2Y","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlan":{"planId":"P-59P80963JF186412JJZU3SMI","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"monthlyPlanWithTrial":{"planId":"P-66C21969LR178604GJPVKUKY","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlanWithTrial":{"planId":"P-6XW32684EX226940VKCT2MFA","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oldMonthlyPlanNoSetupFee":{"planId":"P-4N046520HR188054PCJC7LJI","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlanNoSetupFee":{"planId":"P-7A4913502Y5181304CJEJMXQ","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"sdkUrl":"https:\u002F\u002Fwww.paypal.com\u002Fsdk\u002Fjs"},"stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","log":{"json":true,"level":"info"},"imageUploadMaxSizeMb":25,"staffPicks":{"title":"Staff Picks","catalogId":"c7bc6e1ee00f"}},"session":{"xsrf":""}}</script><script>window.__APOLLO_STATE__ = {"ROOT_QUERY":{"__typename":"Query","viewer":null,"isLoggedIn":false,"collectionByDomainOrSlug({\"domainOrSlug\":\"medium.com\"})":null,"postResult({\"id\":\"d0c5de624597\"})":{"__ref":"Post:d0c5de624597"}},"LinkedAccounts:dec0c9bdedb9":{"__typename":"LinkedAccounts","mastodon":null,"id":"dec0c9bdedb9"},"UserViewerEdge:userId:dec0c9bdedb9-viewerId:lo_7f7941ed61ce":{"__typename":"UserViewerEdge","id":"userId:dec0c9bdedb9-viewerId:lo_7f7941ed61ce","isFollowing":false,"isUser":false,"isMuting":false},"NewsletterV3:2b419fe60434":{"__typename":"NewsletterV3","id":"2b419fe60434","type":"NEWSLETTER_TYPE_AUTHOR","slug":"dec0c9bdedb9","name":"dec0c9bdedb9","collection":null,"user":{"__ref":"User:dec0c9bdedb9"}},"User:dec0c9bdedb9":{"__typename":"User","id":"dec0c9bdedb9","name":"Mor","username":"mor2464","newsletterV3":{"__ref":"NewsletterV3:2b419fe60434"},"linkedAccounts":{"__ref":"LinkedAccounts:dec0c9bdedb9"},"isSuspended":false,"imageId":"1*dmbNkD5D-u45r44go_cf0g.png","mediumMemberAt":0,"verifications":{"__typename":"VerifiedInfo","isBookAuthor":false},"socialStats":{"__typename":"SocialStats","followerCount":29},"customDomainState":null,"hasSubdomain":false,"bio":"","isPartnerProgramEnrolled":false,"viewerEdge":{"__ref":"UserViewerEdge:userId:dec0c9bdedb9-viewerId:lo_7f7941ed61ce"},"viewerIsUser":false,"postSubscribeMembershipUpsellShownAt":0,"allowNotes":true,"membership":null,"twitterScreenName":""},"Paragraph:922c892b4258_0":{"__typename":"Paragraph","id":"922c892b4258_0","name":"7784","type":"H3","href":null,"layout":null,"metadata":null,"text":"Azure AD Pass The Certificate","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_1":{"__typename":"Paragraph","id":"922c892b4258_1","name":"a80c","type":"H3","href":null,"layout":null,"metadata":null,"text":"Intro","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_2":{"__typename":"Paragraph","id":"922c892b4258_2","name":"600a","type":"P","href":null,"layout":null,"metadata":null,"text":"With the evolvement of Azure and Pass-Through authentication, many organizations are connecting devices to Azure AD, making the authentication and management easier. Azure AD devices can be connected only to Azure AD and no longer to On-Prem AD, raising the question how attackers can get access to those machines.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_3":{"__typename":"Paragraph","id":"922c892b4258_3","name":"9b49","type":"P","href":null,"layout":null,"metadata":null,"text":"We have already seen the blog post on Azure AD lateral Movement and Mimikatz “Pass The PRT” attack. Now we only need to find out how to jump between Azure AD joined machines which no longer supports the known authentication protocols.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":38,"end":63,"href":"https:\u002F\u002Fmedium.com\u002F@talthemaor\u002Flateral-movement-graph-for-azure-ad-7c5e0136e2d8","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":77,"end":90,"href":"https:\u002F\u002Fblog.stealthbits.com\u002Flateral-movement-to-the-cloud-pass-the-prt\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_4":{"__typename":"Paragraph","id":"922c892b4258_4","name":"0256","type":"P","href":null,"layout":null,"metadata":null,"text":"In this blog post I’ll provide network behavior analysis of the new authentication mechanism between 2 Azure AD joined machines, I’ll also explain what is Azure AD P2P certificate and how it is generated.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":39,"end":56,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":155,"end":179,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_5":{"__typename":"Paragraph","id":"922c892b4258_5","name":"8041","type":"P","href":null,"layout":null,"metadata":null,"text":"After learning the necessary information, we will dive into “Pass The Certificate” attack that works against Azure AD joined machines and let you gain access to remote machines. This attack use the PRT from Azure AD machine to gain P2P certificates and by using the certificate, to gain permanent access to any Azure AD joined machine (if sufficient privileges).","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":60,"end":82,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_6":{"__typename":"Paragraph","id":"922c892b4258_6","name":"d7e8","type":"H3","href":null,"layout":null,"metadata":null,"text":"Azure AD machine","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_7":{"__typename":"Paragraph","id":"922c892b4258_7","name":"88cf","type":"P","href":null,"layout":null,"metadata":null,"text":"There are 3 ways to connect a device to Azure AD:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_8":{"__typename":"Paragraph","id":"922c892b4258_8","name":"42e3","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Azure AD registered — devices that are registered in Azure but can be accessed using Microsoft account or local account.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_9":{"__typename":"Paragraph","id":"922c892b4258_9","name":"141f","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Azure AD joined — devices that are joined to Azure and can be accessed only by local user or Azure AD user. Those machines are managed in Azure.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_10":{"__typename":"Paragraph","id":"922c892b4258_10","name":"27ab","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Hybrid Azure AD joined — devices that are joined both to Azure AD and to On-Prem AD, and can be accessed by Azure AD accounts, On-Prem accounts and local accounts.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_11":{"__typename":"Paragraph","id":"922c892b4258_11","name":"441e","type":"P","href":null,"layout":null,"metadata":null,"text":"Azure AD joined machines support only 2 mech types for authentication, NegoEx (1.3.6.1.4.1.311.2.2.30) and NtlmSSP (1.3.6.1.4.1.311.2.2.10). We already know how NTLM protocol works, and it also supported by Azure AD joined machines for local user authentication.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*j453dyDiUEORPQUTeFE42A.png":{"__typename":"ImageMetadata","id":"1*j453dyDiUEORPQUTeFE42A.png","originalHeight":114,"originalWidth":624,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_12":{"__typename":"Paragraph","id":"922c892b4258_12","name":"3262","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*j453dyDiUEORPQUTeFE42A.png"},"text":"MechTypes","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_13":{"__typename":"Paragraph","id":"922c892b4258_13","name":"b71a","type":"P","href":null,"layout":null,"metadata":null,"text":"let’s look on the authentication process between 2 Azure AD joined machines, where the client in the left, the initiator, try to authenticate and access the client in the right, the acceptor.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*63wq7BNs0ud47Xkxmj8EEA.png":{"__typename":"ImageMetadata","id":"1*63wq7BNs0ud47Xkxmj8EEA.png","originalHeight":445,"originalWidth":755,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_14":{"__typename":"Paragraph","id":"922c892b4258_14","name":"4b96","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*63wq7BNs0ud47Xkxmj8EEA.png"},"text":"Authentication process between 2 Azure AD Machines","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_15":{"__typename":"Paragraph","id":"922c892b4258_15","name":"b87a","type":"OLI","href":null,"layout":null,"metadata":null,"text":"This step is simple SMB negotiation. In the end of this step, both sides will agree on SMB dialect and will find out what are the mech types supported by the other client. If both support NegoEx, then we will proceed to step 2, otherwise we will proceed to the known NTLM authentication (or other authentication mechanism if they both support it).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_16":{"__typename":"Paragraph","id":"922c892b4258_16","name":"bddd","type":"OLI","href":null,"layout":null,"metadata":null,"text":"If the initiator already has P2P certificate, then we will skip steps 2–4 and proceed to step 5. Otherwise, the initiator will request Nonce from Azure AD that will be used for P2P certificate request.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_17":{"__typename":"Paragraph","id":"922c892b4258_17","name":"761b","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Azure AD will generate a Nonce that will be signed by the requestor in the next request, to prove that the second request is not passed from man in the middle attack or reused.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_18":{"__typename":"Paragraph","id":"922c892b4258_18","name":"0cbe","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The client will build JWT. They will generate random context and place it in the header. In the JWT message they will provide the CSR (certificate signing request) and the PRT. The JWT will be signed by the derived key generated from the context and the session key.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_19":{"__typename":"Paragraph","id":"922c892b4258_19","name":"7526","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Azure AD will validate the JWT using the derived key and if the verification succeeded, it would generate X.509 certificate and send it in the response. This certificate is a P2P (peer-to-peer) certificate and only the client who initiated the request should have the private key associated with the public key.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_20":{"__typename":"Paragraph","id":"922c892b4258_20","name":"87de","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The initiator will send multiple NegoEx messages, where the important message is AP request. AP request message is a Kerberos PKU2U request which is the same as Kerberos PKI AS request (TGT request).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_21":{"__typename":"Paragraph","id":"922c892b4258_21","name":"aaec","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The acceptor will send back multiple NegoEx messages, where the important message is challenge. This message is a Kerberos PKU2U response which is the same as Kerberos PKI AS response (TGT response).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_22":{"__typename":"Paragraph","id":"922c892b4258_22","name":"510d","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The initiator will send 2 NegoEx messages, ap request and verify. The AP request message will be Kerberos AP request to resource using the TGT from the previous stage. Verify message is a checksum message of all the previous NegoEx messages using HMAC_SHA1_96_AES256. The verify message is required, the acceptor will deny the request without it (or with wrong checksum).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_23":{"__typename":"Paragraph","id":"922c892b4258_23","name":"e9fc","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The acceptor will validate the checksum and the AP request messages received from the initiator. If the verification succeeded, they would send 2 NegoEx messages, challenge and verify. The challenge message will be Kerberos AP response from the resource, validating that resource is the one you authenticated to. Verify message is a checksum message like in the previous request (8). In this response, the verify message will also contain the checksum of the messages from the previous stage including the challenge.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_24":{"__typename":"Paragraph","id":"922c892b4258_24","name":"4d9d","type":"H3","href":null,"layout":null,"metadata":null,"text":"PKU2U","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_25":{"__typename":"Paragraph","id":"922c892b4258_25","name":"d703","type":"P","href":null,"layout":null,"metadata":null,"text":"Public Key Cryptography Based User-to-User authentication is a Kerberos PKI extension that removes the KDC from the equation and allow peer-to-peer (client to client) authentication. In this protocol, the realm name changed to the constant “WELLKNOWN:PKU2U”. The difference from Kerberos PKI is that the acceptor (the client we try to connect to) is acting as the KDC, the acceptor will issue a Kerberos ticket that later will be used by the initiator (the client want to authenticate to the acceptor) to prove that they can extract the session key associated with the ticket. It’s also important to mention that PKU2U protocol data units (PDUs) can’t be exchanged as usual Kerberos but wrapped as GSS-API context tokens.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_26":{"__typename":"Paragraph","id":"922c892b4258_26","name":"6387","type":"P","href":null,"layout":null,"metadata":null,"text":"These are the steps to perform PKU2U authentication:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_27":{"__typename":"Paragraph","id":"922c892b4258_27","name":"9c6c","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The initiator generates Kerberos PKI AS request (with the new realm).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_28":{"__typename":"Paragraph","id":"922c892b4258_28","name":"14af","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The acceptor verifies the authenticator and PADATA in the request.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_29":{"__typename":"Paragraph","id":"922c892b4258_29","name":"0039","type":"OLI","href":null,"layout":null,"metadata":null,"text":"If the verification succeeded, the acceptor generate ticket that proves the verification of the initiator, and like in Kerberos PKI, encrypt it with the session key (public-key or Diffie-Hellman).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_30":{"__typename":"Paragraph","id":"922c892b4258_30","name":"c3f2","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The initiator receives the AS response packet, decrypt the relevant parts, and extract the second session key that will be used for the second request.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_31":{"__typename":"Paragraph","id":"922c892b4258_31","name":"06f5","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The initiator generates Kerberos AP request packet using the ticket and the session key from the previous stage and send it to the acceptor.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_32":{"__typename":"Paragraph","id":"922c892b4258_32","name":"a972","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The acceptor receives the packet and validates the ticket and the authenticator like in normal AP request.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_33":{"__typename":"Paragraph","id":"922c892b4258_33","name":"220f","type":"OLI","href":null,"layout":null,"metadata":null,"text":"If the acceptor succeeded to verify the AP request, it will generate AP response and send it back to the initiator.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_34":{"__typename":"Paragraph","id":"922c892b4258_34","name":"dbf7","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The initiator will receive the AP response and validate the authenticator.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_35":{"__typename":"Paragraph","id":"922c892b4258_35","name":"0b44","type":"OLI","href":null,"layout":null,"metadata":null,"text":"If the initiator succeeded to verify the AP response, connection is established between the initiator and the acceptor.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_36":{"__typename":"Paragraph","id":"922c892b4258_36","name":"77f4","type":"H3","href":null,"layout":null,"metadata":null,"text":"SPNEGO","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_37":{"__typename":"Paragraph","id":"922c892b4258_37","name":"c6f2","type":"P","href":null,"layout":null,"metadata":null,"text":"Simple and Protected GSS-API (Generic Security Service Application Program Interface) Negotiation Mechanism which play a key role in the negotiation process for choosing the security mechanism to use, in our case it will be NTLM or NegoEx. It’s a known negotiation protocol so we will not go into more details.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*hruHeY_4KWxq-nKy2Sojhg.png":{"__typename":"ImageMetadata","id":"1*hruHeY_4KWxq-nKy2Sojhg.png","originalHeight":91,"originalWidth":624,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_38":{"__typename":"Paragraph","id":"922c892b4258_38","name":"2660","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*hruHeY_4KWxq-nKy2Sojhg.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_39":{"__typename":"Paragraph","id":"922c892b4258_39","name":"7ba0","type":"H3","href":null,"layout":null,"metadata":null,"text":"NegoEx","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_40":{"__typename":"Paragraph","id":"922c892b4258_40","name":"54fa","type":"P","href":null,"layout":null,"metadata":null,"text":"SPNEGO Extended Negotiation security mechanism. When the NEGOEX security mechanism is selected by SPNEGO, it provides a method allowing selection of a common authentication protocol based on factors beyond just the fact that both client and server support a given security mechanism.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_41":{"__typename":"Paragraph","id":"922c892b4258_41","name":"510f","type":"P","href":null,"layout":null,"metadata":null,"text":"There are 7 types of messages that are used in authentication:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_42":{"__typename":"Paragraph","id":"922c892b4258_42","name":"b3a3","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Initiator Nego — used for sending the authentication schema, like hello message.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_43":{"__typename":"Paragraph","id":"922c892b4258_43","name":"2549","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Acceptor Nego — used for sending authentication schema from the acceptor if needed.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_44":{"__typename":"Paragraph","id":"922c892b4258_44","name":"996f","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Initiator Metadata — used for sending the metadata (GSS-API token) of the initiator if needed.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_45":{"__typename":"Paragraph","id":"922c892b4258_45","name":"bb87","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Acceptor Metadata — used for sending the metadata (GSS-API token) of the acceptor if needed.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_46":{"__typename":"Paragraph","id":"922c892b4258_46","name":"6291","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Challenge — used for accepting the initiator AP Request, contains Kerberos response messages.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_47":{"__typename":"Paragraph","id":"922c892b4258_47","name":"5e24","type":"ULI","href":null,"layout":null,"metadata":null,"text":"AP Request — used for authenticating to the acceptor, contains Kerberos request messages.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_48":{"__typename":"Paragraph","id":"922c892b4258_48","name":"b534","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Verify — used for verifying the conversation.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_49":{"__typename":"Paragraph","id":"922c892b4258_49","name":"7ffd","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Alert — used to notify on errors in the authentication.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_50":{"__typename":"Paragraph","id":"922c892b4258_50","name":"8605","type":"P","href":null,"layout":null,"metadata":null,"text":"The flow as it described in MS-NEGOEX:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*6ROjM0NzWynhM9Mmhi3Liw.png":{"__typename":"ImageMetadata","id":"1*6ROjM0NzWynhM9Mmhi3Liw.png","originalHeight":582,"originalWidth":585,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_51":{"__typename":"Paragraph","id":"922c892b4258_51","name":"afca","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*6ROjM0NzWynhM9Mmhi3Liw.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_52":{"__typename":"Paragraph","id":"922c892b4258_52","name":"38a3","type":"P","href":null,"layout":null,"metadata":null,"text":"Let’s quickly go over the message types:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_53":{"__typename":"Paragraph","id":"922c892b4258_53","name":"1b58","type":"P","href":null,"layout":null,"metadata":null,"text":"First, let’s understand the structure of the MESSAGE_HEADER since it required in every message. It is used to provide metadata about each message. According to the RFC, the structure will be","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":164,"end":167,"href":"https:\u002F\u002Ftools.ietf.org\u002Fhtml\u002Fdraft-zhu-negoex-04","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_54":{"__typename":"Paragraph","id":"922c892b4258_54","name":"b03b","type":"P","href":null,"layout":null,"metadata":null,"text":"struct{","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_55":{"__typename":"Paragraph","id":"922c892b4258_55","name":"7f83","type":"P","href":null,"layout":null,"metadata":null,"text":"ULONG64 Signature; \u002F\u002F contains MESSAGE_SIGNATURE","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_56":{"__typename":"Paragraph","id":"922c892b4258_56","name":"d76e","type":"P","href":null,"layout":null,"metadata":null,"text":"MESSAGE_TYPE MessageType;","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_57":{"__typename":"Paragraph","id":"922c892b4258_57","name":"0c36","type":"P","href":null,"layout":null,"metadata":null,"text":"ULONG SequenceNum; \u002F\u002F the message sequence number of this,","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_58":{"__typename":"Paragraph","id":"922c892b4258_58","name":"13f9","type":"P","href":null,"layout":null,"metadata":null,"text":"\u002F\u002F conversation, starting with 0 and sequentially","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_59":{"__typename":"Paragraph","id":"922c892b4258_59","name":"a5f9","type":"P","href":null,"layout":null,"metadata":null,"text":"\u002F\u002F incremented","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_60":{"__typename":"Paragraph","id":"922c892b4258_60","name":"4a22","type":"P","href":null,"layout":null,"metadata":null,"text":"ULONG cbHeaderLength; \u002F\u002F the header length of this message,","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_61":{"__typename":"Paragraph","id":"922c892b4258_61","name":"f8ed","type":"P","href":null,"layout":null,"metadata":null,"text":"\u002F\u002F including the message specific header, excluding the","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_62":{"__typename":"Paragraph","id":"922c892b4258_62","name":"8742","type":"P","href":null,"layout":null,"metadata":null,"text":"\u002F\u002F payload","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_63":{"__typename":"Paragraph","id":"922c892b4258_63","name":"096a","type":"P","href":null,"layout":null,"metadata":null,"text":"ULONG cbMessageLength; \u002F\u002F the length of this message","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_64":{"__typename":"Paragraph","id":"922c892b4258_64","name":"96a2","type":"P","href":null,"layout":null,"metadata":null,"text":"CONVERSATION_ID ConversationId;","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_65":{"__typename":"Paragraph","id":"922c892b4258_65","name":"1a0e","type":"P","href":null,"layout":null,"metadata":null,"text":"} MESSAGE_HEADER;","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_66":{"__typename":"Paragraph","id":"922c892b4258_66","name":"8760","type":"P","href":null,"layout":null,"metadata":null,"text":"The fields will be:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_67":{"__typename":"Paragraph","id":"922c892b4258_67","name":"59ce","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The Signature that will be “NEGOEXTS” as constant.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_68":{"__typename":"Paragraph","id":"922c892b4258_68","name":"cb71","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The message type, 1 of the 7 types listed above.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_69":{"__typename":"Paragraph","id":"922c892b4258_69","name":"ac61","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The sequence number of the message which will be required for signing the message in the verify message by the order they sent.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_70":{"__typename":"Paragraph","id":"922c892b4258_70","name":"d8c6","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The header struct size.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_71":{"__typename":"Paragraph","id":"922c892b4258_71","name":"568b","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Length of the message.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_72":{"__typename":"Paragraph","id":"922c892b4258_72","name":"60ca","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Conversation id that should be the same for every message during the same authentication session.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_73":{"__typename":"Paragraph","id":"922c892b4258_73","name":"febc","type":"BQ","href":null,"layout":null,"metadata":null,"text":"We will not get into NegoEx details since those are typical GSSAPI messages. It’s important to say that Initiator Nego, Acceptor Nego, Initiator Metadata, Acceptor Metadata and alert messages don’t have any “secret” (they can be generated without the private key or any secret). But, those messages required to generate the verify message which requires checksum over all the previous messages by the order they sent.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_74":{"__typename":"Paragraph","id":"922c892b4258_74","name":"5430","type":"H3","href":null,"layout":null,"metadata":null,"text":"Nego messages","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_75":{"__typename":"Paragraph","id":"922c892b4258_75","name":"7a99","type":"P","href":null,"layout":null,"metadata":null,"text":"The Nego messages used to begin and exchange negotiation of security mechanisms. First the initiator will send Nego message with message type 0 (INITIATOR_NEGO) and a list of supported security mechanisms (MechTypes) to begin the negotiation. Afterwards, the acceptor will respond with Nego message with message type 1 (ACCEPTOR_NEGO) and the list of supported security mechanisms.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_76":{"__typename":"Paragraph","id":"922c892b4258_76","name":"3664","type":"H4","href":null,"layout":null,"metadata":null,"text":"Initiator Nego","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*R_5RRBjAbSrez4pw-n7GzA.png":{"__typename":"ImageMetadata","id":"1*R_5RRBjAbSrez4pw-n7GzA.png","originalHeight":323,"originalWidth":559,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_77":{"__typename":"Paragraph","id":"922c892b4258_77","name":"00d7","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*R_5RRBjAbSrez4pw-n7GzA.png"},"text":"Initiator Nego message","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_78":{"__typename":"Paragraph","id":"922c892b4258_78","name":"1c7f","type":"H4","href":null,"layout":null,"metadata":null,"text":"Acceptor Nego","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*7rwNiFwAOZ3EiiDcEC5Wsg.png":{"__typename":"ImageMetadata","id":"1*7rwNiFwAOZ3EiiDcEC5Wsg.png","originalHeight":329,"originalWidth":552,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_79":{"__typename":"Paragraph","id":"922c892b4258_79","name":"c63f","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*7rwNiFwAOZ3EiiDcEC5Wsg.png"},"text":"Acceptor Nego message","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_80":{"__typename":"Paragraph","id":"922c892b4258_80","name":"0a0f","type":"H3","href":null,"layout":null,"metadata":null,"text":"Exchange messages","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_81":{"__typename":"Paragraph","id":"922c892b4258_81","name":"ec06","type":"P","href":null,"layout":null,"metadata":null,"text":"Those messages are used to encapsulate context tokens of the negotiated security mechanism.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_82":{"__typename":"Paragraph","id":"922c892b4258_82","name":"1f08","type":"H4","href":null,"layout":null,"metadata":null,"text":"Initiator Metadata","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*PssoJ53lGSqZW8vJXKmx9w.png":{"__typename":"ImageMetadata","id":"1*PssoJ53lGSqZW8vJXKmx9w.png","originalHeight":211,"originalWidth":624,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_83":{"__typename":"Paragraph","id":"922c892b4258_83","name":"bff9","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*PssoJ53lGSqZW8vJXKmx9w.png"},"text":"Acceptor Metadata message","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_84":{"__typename":"Paragraph","id":"922c892b4258_84","name":"a845","type":"P","href":null,"layout":null,"metadata":null,"text":"Where the exchange bytes are Asn1 struct and they are the metadata token.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*MXHUNedSbe0PAqFrP2WYBA.png":{"__typename":"ImageMetadata","id":"1*MXHUNedSbe0PAqFrP2WYBA.png","originalHeight":197,"originalWidth":624,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_85":{"__typename":"Paragraph","id":"922c892b4258_85","name":"3dc3","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*MXHUNedSbe0PAqFrP2WYBA.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_86":{"__typename":"Paragraph","id":"922c892b4258_86","name":"ebeb","type":"H4","href":null,"layout":null,"metadata":null,"text":"Acceptor Metadata","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*iNKOPsYXOCgCw-LkLfcwlQ.png":{"__typename":"ImageMetadata","id":"1*iNKOPsYXOCgCw-LkLfcwlQ.png","originalHeight":214,"originalWidth":624,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_87":{"__typename":"Paragraph","id":"922c892b4258_87","name":"7b1f","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*iNKOPsYXOCgCw-LkLfcwlQ.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_88":{"__typename":"Paragraph","id":"922c892b4258_88","name":"1715","type":"P","href":null,"layout":null,"metadata":null,"text":"Where the exchange bytes are Asn1 struct and they are the metadata token.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*JeJ87Rjf7bBrBqDDn2GX9g.png":{"__typename":"ImageMetadata","id":"1*JeJ87Rjf7bBrBqDDn2GX9g.png","originalHeight":112,"originalWidth":624,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_89":{"__typename":"Paragraph","id":"922c892b4258_89","name":"857e","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*JeJ87Rjf7bBrBqDDn2GX9g.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_90":{"__typename":"Paragraph","id":"922c892b4258_90","name":"91c6","type":"H4","href":null,"layout":null,"metadata":null,"text":"AP Request","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*YZiN61VJG8ze-D9EWcdbeA.png":{"__typename":"ImageMetadata","id":"1*YZiN61VJG8ze-D9EWcdbeA.png","originalHeight":240,"originalWidth":470,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_91":{"__typename":"Paragraph","id":"922c892b4258_91","name":"b236","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*YZiN61VJG8ze-D9EWcdbeA.png"},"text":"AP request message","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_92":{"__typename":"Paragraph","id":"922c892b4258_92","name":"5e39","type":"P","href":null,"layout":null,"metadata":null,"text":"The challenge is like Kerberos AS\u002FAP request. The exchange bytes contain the PKU2U PDUs.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_93":{"__typename":"Paragraph","id":"922c892b4258_93","name":"62ce","type":"H4","href":null,"layout":null,"metadata":null,"text":"Challenge","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*0DmTPac0RDrxBIIR7tv5Ew.png":{"__typename":"ImageMetadata","id":"1*0DmTPac0RDrxBIIR7tv5Ew.png","originalHeight":239,"originalWidth":440,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_94":{"__typename":"Paragraph","id":"922c892b4258_94","name":"16f8","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*0DmTPac0RDrxBIIR7tv5Ew.png"},"text":"Challenge message","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_95":{"__typename":"Paragraph","id":"922c892b4258_95","name":"6cc5","type":"P","href":null,"layout":null,"metadata":null,"text":"The challenge is like Kerberos AS\u002FAP response. The exchange bytes contain the PKU2U PDUs.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_96":{"__typename":"Paragraph","id":"922c892b4258_96","name":"e830","type":"H4","href":null,"layout":null,"metadata":null,"text":"Verify","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*fo6ZpH34Mng59TF2cqPCQw.png":{"__typename":"ImageMetadata","id":"1*fo6ZpH34Mng59TF2cqPCQw.png","originalHeight":319,"originalWidth":468,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_97":{"__typename":"Paragraph","id":"922c892b4258_97","name":"4c3d","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*fo6ZpH34Mng59TF2cqPCQw.png"},"text":"Verify message","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_98":{"__typename":"Paragraph","id":"922c892b4258_98","name":"7635","type":"P","href":null,"layout":null,"metadata":null,"text":"The verify message is sent by both the initiator and acceptor. This packet ensures that both sides participated in the whole conversation. This message protects from replay attacks by generating a checksum of all the previous NegoEx messages sent in the conversation, those message checksum by the session key which both the initiator and the acceptor agree on during the authentication.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_99":{"__typename":"Paragraph","id":"922c892b4258_99","name":"2866","type":"H3","href":null,"layout":null,"metadata":null,"text":"Azure AD certificate","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_100":{"__typename":"Paragraph","id":"922c892b4258_100","name":"cb4b","type":"P","href":null,"layout":null,"metadata":null,"text":"For client authentication between 2 Azure AD joined machines, certificate must be issued by Azure AD CA for the required user (as the subject). Certificate will be automatically requested by the Windows machine using the function aadcloudap!GetUserCertificate when the negotiated security mechanism is NegoEx.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_101":{"__typename":"Paragraph","id":"922c892b4258_101","name":"9bd4","type":"P","href":null,"layout":null,"metadata":null,"text":"As you can see bellow, the output will be certificate that can be used using PKU2U for client to client authentication and will be issued by the CA “MS-Organization-P2P-Access [2020]”.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*U2DL5S7kdZfLsxyK7DmY4Q.png":{"__typename":"ImageMetadata","id":"1*U2DL5S7kdZfLsxyK7DmY4Q.png","originalHeight":307,"originalWidth":566,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_102":{"__typename":"Paragraph","id":"922c892b4258_102","name":"cd35","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*U2DL5S7kdZfLsxyK7DmY4Q.png"},"text":"Azure AD P2P Certificate","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_103":{"__typename":"Paragraph","id":"922c892b4258_103","name":"5c5e","type":"P","href":null,"layout":null,"metadata":null,"text":"The process of requesting certificate is as follow (those are steps 2–5 authentication process between 2 Azure AD machines illustration in the beginning of the post).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_104":{"__typename":"Paragraph","id":"922c892b4258_104","name":"150a","type":"P","href":null,"layout":null,"metadata":null,"text":"The client must request nonce by sending grant type of srv_challenge to “login.microsoftonline.com” using the tenant id of his organization.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*TGOkhBxpKY8Hd8ttwHq83g.png":{"__typename":"ImageMetadata","id":"1*TGOkhBxpKY8Hd8ttwHq83g.png","originalHeight":216,"originalWidth":624,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_105":{"__typename":"Paragraph","id":"922c892b4258_105","name":"112a","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*TGOkhBxpKY8Hd8ttwHq83g.png"},"text":"Nonce request — Fiddler","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_106":{"__typename":"Paragraph","id":"922c892b4258_106","name":"a66c","type":"P","href":null,"layout":null,"metadata":null,"text":"After receiving the Nonce, a second request should be made to request for certificate using the following parameters:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_107":{"__typename":"Paragraph","id":"922c892b4258_107","name":"9760","type":"ULI","href":null,"layout":null,"metadata":null,"text":"grant_type of “urn:ietf:params:oauth:grant-type:jwt-bearer”","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_108":{"__typename":"Paragraph","id":"922c892b4258_108","name":"cc17","type":"ULI","href":null,"layout":null,"metadata":null,"text":"request that will contain the json web token (JWT).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_109":{"__typename":"Paragraph","id":"922c892b4258_109","name":"467b","type":"P","href":null,"layout":null,"metadata":null,"text":"In the request, the client will have to generate the following:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_110":{"__typename":"Paragraph","id":"922c892b4258_110","name":"5773","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Security context.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_111":{"__typename":"Paragraph","id":"922c892b4258_111","name":"ec22","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Certificate signing request (CSR).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_112":{"__typename":"Paragraph","id":"922c892b4258_112","name":"c8a7","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Derived key using the client session key and the security context.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_113":{"__typename":"Paragraph","id":"922c892b4258_113","name":"54c8","type":"P","href":null,"layout":null,"metadata":null,"text":"After generating the required information, the client will have to generate json web token (JWT). In the JWT header the client will provide the security context and algorithm (that will be HS256 — HMAC SHA256), and in the message they will provide the following fields:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_114":{"__typename":"Paragraph","id":"922c892b4258_114","name":"e1ec","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Iss — issuer and signer of the token (it will always be “aad:brokerplugin”).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_115":{"__typename":"Paragraph","id":"922c892b4258_115","name":"d456","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Grant_type — the token requested (it will always be “refresh_token”).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_116":{"__typename":"Paragraph","id":"922c892b4258_116","name":"c082","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Aud — the audience, who the token intended for (it will always be “login.microsoftonline.com”).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_117":{"__typename":"Paragraph","id":"922c892b4258_117","name":"1fe7","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Request_nonce — the Nonce from the first step.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_118":{"__typename":"Paragraph","id":"922c892b4258_118","name":"a994","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Scope — the requested permissions (it will always be “openid aza ugs”).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_119":{"__typename":"Paragraph","id":"922c892b4258_119","name":"0a99","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Refresh_token — the client PRT.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_120":{"__typename":"Paragraph","id":"922c892b4258_120","name":"dd6f","type":"ULI","href":null,"layout":null,"metadata":null,"text":"client_id — the AAD cloud ap identifier (it will always be “38aa3b87-a06d-4817-b275–7a316988d93b”).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_121":{"__typename":"Paragraph","id":"922c892b4258_121","name":"a2da","type":"ULI","href":null,"layout":null,"metadata":null,"text":"cert_token_use — the certificate required (it will always be “user_cert”).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_122":{"__typename":"Paragraph","id":"922c892b4258_122","name":"07d8","type":"ULI","href":null,"layout":null,"metadata":null,"text":"csr_type — the certificate signing request type (it will always be “http:\u002F\u002Fschemas.microsoft.com\u002Fwindows\u002Fpki\u002F2009\u002F01\u002Fenrollment#PKCS10”).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_123":{"__typename":"Paragraph","id":"922c892b4258_123","name":"826b","type":"ULI","href":null,"layout":null,"metadata":null,"text":"csr — the certificate signing request.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*um8vD1ZTvr1f2CBXPvprVw.png":{"__typename":"ImageMetadata","id":"1*um8vD1ZTvr1f2CBXPvprVw.png","originalHeight":387,"originalWidth":360,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_124":{"__typename":"Paragraph","id":"922c892b4258_124","name":"b7eb","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*um8vD1ZTvr1f2CBXPvprVw.png"},"text":"JWT — jwt.io","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_125":{"__typename":"Paragraph","id":"922c892b4258_125","name":"47ec","type":"P","href":null,"layout":null,"metadata":null,"text":"The client will take the header and the payload (message) and sign them using the derived key, add the signature field to the and send the JWT (header + ”.” +payload + ”.” + signature) to Azure AD.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_126":{"__typename":"Paragraph","id":"922c892b4258_126","name":"05fc","type":"P","href":null,"layout":null,"metadata":null,"text":"After receiving the request, Azure AD will verify the JWT signature using the client session key and the security context, and will check if the refresh token is valid. If all the checks passed, Azure AD will generate certificate for the user and will send a response with the following fields:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_127":{"__typename":"Paragraph","id":"922c892b4258_127","name":"0bda","type":"ULI","href":null,"layout":null,"metadata":null,"text":"cert_token_use — the same field from the request (it will always be “user_cert”).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_128":{"__typename":"Paragraph","id":"922c892b4258_128","name":"0b00","type":"ULI","href":null,"layout":null,"metadata":null,"text":"expires_in — the duration of time the certificate is valid for.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_129":{"__typename":"Paragraph","id":"922c892b4258_129","name":"504d","type":"ULI","href":null,"layout":null,"metadata":null,"text":"expires_on — the date when the certificate is no longer valid.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_130":{"__typename":"Paragraph","id":"922c892b4258_130","name":"24b5","type":"ULI","href":null,"layout":null,"metadata":null,"text":"ext_expires_in — value to indicate the extended lifetime of an access token.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_131":{"__typename":"Paragraph","id":"922c892b4258_131","name":"ce11","type":"ULI","href":null,"layout":null,"metadata":null,"text":"id_token — token with the identity of the user.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_132":{"__typename":"Paragraph","id":"922c892b4258_132","name":"b74a","type":"ULI","href":null,"layout":null,"metadata":null,"text":"refresh_token — new PRT for the user (the previous one is still valid).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_133":{"__typename":"Paragraph","id":"922c892b4258_133","name":"a960","type":"ULI","href":null,"layout":null,"metadata":null,"text":"resource — the resource the certificate generated for (it will always be “p2p_cert”).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_134":{"__typename":"Paragraph","id":"922c892b4258_134","name":"bc2e","type":"ULI","href":null,"layout":null,"metadata":null,"text":"session_key — new session key for the user (the previous one is still valid).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_135":{"__typename":"Paragraph","id":"922c892b4258_135","name":"8046","type":"ULI","href":null,"layout":null,"metadata":null,"text":"x5c — the PEM certificate generated from the CSR.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_136":{"__typename":"Paragraph","id":"922c892b4258_136","name":"1897","type":"ULI","href":null,"layout":null,"metadata":null,"text":"x5c_ca — the CA of the certificate.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_137":{"__typename":"Paragraph","id":"922c892b4258_137","name":"47f3","type":"P","href":null,"layout":null,"metadata":null,"text":"When the client receives the response from Azure AD, they can store the refresh token and the session key for future requests and they will validate the certificate subject against the PEM certificate to make sure this is the requested account. The P2P certificate will be stored in the certificate store and can be used for client authentication if it still valid.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*sHoLhk7YkchobAi-50Jnpg.png":{"__typename":"ImageMetadata","id":"1*sHoLhk7YkchobAi-50Jnpg.png","originalHeight":270,"originalWidth":627,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_138":{"__typename":"Paragraph","id":"922c892b4258_138","name":"d74b","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*sHoLhk7YkchobAi-50Jnpg.png"},"text":"Request for certificate — fiddler","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_139":{"__typename":"Paragraph","id":"922c892b4258_139","name":"1b82","type":"H3","href":null,"layout":null,"metadata":null,"text":"PRT -\u003E Cert -\u003E Pass The Certificate","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_140":{"__typename":"Paragraph","id":"922c892b4258_140","name":"57e1","type":"P","href":null,"layout":null,"metadata":null,"text":"Now that were familiar with the protocols, we can implement them and authenticate to Azure AD machine from any machine.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_141":{"__typename":"Paragraph","id":"922c892b4258_141","name":"56a7","type":"P","href":null,"layout":null,"metadata":null,"text":"We already saw in his tweet that Mimikatz is extracting the PRT and session key from Azure AD machine, so we can use Mimikatz function “sekurlsa::cloudap” to get the PRT and the session key. Then, we will use other Mimikatz function, “dpapi::cloudapkd”, to get derived key for security context.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":22,"end":27,"href":"https:\u002F\u002Ftwitter.com\u002Fgentilkiwi\u002Fstatus\u002F1291537989395505158","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*5lIs4f4pmkMfDuuACbWw0w.png":{"__typename":"ImageMetadata","id":"1*5lIs4f4pmkMfDuuACbWw0w.png","originalHeight":96,"originalWidth":624,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_142":{"__typename":"Paragraph","id":"922c892b4258_142","name":"ac32","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*5lIs4f4pmkMfDuuACbWw0w.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_143":{"__typename":"Paragraph","id":"922c892b4258_143","name":"6c8d","type":"P","href":null,"layout":null,"metadata":null,"text":"Now we have the following:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_144":{"__typename":"Paragraph","id":"922c892b4258_144","name":"f6c1","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Username","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_145":{"__typename":"Paragraph","id":"922c892b4258_145","name":"3c5e","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Tenant ID","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_146":{"__typename":"Paragraph","id":"922c892b4258_146","name":"c9b1","type":"ULI","href":null,"layout":null,"metadata":null,"text":"PRT","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_147":{"__typename":"Paragraph","id":"922c892b4258_147","name":"fc96","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Security context","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_148":{"__typename":"Paragraph","id":"922c892b4258_148","name":"6cd2","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Derived Key","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_149":{"__typename":"Paragraph","id":"922c892b4258_149","name":"fa47","type":"P","href":null,"layout":null,"metadata":null,"text":"It seems that we have everything we need to request P2P certificate for that user. To request certificate, I wrote python tool using the module requests.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_150":{"__typename":"Paragraph","id":"922c892b4258_150","name":"a539","type":"MIXTAPE_EMBED","href":null,"layout":null,"metadata":null,"text":"morRubin\u002FPrtToCert\nContribute to morRubin\u002FPrtToCert development by creating an account on GitHub.github.com","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":107,"href":"https:\u002F\u002Fgithub.com\u002FmorRubin\u002FPrtToCert","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":0,"end":18,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":19,"end":97,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":{"__typename":"MixtapeMetadata","href":"https:\u002F\u002Fgithub.com\u002FmorRubin\u002FPrtToCert","mediaResource":{"__typename":"MediaResource","mediumCatalog":null},"thumbnailImageId":"0*p1zk6kwbStpMfknz"}},"ImageMetadata:1*1QDjbSk2Kd7soJerIxHb9w.png":{"__typename":"ImageMetadata","id":"1*1QDjbSk2Kd7soJerIxHb9w.png","originalHeight":184,"originalWidth":624,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_151":{"__typename":"Paragraph","id":"922c892b4258_151","name":"1434","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*1QDjbSk2Kd7soJerIxHb9w.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_152":{"__typename":"Paragraph","id":"922c892b4258_152","name":"125c","type":"P","href":null,"layout":null,"metadata":null,"text":"Now we got certificates for all the PRT lifetime. To use the certificate, I wrote another python tool that will authenticate to the remote machine, run PSEXEC and open a CMD on the victim machine. This will allow us to use Mimikatz again to get the PRT of another user.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_153":{"__typename":"Paragraph","id":"922c892b4258_153","name":"6872","type":"MIXTAPE_EMBED","href":null,"layout":null,"metadata":null,"text":"morRubin\u002FAzureADJoinedMachinePTC\nContribute to morRubin\u002FAzureADJoinedMachinePTC development by creating an account on GitHub.github.com","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":135,"href":"https:\u002F\u002Fgithub.com\u002FmorRubin\u002FAzureADJoinedMachinePTC","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":0,"end":32,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":33,"end":125,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":{"__typename":"MixtapeMetadata","href":"https:\u002F\u002Fgithub.com\u002FmorRubin\u002FAzureADJoinedMachinePTC","mediaResource":{"__typename":"MediaResource","mediumCatalog":null},"thumbnailImageId":"0*F0B4arZY1ZPLFap9"}},"ImageMetadata:1*4fHCff6yFlPSDt6qlOqG2w.png":{"__typename":"ImageMetadata","id":"1*4fHCff6yFlPSDt6qlOqG2w.png","originalHeight":293,"originalWidth":656,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_154":{"__typename":"Paragraph","id":"922c892b4258_154","name":"8bb2","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*4fHCff6yFlPSDt6qlOqG2w.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_155":{"__typename":"Paragraph","id":"922c892b4258_155","name":"0084","type":"P","href":null,"layout":null,"metadata":null,"text":"And if you are a Wireshark person, I also modified Wireshark and parsed PKU2U PDUs. Its not in Wireshark code yet, but you can download my modified Wireshark version.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_156":{"__typename":"Paragraph","id":"922c892b4258_156","name":"96ea","type":"MIXTAPE_EMBED","href":null,"layout":null,"metadata":null,"text":"morRubin\u002FWiresharkKerberosPKIDissector\nYou can't perform that action at this time. You signed in with another tab or window. You signed out in another tab or…github.com","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":168,"href":"https:\u002F\u002Fgithub.com\u002FmorRubin\u002FWiresharkKerberosPKIDissector","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":0,"end":38,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":39,"end":158,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":{"__typename":"MixtapeMetadata","href":"https:\u002F\u002Fgithub.com\u002FmorRubin\u002FWiresharkKerberosPKIDissector","mediaResource":{"__typename":"MediaResource","mediumCatalog":null},"thumbnailImageId":"0*0dGm3kO5bwGFpt2H"}},"ImageMetadata:1*YGh5fT84Wzq1YuBJ3v9oxQ.png":{"__typename":"ImageMetadata","id":"1*YGh5fT84Wzq1YuBJ3v9oxQ.png","originalHeight":491,"originalWidth":624,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:922c892b4258_157":{"__typename":"Paragraph","id":"922c892b4258_157","name":"2c1e","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*YGh5fT84Wzq1YuBJ3v9oxQ.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:922c892b4258_158":{"__typename":"Paragraph","id":"922c892b4258_158","name":"a947","type":"P","href":null,"layout":null,"metadata":null,"text":"*right now, the “Pass The Certificate” tool is in python 2.7 and call only PSEXEC, but I’m working to change it to python 3 and add more functionality.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Tag:azure-active-directory":{"__typename":"Tag","id":"azure-active-directory","displayTitle":"Azure Active Directory","normalizedTagSlug":"azure-active-directory"},"Tag:lateral-movement":{"__typename":"Tag","id":"lateral-movement","displayTitle":"Lateral Movement","normalizedTagSlug":"lateral-movement"},"Post:d0c5de624597":{"__typename":"Post","id":"d0c5de624597","collection":null,"content({\"postMeteringOptions\":{}})":{"__typename":"PostContent","isLockedPreviewOnly":false,"bodyModel":{"__typename":"RichText","sections":[{"__typename":"Section","name":"f30d","startIndex":0,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null},{"__typename":"Section","name":"6d9c","startIndex":11,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null},{"__typename":"Section","name":"b0b7","startIndex":24,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null},{"__typename":"Section","name":"a56f","startIndex":99,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null},{"__typename":"Section","name":"c8dd","startIndex":139,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null}],"paragraphs":[{"__ref":"Paragraph:922c892b4258_0"},{"__ref":"Paragraph:922c892b4258_1"},{"__ref":"Paragraph:922c892b4258_2"},{"__ref":"Paragraph:922c892b4258_3"},{"__ref":"Paragraph:922c892b4258_4"},{"__ref":"Paragraph:922c892b4258_5"},{"__ref":"Paragraph:922c892b4258_6"},{"__ref":"Paragraph:922c892b4258_7"},{"__ref":"Paragraph:922c892b4258_8"},{"__ref":"Paragraph:922c892b4258_9"},{"__ref":"Paragraph:922c892b4258_10"},{"__ref":"Paragraph:922c892b4258_11"},{"__ref":"Paragraph:922c892b4258_12"},{"__ref":"Paragraph:922c892b4258_13"},{"__ref":"Paragraph:922c892b4258_14"},{"__ref":"Paragraph:922c892b4258_15"},{"__ref":"Paragraph:922c892b4258_16"},{"__ref":"Paragraph:922c892b4258_17"},{"__ref":"Paragraph:922c892b4258_18"},{"__ref":"Paragraph:922c892b4258_19"},{"__ref":"Paragraph:922c892b4258_20"},{"__ref":"Paragraph:922c892b4258_21"},{"__ref":"Paragraph:922c892b4258_22"},{"__ref":"Paragraph:922c892b4258_23"},{"__ref":"Paragraph:922c892b4258_24"},{"__ref":"Paragraph:922c892b4258_25"},{"__ref":"Paragraph:922c892b4258_26"},{"__ref":"Paragraph:922c892b4258_27"},{"__ref":"Paragraph:922c892b4258_28"},{"__ref":"Paragraph:922c892b4258_29"},{"__ref":"Paragraph:922c892b4258_30"},{"__ref":"Paragraph:922c892b4258_31"},{"__ref":"Paragraph:922c892b4258_32"},{"__ref":"Paragraph:922c892b4258_33"},{"__ref":"Paragraph:922c892b4258_34"},{"__ref":"Paragraph:922c892b4258_35"},{"__ref":"Paragraph:922c892b4258_36"},{"__ref":"Paragraph:922c892b4258_37"},{"__ref":"Paragraph:922c892b4258_38"},{"__ref":"Paragraph:922c892b4258_39"},{"__ref":"Paragraph:922c892b4258_40"},{"__ref":"Paragraph:922c892b4258_41"},{"__ref":"Paragraph:922c892b4258_42"},{"__ref":"Paragraph:922c892b4258_43"},{"__ref":"Paragraph:922c892b4258_44"},{"__ref":"Paragraph:922c892b4258_45"},{"__ref":"Paragraph:922c892b4258_46"},{"__ref":"Paragraph:922c892b4258_47"},{"__ref":"Paragraph:922c892b4258_48"},{"__ref":"Paragraph:922c892b4258_49"},{"__ref":"Paragraph:922c892b4258_50"},{"__ref":"Paragraph:922c892b4258_51"},{"__ref":"Paragraph:922c892b4258_52"},{"__ref":"Paragraph:922c892b4258_53"},{"__ref":"Paragraph:922c892b4258_54"},{"__ref":"Paragraph:922c892b4258_55"},{"__ref":"Paragraph:922c892b4258_56"},{"__ref":"Paragraph:922c892b4258_57"},{"__ref":"Paragraph:922c892b4258_58"},{"__ref":"Paragraph:922c892b4258_59"},{"__ref":"Paragraph:922c892b4258_60"},{"__ref":"Paragraph:922c892b4258_61"},{"__ref":"Paragraph:922c892b4258_62"},{"__ref":"Paragraph:922c892b4258_63"},{"__ref":"Paragraph:922c892b4258_64"},{"__ref":"Paragraph:922c892b4258_65"},{"__ref":"Paragraph:922c892b4258_66"},{"__ref":"Paragraph:922c892b4258_67"},{"__ref":"Paragraph:922c892b4258_68"},{"__ref":"Paragraph:922c892b4258_69"},{"__ref":"Paragraph:922c892b4258_70"},{"__ref":"Paragraph:922c892b4258_71"},{"__ref":"Paragraph:922c892b4258_72"},{"__ref":"Paragraph:922c892b4258_73"},{"__ref":"Paragraph:922c892b4258_74"},{"__ref":"Paragraph:922c892b4258_75"},{"__ref":"Paragraph:922c892b4258_76"},{"__ref":"Paragraph:922c892b4258_77"},{"__ref":"Paragraph:922c892b4258_78"},{"__ref":"Paragraph:922c892b4258_79"},{"__ref":"Paragraph:922c892b4258_80"},{"__ref":"Paragraph:922c892b4258_81"},{"__ref":"Paragraph:922c892b4258_82"},{"__ref":"Paragraph:922c892b4258_83"},{"__ref":"Paragraph:922c892b4258_84"},{"__ref":"Paragraph:922c892b4258_85"},{"__ref":"Paragraph:922c892b4258_86"},{"__ref":"Paragraph:922c892b4258_87"},{"__ref":"Paragraph:922c892b4258_88"},{"__ref":"Paragraph:922c892b4258_89"},{"__ref":"Paragraph:922c892b4258_90"},{"__ref":"Paragraph:922c892b4258_91"},{"__ref":"Paragraph:922c892b4258_92"},{"__ref":"Paragraph:922c892b4258_93"},{"__ref":"Paragraph:922c892b4258_94"},{"__ref":"Paragraph:922c892b4258_95"},{"__ref":"Paragraph:922c892b4258_96"},{"__ref":"Paragraph:922c892b4258_97"},{"__ref":"Paragraph:922c892b4258_98"},{"__ref":"Paragraph:922c892b4258_99"},{"__ref":"Paragraph:922c892b4258_100"},{"__ref":"Paragraph:922c892b4258_101"},{"__ref":"Paragraph:922c892b4258_102"},{"__ref":"Paragraph:922c892b4258_103"},{"__ref":"Paragraph:922c892b4258_104"},{"__ref":"Paragraph:922c892b4258_105"},{"__ref":"Paragraph:922c892b4258_106"},{"__ref":"Paragraph:922c892b4258_107"},{"__ref":"Paragraph:922c892b4258_108"},{"__ref":"Paragraph:922c892b4258_109"},{"__ref":"Paragraph:922c892b4258_110"},{"__ref":"Paragraph:922c892b4258_111"},{"__ref":"Paragraph:922c892b4258_112"},{"__ref":"Paragraph:922c892b4258_113"},{"__ref":"Paragraph:922c892b4258_114"},{"__ref":"Paragraph:922c892b4258_115"},{"__ref":"Paragraph:922c892b4258_116"},{"__ref":"Paragraph:922c892b4258_117"},{"__ref":"Paragraph:922c892b4258_118"},{"__ref":"Paragraph:922c892b4258_119"},{"__ref":"Paragraph:922c892b4258_120"},{"__ref":"Paragraph:922c892b4258_121"},{"__ref":"Paragraph:922c892b4258_122"},{"__ref":"Paragraph:922c892b4258_123"},{"__ref":"Paragraph:922c892b4258_124"},{"__ref":"Paragraph:922c892b4258_125"},{"__ref":"Paragraph:922c892b4258_126"},{"__ref":"Paragraph:922c892b4258_127"},{"__ref":"Paragraph:922c892b4258_128"},{"__ref":"Paragraph:922c892b4258_129"},{"__ref":"Paragraph:922c892b4258_130"},{"__ref":"Paragraph:922c892b4258_131"},{"__ref":"Paragraph:922c892b4258_132"},{"__ref":"Paragraph:922c892b4258_133"},{"__ref":"Paragraph:922c892b4258_134"},{"__ref":"Paragraph:922c892b4258_135"},{"__ref":"Paragraph:922c892b4258_136"},{"__ref":"Paragraph:922c892b4258_137"},{"__ref":"Paragraph:922c892b4258_138"},{"__ref":"Paragraph:922c892b4258_139"},{"__ref":"Paragraph:922c892b4258_140"},{"__ref":"Paragraph:922c892b4258_141"},{"__ref":"Paragraph:922c892b4258_142"},{"__ref":"Paragraph:922c892b4258_143"},{"__ref":"Paragraph:922c892b4258_144"},{"__ref":"Paragraph:922c892b4258_145"},{"__ref":"Paragraph:922c892b4258_146"},{"__ref":"Paragraph:922c892b4258_147"},{"__ref":"Paragraph:922c892b4258_148"},{"__ref":"Paragraph:922c892b4258_149"},{"__ref":"Paragraph:922c892b4258_150"},{"__ref":"Paragraph:922c892b4258_151"},{"__ref":"Paragraph:922c892b4258_152"},{"__ref":"Paragraph:922c892b4258_153"},{"__ref":"Paragraph:922c892b4258_154"},{"__ref":"Paragraph:922c892b4258_155"},{"__ref":"Paragraph:922c892b4258_156"},{"__ref":"Paragraph:922c892b4258_157"},{"__ref":"Paragraph:922c892b4258_158"}]},"validatedShareKey":"","shareKeyCreator":null},"creator":{"__ref":"User:dec0c9bdedb9"},"inResponseToEntityType":null,"isLocked":false,"isMarkedPaywallOnly":false,"lockedSource":"LOCKED_POST_SOURCE_NONE","mediumUrl":"https:\u002F\u002Fmedium.com\u002F@mor2464\u002Fazure-ad-pass-the-certificate-d0c5de624597","primaryTopic":null,"topics":[{"__typename":"Topic","slug":"cybersecurity"}],"isPublished":true,"latestPublishedVersion":"922c892b4258","visibility":"PUBLIC","postResponses":{"__typename":"PostResponses","count":0},"createdAt":1597746904039,"firstPublishedAt":1597845439115,"latestPublishedAt":1597845439115,"clapCount":70,"allowResponses":true,"isLimitedState":false,"title":"Azure AD Pass The Certificate","isSeries":false,"sequence":null,"uniqueSlug":"azure-ad-pass-the-certificate-d0c5de624597","socialTitle":"","socialDek":"","noIndex":null,"canonicalUrl":"","metaDescription":"","readingTime":11.60754716981132,"previewContent":{"__typename":"PreviewContent","subtitle":"Intro"},"previewImage":{"__ref":"ImageMetadata:1*63wq7BNs0ud47Xkxmj8EEA.png"},"isShortform":false,"seoTitle":"","updatedAt":1639582863933,"shortformType":"SHORTFORM_TYPE_LINK","seoDescription":"","isSuspended":false,"license":"ALL_RIGHTS_RESERVED","tags":[{"__ref":"Tag:azure-active-directory"},{"__ref":"Tag:lateral-movement"}],"isNewsletter":false,"statusForCollection":null,"pendingCollection":null,"detectedLanguage":"en","wordCount":2599,"layerCake":0}}</script><script>window.__MIDDLEWARE_STATE__={"session":{"xsrf":""},"cache":{"cacheStatus":"MISS"}}</script><script src="https://cdn-client.medium.com/lite/static/js/manifest.3cc5e3b6.js"></script><script src="https://cdn-client.medium.com/lite/static/js/2640.3217006c.js"></script><script src="https://cdn-client.medium.com/lite/static/js/main.7db0aaff.js"></script><script src="https://cdn-client.medium.com/lite/static/js/instrumentation.4ddbf12e.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/reporting.2021fe63.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/4398.db4d4378.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7883.0e445e04.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9281.e9be8bce.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7111.b294e9da.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6481.362dec70.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8695.6f58679b.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8978.4b110123.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3418.eb013b5a.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3894.e3d01e2c.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5514.32e692f6.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5203.e7f058c5.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7098.93054372.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8051.0a9d3f4b.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8558.abbaadfd.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/1711.7605eb3e.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8597.762eae49.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9174.b1b0f607.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8883.2f95bbf4.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/705.e5898c57.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2911.d072adec.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8580.feeb2549.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6046.f9be485b.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/500.d5389c14.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9408.22b56993.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6605.84e81b15.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6637.661bd7cf.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7421.3f94f5ea.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/51.d8fb2684.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2133.c8ba56b1.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/PostPage.MainContent.81dff084.chunk.js"></script><script>window.main();</script><script defer="" src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon="{&quot;rayId&quot;:&quot;89427133b8d0b38f&quot;,&quot;version&quot;:&quot;2024.4.1&quot;,&quot;token&quot;:&quot;0b5f665943484354a59c39c6833f7078&quot;}" crossorigin="anonymous"></script>
<script src="https://accounts.google.com/gsi/client" async=""></script></body></html>