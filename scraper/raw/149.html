<html lang="en" class="js fontawesome-i2svg-active fontawesome-i2svg-complete"><head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Digital Forensics and Incident Response : Jai Minton</title>
<meta name="description" content="Cheatsheet containing a variety of commands and concepts relating to digital forensics and incident response.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Jai Minton">
<meta property="og:title" content="Digital Forensics and Incident Response">
<meta property="og:url" content="https://www.jaiminton.com/cheatsheet/DFIR/">


  <meta property="og:description" content="Cheatsheet containing a variety of commands and concepts relating to digital forensics and incident response.">



  <meta property="og:image" content="https://www.jaiminton.com/assets/images/BlueTeamSmall.jpg">



  <meta name="twitter:site" content="@CyberRaiju">
  <meta name="twitter:title" content="Digital Forensics and Incident Response">
  <meta name="twitter:description" content="Cheatsheet containing a variety of commands and concepts relating to digital forensics and incident response.">
  <meta name="twitter:url" content="https://www.jaiminton.com/cheatsheet/DFIR/">


    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://www.jaiminton.com/assets/images/BlueTeamSmall.jpg">
  

  



  <meta property="article:published_time" content="2024-03-23T00:00:00+00:00">





  

  


<style type="text/css">svg:not(:root).svg-inline--fa{overflow:visible}.svg-inline--fa{display:inline-block;font-size:inherit;height:1em;overflow:visible;vertical-align:-.125em}.svg-inline--fa.fa-lg{vertical-align:-.225em}.svg-inline--fa.fa-w-1{width:.0625em}.svg-inline--fa.fa-w-2{width:.125em}.svg-inline--fa.fa-w-3{width:.1875em}.svg-inline--fa.fa-w-4{width:.25em}.svg-inline--fa.fa-w-5{width:.3125em}.svg-inline--fa.fa-w-6{width:.375em}.svg-inline--fa.fa-w-7{width:.4375em}.svg-inline--fa.fa-w-8{width:.5em}.svg-inline--fa.fa-w-9{width:.5625em}.svg-inline--fa.fa-w-10{width:.625em}.svg-inline--fa.fa-w-11{width:.6875em}.svg-inline--fa.fa-w-12{width:.75em}.svg-inline--fa.fa-w-13{width:.8125em}.svg-inline--fa.fa-w-14{width:.875em}.svg-inline--fa.fa-w-15{width:.9375em}.svg-inline--fa.fa-w-16{width:1em}.svg-inline--fa.fa-w-17{width:1.0625em}.svg-inline--fa.fa-w-18{width:1.125em}.svg-inline--fa.fa-w-19{width:1.1875em}.svg-inline--fa.fa-w-20{width:1.25em}.svg-inline--fa.fa-pull-left{margin-right:.3em;width:auto}.svg-inline--fa.fa-pull-right{margin-left:.3em;width:auto}.svg-inline--fa.fa-border{height:1.5em}.svg-inline--fa.fa-li{width:2em}.svg-inline--fa.fa-fw{width:1.25em}.fa-layers svg.svg-inline--fa{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.fa-layers{display:inline-block;height:1em;position:relative;text-align:center;vertical-align:-.125em;width:1em}.fa-layers svg.svg-inline--fa{-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter,.fa-layers-text{display:inline-block;position:absolute;text-align:center}.fa-layers-text{left:50%;top:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter{background-color:#ff253a;border-radius:1em;-webkit-box-sizing:border-box;box-sizing:border-box;color:#fff;height:1.5em;line-height:1;max-width:5em;min-width:1.5em;overflow:hidden;padding:.25em;right:0;text-overflow:ellipsis;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-bottom-right{bottom:0;right:0;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom right;transform-origin:bottom right}.fa-layers-bottom-left{bottom:0;left:0;right:auto;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom left;transform-origin:bottom left}.fa-layers-top-right{right:0;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-top-left{left:0;right:auto;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top left;transform-origin:top left}.fa-lg{font-size:1.3333333333em;line-height:.75em;vertical-align:-.0667em}.fa-xs{font-size:.75em}.fa-sm{font-size:.875em}.fa-1x{font-size:1em}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-6x{font-size:6em}.fa-7x{font-size:7em}.fa-8x{font-size:8em}.fa-9x{font-size:9em}.fa-10x{font-size:10em}.fa-fw{text-align:center;width:1.25em}.fa-ul{list-style-type:none;margin-left:2.5em;padding-left:0}.fa-ul>li{position:relative}.fa-li{left:-2em;position:absolute;text-align:center;width:2em;line-height:inherit}.fa-border{border:solid .08em #eee;border-radius:.1em;padding:.2em .25em .15em}.fa-pull-left{float:left}.fa-pull-right{float:right}.fa.fa-pull-left,.fab.fa-pull-left,.fal.fa-pull-left,.far.fa-pull-left,.fas.fa-pull-left{margin-right:.3em}.fa.fa-pull-right,.fab.fa-pull-right,.fal.fa-pull-right,.far.fa-pull-right,.fas.fa-pull-right{margin-left:.3em}.fa-spin{-webkit-animation:fa-spin 2s infinite linear;animation:fa-spin 2s infinite linear}.fa-pulse{-webkit-animation:fa-spin 1s infinite steps(8);animation:fa-spin 1s infinite steps(8)}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.fa-rotate-90{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{-webkit-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{-webkit-transform:scale(-1,1);transform:scale(-1,1)}.fa-flip-vertical{-webkit-transform:scale(1,-1);transform:scale(1,-1)}.fa-flip-both,.fa-flip-horizontal.fa-flip-vertical{-webkit-transform:scale(-1,-1);transform:scale(-1,-1)}:root .fa-flip-both,:root .fa-flip-horizontal,:root .fa-flip-vertical,:root .fa-rotate-180,:root .fa-rotate-270,:root .fa-rotate-90{-webkit-filter:none;filter:none}.fa-stack{display:inline-block;height:2em;position:relative;width:2.5em}.fa-stack-1x,.fa-stack-2x{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.svg-inline--fa.fa-stack-1x{height:1em;width:1.25em}.svg-inline--fa.fa-stack-2x{height:2em;width:2.5em}.fa-inverse{color:#fff}.sr-only{border:0;clip:rect(0,0,0,0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.sr-only-focusable:active,.sr-only-focusable:focus{clip:auto;height:auto;margin:0;overflow:visible;position:static;width:auto}</style><link rel="canonical" href="https://www.jaiminton.com/cheatsheet/DFIR/">





  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "url": "https://www.jaiminton.com",
      "logo": "https://www.jaiminton.com/assets/images/feature-logo.jpg"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "CyberRaiju",
      "url": "https://www.jaiminton.com",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Jai Minton Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->
<script src="/assets/js/particles.js"></script>
<script>/* particlesJS.load(@dom-id, @path-json, @callback (optional)); */
  particlesJS.load('pixels', '/assets/particlesjs-config.json', function() {
  console.log('callback - particles.js config loaded');
  });</script>
<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<meta http-equiv="Content-Security-Policy" content="default-src 'self' https://www.youtube-nocookie.com/;script-src 'self' 'unsafe-inline' 'unsafe-eval' https://platform.twitter.com/ https://www.youtube-nocookie.com/ https://static.cloudflareinsights.com/ https://www.google-analytics.com use.fontawesome.com https://googletagmanager.com https://www.googletagmanager.com https://platform.twitter.com/widgets.js;img-src 'self' 'unsafe-inline' https://www.hackthebox.eu https://cards-dev.twitter.com/ https://www.youtube-nocookie.com/;style-src 'self' 'unsafe-inline';upgrade-insecure-requests">
<meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
<meta http-equiv="X-XSS-Protection" content="1; mode=block">
<meta http-equiv="X-Content-Type-Option" content="nosniff">
<meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains">
<!-- end custom head snippets -->

    
  </head>
  <body class="layout--single single">
    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/rootdir.png" alt=""></a>
        
        <a class="site-title" href="/">CyberRaiju</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/tags/">📗 Browse</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">📙 Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">❓ About Me/Privacy</a>
            </li><li class="masthead__menu-item">
              <a href="https://buymeacoff.ee/JaiMinton">☕ Buy me a coffee</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    <div class="initial-content">
      
  










<div class="page__hero--overlay" style=" background-image: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8)), url('/assets/images/BlueTeam.jpg');">
  
    <div class="wrapper">
      <h1 id="page-title" class="page__title" itemprop="headline">
        
          Digital Forensics and Incident Response

        
      </h1>
      
        <p class="page__lead">Cheatsheet containing a variety of commands and concepts relating to digital forensics and incident response.
</p>
      
      
        <p class="page__meta"><svg class="svg-inline--fa fa-clock fa-w-16" aria-hidden="true" focusable="false" data-prefix="far" data-icon="clock" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"></path></svg><!-- <i class="far fa-clock" aria-hidden="true"></i> --> 




  124 minute read
</p>
      
      
      
    </div>
  
  
</div>




  
    



<nav class="breadcrumbs">
  <ol itemscope="" itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope="" itemtype="https://schema.org/ListItem">
          <a href="https://www.jaiminton.com/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1">
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope="" itemtype="https://schema.org/ListItem">
          <a href="/categories/#cheatsheet" itemprop="item"><span itemprop="name">Cheatsheet</span></a>
          <meta itemprop="position" content="2">
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Digital Forensics and Incident Response</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope="" itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        
        <a href="/">
          <img src="/assets/images/bio-photo.jpg" alt="Jai Minton" itemprop="image">
        </a>
      
    </div>
  

  <div class="author__content">
    
      <a href="/"><h3 class="author__name" itemprop="name">Jai Minton</h3></a>
    
    
      <p class="author__bio" itemprop="description">
        Information and Cyber Security Professional. All thoughts and opinions expressed here are my own, and may not be representative of my employer, or any other entity unless I am specifically quoting someone. Content is licensed under the Creative Commons Attribution 4.0 International License.
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope="" itemtype="https://schema.org/Place">
          <svg class="svg-inline--fa fa-map-marker-alt fa-w-12 fa-fw" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="map-marker-alt" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" data-fa-i2svg=""><path fill="currentColor" d="M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"></path></svg><!-- <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> --> <span itemprop="name">Australia</span>
        </li>
      

      
        
          
        
          
        
          
            <li><a href="https://app.hackthebox.com/profile/10636" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-box fa-w-16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="box" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M509.5 184.6L458.9 32.8C452.4 13.2 434.1 0 413.4 0H272v192h238.7c-.4-2.5-.4-5-1.2-7.4zM240 0H98.6c-20.7 0-39 13.2-45.5 32.8L2.5 184.6c-.8 2.4-.8 4.9-1.2 7.4H240V0zM0 224v240c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48V224H0z"></path></svg><!-- <i class="fas fa-box" aria-hidden="true"></i> -->  Hack The Box</a></li>
          
        
          
            <li><a href="https://twitter.com/CyberRaiju" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-twitter-square fa-w-14 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter-square" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-48.9 158.8c.2 2.8.2 5.7.2 8.5 0 86.7-66 186.6-186.6 186.6-37.2 0-71.7-10.8-100.7-29.4 5.3.6 10.4.8 15.8.8 30.7 0 58.9-10.4 81.4-28-28.8-.6-53-19.5-61.3-45.5 10.1 1.5 19.2 1.5 29.6-1.2-30-6.1-52.5-32.5-52.5-64.4v-.8c8.7 4.9 18.9 7.9 29.6 8.3a65.447 65.447 0 0 1-29.2-54.6c0-12.2 3.2-23.4 8.9-33.1 32.3 39.8 80.8 65.8 135.2 68.6-9.3-44.5 24-80.6 64-80.6 18.9 0 35.9 7.9 47.9 20.7 14.8-2.8 29-8.3 41.6-15.8-4.9 15.2-15.2 28-28.8 36.1 13.2-1.4 26-5.1 37.8-10.2-8.9 13.1-20.1 24.7-32.9 34z"></path></svg><!-- <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> --> Twitter</a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/JaiMinton" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-linkedin fa-w-14" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg><!-- <i class="fab fa-linkedin" aria-hidden="true"></i> --> LinkedIN</a></li>
          
        
          
            <li><a href="https://github.com/JPMinty" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-github fa-w-16 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg=""><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><!-- <i class="fab fa-fw fa-github" aria-hidden="true"></i> --> GitHub</a></li>
          
        
          
            <li><a href="https://www.youtube.com/@cyberraiju/featured" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-youtube fa-w-18 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="youtube" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg><!-- <i class="fab fa-fw fa-youtube" aria-hidden="true"></i> --> YouTube</a></li>
          
        
          
            <li><a href="https://infosec.exchange/@CyberRaiju" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-mastodon fa-w-14" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="mastodon" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 417 512" data-fa-i2svg=""><path fill="currentColor" d="M417.8 179.1c0-97.2-63.7-125.7-63.7-125.7-62.5-28.7-228.5-28.4-290.4 0 0 0-63.7 28.5-63.7 125.7 0 115.7-6.6 259.4 105.6 289.1 40.5 10.7 75.3 13 103.3 11.4 50.8-2.8 79.3-18.1 79.3-18.1l-1.7-36.9s-36.3 11.4-77.1 10.1c-40.4-1.4-83-4.4-89.6-54-.6-4.4-.9-9-.9-13.9 85.6 20.9 158.6 9.1 178.7 6.7 56.1-6.7 105-41.3 111.2-72.9 9.8-49.8 9-121.5 9-121.5zm-75.1 125.2h-46.6V190.1c0-49.7-64-51.6-64 6.9v62.5h-46.3V197c0-58.5-64-56.6-64-6.9v114.2H75.1c0-122.1-5.2-147.9 18.4-175 25.9-28.9 79.8-30.8 103.8 6.1l11.6 19.5 11.6-19.5c24.1-37.1 78.1-34.8 103.8-6.1 23.7 27.3 18.4 53 18.4 175z"></path></svg><!-- <i class="fab fa-mastodon" aria-hidden="true"></i> --> Mastodon</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
        <li>
            <section id="pixels"><canvas class="particles-js-canvas-el" style="width: 100%; height: 100%;" width="348" height="175"></canvas></section>
        </li>
    </ul>
  </div>

</div>

  
  </div>


  <article class="page" itemscope="" itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Digital Forensics and Incident Response">
    <meta itemprop="description" content="Cheatsheet containing a variety of commands and concepts relating to digital forensics and incident response.">
    <meta itemprop="datePublished" content="March 23, 2024">
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><svg class="svg-inline--fa fa-file-alt fa-w-12" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="file-alt" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" data-fa-i2svg=""><path fill="currentColor" d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm64 236c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-64c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-72v8c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm96-114.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"></path></svg><!-- <i class="fas fa-file-alt"></i> --> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#disclaimer">Disclaimer</a></li>
  <li><a href="#artifact-locations">Artifact locations</a>
    <ul>
      <li><a href="#get-an-object-of-forensic-artifacts">Get an object of forensic artifacts</a></li>
      <li><a href="#query-object-for-relevant-registry-keys">Query object for relevant registry keys:</a></li>
      <li><a href="#query-object-for-relevant-file-paths">Query object for relevant file paths:</a></li>
    </ul>
  </li>
  <li><a href="#windows-cheat-sheet">Windows Cheat Sheet</a>
    <ul>
      <li><a href="#order-of-volatility">Order of Volatility</a></li>
      <li><a href="#memory-files-locked-by-os-during-use">Memory Files (Locked by OS during use)</a>
        <ul>
          <li><a href="#binalyze-irec-evidence-collector-gui-or-commandline">Binalyze IREC Evidence Collector (GUI or CommandLine)</a></li>
          <li><a href="#belkasoft-live-ram-capturer">Belkasoft Live RAM Capturer</a></li>
          <li><a href="#redline">Redline</a></li>
          <li><a href="#memoryze">Memoryze</a></li>
          <li><a href="#comae-dumpit">Comae DumpIT</a></li>
          <li><a href="#powershell">Powershell</a></li>
          <li><a href="#magnet-forensics-mostly-gui">Magnet Forensics (Mostly GUI)</a></li>
          <li><a href="#volexity-surge">Volexity Surge</a></li>
          <li><a href="#microsoft-livekd">Microsoft LiveKd</a></li>
          <li><a href="#winpmem">Winpmem</a></li>
        </ul>
      </li>
      <li><a href="#imaging-live-machines">Imaging Live Machines</a>
        <ul>
          <li><a href="#ftk-imager-cmd-version-mostly-gui-for-new-versions">FTK Imager (Cmd version, mostly GUI for new versions)</a></li>
          <li><a href="#dd">DD</a></li>
          <li><a href="#x-ways-imager">X-Ways Imager</a></li>
          <li><a href="#encase-forensic">Encase Forensic</a></li>
          <li><a href="#tableau-imager">Tableau Imager</a></li>
          <li><a href="#guymager">Guymager</a></li>
        </ul>
      </li>
      <li><a href="#carving-out-files-from-image-using-scalpel">Carving Out Files From Image using Scalpel</a></li>
      <li><a href="#live-windows-irtriage">Live Windows IR/Triage</a>
        <ul>
          <li><a href="#interact-with-remote-machine">Interact with remote machine</a></li>
          <li><a href="#system-information">System information</a></li>
          <li><a href="#obtain-list-of-all-files-on-a-computer">Obtain list of all files on a computer</a></li>
          <li><a href="#user-and-admin-information">User and admin information</a></li>
          <li><a href="#logon-information">Logon information</a></li>
          <li><a href="#nt-domainnetwork-client-information">NT Domain/Network Client Information</a></li>
          <li><a href="#firewall-information">Firewall Information</a></li>
          <li><a href="#firewall-changes">Firewall Changes</a></li>
          <li><a href="#applications-which-have-added-a-firewall-rule">Applications which have added a firewall rule</a></li>
          <li><a href="#applications-which-have-modified-a-firewall-rule">Applications which have modified a firewall rule</a></li>
          <li><a href="#applications-which-have-deleted-a-firewall-rule">Applications which have deleted a firewall rule</a></li>
          <li><a href="#pagefile-information">Pagefile information</a></li>
          <li><a href="#group-and-access-information">Group and access information</a></li>
          <li><a href="#cookies">Cookies</a></li>
          <li><a href="#recentdocs-information">RecentDocs Information</a></li>
          <li><a href="#get-ntfs-file-streams-from-mounted-windows-drive-on-linux-os">Get NTFS File Streams from Mounted Windows Drive on Linux OS</a></li>
          <li><a href="#startup-process-information">Startup process information</a></li>
          <li><a href="#startup-process-information-by-pathfile-name">Startup process information by path/file name</a></li>
          <li><a href="#scheduled-taskjob-information">Scheduled task/job information</a></li>
          <li><a href="#finding-shadow-hidden-scheduled-tasks">Finding ‘shadow’ hidden scheduled tasks</a></li>
          <li><a href="#file-hash-and-location-of-all-scheduled-tasks">File hash and location of all scheduled tasks</a></li>
          <li><a href="#remediate-malicious-scheduled-tasks">Remediate malicious scheduled tasks</a></li>
          <li><a href="#av-logs-evidence-of-malware-quarantine-etc">AV Logs (evidence of malware quarantine etc)</a></li>
          <li><a href="#remote-admin--remote-monitoring-and-management-rmm-tool-logs-evidence-of-rmm-tool-usage">Remote Admin / Remote Monitoring and Management (RMM) Tool Logs (evidence of RMM tool usage)</a>
            <ul>
              <li><a href="#action1-rmm-usage-evidence">Action1 RMM Usage Evidence</a></li>
              <li><a href="#ammyadmin-rmm-usage-evidence">AmmyAdmin RMM Usage Evidence</a></li>
              <li><a href="#anydesk-rmm-usage-evidence">AnyDesk RMM Usage Evidence</a></li>
              <li><a href="#atera-rmm-usage-evidence">Atera RMM Usage Evidence</a></li>
              <li><a href="#citrix-gotomypc-rmm-usage-evidence">Citrix GoToMyPC RMM Usage Evidence</a></li>
              <li><a href="#kaseya-rmm-usage-evidence">Kaseya RMM Usage Evidence</a></li>
              <li><a href="#level-rmm-usage-evidence">Level RMM Usage Evidence</a></li>
              <li><a href="#logmein-rmm-usage-evidence">LogMeIn RMM Usage Evidence</a></li>
              <li><a href="#realvnc-rmm-usage-evidence">RealVNC RMM Usage Evidence</a></li>
              <li><a href="#splashtop-rmm-usage-evidence">Splashtop RMM Usage Evidence</a></li>
              <li><a href="#supremo-rmm-usage-evidence">SupRemo RMM Usage Evidence</a></li>
              <li><a href="#supremo-rmm-usage-evidence-1">SupRemo RMM Usage Evidence</a></li>
              <li><a href="#connectwisescreenconnect-rmm-usage-evidence">Connectwise/Screenconnect RMM Usage Evidence</a></li>
              <li><a href="#teamviewer-rmm-usage-evidence">TeamViewer RMM Usage Evidence</a></li>
              <li><a href="#tightvnc-rmm-usage-evidence">TightVNC RMM Usage Evidence</a></li>
              <li><a href="#ultravnc-rmm-usage-evidence">UltraVNC RMM Usage Evidence</a></li>
              <li><a href="#ultraviewer-rmm-usage-evidence">Ultraviewer RMM Usage Evidence</a></li>
              <li><a href="#xeox-rmm-usage-evidence">Xeox RMM Usage Evidence</a></li>
              <li><a href="#zohoassist-rmm-usage-evidence">ZohoAssist RMM Usage Evidence</a></li>
            </ul>
          </li>
          <li><a href="#iso-phishing-execution-evidence">ISO Phishing Execution Evidence</a></li>
          <li><a href="#msi-execution-evidence">MSI Execution Evidence</a></li>
          <li><a href="#azure-run-command-evidence">Azure Run Command Evidence</a></li>
          <li><a href="#uac-bypass-fodhelper">UAC Bypass Fodhelper</a></li>
          <li><a href="#quick-overview-of-persistent-locations-autoruns">Quick overview of persistent locations (AutoRuns)</a></li>
          <li><a href="#persistence-and-automatic-loadrun-reg-keys">Persistence and Automatic Load/Run Reg Keys</a></li>
          <li><a href="#t1015-accessibility-features">T1015 Accessibility Features</a></li>
          <li><a href="#t1098-account-manipulation">T1098 Account Manipulation</a></li>
          <li><a href="#t1182-appcert-dlls">T1182 AppCert DLLs</a></li>
          <li><a href="#t1103-appinit-dlls">T1103 AppInit DLLs</a></li>
          <li><a href="#t1138-application-shimming">T1138 Application Shimming</a></li>
          <li><a href="#t1197-bits-jobs">T1197 BITS Jobs</a></li>
          <li><a href="#t1067-bootkit">T1067 Bootkit</a>
            <ul>
              <li><a href="#general-driver-enumeration">General Driver Enumeration</a></li>
              <li><a href="#unsigned-drivers">Unsigned Drivers</a></li>
              <li><a href="#previous-unusual-loaded-filter-drivers-often-used-by-rootkits">Previous Unusual Loaded Filter Drivers (Often used by rootkits)</a></li>
              <li><a href="#unusual-loaded-filter-drivers-no-longer-present-or-filtering-registry-keys">Unusual Loaded Filter Drivers (No longer present or filtering registry keys)</a></li>
              <li><a href="#safe-boot-registry-keys">Safe Boot registry keys</a></li>
              <li><a href="#unload-malicious-filter-driver">Unload malicious filter driver</a></li>
            </ul>
          </li>
          <li><a href="#t1176-browser-extensions">T1176 Browser Extensions</a>
            <ul>
              <li><a href="#chrome">Chrome</a></li>
              <li><a href="#firefox">Firefox</a></li>
              <li><a href="#edge">Edge</a></li>
              <li><a href="#internet-explorer">Internet Explorer</a></li>
            </ul>
          </li>
          <li><a href="#t1109-component-firmware">T1109 Component Firmware</a></li>
          <li><a href="#t1122-component-object-model-com-hijacking">T1122 Component Object Model (COM) Hijacking</a>
            <ul>
              <li><a href="#get-list-of-all-com-objects">Get list of all COM Objects</a></li>
            </ul>
          </li>
          <li><a href="#t1136-create-account">T1136 Create Account</a></li>
          <li><a href="#t1038-dll-search-order-hijacking">T1038 DLL Search Order Hijacking</a></li>
          <li><a href="#t1133-external-remote-services">T1133 External Remote Services</a></li>
          <li><a href="#t1044-file-system-permissions-weakness">T1044 File System Permissions Weakness</a></li>
          <li><a href="#t1158-hidden-files-and-directories">T1158 Hidden Files and Directories</a></li>
          <li><a href="#t1179-hooking">T1179 Hooking</a>
            <ul>
              <li><a href="#finding-easyhook-injection">Finding EasyHook Injection</a></li>
            </ul>
          </li>
          <li><a href="#t1062-hypervisor">T1062 Hypervisor</a></li>
          <li><a href="#t1183-image-file-execution-options-injection">T1183 Image File Execution Options Injection</a></li>
          <li><a href="#t1037-logon-scripts">T1037 Logon Scripts</a></li>
          <li><a href="#t1177-lsass-driver">T1177 LSASS Driver</a></li>
          <li><a href="#t1031-modify-existing-service">T1031 Modify Existing Service</a></li>
          <li><a href="#t1128-netsh-helper-dll">T1128 Netsh Helper DLL</a></li>
          <li><a href="#t1050-new-service">T1050 New Service</a></li>
          <li><a href="#t1137-office-application-startup">T1137 Office Application Startup</a></li>
          <li><a href="#t1034-path-interception">T1034 Path Interception</a></li>
          <li><a href="#t1013-port-monitors">T1013 Port Monitors</a></li>
          <li><a href="#t1504-powershell-profile">T1504 PowerShell Profile</a></li>
          <li><a href="#t1108-redundant-access">T1108 Redundant Access</a></li>
          <li><a href="#t1060-registry-run-keys--startup-folder">T1060 Registry Run Keys / Startup Folder</a></li>
          <li><a href="#t1053-scheduled-task">T1053 Scheduled Task</a></li>
          <li><a href="#t1180-screensaver">T1180 Screensaver</a></li>
          <li><a href="#t1101-security-support-provider">T1101 Security Support Provider</a></li>
          <li><a href="#t1505-server-software-component">T1505 Server Software Component</a></li>
          <li><a href="#t1058-service-registry-permissions-weakness">T1058 Service Registry Permissions Weakness</a></li>
          <li><a href="#t1023-shortcut-modification">T1023 Shortcut Modification</a></li>
          <li><a href="#t1198-sip-and-trust-provider-hijacking">T1198 SIP and Trust Provider Hijacking</a></li>
          <li><a href="#t1019-system-firmware">T1019 System Firmware</a></li>
          <li><a href="#t1209-time-providers">T1209 Time Providers</a></li>
          <li><a href="#t1078-valid-accounts">T1078 Valid Accounts</a></li>
          <li><a href="#t1100-web-shell">T1100 Web Shell</a></li>
          <li><a href="#t1084-windows-management-instrumentation-event-subscription">T1084 Windows Management Instrumentation Event Subscription</a>
            <ul>
              <li><a href="#get-wmi-namespaces">Get WMI Namespaces</a></li>
              <li><a href="#query-wmi-persistence">Query WMI Persistence</a></li>
            </ul>
          </li>
          <li><a href="#t1004-winlogon-helper-dll">T1004 Winlogon Helper DLL</a></li>
          <li><a href="#other---winsock-helper-dll-persistence">Other - Winsock Helper DLL Persistence</a></li>
          <li><a href="#check-disabled-task-manager-often-from-malware">Check disabled task manager (often from malware)</a></li>
          <li><a href="#review-hivelist">Review Hivelist</a></li>
          <li><a href="#locate-all-user-registry-keys">Locate all user registry keys</a></li>
          <li><a href="#load-all-users-registry-keys-from-their-ntuserdat-file-perform-above-first">Load all users registry keys from their ntuser.dat file (perform above first)</a></li>
          <li><a href="#query-all-users-run-key">Query all users run key</a></li>
          <li><a href="#unload-all-users-registry-keys">Unload all users registry keys</a></li>
          <li><a href="#remediate-automatic-loadrun-reg-keys">Remediate Automatic Load/Run Reg Keys</a></li>
          <li><a href="#check-registry-for-ie-enhanced-security-modification">Check Registry for IE Enhanced Security Modification</a></li>
          <li><a href="#check-registry-for-disabling-of-uac-1uac-disabled">Check Registry for disabling of UAC (1=UAC Disabled)</a></li>
          <li><a href="#review-software-keys-for-malicious-entries">Review Software Keys for malicious entries</a></li>
          <li><a href="#scan-registry-keys-for-specified-text">Scan Registry keys for specified text</a></li>
          <li><a href="#persistent-file-locations-of-interest">Persistent file locations of interest</a></li>
          <li><a href="#locate-any-file-of-interest-from-cmdexe-using-whereexe">Locate any file of interest from cmd.exe using ‘where.exe’</a></li>
          <li><a href="#locate-lnk-files-with-a-particular-string-special-thanks-to-the-notorious">Locate LNK Files with a particular string (Special thanks to the notorious)</a></li>
          <li><a href="#master-file-table">Master File Table</a></li>
          <li><a href="#determine-timestomping">Determine Timestomping</a></li>
          <li><a href="#enable-date-accessed-timestamps">Enable Date Accessed Timestamps</a></li>
          <li><a href="#remove-bitsadmin-persistence">Remove BITSAdmin Persistence</a></li>
          <li><a href="#check-system-directories-for-executables-not-signed-as-part-of-an-operating-system-release">Check system directories for executables not signed as part of an operating system release</a></li>
          <li><a href="#locate-possible-trickbot">Locate Possible Trickbot</a></li>
          <li><a href="#determine-if-user-trusted-a-docspreadsheet-etc-and-ran-a-macro">Determine if user Trusted a doc/spreadsheet etc and ran a macro</a></li>
          <li><a href="#check-office-security-settings">Check Office Security Settings</a></li>
          <li><a href="#check-outlook-temporary-files">Check Outlook Temporary Files</a></li>
          <li><a href="#check-ms-office-logs-for-high-risk-file-names">Check MS Office Logs for high risk file names</a></li>
          <li><a href="#prevent-cve-2017-11882-cve-2018-0802-cve-2018-0804-cve-2018-0805-cve-2018-0806-cve-2018-0807-eqnedt32exe-exploitation">Prevent CVE-2017-11882, CVE-2018-0802, CVE-2018-0804, CVE-2018-0805, CVE-2018-0806, CVE-2018-0807 (EQNEDT32.EXE) Exploitation</a></li>
          <li><a href="#determine-if-user-opened-a-document">Determine if user opened a document</a></li>
          <li><a href="#number-of-sub-directories">Number of Sub-Directories</a></li>
          <li><a href="#prevent-executable-from-running">Prevent Executable from Running.</a></li>
          <li><a href="#show-known-file-extensions-and-hidden-files-excluding-os-hidden-files">Show known file extensions and hidden files (excluding OS hidden files)</a></li>
          <li><a href="#open-file-extension-eg-scripts-with-certain-application-elevated-cmd">Open File Extension (e.g. scripts) with certain application (elevated cmd)</a></li>
          <li><a href="#disable-command-prompt">Disable Command Prompt</a></li>
          <li><a href="#locate-possible-dll-search-order-hijacking">Locate Possible DLL Search Order Hijacking</a>
            <ul>
              <li><a href="#search-order-for-desktop-applications">Search order for desktop applications:</a></li>
            </ul>
          </li>
          <li><a href="#locate-possible-dll-side-loading">Locate Possible Dll Side Loading</a>
            <ul>
              <li><a href="#unique-sideload-dll-hashes-may-take-some-time">Unique Sideload DLL hashes (may take some time)</a></li>
              <li><a href="#unsigned-or-invalid-sideload-dlls-there-will-be-a-lot">Unsigned or Invalid Sideload DLLs (there will be a lot)</a></li>
              <li><a href="#unsigned-sideload-dlls-less-noise">Unsigned Sideload DLLs (Less noise)</a></li>
              <li><a href="#hash-of-unsigned-sideload-dlls">Hash of Unsigned Sideload DLLs</a></li>
            </ul>
          </li>
          <li><a href="#find-files-without-extensions">Find files without extensions</a></li>
          <li><a href="#remediate-malicious-files">Remediate malicious files</a></li>
          <li><a href="#detect-persistent-wmi-subscriptions">Detect Persistent WMI Subscriptions</a></li>
          <li><a href="#remediate-persistent-wmi-subscriptions">Remediate Persistent WMI Subscriptions</a></li>
          <li><a href="#enumerate-wmi-namespaces">Enumerate WMI Namespaces</a></li>
          <li><a href="#mimikatzcredential-extraction-detection">Mimikatz/Credential Extraction Detection</a></li>
          <li><a href="#password-filter-dll-credential-harvesting-detection">Password Filter DLL Credential Harvesting Detection</a></li>
          <li><a href="#network-provider-dll-credential-harvesting-detection">Network Provider DLL Credential Harvesting Detection</a></li>
          <li><a href="#registry-key-modification-timestamp-by-shaun-hess">Registry key modification timestamp (by Shaun Hess)</a></li>
          <li><a href="#netntlm-downgrade-attack-detection">NetNTLM Downgrade Attack Detection</a></li>
          <li><a href="#oauth-access-token-theft-detection-in-azure">Oauth Access Token Theft Detection in Azure</a></li>
          <li><a href="#sans-for509---cloud-forensics-and-azure">SANS FOR509 - Cloud Forensics and Azure</a></li>
          <li><a href="#putty-detection">Putty Detection</a></li>
          <li><a href="#installed-updates">Installed Updates</a></li>
          <li><a href="#installed-softwarepackages">Installed Software/Packages</a></li>
          <li><a href="#process-information">Process information</a></li>
          <li><a href="#current-process-execution-or-module-loads-from-temporary-directories">Current Process execution or module loads from temporary directories</a></li>
          <li><a href="#current-process-execution-or-module-loads-from-temporary-directories--hash">Current Process execution or module loads from temporary directories + hash</a></li>
          <li><a href="#scan-for-malware-with-windows-defender">Scan for malware with Windows Defender</a></li>
          <li><a href="#check-windows-defender-for-excluded-files-and-default-actions">Check Windows Defender for excluded files and default actions</a></li>
          <li><a href="#delete-windows-defender-excluded-files">Delete Windows Defender excluded files</a></li>
          <li><a href="#check-windows-defender-blockquarantine-logs">Check Windows Defender Block/Quarantine Logs</a></li>
          <li><a href="#check-and-set-access-control-lists">Check and Set Access Control Lists</a></li>
          <li><a href="#change-ace-for-everyone-on-folder-and-subfilesfolders">Change ACE for “everyone” on folder and subfiles/folders</a>
            <ul>
              <li><a href="#grant-everyone-full-access">Grant everyone full access</a></li>
              <li><a href="#remove-ace-entries-for-everyone">Remove ACE entries for “everyone”</a></li>
            </ul>
          </li>
          <li><a href="#disable-unwanted-windows-binaries-via-base64-encoding-and-removal">Disable unwanted windows binaries (via Base64 encoding and removal)</a></li>
          <li><a href="#enable-windows-binaries-via-base64-decoding-and-removal">Enable windows binaries (via Base64 decoding and removal)</a></li>
          <li><a href="#make-multiple-files-visible-and-remove-superhidden">Make multiple files visible and remove ‘superhidden’</a></li>
          <li><a href="#check-security-descriptor-definition-language-sddl-and-access-control-entries-ace-for-services">Check Security Descriptor Definition Language (SDDL) and Access Control Entries (ACE) for services</a>
            <ul>
              <li><a href="#syntax-of-security-descriptor-string">Syntax of Security Descriptor String:</a></li>
              <li><a href="#syntax-of-ace-string">Syntax of ACE String:</a></li>
              <li><a href="#example-sddl">Example SDDL:</a></li>
              <li><a href="#example-sddl-breakdown-from-above">Example SDDL Breakdown (from above):</a></li>
            </ul>
          </li>
          <li><a href="#kill-unstoppable-serviceprocess">Kill “Unstoppable” Service/Process</a></li>
          <li><a href="#obtain-hash-for-all-running-executables">Obtain hash for all running executables</a></li>
          <li><a href="#obtain-hash-and-established-network-connections-for-running-executables-with-dns-cache">Obtain hash and established network connections for running executables with dns cache</a></li>
          <li><a href="#obtain-hash-and-listening-network-connections-for-running-executables">Obtain hash and listening network connections for running executables</a></li>
          <li><a href="#obtain-hash-and-possible-tunneled-network-connections-for-running-executables">Obtain hash and possible tunneled network connections for running executables</a></li>
          <li><a href="#obtain-workstation-name-for-tunneled-authentication">Obtain workstation name for tunneled authentication</a></li>
          <li><a href="#obtain-hash-of-dlls-currently-loaded-by-processes">Obtain hash of DLLs currently loaded by processes</a></li>
          <li><a href="#obtain-processes-where-binaries-file-version-doesnt-match-os-release">Obtain processes where binaries file version doesn’t match OS Release</a></li>
          <li><a href="#obtain-process-binary-file-external-names">Obtain process binary file external names</a></li>
          <li><a href="#obtain-processes-running-which-are-running-a-dll">Obtain processes running which are running a DLL</a></li>
          <li><a href="#obtain-hash-of-unsigned-or-invalid-dlls-currently-loaded-by-processes">Obtain hash of unsigned or invalid DLLs currently loaded by processes</a></li>
          <li><a href="#obtain-list-of-unsigned-dlls-currently-loaded-by-processes">Obtain list of unsigned DLLs currently loaded by processes</a></li>
          <li><a href="#obtain-dll-information-listdlls">Obtain DLL information ListDLLs</a></li>
          <li><a href="#unsigned-dlls-loaded-by-processes-using-listdlls">Unsigned DLLs loaded by processes (Using ListDLLs)</a></li>
          <li><a href="#obtain-dlls-in-use-by-processes">Obtain DLLs in use by processes</a></li>
          <li><a href="#enable-logging-of-non-non-windows-module-loads-via-wdac-code-integrity">Enable logging of non non-Windows module loads via WDAC code integrity</a></li>
          <li><a href="#extract-module-dll-sys-and-exe-information-from-wdac-audit-events">Extract Module (DLL, SYS and EXE) information from WDAC Audit Events</a></li>
          <li><a href="#determine-handles-on-a-file">Determine handles on a file</a></li>
          <li><a href="#verify-eternalblue-patch-ms17-010-is-installed---microsoft">Verify EternalBlue Patch (MS17-010) is installed - Microsoft</a></li>
          <li><a href="#obtain-txt-records-from-recently-resolved-domains">Obtain TXT records from recently resolved domains</a></li>
          <li><a href="#check-all-appdata-files-for-unsigned-or-invalid-executables">Check all Appdata files for unsigned or invalid executables</a></li>
          <li><a href="#check-for-execuables-in-local-system-user-profile-and-files">Check for execuables in Local System User Profile and Files</a></li>
          <li><a href="#investigate-wmi-usage">Investigate WMI Usage</a></li>
          <li><a href="#find-executables-and-scripts-in-path-directories-envpath">Find executables and scripts in Path directories ($env:Path)</a></li>
          <li><a href="#powershell-command-history">PowerShell Command History</a></li>
          <li><a href="#find-files-createdwritten-based-on-date">Find files created/written based on date</a></li>
          <li><a href="#check-running-executables-for-malware-via-virustotal">Check running executables for malware via VirusTotal</a></li>
          <li><a href="#scan-systems-for-ioaioc-yara">Scan systems for IOA/IOC (Yara)</a></li>
          <li><a href="#use-snort-to-test-a-created-snort-rule-over-a-pcap">Use Snort to test a created Snort rule over a pcap</a></li>
          <li><a href="#kill-malicious-process">Kill malicious process</a></li>
          <li><a href="#dump-full-process-memory">Dump full process memory</a></li>
          <li><a href="#live-triage-of-memory">Live Triage of Memory</a>
            <ul>
              <li><a href="#locate-possible-shellcode-within-process-via-injected-thread">Locate Possible Shellcode within process via Injected Thread</a></li>
              <li><a href="#obtain-possible-shellcode-within-process-as-hex">Obtain Possible Shellcode within process as Hex</a></li>
              <li><a href="#obtain-possible-shellcode-within-process-as-hex-1">Obtain Possible Shellcode within process as Hex</a></li>
              <li><a href="#basic-memory-analysis-via-powershellarsenal">Basic Memory Analysis via PowerShellArsenal</a></li>
              <li><a href="#locate-possible-shellcode-address-space">Locate Possible Shellcode Address Space</a></li>
              <li><a href="#find-meterpreter-in-process-memory">Find Meterpreter in Process Memory:</a></li>
              <li><a href="#find-cobalt-strike-in-process-memory">Find Cobalt Strike in Process Memory:</a></li>
            </ul>
          </li>
          <li><a href="#network-connections">Network connections</a></li>
          <li><a href="#routing-table-and-arp-cache">Routing table and ARP cache</a></li>
          <li><a href="#contents-of-dns-resolver">Contents of DNS resolver</a></li>
          <li><a href="#currently-connected-access-point-name-wifi">Currently connected Access Point name (WiFi)</a></li>
          <li><a href="#previously-connected-access-point-names-wifi">Previously connected Access Point names (WiFi)</a></li>
          <li><a href="#current-surrounding-access-point-names-wifi">Current surrounding Access Point names (WiFi)</a></li>
          <li><a href="#extended-network-adapter-configuration-information">Extended network adapter configuration information</a></li>
          <li><a href="#enable-dns-logging">Enable DNS Logging</a></li>
          <li><a href="#scan-dns-logs">Scan DNS Logs</a></li>
          <li><a href="#scan-dns-logs-and-output-unique-dns-queries">Scan DNS Logs and output unique DNS Queries</a></li>
          <li><a href="#hostname-to-corresponding-ips-from-list">Hostname to corresponding IPs from list</a></li>
          <li><a href="#t1074-data-staging">T1074 Data Staging</a></li>
          <li><a href="#latest-system-activities">Latest system activities</a></li>
          <li><a href="#driver-information">Driver information</a></li>
          <li><a href="#process-and-extra-information">Process and extra information</a></li>
          <li><a href="#hosts-file-and-serviceport-mapping">Hosts file and service&gt;port mapping</a></li>
          <li><a href="#recycle-bin-forensics">Recycle Bin Forensics</a></li>
          <li><a href="#dcom-information--firewall-rules">DCOM Information + Firewall Rules</a></li>
          <li><a href="#service-information">Service Information</a></li>
          <li><a href="#stop-and-disabledelete-malicious-service">Stop and disable/delete malicious service</a></li>
          <li><a href="#disable-internet-explorer">Disable Internet Explorer</a></li>
          <li><a href="#cmd-history">cmd history</a></li>
          <li><a href="#files-greater-than-a-10mb">Files greater than a 10mb</a></li>
          <li><a href="#temp-files-greater-than-10mb">Temp files greater than 10mb</a></li>
          <li><a href="#locate-process-handles-eg-files-open-by-process">Locate process handles (e.g. files open by process)</a></li>
          <li><a href="#close-process-handles-eg-files-open-by-process">Close process handles (e.g. files open by process)</a></li>
          <li><a href="#event-logs-between-a-timeframe">Event logs between a timeframe</a></li>
          <li><a href="#check-audit-policies">Check audit policies</a></li>
          <li><a href="#set-logging-on-all-successfailure-events">Set logging on all success/failure events</a></li>
          <li><a href="#enable-logging-of-process-creation">Enable logging of process creation</a></li>
          <li><a href="#scan-process-creation-logs-for-appdata">Scan process creation logs for ‘appdata’</a></li>
          <li><a href="#parse-process-creation-logs">Parse process creation logs</a></li>
          <li><a href="#check-for-windows-security-logging-bypass">Check for Windows Security Logging Bypass</a></li>
          <li><a href="#check-group-policies">Check group policies</a></li>
          <li><a href="#obtain-mode-settings-for-ports">Obtain mode settings for ports</a></li>
          <li><a href="#event-logs-for-offline-analysis">Event Logs for offline analysis</a></li>
          <li><a href="#user-access-logging-ual-kstrike-parser">User Access Logging (UAL) KStrike Parser</a></li>
          <li><a href="#quickly-scan-event-logs-with-deepbluecli">Quickly scan event logs with DeepblueCLI</a></li>
          <li><a href="#event-tracing-for-windows-etw">Event Tracing for Windows (ETW).</a>
            <ul>
              <li><a href="#list-running-trace-sessions">List Running Trace Sessions</a></li>
              <li><a href="#list-providers-that-a-trace-session-is-subscribed-to">List Providers That a Trace Session is Subscribed to</a></li>
              <li><a href="#list-all-etw-providers">List all ETW Providers</a></li>
              <li><a href="#view-providers-process-is-sending-events-to">View providers process is sending events to</a></li>
            </ul>
          </li>
          <li><a href="#setup-custom-log-tracing">Setup Custom Log Tracing</a>
            <ul>
              <li><a href="#query-providers-available-and-their-keyword-values">Query Providers Available and their keyword values</a></li>
              <li><a href="#initiate-tracing-session">Initiate Tracing Session</a></li>
            </ul>
          </li>
          <li><a href="#update-trace-with-wanted-providers">Update trace with wanted providers</a></li>
          <li><a href="#delete-subscription-and-providers">Delete Subscription and Providers</a></li>
          <li><a href="#event-logtracing-tampering-detection">Event Log/Tracing Tampering Detection</a></li>
          <li><a href="#timeline-windows-event-logs">Timeline Windows Event Logs.</a></li>
          <li><a href="#super-timeline-a-host">Super Timeline a host:</a></li>
          <li><a href="#security-log-information">Security log information</a></li>
          <li><a href="#logon-type-information">Logon type information</a></li>
          <li><a href="#special-logon-information-4672">Special logon information (4672)</a></li>
          <li><a href="#system-log-information">System log information:</a></li>
          <li><a href="#application-log-information">Application log information</a></li>
          <li><a href="#sysmon-log-information">Sysmon log information</a>
            <ul>
              <li><a href="#review-sysmon-logs-1-liner-replace-id-value-as-required-from-above">Review Sysmon Logs 1-liner (replace ID value as required from above)</a></li>
              <li><a href="#parse-process-creation-events-and-display-data">Parse Process Creation Events and Display Data</a></li>
              <li><a href="#parse-dns-query-events-and-display-data">Parse DNS Query Events and Display Data</a></li>
            </ul>
          </li>
          <li><a href="#active-directory-investigation">Active Directory Investigation</a>
            <ul>
              <li><a href="#nt-directory-services-directory-information-tree-file-ntdsdit">NT Directory Services Directory Information Tree File (ntds.dit)</a></li>
              <li><a href="#edblog">Edb.log</a></li>
              <li><a href="#edbxxxxxlog">Edbxxxxx.log</a></li>
              <li><a href="#edbchk">Edb.chk</a></li>
              <li><a href="#resxlogresxjrs">Resx.log/Resx.jrs</a></li>
              <li><a href="#tempedb">Temp.edb</a></li>
              <li><a href="#schemaini">Schema.ini</a></li>
              <li><a href="#investigation-of-ntdsdit">Investigation of ntds.dit</a></li>
            </ul>
          </li>
          <li><a href="#origami-pdf-malicious-pdf-analysis">Origami-PDF (Malicious PDF Analysis)</a></li>
          <li><a href="#more-malicious-pdfdoc-analysis">More Malicious PDF/Doc Analysis</a></li>
          <li><a href="#exiftool-image-analysis">Exiftool (Image Analysis)</a></li>
          <li><a href="#dump-all-thumbnails-from-a-jpg-image-to-a-folder">Dump all thumbnails from a jpg image to a folder</a></li>
          <li><a href="#rdp-cache-images">RDP Cache images</a></li>
          <li><a href="#rdp-terminal-services-activity">RDP (Terminal Services) Activity</a></li>
          <li><a href="#rdp-terminal-services-configuration">RDP (Terminal Services) Configuration</a>
            <ul>
              <li><a href="#check-if-terminal-services-enabled">Check if Terminal Services Enabled</a></li>
              <li><a href="#check-if-one-session-per-user-has-been-modified">Check if one session per user has been modified</a></li>
              <li><a href="#check-if-port-number-has-been-modified">Check if port number has been modified</a></li>
            </ul>
          </li>
          <li><a href="#host-firewall-information">Host Firewall information:</a></li>
          <li><a href="#model-of-motherboard-and-hardware-information">Model of motherboard and hardware information:</a></li>
          <li><a href="#monitoring-of-open-files">Monitoring of open files:</a></li>
          <li><a href="#check-bitlocker-encryption">Check Bitlocker Encryption</a></li>
          <li><a href="#list-open-files">List open files</a></li>
          <li><a href="#display-proxy-information">Display proxy information</a></li>
          <li><a href="#disconnect-open-files-based-on-username">Disconnect open files based on username:</a></li>
          <li><a href="#powershell-commands">Powershell Commands</a></li>
          <li><a href="#service-information-1">Service information</a></li>
          <li><a href="#view-named-pipes">View Named Pipes</a></li>
          <li><a href="#harden-system-from-iso-phishing">Harden System from ISO Phishing</a></li>
          <li><a href="#harden-system-from-lateral-movementprivesc">Harden System from Lateral Movement/privesc</a>
            <ul>
              <li><a href="#disable-remote-interaction-with-services">Disable remote interaction with services</a></li>
              <li><a href="#disable-remote-interaction-with-scheduled-tasks">Disable remote interaction with scheduled tasks</a></li>
              <li><a href="#disable-rdp-access">Disable RDP access</a></li>
              <li><a href="#disable-dcom">Disable DCOM</a></li>
              <li><a href="#disable-admin-shares">Disable Admin Shares</a></li>
              <li><a href="#disable-printer-spooler-service-printnightmare-rce--lpe-mitigation">Disable Printer Spooler Service (PrintNightmare RCE &amp; LPE Mitigation)</a></li>
              <li><a href="#prevent-system-from-writing-new-print-dll-printnightmare-rce--lpe-mitigation">Prevent SYSTEM from writing new print DLL (PrintNightmare RCE &amp; LPE Mitigation)</a></li>
              <li><a href="#disable-remote-printing-printnightmare-rce-mitigation">Disable Remote Printing (PrintNightmare RCE mitigation)</a></li>
              <li><a href="#enable-warning-on-pointandprint-and-uac-printnightmare-lpe-mitigation">Enable Warning on PointAndPrint and UAC (PrintNightmare LPE mitigation)</a></li>
              <li><a href="#deny-vulnerable-netlogon-connections-prevent-zerologon-cve-2020-1472">Deny vulnerable Netlogon connections (Prevent ZeroLogon CVE-2020-1472)</a></li>
              <li><a href="#rename-mshtmldll-cve-2021-40444-mitigation">Rename mshtml.dll (CVE-2021-40444 Mitigation)</a></li>
              <li><a href="#delete-ms-msdt-association-cve-2022-30190follina-mitigation">Delete ms-msdt association (CVE-2022-30190/Follina Mitigation)</a></li>
              <li><a href="#stop-server-responsible-for-inter-process-communication-calls">Stop Server Responsible for Inter-process Communication Calls</a></li>
              <li><a href="#delete-admin-shares">Delete Admin Shares</a></li>
              <li><a href="#disable-anonymous-access-to-named-pipes">Disable Anonymous Access to Named Pipes</a></li>
              <li><a href="#disable-ole-objects-in">Disable OLE objects in</a></li>
            </ul>
          </li>
          <li><a href="#process-wmi-objects">Process WMI objects</a></li>
          <li><a href="#process-information-1">Process information</a></li>
          <li><a href="#baseline-processes-and-services">Baseline processes and services</a></li>
          <li><a href="#view-and-interact-with-shadow-copies-must-be-run-from-elevated-cmdexe">View and interact with shadow copies (MUST BE RUN FROM ELEVATED CMD.exe)</a></li>
          <li><a href="#create-shadow-copy-for-c-drive">Create Shadow Copy for C: drive</a></li>
          <li><a href="#other-shadow-copy-techniques">Other Shadow Copy Techniques</a></li>
          <li><a href="#tcp-connections">TCP Connections</a></li>
          <li><a href="#list-of-ipv4-addresses-who-have-connected-rdp">List of IPV4 addresses who have connected (RDP)</a></li>
          <li><a href="#powershell-logs">Powershell logs</a></li>
          <li><a href="#event-logs-available">Event logs available</a></li>
          <li><a href="#event-logs-per-application-source">Event Logs per Application Source</a></li>
          <li><a href="#event-logs-per-severity-source">Event Logs per Severity Source</a>
            <ul>
              <li><a href="#critical-logs">Critical Logs</a></li>
              <li><a href="#error-logs">Error Logs</a></li>
              <li><a href="#warning-logs">Warning Logs</a></li>
              <li><a href="#information-logs">Information Logs</a></li>
            </ul>
          </li>
          <li><a href="#live-event-log-filtering">Live Event Log Filtering</a></li>
          <li><a href="#find-authenticating-userasset-for-remote-service-creation-lateral-movement">Find Authenticating user/asset for remote service creation (lateral movement)</a>
            <ul>
              <li><a href="#locate-possible-kerberoastkerberos-based-attacks">Locate possible Kerberoast/Kerberos based attacks</a></li>
            </ul>
          </li>
          <li><a href="#extract-useful-fields-from-legacy-logs">Extract useful fields from Legacy Logs</a>
            <ul>
              <li><a href="#find-user-authenticating">Find User Authenticating</a></li>
              <li><a href="#find-ipport-authenticating">Find IP/Port Authenticating</a></li>
            </ul>
          </li>
          <li><a href="#remote-desktop-lateral-movement-detection-destinations">Remote Desktop Lateral Movement Detection (Destinations)</a></li>
          <li><a href="#map-network-shares-lateral-movement-detection-destinations">Map Network Shares Lateral Movement Detection (Destinations)</a></li>
          <li><a href="#psexec-lateral-movement-detection-destinations">PsExec Lateral Movement Detection (Destinations)</a></li>
          <li><a href="#scheduled-tasks-lateral-movement-detection-destinations">Scheduled Tasks Lateral Movement Detection (Destinations)</a></li>
          <li><a href="#services-lateral-movement-detection-destinations">Services Lateral Movement Detection (Destinations)</a></li>
          <li><a href="#wmiwmic-lateral-movement-detection-destinations">WMI/WMIC Lateral Movement Detection (Destinations)</a></li>
          <li><a href="#powershell-lateral-movement-detection-destinations">PowerShell Lateral Movement Detection (Destinations)</a></li>
          <li><a href="#extra-information">Extra Information</a></li>
          <li><a href="#user-accounts-and-logon-information">User accounts and logon information</a></li>
          <li><a href="#share-information">Share information</a></li>
          <li><a href="#list-alternate-data-streams-in-current-dir-and-view-them">List Alternate Data Streams in current Dir and view them</a></li>
          <li><a href="#list-alternate-data-streams-in-text-files-within-appdata">List Alternate Data Streams in text files within AppData</a></li>
          <li><a href="#use-alternate-data-streams-to-find-download-location">Use Alternate Data Streams to find download location</a></li>
          <li><a href="#general-notes">General Notes</a></li>
          <li><a href="#gather-artifacts">Gather artifacts</a></li>
          <li><a href="#powershell-execution-log">Powershell execution log</a></li>
          <li><a href="#analyse-document-for-macros">Analyse document for macros</a></li>
          <li><a href="#capture-powershell-memdump-and-analyse">Capture powershell memdump and analyse</a></li>
          <li><a href="#recent-execution-of-programs">Recent execution of programs</a></li>
          <li><a href="#programs-specifically-set-to-run-as-admin">Programs specifically set to run as admin</a>
            <ul>
              <li><a href="#windows-indexing-service">Windows Indexing Service</a></li>
            </ul>
          </li>
          <li><a href="#programs-accessing-windows-features-such-as-webcam-and-microphone">Programs Accessing Windows Features such as Webcam and Microphone</a>
            <ul>
              <li><a href="#all-windows-features-including-start-and-stop-timestamps">All Windows Features Including Start and Stop Timestamps</a></li>
              <li><a href="#programs-using-webcam">Programs Using Webcam</a></li>
              <li><a href="#programs-using-microphone">Programs Using Microphone</a></li>
            </ul>
          </li>
          <li><a href="#usn-journal-any-changes-to-ntfs-volume">USN Journal (any changes to NTFS volume)</a></li>
          <li><a href="#ntfs-index-attributes-i30-file-made-up-of-index_root-index_allocation-attributes">NTFS Index Attributes ($I30 file made up of $INDEX_ROOT, $INDEX_ALLOCATION attributes)</a>
            <ul>
              <li><a href="#indxparse">INDXParse</a></li>
              <li><a href="#indxripper">INDXRipper</a></li>
              <li><a href="#indx2csv">Indx2Csv</a></li>
            </ul>
          </li>
          <li><a href="#link-file-analysis">Link File Analysis</a></li>
          <li><a href="#jump-lists-analysis">Jump Lists Analysis</a></li>
          <li><a href="#srum-analysis">SRUM Analysis</a></li>
          <li><a href="#background-activity-moderator-bamdam">Background Activity Moderator (BAM/DAM)</a></li>
          <li><a href="#windows-10-mail-app-forensics">Windows 10 Mail App Forensics</a></li>
          <li><a href="#capture-packets-with-netsh">Capture packets with netsh</a></li>
          <li><a href="#capture-packets-with-powershell">Capture Packets with PowerShell</a></li>
          <li><a href="#stop-capturing-packets-with-powershell">Stop Capturing Packets with PowerShell</a></li>
          <li><a href="#convert-etl-file-to-pcap">Convert ETL File to PCAP</a></li>
        </ul>
      </li>
      <li><a href="#ntuserdat-important-registry-entries">NTUSER.DAT Important Registry entries:</a>
        <ul>
          <li><a href="#recent-execution-of-programs-gui">Recent execution of programs (GUI)</a></li>
          <li><a href="#recent-appslast-visited-mru">Recent Apps/Last Visited MRU</a></li>
          <li><a href="#execution-of-sysinternals-tool">Execution of Sysinternals Tool</a></li>
          <li><a href="#recent-internet-explorer-history">Recent Internet Explorer History</a></li>
          <li><a href="#google-chrome-service-workers">Google Chrome Service Workers</a></li>
          <li><a href="#recent-chrome-history">Recent Chrome History</a></li>
          <li><a href="#recent-firefox-history">Recent Firefox History</a></li>
          <li><a href="#recent-edge-history">Recent Edge History</a></li>
          <li><a href="#check-root-certificate-store">Check Root Certificate Store</a></li>
          <li><a href="#thumbnail-cache">Thumbnail Cache</a></li>
          <li><a href="#shellbags">Shellbags</a></li>
          <li><a href="#usrclassdat-shellbags">UsrClass.dat Shellbags</a></li>
        </ul>
      </li>
      <li><a href="#software-hive-registry-entries">SOFTWARE Hive Registry Entries</a>
        <ul>
          <li><a href="#common-startup-locations">Common startup locations</a></li>
          <li><a href="#network-information">Network Information</a></li>
          <li><a href="#gather-wifi-passwords">Gather WiFi Passwords</a></li>
          <li><a href="#networks-connecteddisconnected-tofrom-and-mac-address">Networks connected\disconnected to\from and mac address</a></li>
          <li><a href="#get-host-mac-addresses">Get host Mac Addresses</a></li>
          <li><a href="#lookup-mac-addressorganizationally-unique-identifier-oui">Lookup MAC Address/Organizationally Unique Identifier (OUI)</a></li>
        </ul>
      </li>
      <li><a href="#useful-wireshark-filters">Useful Wireshark filters</a>
        <ul>
          <li><a href="#all-traffic-to-or-from-an-ip">All traffic to or from an IP</a></li>
          <li><a href="#all-tcp-traffic-on-a-port">All TCP traffic on a port</a></li>
          <li><a href="#all-traffic-from-an-ip">All traffic from an IP</a></li>
          <li><a href="#all-traffic-to-an-ip">All traffic to an IP</a></li>
          <li><a href="#http-or-dns-traffic">HTTP or DNS Traffic</a></li>
          <li><a href="#clientdc-traffic-filtering-noise">Client&gt;DC traffic filtering noise</a></li>
          <li><a href="#tcp-issues-flags">TCP issues (flags)</a></li>
          <li><a href="#tcp-protocol-flags-present">TCP protocol flags (present)</a></li>
          <li><a href="#encrypted-traffic">Encrypted Traffic</a></li>
          <li><a href="#follow-tcp-stream">Follow TCP Stream</a></li>
          <li><a href="#tcp-packets-for-string">TCP packets for string</a></li>
          <li><a href="#http-codes">HTTP codes</a></li>
          <li><a href="#user-agent-withoutwith-case-sensitivity">User agent, without/with case sensitivity</a></li>
          <li><a href="#addresses-on-subnet-by-iphostname">Addresses on subnet by IP/Hostname</a></li>
          <li><a href="#tls-handshakes-shows-certificate-information">TLS Handshakes (Show’s certificate information)</a></li>
          <li><a href="#filter-based-on-server-type">Filter based on server type</a></li>
        </ul>
      </li>
      <li><a href="#wireshark-key-tips-and-tricks-by-brad-duncan">Wireshark Key Tips and Tricks by Brad Duncan</a></li>
      <li><a href="#decrypting-encrypted-packets">Decrypting Encrypted Packets</a></li>
      <li><a href="#using-tshark-to-analyse-pcaps">Using tshark to analyse pcaps</a>
        <ul>
          <li><a href="#merging-multiple-pcap-files">Merging multiple pcap files</a></li>
          <li><a href="#list-unique-ip-sources-in-pcap">List Unique IP Sources in Pcap</a></li>
          <li><a href="#list-unique-ip-sources-and-destination-for-http-traffic">List Unique IP Sources and Destination for HTTP traffic</a></li>
          <li><a href="#live-dns-request-and-responses-on-wifi">Live DNS Request and Responses on WiFi</a></li>
          <li><a href="#extract-all-objectsfiles-from-supported-protocols">Extract All Objects/Files from Supported Protocols</a></li>
          <li><a href="#list-uris-accessed">List URIs Accessed</a></li>
          <li><a href="#get-http-post-requests-and-output-to-json">Get HTTP POST Requests and Output to JSON</a></li>
          <li><a href="#export-objects">Export objects</a></li>
          <li><a href="#list-post-request-parameters">List POST Request Parameters</a></li>
        </ul>
      </li>
      <li><a href="#using-tcpdump-to-analyse-cut-out-pcaps">Using tcpdump to analyse (cut out) pcaps</a>
        <ul>
          <li><a href="#packets-containing-syn--ack-flags">Packets containing Syn &amp; Ack Flags</a></li>
          <li><a href="#packets-containing-only-syn-flag">Packets containing only Syn Flag</a></li>
          <li><a href="#packets-containing-only-syn-and-ack-flags">Packets containing only Syn and Ack Flags</a></li>
        </ul>
      </li>
      <li><a href="#system-hive-registry-entries">SYSTEM Hive Registry Entries</a>
        <ul>
          <li><a href="#usb-information">USB Information</a></li>
          <li><a href="#os-information">OS Information</a></li>
          <li><a href="#network-information-1">Network Information</a></li>
          <li><a href="#prefetch-information">Prefetch Information</a></li>
          <li><a href="#superfetch-information">Superfetch Information</a></li>
        </ul>
      </li>
      <li><a href="#powershell-host-based-investigation-and-containment-techniques">PowerShell Host Based Investigation and Containment Techniques</a>
        <ul>
          <li><a href="#powerforensics">PowerForensics</a></li>
          <li><a href="#google-rapid-response">Google Rapid Response</a></li>
          <li><a href="#kansa-powershell-ir-framework">Kansa PowerShell IR Framework</a></li>
          <li><a href="#enable-ps-remoting-using-psexec">Enable PS Remoting using PsExec</a></li>
          <li><a href="#confirm-trusted-hosts-list-if-required">Confirm trusted hosts list if required</a></li>
          <li><a href="#quick-remote-response-no-auditlogging">Quick Remote Response (no audit/logging)</a></li>
          <li><a href="#setup-logging-for-ir">Setup logging for IR</a></li>
          <li><a href="#establish-remote-session">Establish Remote Session</a></li>
          <li><a href="#enter-or-exit-remote-session">Enter or exit remote session</a></li>
          <li><a href="#issuing-remote-commandshell">Issuing remote command/shell</a></li>
          <li><a href="#retrievingdownloading-files">Retrieving/downloading files</a></li>
          <li><a href="#checking-for-running-processes">Checking for running processes</a></li>
          <li><a href="#query-registry-keys">Query Registry Keys</a></li>
          <li><a href="#pcap-collection">PCAP collection</a></li>
          <li><a href="#blocking-a-domain">Blocking a domain</a></li>
          <li><a href="#blocking-an-ip">Blocking an IP</a></li>
          <li><a href="#unblocking-an-ip">Unblocking an IP</a></li>
          <li><a href="#quarantining-a-host-using-firewall">Quarantining a host using Firewall</a></li>
          <li><a href="#creating-an-ou-to-quarantine-a-host-into">Creating an OU to quarantine a host into</a></li>
          <li><a href="#moving-an-ad-object-into-a-quarantine-ou">Moving an AD Object into a quarantine OU</a></li>
          <li><a href="#quarantining-a-host-using-dcom">Quarantining a host using DCOM</a></li>
          <li><a href="#remove-a-quarantined-host">Remove a quarantined host</a></li>
          <li><a href="#disable-admin-shares-1">Disable Admin Shares</a></li>
          <li><a href="#credentials-and-exposure">Credentials and Exposure</a>
            <ul>
              <li><a href="#cached-credentials">Cached Credentials</a></li>
            </ul>
          </li>
          <li><a href="#kerberos-tickets-and-exposure">Kerberos Tickets and Exposure</a></li>
        </ul>
      </li>
      <li><a href="#windows-memory-forensics">Windows Memory Forensics</a>
        <ul>
          <li><a href="#volatility-2x-basics">Volatility 2.x Basics</a>
            <ul>
              <li><a href="#find-out-what-profiles-you-have-available">Find out what profiles you have available</a></li>
              <li><a href="#find-out-the-originating-os-profile-to-be-used-from-the-memory-dump">Find out the originating OS profile to be used from the memory dump.</a></li>
              <li><a href="#determine-what-plugins-are-available-for-use">Determine what plugins are available for use.</a></li>
              <li><a href="#check-what-processes-were-running">Check what processes were running.</a></li>
              <li><a href="#check-what-commands-have-been-run-and-their-output">Check what commands have been run and their output.</a></li>
              <li><a href="#dump-process-files-which-were-running-from-memory">Dump process files which were running from memory.</a></li>
              <li><a href="#dump-the-memory-associated-with-a-process-file">Dump the memory associated with a process file.</a></li>
              <li><a href="#dump-all-cached-files-from-memory">Dump all cached files from memory.</a></li>
              <li><a href="#check-what-drivers-or-kernal-modules-were-unloaded-or-hidden">Check what drivers or kernal modules were unloaded or hidden.</a></li>
              <li><a href="#check-what-network-connectivity-has-occurred">Check what network connectivity has occurred.</a></li>
              <li><a href="#check-what-network-connectivity-has-occurred-windows-xpserver-2003">Check what network connectivity has occurred (Windows XP/Server 2003).</a></li>
              <li><a href="#check-what-information-exists-within-registry-from-memory">Check what information exists within registry from memory.</a></li>
              <li><a href="#check-internet-explorer-browsing-history">Check internet explorer browsing history</a></li>
              <li><a href="#check-for-files-in-memory-dump">Check for files in memory dump</a></li>
              <li><a href="#dump-files-based-on-offset">Dump files based on offset</a></li>
              <li><a href="#scan-memory-with-yara-rule">Scan memory with Yara Rule</a></li>
              <li><a href="#duplicate-image-space-out-as-a-raw-dd-file">Duplicate image space out as a raw DD file</a></li>
              <li><a href="#dump-timelined-artifacts-from-memory">Dump timelined artifacts from memory.</a></li>
              <li><a href="#detect-persistence-mechanisms-using-winesap">Detect persistence mechanisms using Winesap</a></li>
              <li><a href="#compare-memory-dump-to-known-good-memory-dump">Compare memory dump to known good memory dump.</a></li>
              <li><a href="#output-visual-dot-file-to-view-process-tree">Output visual .dot file to view process tree</a></li>
            </ul>
          </li>
          <li><a href="#volatility-3x-basics">Volatility 3.x Basics</a>
            <ul>
              <li><a href="#check-memory-image-information">Check Memory Image Information</a></li>
              <li><a href="#check-list-of-kernel-drivers">Check List of Kernel Drivers</a></li>
              <li><a href="#check-list-of-kernel-drivers-incl-previously-unloaded-and-hidden">Check List of Kernel Drivers (incl previously unloaded and hidden)</a></li>
              <li><a href="#dump-list-of-kernel-drivers-to-files">Dump List of Kernel Drivers to Files</a></li>
              <li><a href="#dump-list-of-running-processes-to-files">Dump List of Running Processes to Files</a></li>
              <li><a href="#check-process-list-of-running-processes">Check Process List of Running Processes</a></li>
              <li><a href="#check-process-tree-of-running-processes">Check Process Tree of Running Processes</a></li>
              <li><a href="#check-running-processes-from-eprocess-blocks">Check Running Processes from EPROCESS blocks</a></li>
              <li><a href="#check-running-processes-for-possible-shellcodeinjection-via-page_execute_readwrite">Check Running Processes for possible shellcode/injection via PAGE_EXECUTE_READWRITE</a></li>
              <li><a href="#check-processes-and-their-command-lines">Check processes and their command lines</a></li>
              <li><a href="#check-for-files-which-exist-in-memory">Check for files which exist in memory</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#miscellaneous-tools-and-notes">Miscellaneous Tools and Notes</a>
        <ul>
          <li><a href="#regripper">RegRipper</a></li>
          <li><a href="#kape">Kape</a></li>
          <li><a href="#chainsaw">Chainsaw</a></li>
          <li><a href="#hayabusa">Hayabusa</a></li>
          <li><a href="#shimcaheparser">ShimCaheParser</a></li>
          <li><a href="#appcompatcacheparser">AppCompatCacheParser</a></li>
          <li><a href="#amcacheparser">AmCacheParser</a></li>
          <li><a href="#windows-10-timeline-database-parser">Windows 10 Timeline Database Parser</a></li>
          <li><a href="#bulk-extractor">Bulk Extractor</a></li>
          <li><a href="#forensicdots">ForensicDots</a></li>
          <li><a href="#cyber-chef">Cyber Chef</a></li>
          <li><a href="#urlscan">URLScan</a></li>
          <li><a href="#redirect-tracker">Redirect Tracker</a></li>
          <li><a href="#unshorten-me">Unshorten Me</a></li>
          <li><a href="#malware-hash-registry---team-cymru">Malware Hash Registry - Team Cymru</a></li>
          <li><a href="#virustotal">VirusTotal</a></li>
          <li><a href="#mitre-attck-framework">MITRE ATT&amp;CK® Framework</a></li>
          <li><a href="#lolbas-project">LOLBAS Project</a></li>
          <li><a href="#gtfobins">GTFOBins</a></li>
          <li><a href="#malapiio">MalAPI.io</a></li>
          <li><a href="#lots-project">LOTS-Project</a></li>
          <li><a href="#filesecio">Filesec.io</a></li>
          <li><a href="#loldriversio">LOLDrivers.io</a></li>
          <li><a href="#echotrail">EchoTrail</a></li>
          <li><a href="#winbindex">Winbindex</a></li>
          <li><a href="#osquery">OSQuery</a></li>
          <li><a href="#velociraptor">Velociraptor</a></li>
          <li><a href="#vipermonkey">ViperMonkey</a></li>
          <li><a href="#pcapxray">PcapXray</a>
            <ul>
              <li><a href="#parse-and-interpret-vba-macros">Parse and interpret VBA macros</a></li>
              <li><a href="#faster-output">Faster output</a></li>
              <li><a href="#less-verbose-output">Less verbose output</a></li>
            </ul>
          </li>
          <li><a href="#xlm-macro-deobfuscator">XLM Macro Deobfuscator</a>
            <ul>
              <li><a href="#parse-and-interpret-hidden-xlm-macros-excel-40-macros">Parse and interpret hidden XLM Macros (Excel 4.0 Macros)</a></li>
            </ul>
          </li>
          <li><a href="#mounting-image-files-in-linux">Mounting image files in linux</a></li>
          <li><a href="#mounting-image-files-in-windows">Mounting image files in Windows</a></li>
          <li><a href="#unpack-binary-packed-with-upx">Unpack binary packed with UPX</a></li>
          <li><a href="#scan-exchange-for-phishing-emails">Scan exchange for phishing emails</a></li>
          <li><a href="#common-dll-information">Common DLL Information</a></li>
          <li><a href="#show-processes-with-networking-functions">Show processes with networking functions</a></li>
          <li><a href="#show-processes-importing-the-remote-access-api">Show processes importing the Remote Access API</a></li>
          <li><a href="#show-processes-importing-the-task-scheduler-api">Show processes importing the task scheduler API</a></li>
          <li><a href="#show-processes-importing-the-windows-media-instrumentation-api">Show processes importing the Windows Media Instrumentation API</a></li>
        </ul>
      </li>
      <li><a href="#windows-memory-analysis-example-process-with-volatility">Windows Memory Analysis (Example Process with Volatility)</a>
        <ul>
          <li><a href="#windows-memory-analysis-dump-using-windbg">Windows Memory Analysis (dump) using Windbg</a>
            <ul>
              <li><a href="#other-inbuilt-windbg-commands-useful-for-single-process-memory-dump-analysis">Other inbuilt WindBG commands (Useful for single-process memory dump analysis)</a></li>
            </ul>
          </li>
          <li><a href="#normal-process-relationship-hierarchy-geneology">Normal Process Relationship Hierarchy (Geneology)</a></li>
          <li><a href="#extra-notes">Extra notes</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#linux-cheat-sheet">Linux Cheat Sheet</a>
    <ul>
      <li><a href="#dumping-memory">Dumping Memory</a></li>
      <li><a href="#taking-image">Taking Image</a></li>
      <li><a href="#misc-useful-tools">Misc Useful Tools</a></li>
      <li><a href="#live-triage">Live Triage</a>
        <ul>
          <li><a href="#system-information-1">System Information</a></li>
          <li><a href="#account-information">Account Information</a></li>
          <li><a href="#current-user">Current user</a></li>
          <li><a href="#last-logged-on-users">Last logged on users</a></li>
          <li><a href="#initialisation-files">Initialisation Files</a></li>
          <li><a href="#environment-and-startup-programs">Environment and Startup Programs</a></li>
          <li><a href="#scheduled-tasks">Scheduled Tasks</a></li>
          <li><a href="#commands-that-can-be-run-as-root-or-user">Commands That Can Be Run As Root or User</a></li>
          <li><a href="#ssh-keys-and-authorised-users">SSH Keys and Authorised Users</a></li>
          <li><a href="#sudoers-file-who-who-can-run-commands-as-a-different-user">Sudoers File (who who can run commands as a different user)</a></li>
          <li><a href="#configuration-information">Configuration Information</a></li>
          <li><a href="#network-connections--socket-stats">Network Connections / Socket Stats</a></li>
          <li><a href="#dns-information-for-domain">DNS Information for Domain</a></li>
          <li><a href="#ips-allowed-to-perform-domain-transfer">IPs Allowed to Perform Domain Transfer</a></li>
          <li><a href="#specify-ip-to-use-for-domain-transfer">Specify IP To Use For Domain Transfer</a></li>
          <li><a href="#ip-table-information">IP Table Information</a></li>
          <li><a href="#use-iptables-for-filtering">Use IPTables For Filtering</a></li>
          <li><a href="#network-configuration">Network Configuration</a></li>
          <li><a href="#difference-between-2-files">Difference Between 2 Files</a></li>
          <li><a href="#browser-plugin-information">Browser Plugin Information</a></li>
          <li><a href="#kernel-modules-and-extensions">Kernel Modules and Extensions/</a></li>
          <li><a href="#file-permissions">File Permissions</a></li>
          <li><a href="#decode-base64-encoded-file">Decode base64 Encoded File</a></li>
          <li><a href="#process-information-2">Process Information</a></li>
          <li><a href="#size-of-file-bytes">Size Of File (Bytes)</a></li>
          <li><a href="#ip-making-most-requests-in-access-log">IP Making Most Requests in Access Log</a></li>
          <li><a href="#count-of-unique-ips-in-access-log">Count of Unique IPs in Access Log</a></li>
          <li><a href="#unique-user-agents-in-access-log">Unique User Agents in Access Log</a></li>
          <li><a href="#most-requested-urls-for-post-request-in-access-log">Most Requested URLs For POST Request in Access Log</a></li>
          <li><a href="#lines-in-file">Lines In File</a></li>
          <li><a href="#search-files-recursively-in-directory-for-keyword">Search files recursively in directory for keyword</a></li>
          <li><a href="#process-tree">Process Tree</a></li>
          <li><a href="#open-files-and-space-usage">Open Files and space usage</a></li>
          <li><a href="#pluggable-authentication-modules-pam">Pluggable Authentication Modules (PAM)</a></li>
          <li><a href="#disk--partition-information">Disk / Partition Information</a></li>
          <li><a href="#fulle-path-for-command-in-environment-variables">Fulle Path For Command in environment variables</a></li>
          <li><a href="#system-calls--network-traffic">System Calls / Network Traffic</a></li>
          <li><a href="#strings-present-in-file">Strings Present In File</a></li>
          <li><a href="#detailed-process-information">Detailed Process Information</a></li>
          <li><a href="#recover-deleted-binary-which-is-currently-running">Recover deleted binary which is currently running</a></li>
          <li><a href="#capture-binary-data-for-review">Capture Binary Data for Review</a></li>
          <li><a href="#binary-hash-information">Binary hash information</a></li>
          <li><a href="#process-command-line-information">Process Command Line Information</a></li>
          <li><a href="#process-environment-variables-incl-user-who-ran-binary">Process Environment Variables (incl user who ran binary)</a></li>
          <li><a href="#process-file-descriptorsmaps-what-the-process-is-accessing-or-using">Process file descriptors/maps (what the process is ‘accessing’ or using)</a></li>
          <li><a href="#process-stackstatus-information-may-reveal-useful-elements">Process stack/status information (may reveal useful elements)</a></li>
          <li><a href="#deleted-binaries-which-are-still-running">Deleted binaries which are still running</a></li>
          <li><a href="#process-working-directories-including-common-targeted-directories">Process Working Directories (including common targeted directories)</a></li>
          <li><a href="#using-jq-to-analyse-json">Using JQ To Analyse JSON</a></li>
          <li><a href="#hidden-directories-and-files">Hidden Directories and Files</a></li>
          <li><a href="#immutable-files-and-directories-often-suspicious">Immutable Files and Directories (Often Suspicious)</a></li>
          <li><a href="#suidsgid-and-sticky-bit-special-permissions">SUID/SGID and Sticky Bit Special Permissions</a></li>
          <li><a href="#file-and-directories-with-no-usergroup-name">File and Directories with no user/group name</a></li>
          <li><a href="#file-types-in-current-directory">File types in current directory</a></li>
          <li><a href="#executables-on-file-system">Executables on file system</a></li>
          <li><a href="#hidden-executables-on-file-system">Hidden Executables on file system</a></li>
          <li><a href="#files-modified-within-the-past-day">Files modified within the past day</a></li>
          <li><a href="#find-files-for-a-particular-user">Find files for a particular user</a></li>
          <li><a href="#persistent-areas-of-interest">Persistent Areas of Interest</a></li>
          <li><a href="#audit-logs">Audit Logs</a></li>
          <li><a href="#installed-software-packages">Installed Software Packages</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#macos-cheat-sheet">MacOS Cheat Sheet</a>
    <ul>
      <li><a href="#dumping-memory-1">Dumping Memory</a></li>
      <li><a href="#live-mac-ir--triage">Live Mac IR / Triage</a>
        <ul>
          <li><a href="#system-information-2">System Information</a></li>
          <li><a href="#network-connections-1">Network Connections</a></li>
          <li><a href="#routing-table">Routing Table</a></li>
          <li><a href="#network-information-2">Network Information</a></li>
          <li><a href="#open-files">Open Files</a></li>
          <li><a href="#file-system-usage">File System Usage</a></li>
          <li><a href="#bash-history">Bash History</a></li>
          <li><a href="#user-logins">User Logins</a></li>
          <li><a href="#list-of-users">List of users</a></li>
          <li><a href="#user-information">User information</a></li>
          <li><a href="#running-processes">Running Processes</a></li>
          <li><a href="#extended-running-process-information">Extended Running Process Information</a></li>
          <li><a href="#system-profiler">System Profiler</a></li>
          <li><a href="#persistent-locations">Persistent Locations</a>
            <ul>
              <li><a href="#quick-overview-knockknock">Quick Overview (KnockKnock)</a></li>
              <li><a href="#xpc-services">XPC Services</a></li>
              <li><a href="#launch-agents--launch-daemons">Launch Agents &amp; Launch Daemons</a></li>
              <li><a href="#loginitems">LoginItems</a></li>
            </ul>
          </li>
          <li><a href="#disable-persistent-launch-daemon">Disable Persistent Launch Daemon</a></li>
          <li><a href="#web-browsing-preferences">Web Browsing Preferences</a></li>
          <li><a href="#safari-internet-history">Safari Internet History</a></li>
          <li><a href="#chrome-internet-history">Chrome Internet History</a></li>
          <li><a href="#firefox-internet-history">Firefox Internet History</a></li>
          <li><a href="#apple-email">Apple Email</a></li>
          <li><a href="#temporary--cached">Temporary / Cached</a></li>
          <li><a href="#system-and-audit-logs">System and Audit Logs</a></li>
          <li><a href="#specific-log-analysis">Specific Log Analysis</a></li>
          <li><a href="#files-quarantined">Files Quarantined</a></li>
          <li><a href="#user-accounts--password-shadows">User Accounts / Password Shadows</a></li>
          <li><a href="#pluggable-authentication-modules-pam-1">Pluggable Authentication Modules (PAM)</a></li>
          <li><a href="#file-fingerprintingreversing">File Fingerprinting/Reversing</a></li>
          <li><a href="#connected-disks-and-partitions">Connected Disks and Partitions</a></li>
          <li><a href="#disk-file-image-information">Disk File Image Information</a></li>
          <li><a href="#user-keychain-information">User Keychain Information</a></li>
          <li><a href="#spotlight-metadata">Spotlight Metadata</a></li>
          <li><a href="#extract-download-location-from-extended-attribute">Extract download location from Extended Attribute</a></li>
          <li><a href="#locate-historical-file-names-from-extended-attribute">Locate historical file names from Extended Attribute</a></li>
        </ul>
      </li>
      <li><a href="#bonus-valuable-links">Bonus Valuable Links</a></li>
    </ul>
  </li>
  <li><a href="#special-thanks">Special Thanks</a></li>
</ul>
            </nav>
          </aside>
        
        <p><img src="https://www.jaiminton.com/assets/images/BlueTeam.jpg" alt="BlueTeamImage"></p>

<h1 id="introduction">Introduction</h1>

<p>This post is inspired by all the hard working DFIR, and more broadly security professionals, who have put in the hard yards over the years to discuss in depth digital forensics and incident response.</p>

<h1 id="disclaimer">Disclaimer</h1>

<p>This page contains a variety of commands and concepts which are known through experience, higher education, tutorials, online blogs, YouTube Videos, professional training, reading the manual, and more. All references to original posts or material will aim to be documented in the ‘Special Thanks’ section.</p>

<p>This is not designed as a manual on how to perform DFIR, and serves only as a quick reference sheet for commands, tools, and common items of interest when performing Incident Response. 
If you need to undertake Digital Forensics for legal proceedings, seek specialist advice as this requires more rigor around Identification, Preservation, Collection, Examination, Analysis, and Presentation of findings.</p>

<h1 id="artifact-locations">Artifact locations</h1>

<p>A number of forensic artifacts are known for a number of operating systems.</p>

<p>A large number of these are covered on the Digital Forensics Artifact Repository, and can be ingested both by humans and systems given the standard YAML format.</p>

<ul>
  <li><a href="https://github.com/ForensicArtifacts/artifacts/tree/master/data">ForensicArtifacts</a></li>
</ul>

<p>One action you can take is to parse this for items of interest and then directly spit out areas for investigation. For example if you have the PowerShell <a href="https://github.com/cloudbase/powershell-yaml">ConvertFrom-Yaml module</a>, you can query this directly.</p>

<h2 id="get-an-object-of-forensic-artifacts">Get an object of forensic artifacts</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$WindowsArtifacts=$(curl https://raw.githubusercontent.com/ForensicArtifacts/artifacts/master/data/windows.yaml)
$obj = ConvertFrom-Yaml $WindowsArtifacts.Content -AllDocuments
</code></pre></div></div>

<p>Now that it is stored within a format we can use the below will give us information at a glance.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$count=0;
foreach ($Artifact in $obj){
$Artifacts = [pscustomobject][ordered]@{
	Name = $obj.name[$count]
	Description = $obj.doc[$count]
	References = $obj.urls[$count]
	Attributes = $obj.sources.attributes[$count]
}
$count++;
$Artifacts | FL;
}
</code></pre></div></div>

<h2 id="query-object-for-relevant-registry-keys">Query object for relevant registry keys:</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$obj.sources.attributes.keys|Select-String "HKEY"
$obj.sources.attributes.key_value_pairs
</code></pre></div></div>

<h2 id="query-object-for-relevant-file-paths">Query object for relevant file paths:</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$obj.sources.attributes.paths
</code></pre></div></div>

<h1 id="windows-cheat-sheet">Windows Cheat Sheet</h1>

<h2 id="order-of-volatility">Order of Volatility</h2>

<p>If performing Evidence Collection rather than IR, respect the order of volatility as defined in: rfc3227</p>

<ul>
  <li>registers, cache</li>
  <li>routing table, arp cache, process table, kernel statistics, memory</li>
  <li>temporary file systems</li>
  <li>disk</li>
  <li>remote logging and monitoring data that is relevant to the system in question</li>
  <li>physical configuration, network topology</li>
  <li>archival media</li>
</ul>

<h2 id="memory-files-locked-by-os-during-use">Memory Files (Locked by OS during use)</h2>

<p>Note: To obtain these files while they’re in use you can use a low level file extractor such as <a href="https://github.com/jschicht/RawCopy">RawCopy</a></p>

<p>hiberfil.sys (RAM stored during machine hibernation)</p>

<ul>
  <li>%SystemRoot%\hiberfil.sys</li>
</ul>

<p>pagefile.sys (Virtual memory used by Windows)</p>

<ul>
  <li>%SystemDrive%\pagefile.sys</li>
</ul>

<p>swapfile.sys (Virtual memory used by Windows Store Apps)</p>

<ul>
  <li>%SystemDrive%\swapfile.sys</li>
</ul>

<h3 id="binalyze-irec-evidence-collector-gui-or-commandline"><a href="https://binalyze.com/products/irec">Binalyze IREC Evidence Collector</a> (GUI or CommandLine)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>IREC.exe --license AAAA-BBBB-CCDD-DDDD --profile memory
</code></pre></div></div>

<p>Note: Can be used as an all in one collector (License required for full collection, free version available).</p>

<p><a href="https://irec.readthedocs.io/en/latest/commandline.html">Latest documentation</a></p>

<h3 id="belkasoft-live-ram-capturer"><a href="https://belkasoft.com/get?product=ram">Belkasoft Live RAM Capturer</a></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RamCapture64.exe "output.mem"
</code></pre></div></div>

<p>OR for 32 bit OS</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RamCapture32.exe "output.mem"
</code></pre></div></div>

<h3 id="redline">Redline</h3>

<p>Excellent resource:</p>

<p><a href="https://resources.infosecinstitute.com/memory-analysis-using-redline/">Infosec Institute - Memory Analysis using Redline</a></p>

<h3 id="memoryze">Memoryze</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MemoryDD.bat --output [LOCATION]
</code></pre></div></div>

<h3 id="comae-dumpit">Comae DumpIT</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DumpIt.exe /O [LOCATION]

	- Used for getting a memory crash file (Useful for analysis with both windbg and volatility)
	
DumpIt.exe /O [LOCATION]\mem.raw /T RAW

	- Used for getting a raw memory dump (Considered a legacy format)
</code></pre></div></div>

<p>These can be bundled with PSEXEC to execute on a remote PC; however, this will copy the file to the remote PC for executing. There’s limitations if the tool requires other drivers or files to execute (such as RamCapture).  An example command may be:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>psexec \\remotepcname -c DumpIt.exe
</code></pre></div></div>

<h3 id="powershell">Powershell</h3>

<p>Where the Microsoft Storage namespace is available (known not to be available in Win7), PowerShell can be used to invoke a native live memory dump. Special thanks to <a href="https://twitter.com/0gtweet/status/1273264867382788096?s=20">Grzegorz Tworek - 0gtweet</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ss = Get-CimInstance -ClassName MSFT_StorageSubSystem -Namespace Root\Microsoft\Windows\Storage;
Invoke-CimMethod -InputObject $ss -MethodName "GetDiagnosticInfo" -Arguments @{DestinationPath="[LOCATION]\dmp"; IncludeLiveDump=$true};
</code></pre></div></div>

<h3 id="magnet-forensics-mostly-gui">Magnet Forensics (Mostly GUI)</h3>

<ul>
  <li><a href="https://www.magnetforensics.com/resources/?cat=Free%20Tool">Magnet Forensics Tools</a></li>
  <li><a href="https://www.magnetforensics.com/free-tool-magnet-ram-capture">Magnet RAM Capture</a></li>
  <li><a href="https://www.magnetforensics.com/resources/magnet-process-capture/">Magnet Process Capture</a></li>
</ul>

<h3 id="volexity-surge"><a href="https://www.volexity.com/blog/2018/06/12/surge-collect-provides-reliable-memory-acquisition-across-windows-linux-and-macos/">Volexity Surge</a></h3>

<h3 id="microsoft-livekd"><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/livekd">Microsoft LiveKd</a></h3>

<h3 id="winpmem"><a href="https://github.com/Velocidex/WinPmem/releases">Winpmem</a></h3>

<p><a href="https://winpmem.velocidex.com/docs/memory/">Winpmem Docs</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>winpmem.exe -o test.aff4 -dd
winpmem.exe -o test.raw --format raw -dd
</code></pre></div></div>

<h2 id="imaging-live-machines">Imaging Live Machines</h2>

<h3 id="ftk-imager-cmd-version-mostly-gui-for-new-versions"><a href="https://accessdata.com/product-download">FTK Imager (Cmd version, mostly GUI for new versions)</a></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ftkimager --list-drives
ftkimager \\.\PHYSICALDRIVE0 "[Location]\Case" --e01
ftkimager [source] [destination]
ftkimager \\.\PHYSICALDRIVE0 "[Location]\Case" --e01 --outpass securepasswordinsertedhere 
</code></pre></div></div>

<h3 id="dd">DD</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dd.exe --list
dd.exe if=/dev[drive] of=Image.img bs=1M
dd.exe if=\\.\[OSDrive]: of=[drive]:\[name].img bs=1M --size --progress
(LINUX) sudo dd if=/dev/[OSDrive] of=/mnt/[name].ddimg bs=1M conv=noerror,sync
</code></pre></div></div>

<h3 id="x-ways-imager"><a href="https://www.x-ways.net/order.html">X-Ways Imager</a></h3>

<h3 id="encase-forensic"><a href="https://www.guidancesoftware.com/encase-forensic">Encase Forensic</a></h3>

<h3 id="tableau-imager"><a href="https://www.guidancesoftware.com/tableau/download-center">Tableau Imager</a></h3>

<h3 id="guymager"><a href="https://guymager.sourceforge.io/">Guymager</a></h3>

<h2 id="carving-out-files-from-image-using-scalpel">Carving Out Files From Image using <a href="https://github.com/sleuthkit/scalpel">Scalpel</a></h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano /etc/scalpel/scalpel.conf
mkdir carve
scalpel imagefile.img -o carve
</code></pre></div></div>

<h2 id="live-windows-irtriage">Live Windows IR/Triage</h2>

<p>CMD and WMIC (Windows Management Instrumentation Command-Line)
Note: less information can be gathered by using ‘list brief’.</p>

<h3 id="interact-with-remote-machine">Interact with remote machine</h3>

<p>Enable Powershell remoting:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wmic /node:[IP] process call create "powershell enable-psremoting -force"
</code></pre></div></div>

<p><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/enter-pssession?view=powershell-6">Powershell</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Enter-PSSession -ComputerName [IP]
</code></pre></div></div>

<p>PSExec:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PsExec: psexec \\IP -c cmd.exe
</code></pre></div></div>

<h3 id="system-information">System information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>get-computerinfo
echo %DATE% %TIME%
date /t
time /t
reg query "HKLM\System\CurrentControlSet\Control\TimeZoneInformation"
systeminfo
wmic computersystem list full
wmic /node:localhost product list full /format:csv
wmic softwarefeature get name,version /format:csv
wmic softwareelement get name,version /format:csv
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /s
echo %PATH%
(gci env:path|Select -exp Value).split(';')
SET
wmic bootconfig get /all /format:List
wmic computersystem get name, domain, manufacturer, model, numberofprocessors,primaryownername,username,roles,totalphysicalmemory /format:list
wmic timezone get Caption, Bias, DaylightBias, DaylightName, StandardName
wmic recoveros get /all /format:List
wmic os get /all /format:list
wmic partition get /all /format:list
wmic logicaldisk get /all /format:list
wmic diskdrive get /all /format:list
fsutil fsinfo drives
$env
Get-Variable
</code></pre></div></div>

<p>(psinfo requires sysinternals psinfo.exe):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>psinfo -accepteula -s -h -d
</code></pre></div></div>

<h3 id="obtain-list-of-all-files-on-a-computer">Obtain list of all files on a computer</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tree C:\ /F &gt; output.txt
dir C:\ /A:H /-C /Q /R /S /X
</code></pre></div></div>

<h3 id="user-and-admin-information">User and admin information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>whoami
whoami /user
net users
net localgroup administrators
net group /domain [groupname]
net user /domain [username]
wmic sysaccount
wmic useraccount get name,SID
wmic useraccount list
</code></pre></div></div>

<h3 id="logon-information">Logon information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wmic netlogin list /format:List
Get-WmiObject Win32_LoggedOnUser
Get-WmiObject win32_logonsession
query user
qwinsta
klist sessions
klist -li
</code></pre></div></div>

<h3 id="nt-domainnetwork-client-information">NT Domain/Network Client Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wmic ntdomain get /all /format:List
wmic netclient get /all /format:List
nltest /trusted_domains
</code></pre></div></div>

<h3 id="firewall-information">Firewall Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh Firewall show state
netsh advfirewall firewall show rule name=all dir=in type=dynamic
netsh advfirewall firewall show rule name=all dir=out type=dynamic
netsh advfirewall firewall show rule name=all dir=in type=static
netsh advfirewall firewall show rule name=all dir=out type=static
</code></pre></div></div>

<h3 id="firewall-changes">Firewall Changes</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Windows Firewall With Advanced Security/Firewall';} | FL TimeCreated, Message
</code></pre></div></div>

<h3 id="applications-which-have-added-a-firewall-rule">Applications which have added a firewall rule</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$events=Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-Windows Firewall With Advanced Security/Firewall'; Id='2004'};
$output = @();
foreach ($Event in $events){
$data = New-Object -TypeName PSObject;
$XML = [xml]$Event.ToXml();
$RuleId=$XML.Event.EventData.Data|?{$_.Name -eq 'RuleId'} | Select -exp InnerText;
$RuleName=$XML.Event.EventData.Data|?{$_.Name -eq 'RuleName'} | Select -exp InnerText;
$Origin=$XML.Event.EventData.Data|?{$_.Name -eq 'Origin'} | Select -exp InnerText;
$ApplicationPath=$XML.Event.EventData.Data|?{$_.Name -eq 'ApplicationPath'} | Select -exp InnerText;
$ServiceName=$XML.Event.EventData.Data|?{$_.Name -eq 'ServiceName'} | Select -exp InnerText;
$Direction=$XML.Event.EventData.Data|?{$_.Name -eq 'Direction'} | Select -exp InnerText;
$Protocol=$XML.Event.EventData.Data|?{$_.Name -eq 'Protocol'} | Select -exp InnerText;
$LocalPorts=$XML.Event.EventData.Data|?{$_.Name -eq 'LocalPorts'} | Select -exp InnerText;
$RemotePorts=$XML.Event.EventData.Data|?{$_.Name -eq 'RemotePorts'} | Select -exp InnerText;
$Action=$XML.Event.EventData.Data|?{$_.Name -eq 'Action'} | Select -exp InnerText;
$Profiles=$XML.Event.EventData.Data|?{$_.Name -eq 'Profiles'} | Select -exp InnerText;
$LocalAddresses=$XML.Event.EventData.Data|?{$_.Name -eq 'LocalAddresses'} | Select -exp InnerText;
$RemoteAddresses=$XML.Event.EventData.Data|?{$_.Name -eq 'RemoteAddresses'} | Select -exp InnerText;
$RemoteMachineAuthorizationList=$XML.Event.EventData.Data|?{$_.Name -eq 'RemoteMachineAuthorizationList'} | Select -exp InnerText;
$RemoteUserAuthorizationList=$XML.Event.EventData.Data|?{$_.Name -eq 'RemoteUserAuthorizationList'} | Select -exp InnerText;
$EmbeddedContext=$XML.Event.EventData.Data|?{$_.Name -eq 'EmbeddedContext'} | Select -exp InnerText;
$Flags=$XML.Event.EventData.Data|?{$_.Name -eq 'Flags'} | Select -exp InnerText;
$EdgeTraversal=$XML.Event.EventData.Data|?{$_.Name -eq 'EdgeTraversal'} | Select -exp InnerText;
$LooseSourceMapped=$XML.Event.EventData.Data|?{$_.Name -eq 'LooseSourceMapped'} | Select -exp InnerText;
$SecurityOptions=$XML.Event.EventData.Data|?{$_.Name -eq 'SecurityOptions'} | Select -exp InnerText;
$ModifyingUser=$XML.Event.EventData.Data|?{$_.Name -eq 'ModifyingUser'} | Select -exp InnerText;
$ModifyingApplication=$XML.Event.EventData.Data|?{$_.Name -eq 'ModifyingApplication'} | Select -exp InnerText;
$SchemaVersion=$XML.Event.EventData.Data|?{$_.Name -eq 'SchemaVersion'} | Select -exp InnerText;
$RuleStatus=$XML.Event.EventData.Data|?{$_.Name -eq 'RuleStatus'} | Select -exp InnerText;
$LocalOnlyMapped=$XML.Event.EventData.Data|?{$_.Name -eq 'LocalOnlyMapped'} | Select -exp InnerText;
$data `
| Add-Member NoteProperty RuleId "$RuleId" -PassThru `
| Add-Member NoteProperty RuleName "$RuleName" -PassThru `
| Add-Member NoteProperty Origin "$Origin" -PassThru `
| Add-Member NoteProperty ApplicationPath "$ApplicationPath" -PassThru `
| Add-Member NoteProperty ServiceName "$ServiceName" -PassThru `
| Add-Member NoteProperty Direction "$Direction" -PassThru `
| Add-Member NoteProperty Protocol "$Protocol" -PassThru `
| Add-Member NoteProperty LocalPorts "$LocalPorts" -PassThru `
| Add-Member NoteProperty RemotePorts "$RemotePorts" -PassThru `
| Add-Member NoteProperty Action "$Action" -PassThru `
| Add-Member NoteProperty Profiles "$Profiles" -PassThru `
| Add-Member NoteProperty LocalAddresses "$LocalAddresses" -PassThru `
| Add-Member NoteProperty RemoteAddresses "$RemoteAddresses" -PassThru `
| Add-Member NoteProperty RemoteMachineAuthorizationList "$RemoteMachineAuthorizationList" -PassThru `
| Add-Member NoteProperty RemoteUserAuthorizationList "$RemoteUserAuthorizationList" -PassThru `
| Add-Member NoteProperty EmbeddedContext "$EmbeddedContext" -PassThru `
| Add-Member NoteProperty Flags "$Flags" -PassThru `
| Add-Member NoteProperty EdgeTraversal "$EdgeTraversal" -PassThru `
| Add-Member NoteProperty LooseSourceMapped "$LooseSourceMapped" -PassThru `
| Add-Member NoteProperty SecurityOptions "$SecurityOptions" -PassThru `
| Add-Member NoteProperty ModifyingUser "$ModifyingUser" -PassThru `
| Add-Member NoteProperty ModifyingApplication "$ModifyingApplication" -PassThru `
| Add-Member NoteProperty SchemaVersion "$SchemaVersion" -PassThru `
| Add-Member NoteProperty RuleStatus "$RuleStatus" -PassThru `
| Add-Member NoteProperty LocalOnlyMapped "$LocalOnlyMapped" -PassThru | Out-Null
$output += $data;
}
$output = $output
$output | select -exp ModifyingApplication | sort -u | unique
</code></pre></div></div>

<h3 id="applications-which-have-modified-a-firewall-rule">Applications which have modified a firewall rule</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$events=Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-Windows Firewall With Advanced Security/Firewall'; Id='2005'};
$output = @();
foreach ($Event in $events){
$data = New-Object -TypeName PSObject;
$XML = [xml]$Event.ToXml();
$RuleId=$XML.Event.EventData.Data|?{$_.Name -eq 'RuleId'} | Select -exp InnerText;
$RuleName=$XML.Event.EventData.Data|?{$_.Name -eq 'RuleName'} | Select -exp InnerText;
$Origin=$XML.Event.EventData.Data|?{$_.Name -eq 'Origin'} | Select -exp InnerText;
$ApplicationPath=$XML.Event.EventData.Data|?{$_.Name -eq 'ApplicationPath'} | Select -exp InnerText;
$ServiceName=$XML.Event.EventData.Data|?{$_.Name -eq 'ServiceName'} | Select -exp InnerText;
$Direction=$XML.Event.EventData.Data|?{$_.Name -eq 'Direction'} | Select -exp InnerText;
$Protocol=$XML.Event.EventData.Data|?{$_.Name -eq 'Protocol'} | Select -exp InnerText;
$LocalPorts=$XML.Event.EventData.Data|?{$_.Name -eq 'LocalPorts'} | Select -exp InnerText;
$RemotePorts=$XML.Event.EventData.Data|?{$_.Name -eq 'RemotePorts'} | Select -exp InnerText;
$Action=$XML.Event.EventData.Data|?{$_.Name -eq 'Action'} | Select -exp InnerText;
$Profiles=$XML.Event.EventData.Data|?{$_.Name -eq 'Profiles'} | Select -exp InnerText;
$LocalAddresses=$XML.Event.EventData.Data|?{$_.Name -eq 'LocalAddresses'} | Select -exp InnerText;
$RemoteAddresses=$XML.Event.EventData.Data|?{$_.Name -eq 'RemoteAddresses'} | Select -exp InnerText;
$RemoteMachineAuthorizationList=$XML.Event.EventData.Data|?{$_.Name -eq 'RemoteMachineAuthorizationList'} | Select -exp InnerText;
$RemoteUserAuthorizationList=$XML.Event.EventData.Data|?{$_.Name -eq 'RemoteUserAuthorizationList'} | Select -exp InnerText;
$EmbeddedContext=$XML.Event.EventData.Data|?{$_.Name -eq 'EmbeddedContext'} | Select -exp InnerText;
$Flags=$XML.Event.EventData.Data|?{$_.Name -eq 'Flags'} | Select -exp InnerText;
$EdgeTraversal=$XML.Event.EventData.Data|?{$_.Name -eq 'EdgeTraversal'} | Select -exp InnerText;
$LooseSourceMapped=$XML.Event.EventData.Data|?{$_.Name -eq 'LooseSourceMapped'} | Select -exp InnerText;
$SecurityOptions=$XML.Event.EventData.Data|?{$_.Name -eq 'SecurityOptions'} | Select -exp InnerText;
$ModifyingUser=$XML.Event.EventData.Data|?{$_.Name -eq 'ModifyingUser'} | Select -exp InnerText;
$ModifyingApplication=$XML.Event.EventData.Data|?{$_.Name -eq 'ModifyingApplication'} | Select -exp InnerText;
$SchemaVersion=$XML.Event.EventData.Data|?{$_.Name -eq 'SchemaVersion'} | Select -exp InnerText;
$RuleStatus=$XML.Event.EventData.Data|?{$_.Name -eq 'RuleStatus'} | Select -exp InnerText;
$LocalOnlyMapped=$XML.Event.EventData.Data|?{$_.Name -eq 'LocalOnlyMapped'} | Select -exp InnerText;
$data `
| Add-Member NoteProperty RuleId "$RuleId" -PassThru `
| Add-Member NoteProperty RuleName "$RuleName" -PassThru `
| Add-Member NoteProperty Origin "$Origin" -PassThru `
| Add-Member NoteProperty ApplicationPath "$ApplicationPath" -PassThru `
| Add-Member NoteProperty ServiceName "$ServiceName" -PassThru `
| Add-Member NoteProperty Direction "$Direction" -PassThru `
| Add-Member NoteProperty Protocol "$Protocol" -PassThru `
| Add-Member NoteProperty LocalPorts "$LocalPorts" -PassThru `
| Add-Member NoteProperty RemotePorts "$RemotePorts" -PassThru `
| Add-Member NoteProperty Action "$Action" -PassThru `
| Add-Member NoteProperty Profiles "$Profiles" -PassThru `
| Add-Member NoteProperty LocalAddresses "$LocalAddresses" -PassThru `
| Add-Member NoteProperty RemoteAddresses "$RemoteAddresses" -PassThru `
| Add-Member NoteProperty RemoteMachineAuthorizationList "$RemoteMachineAuthorizationList" -PassThru `
| Add-Member NoteProperty RemoteUserAuthorizationList "$RemoteUserAuthorizationList" -PassThru `
| Add-Member NoteProperty EmbeddedContext "$EmbeddedContext" -PassThru `
| Add-Member NoteProperty Flags "$Flags" -PassThru `
| Add-Member NoteProperty EdgeTraversal "$EdgeTraversal" -PassThru `
| Add-Member NoteProperty LooseSourceMapped "$LooseSourceMapped" -PassThru `
| Add-Member NoteProperty SecurityOptions "$SecurityOptions" -PassThru `
| Add-Member NoteProperty ModifyingUser "$ModifyingUser" -PassThru `
| Add-Member NoteProperty ModifyingApplication "$ModifyingApplication" -PassThru `
| Add-Member NoteProperty SchemaVersion "$SchemaVersion" -PassThru `
| Add-Member NoteProperty RuleStatus "$RuleStatus" -PassThru `
| Add-Member NoteProperty LocalOnlyMapped "$LocalOnlyMapped" -PassThru | Out-Null
$output += $data;
}
$output = $output
$output | select -exp ModifyingApplication | sort -u | unique
</code></pre></div></div>

<h3 id="applications-which-have-deleted-a-firewall-rule">Applications which have deleted a firewall rule</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$events=Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-Windows Firewall With Advanced Security/Firewall'; Id='2006'};
$output = @();
foreach ($Event in $events){
$data = New-Object -TypeName PSObject;
$XML = [xml]$Event.ToXml();
$RuleId=$XML.Event.EventData.Data|?{$_.Name -eq 'RuleId'} | Select -exp InnerText;
$RuleName=$XML.Event.EventData.Data|?{$_.Name -eq 'RuleName'} | Select -exp InnerText;
$ModifyingUser=$XML.Event.EventData.Data|?{$_.Name -eq 'ModifyingUser'} | Select -exp InnerText;
$ModifyingApplication=$XML.Event.EventData.Data|?{$_.Name -eq 'ModifyingApplication'} | Select -exp InnerText;
$data `
| Add-Member NoteProperty RuleId "$RuleId" -PassThru `
| Add-Member NoteProperty RuleName "$RuleName" -PassThru `
| Add-Member NoteProperty ModifyingUser "$ModifyingUser" -PassThru `
| Add-Member NoteProperty ModifyingApplication "$ModifyingApplication" -PassThru ` | Out-Null
$output += $data;
}
$output = $output
$output | select -exp ModifyingApplication | sort -u | unique
</code></pre></div></div>

<h3 id="pagefile-information">Pagefile information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wmic pagefile
</code></pre></div></div>

<h3 id="group-and-access-information">Group and access information</h3>

<p>(Accesschk requires accesschk64.exe or accesschk.exe from sysinternals):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>net localgroup
accesschk64 -a *
</code></pre></div></div>

<h3 id="cookies">Cookies</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\*\AppData\Local\Microsoft\Windows\INetCookies
C:\Users\*\AppData\Roaming\Microsoft\Windows\Cookies
C:\Users\*\AppData\Roaming\Microsoft\Windows\Cookies\Low
</code></pre></div></div>

<h3 id="recentdocs-information">RecentDocs Information</h3>

<p><a href="https://twitter.com/barnabyskeggs">Special thanks Barnaby Skeggs</a></p>

<p>*Note: Run with Powershell, get SID and user information with ‘wmic useraccount get name,SID’</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$SID = "S-1-5-21-1111111111-11111111111-1111111-11111"; $output = @(); Get-Item -Path "Registry::HKEY_USERS\$SID\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs" | Select-Object -ExpandProperty property | ForEach-Object {$i = [System.Text.Encoding]::Unicode.GetString((gp "Registry::HKEY_USERS\$SID\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs" -Name $_).$_); $i = $i -replace '[^a-zA-Z0-9 \.\-_\\/()~ ]', '\^'; $output += $i.split('\^')[0]}; $output | Sort-Object -Unique
</code></pre></div></div>

<p>More information on recent documents may be found:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\[username]\AppData\Local\Microsoft\Windows\FileHistory\Data
gci "REGISTRY::HKU\*\Software\Microsoft\Office\*\Word\Reading Locations\*"
</code></pre></div></div>

<h3 id="get-ntfs-file-streams-from-mounted-windows-drive-on-linux-os">Get NTFS File Streams from Mounted Windows Drive on Linux OS</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>getfattr -R -n ntfs.streams.list /mnt/[filepath]
</code></pre></div></div>

<h3 id="startup-process-information">Startup process information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wmic startup list full
wmic startup list brief
Get-CimInstance Win32_StartupCommand | Select-Object Name, command, Location, User | FL
</code></pre></div></div>

<h3 id="startup-process-information-by-pathfile-name">Startup process information by path/file name</h3>

<p>Note: This will search common persistence areas but not all of them, change the $Malware variable value to a term of your choosing.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$Malware = "appdata";
$Processes = gps |?{$_.Path -match $Malware -or $_.Name -match $Malware} | FL Name,Path,Id;
$Tasks = schtasks /query /fo csv /v | ConvertFrom-Csv | ?{"$_.Task To Run" -match $Malware}| FL "Taskname","Task To Run","Run As User";
$Services = gwmi win32_service | ? {$_.PathName -match $Malware}| FL Name,PathName;
$ServiceDLL = reg query HKLM\SYSTEM\CurrentControlSet\Services /s /v "ServiceDLL" | findstr "$Malware";
$RunKey1 = Get-ItemProperty -Path 'HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Run*' | ?{$_ -match $Malware};
$RunKey2 = Get-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run*' | ?{$_ -match $Malware};
$UserProfiles = (gwmi Win32_UserProfile | ? { $_.SID -notmatch 'S-1-5-(18|19|20).*' }); $paths = $UserProfiles.localpath; $sids = $UserProfiles.sid; for ($counter=0; $counter -lt $UserProfiles.length; $counter++){$path = $UserProfiles[$counter].localpath; $sid = $UserProfiles[$counter].sid; reg load hku\$sid $path\ntuser.dat};
$RunKey3 = Get-ItemProperty -Path Registry::HKU\*\SOFTWARE\Microsoft\Windows\CurrentVersion\Run* | ?{$_ -match $Malware};
$Startup = Select-String -Path 'C:\Users\*\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\*' -Pattern $Malware | Select Path;
$Startup2 = Select-String -Path 'C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\*' -Pattern $Malware | Select Path;
if ($Processes) {echo "Process Found!";$Processes} else {echo "No Running Processes Found."};
if ($Tasks) {echo "Tasks Found!";$Tasks} else {echo "No Tasks Found."};
if ($Services) {echo "Services Found!";$Services} else {echo "No Services Found."};
if ($ServiceDLL) {echo "ServiceDLL Found!";$ServiceDll} else {echo "No Service Dlls Found."};
if ($RunKey1) {echo "Wow6432Node Run Key Found!";$RunKey1} else {echo "No Local Machine Wow6432Node Run Key Found."};
if ($RunKey2) {echo "Local Machine Run Key Found!";$RunKey2} else {echo "No Local Machine Run Key Found."};
if ($RunKey3) {echo "User Run Key Found!";$RunKey3} else {echo "No User Run Key Found."};
if ($Startup) {echo "AppData Startup Link Found!";$Startup} else {echo "No AppData Startups Found."};
if ($Startup2) {echo "ProgramData Startup Link Found!";$Startup2} else {echo "No ProgramData Startups Found."};
</code></pre></div></div>

<h3 id="scheduled-taskjob-information">Scheduled task/job information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>at (For older OS)
schtasks
schtasks /query /fo LIST /v
schtasks /query /fo LIST /v | findstr "Task To Run:"
schtasks /query /fo LIST /v | findstr "appdata"
schtasks /query /fo LIST /v | select-string "Enabled" -CaseSensitive -Context 10,0 | findstr "exe"
schtasks /query /fo LIST /v | select-string "Enabled" -CaseSensitive -Context 10,0 | findstr "Task"
schtasks /query /fo LIST /v | Select-String "exe" -Context 2,27 
gci -path C:\windows\system32\tasks -recurse | Select-String Command | ? {$_.Line -match "EXENAME"} | FL Line, Filename
gci -path C:\windows\system32\tasks -recurse | where {$_.CreationTime -ge (get-date).addDays(-1)}|Select-String Command|FL Filename,Line
gci -path C:\windows\system32\tasks -recurse | where {$_.CreationTime -ge (get-date).addDays(-1)} | where {$_.CreationTime.hour -ge (get-date).hour-2}|Select-String Command|FL Line,Filename
schtasks /query /fo csv /v | ConvertFrom-Csv | ?{"$_.Task To Run" -match "MALICIOUS"}| FL "Taskname","Task To Run"
schtasks /query /fo csv /v | ConvertFrom-Csv | ?{$_.Taskname -ne "TaskName"} | FL "Taskname","Task To Run"
wmic job get Name, Owner, DaysOfMonth, DaysOfWeek, ElapsedTime, JobStatus, StartTime, Status
</code></pre></div></div>

<p>Powershell:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-ScheduledTask
gci -path C:\windows\system32\tasks -recurse | Select-String Command | FL Filename, Line
gci -path C:\windows\system32\tasks -recurse | Select-String "&lt;Command&gt;",Argument | FT Filename,Command,Line
gci -path C:\windows\system32\tasks -recurse | Select-String Command | ? {$_.Line -match "MALICIOUSNAME"} | FL Filename, Line
(gci -path C:\windows\system32\tasks -recurse | Select-String "&lt;Command&gt;" | select -exp Line).replace("&lt;Command&gt;","").trim("&lt;/Command&gt;").replace("`"","").trim();
</code></pre></div></div>

<h3 id="finding-shadow-hidden-scheduled-tasks">Finding ‘shadow’ hidden scheduled tasks</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci 'REGISTRY::HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tree' -rec -force | ?{$_.Property -notcontains 'SD'}
gci 'REGISTRY::HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tree' -rec -force | Get-ItemProperty | ?{$_.SD.length -lt 100}
</code></pre></div></div>

<h3 id="file-hash-and-location-of-all-scheduled-tasks">File hash and location of all scheduled tasks</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$a=((gci C:\windows\system32\tasks -rec | Select-String "&lt;Command&gt;" | select -exp Line).replace("&lt;Command&gt;","").trim("&lt;/Command&gt;").replace("`"","").trim());foreach ($b in $a){filehash ([System.Environment]::ExpandEnvironmentVariables($b))}
</code></pre></div></div>

<p>From System32 Directory:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$a=((gci tasks -rec | Select-String "&lt;Command&gt;" | select -exp Line).replace("&lt;Command&gt;","").trim("&lt;/Command&gt;").replace("`"","").trim());foreach ($b in $a){filehash ([System.Environment]::ExpandEnvironmentVariables($b))}
</code></pre></div></div>

<h3 id="remediate-malicious-scheduled-tasks">Remediate malicious scheduled tasks</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>schtasks /Delete /TN [taskname] /F
</code></pre></div></div>

<p>Powershell:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Unregister-ScheduledTask -TaskName [taskname]
Unregister-ScheduledTask -TaskPath [taskname]
</code></pre></div></div>

<h3 id="av-logs-evidence-of-malware-quarantine-etc">AV Logs (evidence of malware quarantine etc)</h3>

<p>Note: Special thanks to <a href="https://twitter.com/phillmoore">Phill Moore</a> who has put a lot of effort into this project.</p>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/av/">The RULER Project - AV</a></p>

<h3 id="remote-admin--remote-monitoring-and-management-rmm-tool-logs-evidence-of-rmm-tool-usage">Remote Admin / Remote Monitoring and Management (RMM) Tool Logs (evidence of RMM tool usage)</h3>

<p>Note: Special thanks to <a href="https://twitter.com/phillmoore">Phill Moore</a> who has put a lot of effort into this project.</p>

<h4 id="action1-rmm-usage-evidence">Action1 RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/Action1/">The RULER Project - Action1</a></p>

<h4 id="ammyadmin-rmm-usage-evidence">AmmyAdmin RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/AmmyAdmin/">The RULER Project - AmmyAdmin</a></p>

<h4 id="anydesk-rmm-usage-evidence">AnyDesk RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/AnyDesk/">The RULER Project - AnyDesk</a></p>

<h4 id="atera-rmm-usage-evidence">Atera RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/Atera/">The RULER Project - Atera</a></p>

<h4 id="citrix-gotomypc-rmm-usage-evidence">Citrix GoToMyPC RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/Citrix%20GoToMyPC/">The RULER Project - Citrix GoToMyPC</a></p>

<h4 id="kaseya-rmm-usage-evidence">Kaseya RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/Kaseya/">The RULER Project - Kaseya</a></p>

<h4 id="level-rmm-usage-evidence">Level RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/Level/">The RULER Project - Level</a></p>

<h4 id="logmein-rmm-usage-evidence">LogMeIn RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/LogMeIn/">The RULER Project - LogMeIn</a></p>

<h4 id="realvnc-rmm-usage-evidence">RealVNC RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/RealVNC/">The RULER Project - RealVNC</a></p>

<h4 id="splashtop-rmm-usage-evidence">Splashtop RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/Splashtop/">The RULER Project - Splashtop</a></p>

<h4 id="supremo-rmm-usage-evidence">SupRemo RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/SupRemo/">The RULER Project - SupRemo</a></p>

<h4 id="supremo-rmm-usage-evidence-1">SupRemo RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/SupRemo/">The RULER Project - SupRemo</a></p>

<h4 id="connectwisescreenconnect-rmm-usage-evidence">Connectwise/Screenconnect RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/Connectwise_Screenconnect/">The RULER Project - Connectwise/Screenconnect</a></p>

<h4 id="teamviewer-rmm-usage-evidence">TeamViewer RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/TeamViewer/">The RULER Project - TeamViewer</a></p>

<h4 id="tightvnc-rmm-usage-evidence">TightVNC RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/TightVNC/">The RULER Project - TightVNC</a></p>

<h4 id="ultravnc-rmm-usage-evidence">UltraVNC RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/UltraVNC/">The RULER Project - UltraVNC</a></p>

<h4 id="ultraviewer-rmm-usage-evidence">Ultraviewer RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/Ultraviewer/">The RULER Project - Ultraviewer</a></p>

<h4 id="xeox-rmm-usage-evidence">Xeox RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/Xeox/">The RULER Project - Xeox</a></p>

<h4 id="zohoassist-rmm-usage-evidence">ZohoAssist RMM Usage Evidence</h4>

<p><a href="https://ruler-project.github.io/ruler-project/RULER/remote/ZohoAssist/">The RULER Project - ZohoAssist</a></p>

<h3 id="iso-phishing-execution-evidence">ISO Phishing Execution Evidence</h3>

<p><a href="https://thedfirreport.com/2022/04/25/quantum-ransomware/">Special Thanks, created from intel by The DFIR Report</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-VHDMP-Operational';} | FL TimeCreated, Message
</code></pre></div></div>

<h3 id="msi-execution-evidence">MSI Execution Evidence</h3>

<p><a href="https://stackoverflow.com/questions/29937568/how-can-i-find-the-product-guid-of-an-installed-msi-setup/29937569#29937569">Special Thanks</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{LogName='Application';ProviderName='MsiInstaller'} | FL
gci REGISTRY::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\UserData\*\Products\*\InstallProperties -force
gci REGISTRY::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\UserData\*\Products\*\InstallProperties -force | Get-ItemProperty | FL PSPath, LocalPackage, InstallDate, InstallSource, ModifyPath, Publisher, DisplayName
get-wmiobject Win32_Product | Sort-Object -Property Name |Format-Table IdentifyingNumber, Name, LocalPackage -AutoSize
reg query HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\UserData\ /s /f .msi
</code></pre></div></div>

<h3 id="azure-run-command-evidence">Azure Run Command Evidence</h3>

<p><a href="https://github.com/AtomicGaryBusey/AzureForensics/blob/master/FORENSIC%20ARTIFACTS%20-%20Azure%20Run%20Command%20Extension%20Use.md">Special Thanks</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci C:\Packages\Plugins\Microsoft.CPlat.Core.RunCommandWindows\*\Status\
gci C:\Packages\Plugins\Microsoft.CPlat.Core.RunCommandWindows\*\RuntimeSettings\
gci C:\Packages\Plugins\Microsoft.CPlat.Core.RunCommandWindows\*\
</code></pre></div></div>

<p>Examine:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%SystemRoot%\System32\Winevt\Logs\Microsoft-WindowsAzure-Status%4Plugins.evtx
</code></pre></div></div>

<h3 id="uac-bypass-fodhelper">UAC Bypass Fodhelper</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKCU\Software\Classes\ms-settings\shell\open\command
reg query HKU\{SID}\Software\Classes\ms-settings\shell\open\command
</code></pre></div></div>

<h3 id="quick-overview-of-persistent-locations-autoruns"><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/autoruns">Quick overview of persistent locations (AutoRuns)</a></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>autorunsc.exe -accepteula -a * -c -h -v -m &gt; autoruns.csv
autorunsc.exe -accepteula -a * -c -h -v -m -z 'E:\Windows' &gt; autoruns.csv
</code></pre></div></div>

<h3 id="persistence-and-automatic-loadrun-reg-keys">Persistence and Automatic Load/Run Reg Keys</h3>
<p><em>Replace: “reg query” with “Get-ItemProperty -Path HK</em>:" in Powershell*</p>

<p>e.g.: Get-Item -Path HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</p>

<p><strong>User Registry (NTUSER.DAT HIVE)</strong> - Commonly located at:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\[username]
</code></pre></div></div>

<p>*Note: These are setup for querying the current users registry only (HKCU), to query others you will need to load them from the relevant NTUSER.DAT file and then query them.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"
reg query "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce"
reg query "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnceEx"
reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\StartupApproved\Run"
reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\StartupApproved\Run32"
reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\StartupApproved\StartupFolder"
reg query "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run"
reg query "HKCU\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows" /f run
reg query "HKCU\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows" /f load
reg query "HKCU\Environment" /v UserInitMprLogonScript
reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Run" /v RESTART_STICKY_NOTES
reg query "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders"
reg query "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Windows\Scripts"
reg query "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\RecentDocs"
reg query "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\RunMRU"
reg query "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\RunMRU"
reg query "HKCU\SOFTWARE\AcroDC"
reg query "HKCU\SOFTWARE\Itime"
reg query "HKCU\SOFTWARE\info"
reg query "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\User Shell Folders"
reg query "HKCU\SOFTWARE\Microsoft\Command Processor"
reg query "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Applets\RegEdit" /v LastKey
reg query "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSavePidlMRU" /s
reg query "HKCU\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v Shell
reg query "HKCU\SOFTWARE\Microsoft\Windows\currentversion\run"
reg query "HKCU\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Microsoft\Windows\CurrentVersion\Run"
reg query "HKCU\Software\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Microsoft\Windows\CurrentVersion\RunOnce"
reg query "HKCU\SOFTWARE\Microsoft\Active Setup\Installed Components\[Random]\StubPath" /s
reg query "HKCU\SOFTWARE\Wow6432Node\Microsoft\Active Setup\Installed Components\[Random]\StubPath" /s
reg query "HKCU\SOFTWARE\Microsoft\Office\[officeversion]\[word/excel/access etc]\Security\AccessVBOM"
reg query "HKCU\SOFTWARE\Microsoft\IEAK\GroupPolicy\PendingGPOs" /s
reg query "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Control Panel\CPLs"
reg query "HKCU\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Control Panel\CPLs"
	reg query "HKCU\SOFTWARE\Microsoft\Office\15.0\Excel\Security\AccessVBOM
	reg query "HKCU\SOFTWARE\Microsoft\Office\15.0\Word\Security\AccessVBOM
	reg query "HKCU\SOFTWARE\Microsoft\Office\15.0\Powerpoint\Security\AccessVBOM
	reg query "HKCU\SOFTWARE\Microsoft\Office\15.0\Access\Security\AccessVBOM
</code></pre></div></div>

<p><strong>Local Machine (SOFTWARE HIVE)</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce"
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnceEx"
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunServicesOnce"
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunServices"
reg query "HKLM\SOFTWARE\Policies\Microsoft\Windows\System\Scripts"
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows" /f AppInit_DLLs
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run"
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v Userinit
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options" /s
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit" /s
reg query "HKLM\SOFTWARE\wow6432node\Microsoft\Windows\CurrentVersion\policies\explorer\run"
reg query "HKLM\SOFTWARE\wow6432node\Microsoft\Windows\CurrentVersion\run"
reg query "HKLM\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows"
reg query "HKLM\SOFTWARE\Microsoft\Office\[officeversion]\[word/excel/access etc]\Security\AccessVBOM"
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\StartupApproved\Run"
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\StartupApproved\Run32"
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\StartupApproved\StartupFolder"
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AeDebug"
reg query "HKLM\SOFTWARE\Microsoft\Active Setup\Installed Components\[Random]\StubPath" /s
reg query "HKLM\SOFTWARE\Wow6432Node\Microsoft\Active Setup\Installed Components\[Random]\StubPath" /s
reg query "HKLM\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Control Panel\CPLs"
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Control Panel\CPLs"
	reg query "HKLM\SOFTWARE\Microsoft\Office\15.0\Excel\Security\AccessVBOM
	reg query "HKLM\SOFTWARE\Microsoft\Office\15.0\Word\Security\AccessVBOM
	reg query "HKLM\SOFTWARE\Microsoft\Office\15.0\Powerpoint\Security\AccessVBOM
	reg query "HKLM\SOFTWARE\Microsoft\Office\15.0\Access\Security\AccessVBOM
</code></pre></div></div>

<p>Don’t be afraid to use “findstr” or ‘/f’ to find entries of interest, for example file extensions which may also invoke malicious executables when run, or otherwise.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SOFTWARE\Classes" | findstr "file"
reg query "HKLM\SOFTWARE\Classes" /f "file"
reg query HKCR\CLSID\{AB8902B4-09CA-4bb6-B78D-A8F59079A8D5} /s
reg query HKCR\AppID\ /s | findstr "exe"
</code></pre></div></div>

<p><strong>Local Machine (SYSTEM HIVE)</strong></p>

<p>Note: This not only contains services, but also malicious drivers which may run at startup (these are in the form of “.sys” files and are generally loaded from here: \SystemRoot\System32\drivers)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SYSTEM\CurrentControlSet\Services\[Random_name]\imagePath"
reg query "HKLM\SYSTEM\CurrentControlSet\Services\ /s /f "*.exe"
reg query "HKLM\SYSTEM\CurrentControlSet\Services" /s /v ImagePath /f "*.exe"
reg query "HKLM\SYSTEM\CurrentControlSet\Services" /s /v ImagePath /f "*.sys"
reg query "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager" /v BootExecute
Get-Service -Name "*MALICIOUSSERVICE*"
gwmi win32_service | ? {$_.PathName -match "MALICIOUSSERVICE"}|FL Name,PathName
Get-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Services\*" | FL DisplayName,ImagePath,ObjectName
gci -Path C:\Windows\system32\drivers -include *.sys -recurse -ea 0 -force | Get-AuthenticodeSignature
gci -Path C:\Windows\system32\drivers -include *.sys -recurse -ea 0 -force | Get-FileHash
</code></pre></div></div>

<p>Note: Some useful commands to show relevant service information</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\SYSTEM\CurrentControlSet\Services /s /v "ImagePath"
reg query HKLM\SYSTEM\CurrentControlSet\Services /s /v "ServiceDLL"
reg query HKLM\SYSTEM\CurrentControlSet\Services /s /v "FailureCommand"
</code></pre></div></div>

<h3 id="t1015-accessibility-features">T1015 Accessibility Features</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe" /v "Debugger"
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\utilman.exe" /v "Debugger"
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\AtBroker.exe" /v "Debugger"
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\Narrator.exe" /v "Debugger"
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\Magnify.exe" /v "Debugger"
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\DisplaySwitch.exe" /v "Debugger"
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\osk.exe" /v "Debugger"
sfc /VERIFYFILE=C:\Windows\System32\sethc.exe
sfc /VERIFYFILE=C:\Windows\System32\utilman.exe
sfc /VERIFYFILE=C:\Windows\System32\AtBroker.exe
sfc /VERIFYFILE=C:\Windows\System32\Narrator.exe
sfc /VERIFYFILE=C:\Windows\System32\Magnify.exe
sfc /VERIFYFILE=C:\Windows\System32\DisplaySwitch.exe
sfc /VERIFYFILE=C:\Windows\System32\osk.exe
</code></pre></div></div>

<h3 id="t1098-account-manipulation">T1098 Account Manipulation</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h3 id="t1182-appcert-dlls">T1182 AppCert DLLs</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\System\CurrentControlSet\Control\Session Manager" /v AppCertDlls
</code></pre></div></div>

<h3 id="t1103-appinit-dlls">T1103 AppInit DLLs</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Windows" /v Appinit_Dlls
reg query "HKLM\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows" /v Appinit_Dlls
reg query "HKU\{SID}\Software\Microsoft\Windows NT\CurrentVersion\Windows" /v Appinit_Dlls
reg query "HKU\{SID}\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows" /v Appinit_Dlls
Get-WinEvent -FilterHashtable @{ LogName='System'; Id='11'} | FL TimeCreated,Message
</code></pre></div></div>

<h3 id="t1138-application-shimming">T1138 Application Shimming</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Custom"
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\InstalledSDB"
dir %WINDIR%\AppPatch\custom
dir %WINDIR%\AppPatch\AppPatch64\Custom
Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Kernel-ShimEngine/Operational';}|FL
</code></pre></div></div>

<p>Note: Some other similar methods exist such as abusing the ‘Command’ value of <a href="https://www.trustedsec.com/blog/abusing-windows-telemetry-for-persistence/">Windows Telemetry Controller - Special Thanks to TrustedSec</a>.</p>

<p>Hint: Look for a Command not pointing to “CompatTelRunner.exe” or which has ‘-cv’, ‘-oobe’, or ‘-fullsync’ in the command line.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\TelemetryController" /s
</code></pre></div></div>

<h3 id="t1197-bits-jobs">T1197 BITS Jobs</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bitsadmin /list /allusers /verbose
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-Bits-Client/Operational'; Id='59'} | FL TimeCreated,Message
ls 'C:\ProgramData\Microsoft\Network\Downloader\qmgr.db'
</code></pre></div></div>

<h3 id="t1067-bootkit">T1067 Bootkit</h3>

<p>Note: This exists below the OS in the Master Boot Record or Volume Boot Record. The system must be booted through Advanced Startup Options with a Command Prompt, or through a recovery cd.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bootrec /FIXMBR
bootrec /FIXBOOT
</code></pre></div></div>

<p>Extra: If your boot configuration data is missing or contains errors the below can fix this.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bootrec /REBUILDBCD
</code></pre></div></div>

<p>If you’re thinking of a bootkit more as a rootkit (malicious system drivers) you can go with the below.</p>

<h4 id="general-driver-enumeration">General Driver Enumeration</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci C:\Windows\*\DriverStore\FileRepository\ -recurse -include *.inf | FL FullName,LastWriteTime,LastWriteTimeUtc
gci -path C:\Windows\System32\drivers -include *.sys -recurse -ea SilentlyContinue
reg query HKEY_LOCAL_MACHINE\DRIVERS\DriverDatabase\DriverPackages\ /s /f Provider
sc.exe query type=driver state=all
</code></pre></div></div>

<h4 id="unsigned-drivers">Unsigned Drivers</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-CodeIntegrity/Operational'; Id='3001'} | FL TimeCreated,Message
gci -path C:\Windows\System32\drivers -include *.sys -recurse -ea SilentlyContinue | Get-AuthenticodeSignature | where {$_.status -ne 'Valid'}
</code></pre></div></div>

<h4 id="previous-unusual-loaded-filter-drivers-often-used-by-rootkits">Previous Unusual Loaded Filter Drivers (Often used by rootkits)</h4>

<p>Note: This will likely have false positives, particularly relating to filter drivers which are used by AV products, EDR solutions, or otherwise.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$FilterEvents = Get-WinEvent -FilterHashtable @{LogName='System'; ProviderName="Microsoft-Windows-FilterManager"} | ForEach-Object {
	[PSCustomObject] @{
		TimeCreated = $_.TimeCreated
		MachineName = $_.MachineName
		UserId = $_.UserId
		FilterDriver = $_.Properties[4].Value
        Message = $_.Message
	}
}
echo "Scanning for suspicious filter drivers. Any found will be displayed below:"
$FilterEvents | sort TimeCreated | where-object {$_.FilterDriver -ine "FileInfo" -AND $_.FilterDriver -ine "WdFilter" -AND $_.FilterDriver -ine "storqosflt" -AND $_.FilterDriver -ine "wcifs" -AND $_.FilterDriver -ine "CldFlt" -AND $_.FilterDriver -ine "FileCrypt" -AND $_.FilterDriver -ine "luafv" -AND $_.FilterDriver -ine "npsvctrig" -AND $_.FilterDriver -ine "Wof" -AND $_.FilterDriver -ine "FileInfo" -AND $_.FilterDriver -ine "bindflt" -AND $_.FilterDriver -ine "PROCMON24" -AND $_.FilterDriver -ine "FsDepends" -AND $_.FilterDriver -ine "SysmonDrv"}
</code></pre></div></div>

<p>Or, filter by unique drivers:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$FilterEvents = Get-WinEvent -FilterHashtable @{LogName='System'; ProviderName="Microsoft-Windows-FilterManager"} | ForEach-Object {
	[PSCustomObject] @{
		TimeCreated = $_.TimeCreated
		MachineName = $_.MachineName
		UserId = $_.UserId
		FilterDriver = $_.Properties[4].Value
		Message = $_.Message
	}
}
echo "Scanning for suspicious filter drivers. Any found will be displayed below:"
$FilterEvents | sort FilterDriver -Unique | where-object {$_.FilterDriver -ine "FileInfo" -AND $_.FilterDriver -ine "WdFilter" -AND $_.FilterDriver -ine "storqosflt" -AND $_.FilterDriver -ine "wcifs" -AND $_.FilterDriver -ine "CldFlt" -AND $_.FilterDriver -ine "FileCrypt" -AND $_.FilterDriver -ine "luafv" -AND $_.FilterDriver -ine "npsvctrig" -AND $_.FilterDriver -ine "Wof" -AND $_.FilterDriver -ine "FileInfo" -AND $_.FilterDriver -ine "bindflt" -AND $_.FilterDriver -ine "PROCMON24" -AND $_.FilterDriver -ine "FsDepends" -AND $_.FilterDriver -ine "SysmonDrv"}
</code></pre></div></div>

<h4 id="unusual-loaded-filter-drivers-no-longer-present-or-filtering-registry-keys">Unusual Loaded Filter Drivers (No longer present or filtering registry keys)</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$FilterEvents = Get-WinEvent -FilterHashtable @{LogName='System'; ProviderName="Microsoft-Windows-FilterManager"} | ForEach-Object {
	[PSCustomObject] @{
		TimeCreated = $_.TimeCreated
		MachineName = $_.MachineName
		UserId = $_.UserId
		FilterDriver = $_.Properties[4].Value
		Message = $_.Message
	}
}
echo "Scanning for suspicious filter drivers. Any found will be compared against existing services."
echo "Suspicious filter drivers found:"
echo ""
$SuspectDrivers = $($FilterEvents | sort FilterDriver -Unique | where-object {$_.FilterDriver -ine "FileInfo" -AND $_.FilterDriver -ine "WdFilter" -AND $_.FilterDriver -ine "storqosflt" -AND $_.FilterDriver -ine "wcifs" -AND $_.FilterDriver -ine "CldFlt" -AND $_.FilterDriver -ine "FileCrypt" -AND $_.FilterDriver -ine "luafv" -AND $_.FilterDriver -ine "npsvctrig" -AND $_.FilterDriver -ine "Wof" -AND $_.FilterDriver -ine "FileInfo" -AND $_.FilterDriver -ine "bindflt" -AND $_.FilterDriver -ine "PROCMON24" -AND $_.FilterDriver -ine "FsDepends" -AND $_.FilterDriver -ine "SysmonDrv"} | select -exp FilterDriver)
foreach ($driver in $SuspectDrivers){
Write-Warning "Unknown Driver Found - $driver"
}
echo ""
foreach ($driver in $SuspectDrivers){
echo "Checking $driver for relevant service. Any which aren't present may indicate a filter driver which has since been removed, or an active rootkit filtering service registry keys."
try{gci REGISTRY::HKLM\SYSTEM\CurrentControlSet\Services\$driver -force -ErrorAction Stop}Catch{Write-Warning "$driver NOT FOUND"}
}
</code></pre></div></div>

<h4 id="safe-boot-registry-keys">Safe Boot registry keys</h4>

<p>Special Thanks - <a href="https://blog.didierstevens.com/2007/02/19/restoring-safe-mode-with-a-reg-file/">Didier Stevens</a>, <a href="https://blog.didierstevens.com/2006/06/22/save-safeboot/">multiple times</a></p>

<p>Note: These keys specify what services are run in Safe Mode. Sometimes they’ll be modified by malware to ensure rootkits can still function in Safe Mode.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot
reg query HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot\Minimal /s
reg query HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot\Network /s
</code></pre></div></div>

<h4 id="unload-malicious-filter-driver">Unload malicious filter driver</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fltmc filters
fltmc volumes
fltmc instances
fltmc unload [filtername]
fltmc detach [filtername] [volumeName] [instanceName]
</code></pre></div></div>

<p>Note: Common legitimate filter drivers include</p>

<ul>
  <li>WdFilter – Windows Defender Filter</li>
  <li>storqosflt - Storage QoS Filter</li>
  <li>wcifs - Windows Container Isolation File System Filter</li>
  <li>CldFlt - Windows Cloud Files Filter</li>
  <li>FileCrypt - Windows Sandboxing and Encryption Filter</li>
  <li>luafv – LUA File Virtualization Filter (UAC)</li>
  <li>npsvctrig – Named Pipe Service Trigger Provider Filter</li>
  <li>Wof – Windows Overlay Filter</li>
  <li>FileInfo – FileInfo Filter (SuperFetch)</li>
  <li>bindflt - Windows Bind Filter system driver</li>
  <li>FsDepends - File System Dependency Minifilter</li>
  <li>PROCMON24 - Procmon Process Monitor Driver</li>
</ul>

<h3 id="t1176-browser-extensions">T1176 Browser Extensions</h3>

<h4 id="chrome">Chrome</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-ChildItem -path "C:\Users\*\AppData\Local\Google\Chrome\User Data\Default\Extensions" -recurse -erroraction SilentlyContinue
Get-ChildItem -path 'C:\Users\*\AppData\Local\Google\Chrome\User Data\Default\Extensions' -recurse -erroraction SilentlyContinue -include manifest.json | cat
reg query "HKLM\Software\Google\Chrome\Extensions" /s
reg query "HKLM\Software\Wow6432Node\Google\Chrome\Extensions" /s
</code></pre></div></div>

<h4 id="firefox">Firefox</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-ChildItem -path "C:\Users\*\AppData\Roaming\Mozilla\Firefox\Profiles\*\extensions" -recurse -erroraction SilentlyContinue
Get-ChildItem -path "C:\Program Files\Mozilla Firefox\plugins\" -recurse -erroraction SilentlyContinue
Get-ChildItem -path registry::HKLM\SOFTWARE\Mozilla\*\extensions
</code></pre></div></div>

<h4 id="edge">Edge</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-ChildItem -Path C:\Users\*\AppData\Local\Packages\ -recurse -erroraction SilentlyContinue
</code></pre></div></div>

<h4 id="internet-explorer">Internet Explorer</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-ChildItem -path "C:\Program Files\Internet Explorer\Plugins\" -recurse -erroraction SilentlyContinue
reg query 'HKLM\Software\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects'
reg query 'HKLM\Software\Microsoft\Internet Explorer\Toolbar'
reg query 'HKLM\Software\Microsoft\Internet Explorer\URLSearchHooks'
reg query 'HKLM\Software\Microsoft\Internet Explorer\Explorer Bars'
reg query 'HKU\{SID}\Software\Microsoft\Internet Explorer\Explorer Bars'
reg query 'HKLM\SOFTWARE\Microsoft\Internet Explorer\Extensions'
</code></pre></div></div>

<h3 id="t1109-component-firmware">T1109 Component Firmware</h3>

<p>Note: This is incredibly rare, and doesn’t have an easy detection/remediation mechanism. Using the Windows CheckDisk utility, System File Checker, or Deployment Image Servicing and Management may assist but isn’t guaranteed.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chkdsk /F
sfc /scannow
dism /Online /Cleanup-Image /ScanHealth
dism /Online /Cleanup-Image /RestoreHealth
dism /Online /Cleanup-Image /StartComponentCleanup /ResetBase
</code></pre></div></div>

<h3 id="t1122-component-object-model-com-hijacking">T1122 Component Object Model (COM) Hijacking</h3>

<p>Note: This involves replacing legitimate components with malicious ones, and as such the legitimate components will likely no longer function. 
If you have a detection based on DLLHost.exe with /Processid:{xyz}, you can match xyz with the CLSID (COM Class Object) or AppID mentioned below to check for any malicious EXE or DLL.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HKLM\SOFTWARE\Classes\WOW6432Node\CLSID\{abc} /v AppID /t REG_SZ /d {xyz}
HKLM\SOFTWARE\Classes\CLSID\{abc} /v AppID /t REG_SZ /d {xyz}
HKLM\SOFTWARE\Classes\AppID\{xyz}
HKLM\SOFTWARE\Classes\WOW6432Node\AppID\{xyz}
HKLM\SOFTWARE\WOW6432Node\Classes\AppID\{xyz}
</code></pre></div></div>

<p>Example analysis:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SOFTWARE\Classes\WOW6432Node\CLSID" /s /f "{973D20D7-562D-44B9-B70B-5A0F49CCDF3F}"
reg query "HKLM\SOFTWARE\Classes\WOW6432Node\CLSID\{178167bc-4ee3-403e-8430-a6434162db17}" /s
reg query "HKLM\SOFTWARE\Classes\AppID\{973D20D7-562D-44B9-B70B-5A0F49CCDF3F}"
</code></pre></div></div>

<p>Queries:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\SOFTWARE\Classes\CLSID\ /s /f ".dll"
reg query HKLM\SOFTWARE\Classes\CLSID\ /s /f ".exe"
reg query HKLM\SOFTWARE\Classes\AppID\ /s /f DllSurrogate
gci -path REGISTRY::HKLM\SOFTWARE\Classes\*\shell\open\command 
reg query HKU\{SID}\SOFTWARE\Classes\CLSID\ /s /f ".dll"
reg query HKU\{SID}\SOFTWARE\Classes\CLSID\ /s /f ".exe"
gci 'REGISTRY::HKU\*\Software\Classes\CLSID\*\TreatAs'
gci 'REGISTRY::HKU\*\Software\Classes\Scripting.Dictionary'
gci "REGISTRY::HKU\*\SOFTWARE\Classes\CLSID\*\LocalServer32" -ea 0
gci "REGISTRY::HKU\*\SOFTWARE\Classes\CLSID\*\InprocServer32" -ea 0
gci "REGISTRY::HKU\*\SOFTWARE\Classes\CLSID\*\InprocHandler*" -ea 0
gci "REGISTRY::HKU\*\SOFTWARE\Classes\CLSID\*\*Server32" -ea 0
gci "REGISTRY::HKU\*\SOFTWARE\Classes\CLSID\*\ScriptletURL" -ea 0
reg query HKU\{SID}\SOFTWARE\Classes\CLSID\ /s /f "ScriptletURL"
</code></pre></div></div>

<h4 id="get-list-of-all-com-objects">Get list of all COM Objects</h4>

<p><a href="https://stackoverflow.com/questions/660319/where-can-i-find-all-of-the-com-objects-that-can-be-created-in-powershell">Original by Jeff Atwood</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci HKLM:\Software\Classes -ea 0| ? {$_.PSChildName -match '^\w+\.\w+$' -and(gp "$($_.PSPath)\CLSID" -ea 0)} | select -ExpandProperty PSChildName
</code></pre></div></div>

<h3 id="t1136-create-account">T1136 Create Account</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>net user
net user /domain
reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts" /s
</code></pre></div></div>

<h3 id="t1038-dll-search-order-hijacking">T1038 DLL Search Order Hijacking</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\KnownDLLs"
gci -path C:\Windows\* -include *.dll | Get-AuthenticodeSignature | Where-Object Status -NE "Valid"
gci -path C:\Windows\System32\* -include *.dll | Get-AuthenticodeSignature | Where-Object Status -NE "Valid"
gps | FL ProcessName, @{l="Modules";e={$_.Modules|Out-String}}
gps | ? {$_.Modules -like '*{DLLNAME}*'} | FL ProcessName, @{l="Modules";e={$_.Modules|Out-String}}
$dll = gps | Where {$_.Modules -like '*{DLLNAME}*' } | Select Modules;$dll.Modules;
(gps).Modules.FileName
(gps).Modules | FL FileName,FileVersionInfo
(gps).Modules.FileName | get-authenticodesignature | ? Status -NE "Valid"
</code></pre></div></div>

<h3 id="t1133-external-remote-services">T1133 External Remote Services</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h3 id="t1044-file-system-permissions-weakness">T1044 File System Permissions Weakness</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WmiObject win32_service | FL name,PathName
get-acl "C:\Program Files (x86)\Google\Update\GoogleUpdate.exe" | FL | findstr "FullControl"
</code></pre></div></div>

<h3 id="t1158-hidden-files-and-directories">T1158 Hidden Files and Directories</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dir /S /A:H
</code></pre></div></div>

<h3 id="t1179-hooking">T1179 Hooking</h3>

<h4 id="finding-easyhook-injection">Finding EasyHook Injection</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tasklist /m EasyHook32.dll;tasklist /m EasyHook64.dll;tasklist /m EasyLoad32.dll;tasklist /m EasyLoad64.dll;
</code></pre></div></div>

<p>More Material:</p>

<ul>
  <li><a href="https://github.com/jay/gethooks/releases/tag/1.01">GetHooks</a></li>
</ul>

<h3 id="t1062-hypervisor">T1062 Hypervisor</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h3 id="t1183-image-file-execution-options-injection">T1183 Image File Execution Options Injection</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit" /s /f "MonitorProcess"
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options" /s /f "Debugger"
</code></pre></div></div>

<h3 id="t1037-logon-scripts">T1037 Logon Scripts</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKU\{SID}\Environment" /v UserInitMprLogonScript
</code></pre></div></div>

<h3 id="t1177-lsass-driver">T1177 LSASS Driver</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4614';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='3033';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='3063';} | FL TimeCreated,Message
</code></pre></div></div>

<h3 id="t1031-modify-existing-service">T1031 Modify Existing Service</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\SYSTEM\CurrentControlSet\Services /s /v "ImagePath"
reg query HKLM\SYSTEM\CurrentControlSet\Services /s /v "ServiceDLL"
reg query HKLM\SYSTEM\CurrentControlSet\Services /s /v "FailureCommand"
Get-ItemProperty REGISTRY::HKLM\SYSTEM\CurrentControlSet\Services\*\* -ea 0 | where {($_.ServiceDll -ne $null)} | foreach {filehash $_.ServiceDll}
Get-ItemProperty REGISTRY::HKLM\SYSTEM\CurrentControlSet\Services\*\* -ea 0 | where {($_.ServiceDll -ne $null)} | select -uniq ServiceDll -ea 0 | foreach {filehash $_.ServiceDll} | select -uniq -exp hash
</code></pre></div></div>

<h3 id="t1128-netsh-helper-dll">T1128 Netsh Helper DLL</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\SOFTWARE\Microsoft\Netsh
</code></pre></div></div>

<h3 id="t1050-new-service">T1050 New Service</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\SYSTEM\CurrentControlSet\Services /s /v "ImagePath"
reg query HKLM\SYSTEM\CurrentControlSet\Services /s /v "ServiceDLL"
reg query HKLM\SYSTEM\CurrentControlSet\Services /s /v "FailureCommand"
Get-WmiObject win32_service | FL Name, DisplayName, PathName, State
Get-WinEvent -FilterHashtable @{ LogName='System'; Id='7045';} | FL TimeCreated,Message
</code></pre></div></div>

<p>Note: If not examining the registry directly and looking at services in a ‘live’ capacity you may encounter ‘hidden services’ which aren’t shown due to a SDDL applied to them. You can find solely these services using the following (<a href="https://gist.github.com/joswr1ght/c5d9773a90a22478309e9e427073fd30">Special thanks - Josh Wright</a>)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Compare-Object -ReferenceObject (Get-Service | Select-Object -ExpandProperty Name | % { $_ -replace "_[0-9a-f]{2,8}$" } ) -DifferenceObject (gci -path hklm:\system\currentcontrolset\services | % { $_.Name -Replace "HKEY_LOCAL_MACHINE\\","HKLM:\" } | ? { Get-ItemProperty -Path "$_" -name objectname -erroraction 'ignore' } | % { $_.substring(40) }) -PassThru | ?{$_.sideIndicator -eq "=&gt;"}
</code></pre></div></div>

<p>Some common legitimate hidden services are:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WUDFRd
WUDFWpdFs
WUDFWpdMtp
</code></pre></div></div>

<h3 id="t1137-office-application-startup">T1137 Office Application Startup</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-ChildItem -path C:\Users\*\Microsoft\*\STARTUP\*.dotm -force
Get-ChildItem -path C:\Users\*\AppData\Roaming\Microsoft\*\STARTUP\* -force
reg query "HKU\{SID}\Software\Microsoft\Office test\Special\Perf" /s
reg query "HKLM\Software\Microsoft\Office test\Special\Perf" /s
Get-ChildItem -path registry::HKLM\SOFTWARE\Microsoft\Office\*\Addins\*
Get-ChildItem -path registry::HKLM\SOFTWARE\Wow6432node\Microsoft\Office\*\Addins\*
Get-ChildItem -path registry::HKLM\SOFTWARE\Wow6432node\Microsoft\Office\*\Addins\*
Get-ChildItem -path "C:\Users\*\AppData\Roaming\Microsoft\Templates\*" -erroraction SilentlyContinue
Get-ChildItem -path "C:\Users\*\AppData\Roaming\Microsoft\Excel\XLSTART\*" -erroraction SilentlyContinue
Get-ChildItem -path C:\ -recurse -include Startup -ea 0
ls 'C:\Program Files\Microsoft Office\root\*\XLSTART\*'
ls 'C:\Program Files\Microsoft Office\root\*\STARTUP\*'
reg query HKCU\Software\Microsoft\Office\[Outlook Version]\Outlook\WebView\Inbox
reg query HKCU\Software\Microsoft\Office\[Outlook Version]\Outlook\Security
reg query HKCU\Software\Microsoft\Office\[Outlook Version]\Outlook\Today\UserDefinedUrl
reg query HKCU\Software\Microsoft\Office\[Outlook Version]\Outlook\WebView\Calendar\URL
Get-WinEvent -FilterHashtable @{ LogName='Microsoft Office Alerts'; Id='300';} | FL TimeCreated,Message
</code></pre></div></div>

<h3 id="t1034-path-interception">T1034 Path Interception</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h3 id="t1013-port-monitors">T1013 Port Monitors</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SYSTEM\CurrentControlSet\Control\Print\Monitors" /s /v "Driver"
</code></pre></div></div>

<h3 id="t1504-powershell-profile">T1504 PowerShell Profile</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls C:\Windows\System32\WindowsPowerShell\v1.0\Profile.ps1
ls C:\Windows\System32\WindowsPowerShell\v1.0\Microsoft.*Profile.ps1
ls C:\Windows\System32\WindowsPowerShell\v1.0\Microsoft.*Profile.ps1
gci -path "C:\Users\*\Documents\PowerShell\Profile.ps1"
gci -path "C:\Users\*\Documents\PowerShell\Microsoft.*Profile.ps1"
</code></pre></div></div>

<h3 id="t1108-redundant-access">T1108 Redundant Access</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h3 id="t1060-registry-run-keys--startup-folder">T1060 Registry Run Keys / Startup Folder</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKU\{SID}\Software\Microsoft\Windows\CurrentVersion\Run"
reg query "HKU\{SID}\Software\Microsoft\Windows\CurrentVersion\RunOnce"
reg query "HKU\{SID}\Software\Microsoft\Windows\CurrentVersion\RunOnceEx"
reg query "HKLM\Software\Microsoft\Windows\CurrentVersion\Run"
reg query "HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce"
reg query "HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnceEx"
reg query "HKU\{SID}\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders"
reg query "HKU\{SID}\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders"
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders"
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders"
reg query "HKLM\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce"
reg query "HKU\{SID}\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce"
reg query "HKLM\Software\Microsoft\Windows\CurrentVersion\RunServices"
reg query "HKU\{SID}\Software\Microsoft\Windows\CurrentVersion\RunServices"
reg query "HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run"
reg query "HKU\{SID}\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run"
reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon" /v Userinit
reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon" /v Shell
reg query "HKU\{SID}\Software\Microsoft\Windows NT\CurrentVersion\Windows"
reg query "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager" /v BootExecute
gci -path "C:\Users\*\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\*" -include *.lnk,*.url
gci -path "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\*" -include *.lnk,*.url
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-Shell-Core/Operational'; Id='9707'} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-Shell-Core/Operational'; Id='9708'} | FL TimeCreated,Message
</code></pre></div></div>

<h3 id="t1053-scheduled-task">T1053 Scheduled Task</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci -path C:\windows\system32\tasks | Select-String Command | FT Line, Filename
gci -path C:\windows\system32\tasks -recurse | where {$_.CreationTime -ge (get-date).addDays(-1)} | Select-String Command | FL Filename,Line
gci -path C:\windows\system32\tasks -recurse | where {$_.CreationTime -ge (get-date).addDays(-1)} | where {$_.CreationTime.hour -ge (get-date).hour-2}| Select-String Command | FL Line,Filename
gci -path 'registry::HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks\'
gci -path 'registry::HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tree\'
ls 'C:\Windows\System32\WptsExtensions.dll'
</code></pre></div></div>

<p>Note: thanks to <a href="https://twitter.com/markus_pieton/status/1189559716453801991">Markus Piéton</a> for the WptsExtensions.dll one.</p>

<h3 id="t1180-screensaver">T1180 Screensaver</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKU\{SID}\Control Panel\Desktop" /s /v "ScreenSaveActive"
reg query "HKU\{SID}\Control Panel\Desktop" /s /v "SCRNSAVE.exe"
reg query "HKU\{SID}\Control Panel\Desktop" /s /v "ScreenSaverIsSecure"
</code></pre></div></div>

<h3 id="t1101-security-support-provider">T1101 Security Support Provider</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SYSTEM\CurrentControlSet\Control\Lsa\OSConfig" /v "Security Packages"
reg query "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" /v "Security Packages"
</code></pre></div></div>

<h3 id="t1505-server-software-component">T1505 Server Software Component</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<h3 id="t1058-service-registry-permissions-weakness">T1058 Service Registry Permissions Weakness</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>get-acl REGISTRY::HKLM\SYSTEM\CurrentControlSet\Services\* |FL
get-acl REGISTRY::HKLM\SYSTEM\CurrentControlSet\Services\servicename |FL
</code></pre></div></div>

<h3 id="t1023-shortcut-modification">T1023 Shortcut Modification</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Select-String -Path "C:\Users\*\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\*.lnk" -Pattern "exe"
Select-String -Path "C:\Users\*\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\*.lnk" -Pattern "dll"
Select-String -Path "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\*" -Pattern "dll"
Select-String -Path "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\*" -Pattern "exe"
gci -path "C:\Users\" -recurse -include *.lnk -ea SilentlyContinue | Select-String -Pattern "exe" | FL
gci -path "C:\Users\" -recurse -include *.lnk -ea SilentlyContinue | Select-String -Pattern "dll" | FL
</code></pre></div></div>

<h3 id="t1198-sip-and-trust-provider-hijacking">T1198 SIP and Trust Provider Hijacking</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SOFTWARE\Microsoft\Cryptography\OID\EncodingType 0\CryptSIPDllGetSignedDataMsg" /s /v "Dll"
reg query "HKLM\SOFTWARE\Microsoft\Cryptography\OID\EncodingType 0\CryptSIPDllVerifyIndirectData" /s /v "Dll"
reg query "HKLM\SOFTWARE\Microsoft\Cryptography\Providers\Trust\FinalPolicy" /s /v "`$DLL"
reg query "HKLM\SOFTWARE\WOW6432Node\Microsoft\Cryptography\OID\EncodingType 0\CryptSIPDllGetSignedDataMsg" /s /v "Dll"
reg query "HKLM\SOFTWARE\WOW6432Node\Microsoft\Cryptography\OID\EncodingType 0\CryptSIPDllVerifyIndirectData" /s /v "Dll"
reg query "HKLM\SOFTWARE\WOW6432Node\Microsoft\Cryptography\Providers\Trust\FinalPolicy" /s /v "`$DLL"
</code></pre></div></div>

<h3 id="t1019-system-firmware">T1019 System Firmware</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\HARDWARE\DESCRIPTION\System\BIOS
Confirm-SecureBootUEFI
Get-WmiObject win32_bios
</code></pre></div></div>

<h3 id="t1209-time-providers">T1209 Time Providers</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\System\CurrentControlSet\Services\W32Time\TimeProviders" /s /f "Dll"
</code></pre></div></div>

<h3 id="t1078-valid-accounts">T1078 Valid Accounts</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>net users
net group /domain "Domain Admins"
net users /domain [name]
</code></pre></div></div>

<h3 id="t1100-web-shell">T1100 Web Shell</h3>

<p>Note: The presence of files with these values isn’t necessarily indicative of a webshell, review output.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci -path "C:\inetpub\wwwroot" -recurse -File -ea SilentlyContinue | Select-String -Pattern "runat" | FL
gci -path "C:\inetpub\wwwroot" -recurse -File -ea SilentlyContinue | Select-String -Pattern "eval" | FL
</code></pre></div></div>

<p><a href="https://www.thezdi.com/blog/2021/8/17/from-pwn2own-2021-a-new-attack-surface-on-microsoft-exchange-proxyshell">ProxyShell</a> - May reveal evidence of mailbox exfil or Web Shell being dropped:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{LogName='MSExchange Management';} | ? {$_.Message -match 'MailboxExportRequest'} | FL TimeCreated, Message
Get-WinEvent -FilterHashtable @{LogName='MSExchange Management';} | ? {$_.Message -match 'aspx'} | FL TimeCreated, Message
</code></pre></div></div>

<h3 id="t1084-windows-management-instrumentation-event-subscription">T1084 Windows Management Instrumentation Event Subscription</h3>

<h4 id="get-wmi-namespaces">Get WMI Namespaces</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Function Get-WmiNamespace ($Path = 'root')
{
	foreach ($Namespace in (Get-WmiObject -Namespace $Path -Class __Namespace))
	{
		$FullPath = $Path + "/" + $Namespace.Name
		Write-Output $FullPath
		Get-WmiNamespace -Path $FullPath
	}
}
Get-WMINamespace -Recurse
</code></pre></div></div>

<h4 id="query-wmi-persistence">Query WMI Persistence</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WmiObject -Class __FilterToConsumerBinding -Namespace root\subscription
Get-WmiObject -Class __EventFilter -Namespace root\subscription
Get-WmiObject -Class __EventConsumer -Namespace root\subscription
</code></pre></div></div>

<h3 id="t1004-winlogon-helper-dll">T1004 Winlogon Helper DLL</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKU\{SID}\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify" /s
reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify" /s
reg query "HKU\{SID}\Software\Microsoft\Windows NT\CurrentVersion\Winlogon" /v "Userinit"
reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon" /v "Userinit"
reg query "HKU\{SID}\Software\Microsoft\Windows NT\CurrentVersion\Winlogon" /v "Shell"
reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon" /v "Shell"
reg query "HKLM\Software\WOW6432Node\Microsoft\Windows NT\CurrentVersion\Winlogon" /s
</code></pre></div></div>

<h3 id="other---winsock-helper-dll-persistence">Other - Winsock Helper DLL Persistence</h3>

<p><a href="https://modexp.wordpress.com/2019/07/27/process-injection-winsock/">Special Thanks - odzhan</a></p>

<p><a href="https://www.hexacorn.com/blog/2015/01/13/beyond-good-ol-run-key-part-24/">Special Thanks - Hexacorn</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-Winsock-WS2HELP/Operational'; Id='1'} | FL TimeCreated,Message
reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Winsock\Parameters /v Transports
get-itemproperty 'REGISTRY::HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Winsock\Parameters' -ea 0 | select -exp Transports
get-item 'REGISTRY::HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\*\Parameters\Winsock' -ea 0
get-itemproperty 'REGISTRY::HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\*\Parameters\Winsock' -ea 0 | select -exp HelperDllName
get-item 'REGISTRY::HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Winsock2\Parameters' -ea 0
</code></pre></div></div>

<h3 id="check-disabled-task-manager-often-from-malware">Check disabled task manager (often from malware)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\System /v DisableTaskMgr
</code></pre></div></div>

<h3 id="review-hivelist">Review Hivelist</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gp REGISTRY::HKLM\SYSTEM\CurrentControlSet\Control\hivelist | Select *USER*
</code></pre></div></div>

<h3 id="locate-all-user-registry-keys">Locate all user registry keys</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$UserProfiles = Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList\*" | Where {$_.PSChildName -match "S-1-5-21-(\d+-?){4}$" } | Select-Object @{Name="SID"; Expression={$_.PSChildName}}, @{Name="UserHive";Expression={"$($_.ProfileImagePath)\ntuser.dat"}}
</code></pre></div></div>

<h3 id="load-all-users-registry-keys-from-their-ntuserdat-file-perform-above-first">Load all users registry keys from their ntuser.dat file (perform above first)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Foreach ($UserProfile in $UserProfiles) {If (($ProfileWasLoaded = Test-Path Registry::HKEY_USERS\$($UserProfile.SID)) -eq $false) {reg load HKU\$($UserProfile.SID) $($UserProfile.UserHive) | echo "Successfully loaded: $($UserProfile.UserHive)"}}
</code></pre></div></div>

<h3 id="query-all-users-run-key">Query all users run key</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Foreach ($UserProfile in $UserProfiles) {reg query HKU\$($UserProfile.SID)\SOFTWARE\Microsoft\Windows\CurrentVersion\Run};
</code></pre></div></div>

<h3 id="unload-all-users-registry-keys">Unload all users registry keys</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Foreach ($UserProfile in $UserProfiles) {reg unload HKU\$($UserProfile.SID)};
</code></pre></div></div>

<h3 id="remediate-automatic-loadrun-reg-keys">Remediate Automatic Load/Run Reg Keys</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg delete [keyname] /v [ValueName] /f
reg delete [keyname] /f
Foreach ($UserProfile in $UserProfiles) {reg delete HKU\$($UserProfile.SID)\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce /f}
Foreach ($UserProfile in $UserProfiles) {reg delete HKU\$($UserProfile.SID)\SOFTWARE\Microsoft\Windows\CurrentVersion\Run /f}
</code></pre></div></div>

<p>Powershell:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Remove-ItemProperty -Path "[Path]" -Name "[name]"
</code></pre></div></div>

<h3 id="check-registry-for-ie-enhanced-security-modification">Check Registry for IE Enhanced Security Modification</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci 'REGISTRY::HKU\*\Software\Policies\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap'
gci 'REGISTRY::HKLM\Software\Policies\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap'
</code></pre></div></div>

<h3 id="check-registry-for-disabling-of-uac-1uac-disabled">Check Registry for disabling of UAC (1=UAC Disabled)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci REGISTRY::HKU\*\Software\Microsoft\Windows\CurrentVersion\Policies\System\EnableLUA 
gci REGISTRY::HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\EnableLUA 
</code></pre></div></div>

<h3 id="review-software-keys-for-malicious-entries">Review Software Keys for malicious entries</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci registry::HKLM\Software\*
gci registry::HKU\*\Software\*
</code></pre></div></div>

<h3 id="scan-registry-keys-for-specified-text">Scan Registry keys for specified text</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-ChildItem -path HKLM:\ -Recurse -ea SilentlyContinue | where {$_.Name -match 'notepad' -or $_.Name -match 'sql'}
Get-ChildItem -path HKLM:\ -Recurse -ea SilentlyContinue | get-itemproperty | where {$_ -match 'notepad' -or $_ -match 'sql'}
reg query HKLM\SOFTWARE /s /f ".exe"
reg query HKLM\SYSTEM /s /f ".exe"
reg query HKLM\SECURITY /s /f ".exe"
reg query HKLM /s /f ".exe"
</code></pre></div></div>

<h3 id="persistent-file-locations-of-interest">Persistent file locations of interest</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%localappdata%\[random]\[random].[4-9 file ext]
%localappdata%\[random]\[random].lnk
%localappdata%\[random]\[random].bat
%appdata%\[random]\[random].[4-9 file ext]
%appdata%\[random]\[random].lnk
%appdata%\[random]\[random].bat
%appdata%\[random]\[random].bat
%SystemRoot%\[random 4 chars starting with digit]
%appdata%\Microsoft\Windows\Start Menu\Programs\Startup\*
"C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\*"
%SystemRoot%\System32\[randomnumber]\
%SystemRoot%\System32\tasks\[randomname]
%SystemRoot%\[randomname]
C:\Users\[username]\appdata\roaming\[random]
C:\Users\[username]\appdata\roaming\[random]
C:\Users\Public\*
</code></pre></div></div>

<p>You can scan these directories for items of interest e.g. unusual exe, dll, bat, lnk etc files with:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dir /s /b %localappdata%\*.exe | findstr /e .exe
dir /s /b %appdata%\*.exe | findstr /e .exe
dir /s /b %localappdata%\*.dll | findstr /e .dll
dir /s /b %appdata%\*.dll | findstr /e .dll
dir /s /b %localappdata%\*.bat | findstr /e .bat
dir /s /b "%appdata%\Microsoft\Windows\Start Menu\Programs\Startup\" | findstr /e .lnk
dir /s /b "C:\Users\Public\" | findstr /e .exe
dir /s /b "C:\Users\Public\" | findstr /e .lnk
dir /s /b "C:\Users\Public\" | findstr /e .dll
dir /s /b "C:\Users\Public\" | findstr /e .bat
ls "C:\Users\[User]\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup" | findstr /e .lnk
</code></pre></div></div>

<h3 id="locate-any-file-of-interest-from-cmdexe-using-whereexe">Locate any file of interest from cmd.exe using ‘where.exe’</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>where.exe /r C:\ *password*
where.exe /r D:\  version.dll /t
</code></pre></div></div>

<h3 id="locate-lnk-files-with-a-particular-string-special-thanks-to-the-notorious">Locate LNK Files with a particular string (Special thanks to the notorious)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Select-String -Path 'C:\Users\[User]\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\*.lnk' -Pattern "powershell" | Select Path
</code></pre></div></div>

<h3 id="master-file-table">Master File Table</h3>

<p>The Master File Table is an incredibly important artifact; however, this can only be read or obtained using low level disk reading. This contains an entry for every file or directory on the filesystem including metadata about these files, and may provide evidence on files which have been removed (MFT entries marked as ‘free’).
More information can be found on <a href="https://docs.microsoft.com/en-us/windows/win32/fileio/master-file-table">Microsoft Docs</a></p>

<h3 id="determine-timestomping">Determine Timestomping</h3>

<p>Within the Master File Table (Located at the Win root) there are 2 elements, $STANDARD_INFORMATION and $FILE_NAME, both of which have values for a file being created, modified, accessed and written.</p>

<p>These are known as MACB times (Modified, Accessed, Changed, Birth). The $STANDARD_INFORMATION element can be modified from a malicious process, but the $FILE_NAME element is left intact and cannot without some extra trickery.</p>

<p>These discrepancies generally indicate Timestomping with the $FILE_NAME entry being the source of truth. This can be determined by obtaining the MFT (e.g. using a tool such as Rawcopy), and comparing timestamps on the file (e.g. using a tool such as MFTExplorer).</p>

<p><a href="https://github.com/jschicht/RawCopy">Rawcopy</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RawCopy.exe /FileNamePath:C:0 /OutputPath:C:\Audit /OutputName:MFT_C.bin
</code></pre></div></div>

<p><a href="https://ericzimmerman.github.io/#!index.md">MFTExplorer</a></p>

<h3 id="enable-date-accessed-timestamps">Enable Date Accessed Timestamps</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add "HKLM\SYSTEM\CurrentControlSet\Control\FileSystem" /v NtfsDisableLastAccessUpdate /d 0 /t REG_DWORD /f
</code></pre></div></div>

<h3 id="remove-bitsadmin-persistence">Remove BITSAdmin Persistence</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bitsadmin /reset /allusers
import-module bitstransfer
Get-BitsTransfer -AllUsers | Remove-BitsTransfer
</code></pre></div></div>

<h3 id="check-system-directories-for-executables-not-signed-as-part-of-an-operating-system-release">Check system directories for executables not signed as part of an operating system release</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci C:\windows\*\*.exe -File -force |get-authenticodesignature|?{$_.IsOSBinary -notmatch 'True'}
</code></pre></div></div>

<h3 id="locate-possible-trickbot">Locate Possible Trickbot</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci -path C:\Users\*\AppData\Roaming\*\Data -recurse -force -ea SilentlyContinue
gci -path C:\Users\*\AppData\Roaming\*\Modules -recurse -force -ea SilentlyContinue
gci -path C:\Users\*\AppData\Local\*\Data -recurse -force -ea SilentlyContinue
gci -path C:\Users\*\AppData\Local\*\Modules -recurse -force -ea SilentlyContinue
gci -path C:\Users\*\AppData\Roaming\*\*\Data -recurse -force -ea SilentlyContinue
gci -path C:\Users\*\AppData\Roaming\*\*\Modules -recurse -force -ea SilentlyContinue
gci -path C:\Users\*\AppData\Local\*\*\Data -recurse -force -ea SilentlyContinue
gci -path C:\Users\*\AppData\Local\*\*\Modules -recurse -force -ea SilentlyContinue
gci -path C:\Windows\System32\config\systemprofile\appdata\roaming -recurse -force -include *.exe
schtasks /query /fo LIST /v | findstr "appdata"	
schtasks /query /fo LIST /v | findstr "programdata"	
schtasks /query /fo LIST /v | findstr "public"	
tasklist /svc | findstr "svchost"
</code></pre></div></div>

<h3 id="determine-if-user-trusted-a-docspreadsheet-etc-and-ran-a-macro">Determine if user Trusted a doc/spreadsheet etc and ran a macro</h3>

<p>Note: Don’t forget to load in user hives.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query 'HKU\[SID]\Software\Microsoft\Office\[versionnumber]\Word\Security\Trusted Documents\TrustRecords';
gci 'REGISTRY::HKU\*\Software\Microsoft\Office\*\*\Security\Trusted Documents\TrustRecords' -ea 0 | foreach {reg query $_.Name}
</code></pre></div></div>

<p>Note: This will show the file name/location and metadata in Hex. If the last lot of hex is FFFFFF7F then the user enabled the macro.</p>

<h3 id="check-office-security-settings">Check Office Security Settings</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci REGISTRY::HKU\*\Software\Microsoft\Office\*\*\Security -rec
gci REGISTRY::HKCU\Software\Microsoft\Office\*\*\Security -rec
</code></pre></div></div>

<h3 id="check-outlook-temporary-files">Check Outlook Temporary Files</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci ((gp REGISTRY::HKU\*\Software\Microsoft\Office\[VerNumber]\Outlook\Security\ -ea 0).OutlookSecureTempFolder)
gci (((gp REGISTRY::HKU\*\Software\Microsoft\Office\*\Outlook\Security\ -ea 0)|select -exp OutlookSecureTempFolder -ea 0))
</code></pre></div></div>

<h3 id="check-ms-office-logs-for-high-risk-file-names">Check MS Office Logs for high risk file names</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='OAlerts';} |Where { $_.Message -Match 'invoice' }| FL TimeCreated, Message
</code></pre></div></div>

<h3 id="prevent-cve-2017-11882-cve-2018-0802-cve-2018-0804-cve-2018-0805-cve-2018-0806-cve-2018-0807-eqnedt32exe-exploitation">Prevent CVE-2017-11882, CVE-2018-0802, CVE-2018-0804, CVE-2018-0805, CVE-2018-0806, CVE-2018-0807 (EQNEDT32.EXE) Exploitation</h3>

<p>Note: This is the “Equation Editor” exploit, either patch or mitigate. <a href="https://support.microsoft.com/en-us/help/4055535/how-to-disable-equation-editor-3-0">More information on the below process</a>.</p>

<p>64-Bit Windows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add "HKLM\SOFTWARE\Microsoft\Office\Common\COM Compatibility\{0002CE02-0000-0000-C000-000000000046}" /v "Compatibility Flags" /t REG_DWORD /d 0x400 /f
reg delete "HKEY_CLASSES_ROOT\CLSID\{0002CE02-0000-0000-C000-000000000046}"
reg delete "HKLM\SOFTWARE\Classes\Equation.3"
</code></pre></div></div>

<p>32-Bit Windows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add "HKLM\SOFTWARE\Wow6432Node\Microsoft\Office\Common\COM Compatibility\{0002CE02-0000-0000-C000-000000000046}" /v "Compatibility Flags" /t REG_DWORD /d 0x400 /f
reg delete "HKEY_CLASSES_ROOT\WOW6432Node\CLSID\{0002CE02-0000-0000-C000-000000000046}"
reg delete "HKLM\SOFTWARE\Classes\Equation.3" /f
</code></pre></div></div>

<h3 id="determine-if-user-opened-a-document">Determine if user opened a document</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci "REGISTRY::HKU\*\Software\Microsoft\Office\*\Word\Reading Locations\*"
</code></pre></div></div>

<h3 id="number-of-sub-directories">Number of Sub-Directories</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gci -Path C:\Users\User\ -Recurse -Directory).length
</code></pre></div></div>

<h3 id="prevent-executable-from-running">Prevent Executable from Running.</h3>

<p>Note: Load in hives and add particular SID to prevent users running named files, helps prevent for example your IIS service account from running cmd.exe or powershell.exe</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add "HKU\{SID}\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v DisallowRun /t REG_DWORD /d "00000001" /f
reg add "HKU\{SID}\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun" /v malware.exe /t REG_SZ /d "malware.exe" /f
</code></pre></div></div>

<h3 id="show-known-file-extensions-and-hidden-files-excluding-os-hidden-files">Show known file extensions and hidden files (excluding OS hidden files)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add "HKU\{SID}\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v Hidden /t REG_DWORD /d "1" /f
reg add "HKU\{SID}\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" /v HideFileExt /t REG_DWORD /d "0" /f
Stop-Process -processname explorer
</code></pre></div></div>

<h3 id="open-file-extension-eg-scripts-with-certain-application-elevated-cmd">Open File Extension (e.g. scripts) with certain application (elevated cmd)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FTYPE Custom=Notepad.exe "%1"
ASSOC .wsf=Custom
</code></pre></div></div>

<h3 id="disable-command-prompt">Disable Command Prompt</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add "HKCU\SOFTWARE\Microsoft\Windows\System" /v DisableCMD /t REG_DWORD /d 0 /f
</code></pre></div></div>

<h3 id="locate-possible-dll-search-order-hijacking">Locate Possible <a href="https://attack.mitre.org/techniques/T1038/">DLL Search Order Hijacking</a></h3>

<p>Note: A legitimate clean executable can be used to run malicious DLLs based on how the software searches for them.</p>

<p>More information on <a href="https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-search-order">Microsoft Docs</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\KnownDLLs"
reg query "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\SafeDllSearchMode"
</code></pre></div></div>

<h4 id="search-order-for-desktop-applications">Search order for desktop applications:</h4>

<p>If SafeDllSearchMode is enabled (is by default), the search order is as follows:</p>

<ul>
  <li>The same directory from which the executable is run.</li>
  <li>The System Directory (Usually C:\Windows\System32).</li>
  <li>The 16-bit System Directory.</li>
  <li>The Windows Directory (Usually C:\Windows).</li>
  <li>The Current Directory (From the process which executed the executable).</li>
  <li>The directories that are listed in the PATH environment variable.</li>
</ul>

<p>If SafeDllSearchMode is disabled (SafeDllSearchMode has a reg value of 0), the search order is as follows:</p>

<ul>
  <li>The same directory from which the executable is run.</li>
  <li>The Current Directory (From the process which executed the executable).</li>
  <li>The System Directory (Usually C:\Windows\System32).</li>
  <li>The 16-bit System Directory.</li>
  <li>The Windows Directory (Usually C:\Windows).</li>
  <li>The directories that are listed in the PATH environment variable.</li>
</ul>

<h3 id="locate-possible-dll-side-loading">Locate Possible <a href="https://attack.mitre.org/techniques/T1073/">Dll Side Loading</a></h3>

<p>Note: A legitimate clean executable can be used to run malicious DLLs based on issues with a manifest file used by the application to load DLLs.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\SideBySide\Winners"
</code></pre></div></div>

<p>By placing a malicious DLL in the below locations legitimate binaries may have been used to sideload these malicious DLLs.</p>

<ul>
  <li>C:\Windows\WinSxS</li>
  <li>C:\Windows\SXS</li>
</ul>

<h4 id="unique-sideload-dll-hashes-may-take-some-time">Unique Sideload DLL hashes (may take some time)</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gci -path C:\Windows\WinSxS -recurse -include *.dll|gi -ea SilentlyContinue|filehash).hash|sort -u
</code></pre></div></div>

<h4 id="unsigned-or-invalid-sideload-dlls-there-will-be-a-lot">Unsigned or Invalid Sideload DLLs (there will be a lot)</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci -path C:\Windows\WinSxS -recurse -include *.dll | Get-AuthenticodeSignature | Where-Object Status -NE "Valid"
</code></pre></div></div>

<h4 id="unsigned-sideload-dlls-less-noise">Unsigned Sideload DLLs (Less noise)</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci -path C:\Windows\WinSxS -recurse -include *.dll | Get-AuthenticodeSignature | Where-Object Status -E "NotSigned"
gci -path C:\Windows\WinSxS -recurse -include *.ocx | Get-AuthenticodeSignature | Where-Object Status -NE "Valid"
</code></pre></div></div>

<h4 id="hash-of-unsigned-sideload-dlls">Hash of Unsigned Sideload DLLs</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci -path C:\Windows\WinSxS -recurse -include *.dll | Get-AuthenticodeSignature | Where-Object Status -E "NotSigned" | Select Path | gi -ea SilentlyContinue | filehash | sort -u
gci -path C:\Windows\WinSxS -recurse -include *.ocx | Get-AuthenticodeSignature | Where-Object Status -NE "Valid" | Select Path | gi -ea SilentlyContinue | filehash | sort -u
</code></pre></div></div>

<h3 id="find-files-without-extensions">Find files without extensions</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-ChildItem -Path C:\Users\[user]\AppData -Recurse -Exclude *.* -File -Force -ea SilentlyContinue
</code></pre></div></div>

<h3 id="remediate-malicious-files">Remediate malicious files</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rmdir %localappdata%\maliciousdirectory\ /s
del /F %localappdata%\maliciousdirectory\malware.exe
</code></pre></div></div>

<p>Powershell:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Remove-Item [C:\Users\Public\*.exe]
Remove-Item -Path [C:\Users\Public\malware.exe] -Force
Get-ChildItem * -Include *.exe -Recurse | Remove-Item
</code></pre></div></div>

<h3 id="detect-persistent-wmi-subscriptions">Detect Persistent WMI Subscriptions</h3>

<p>These will appear as children spawning from wmiprvse.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WmiObject -Class __FilterToConsumerBinding -Namespace root\subscription
Get-WmiObject -Class __EventFilter -Namespace root\subscription
Get-WmiObject -Class __EventConsumer -Namespace root\subscription
</code></pre></div></div>

<h3 id="remediate-persistent-wmi-subscriptions">Remediate Persistent WMI Subscriptions</h3>

<p>The most important aspect is to locate and remove the CommandLineEventConsumer. This has the malicious command stored within the value ‘CommandLineTemplate’. The below example searches for commands that contain ‘powershell’.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WMIObject -Namespace root\subscription -Class __EventFilter -Filter "Name like '%%[Name]%%'" | Remove-WmiObject
Get-WMIObject -Namespace root\subscription -Class CommandLineEventConsumer -Filter "CommandLineTemplate like '%%powershell%%'" | Remove-WmiObject
Get-WMIObject -Namespace root\subscription -Class __FilterToConsumerBinding -Filter "__Path like '%%[Name]%%'" | Remove-WmiObject 
</code></pre></div></div>

<h3 id="enumerate-wmi-namespaces"><a href="https://learn-powershell.net/2014/05/09/quick-hits-list-all-available-wmi-namespaces-using-powershell/">Enumerate WMI Namespaces</a></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Function Get-WmiNamespace ($Path = 'root')
{
	foreach ($Namespace in (Get-WmiObject -Namespace $Path -Class __Namespace))
	{
		$FullPath = $Path + "/" + $Namespace.Name
		Write-Output $FullPath
		Get-WmiNamespace -Path $FullPath
	}
}
Get-WMINamespace -Recurse
</code></pre></div></div>

<h3 id="mimikatzcredential-extraction-detection">Mimikatz/Credential Extraction Detection</h3>

<p>The below represent registry keys which make it more difficult for Mimikatz to work. Modification of these keys may indicate an attacker trying to execute Mimikatz within an environment if they were set to their more secure state. Always test prior to changing registry keys such as these in a production environment to ensure nothing breaks.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest
	- “UseLogonCredential” should be 0 to prevent the password in LSASS/WDigest
HKLM\SYSTEM\CurrentControlSet\Control\Lsa
	- “RunAsPPL” should be set to dword:00000001 to enable LSA Protection which prevents non-protected processes from interacting with LSASS. 
	- Mimikatz can remove these flags using a custom driver called mimidriver.
		- This uses the command **!+** and then **!processprotect /remove /process:lsass.exe** by default so tampering of this registry key can be indicative of Mimikatz activity.
</code></pre></div></div>

<p>The <a href="https://github.com/gentilkiwi/mimikatz/blob/master/kiwi_passwords.yar">Mimikatz Yara rule</a> may also prove useful.</p>

<p>Some techniques may involve loading lsasrv.dll or wdigest.dll to extract credentials and may be caught if this is loaded legitimately using:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tasklist /m wdigest.dll
tasklist /m lsasrv.dll
</code></pre></div></div>

<p>You may be able to detect changes to the below registry keys which can be used to load an arbitrary DLL and extract credentials, more information from <a href="https://blog.xpnsec.com/exploring-mimikatz-part-1/">Adam Chester</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\SYSTEM\CurrentControlSet\Services\NTDS /v LsaDbExtPt
reg query HKLM\SYSTEM\CurrentControlSet\Services\NTDS\DirectoryServiceExtPt
</code></pre></div></div>

<p>An adversary may also tamper with the number of cached logons a system holds (default of 10).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v CachedLogonsCount
</code></pre></div></div>

<h3 id="password-filter-dll-credential-harvesting-detection">Password Filter DLL Credential Harvesting Detection</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" /s /f Notification
</code></pre></div></div>

<h3 id="network-provider-dll-credential-harvesting-detection">Network Provider DLL Credential Harvesting Detection</h3>

<p>Note: There will be many legitimate ones so verify first.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\SYSTEM\CurrentControlSet /s /f NetworkProvider
gci HKLM:\SYSTEM\CurrentControlSet\Services\*\NetworkProvider
</code></pre></div></div>

<p>Note: This is 100% the research performed by <a href="https://github.com/gtworek/PSBits/tree/master/PasswordStealing/NPPSpy">Grzegorz Tworek</a>, and the below script can be used to automate detection.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># The script reads information about network providers (possibly acting as password sniffers) from registry, and displays it
# each entry is checked for binary signature and DLL metadata
# no admin privileges needed

# get providers from registry
$providers = Get-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\NetworkProvider\Order" -Name ProviderOrder

# iterate through entries
$arrExp=@()
foreach ($prov in ($providers.ProviderOrder -split ','))
{
    $row = New-Object psobject
    $row | Add-Member -Name "Name" -MemberType NoteProperty -Value $prov

    $dllPath = (Get-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Services\$prov\NetworkProvider" -Name ProviderPath).ProviderPath
    $row | Add-Member -Name "DllPath" -MemberType NoteProperty -Value $dllPath
    $signature = Get-AuthenticodeSignature -FilePath $dllPath
    $certSubject = ""
    if ($signature.Status.value__ -eq 0)  #valid
    {
        $certSubject = $signature.SignerCertificate.Subject
    }
    $row | Add-Member -Name "Signer" -MemberType NoteProperty -Value $certSubject
    $row | Add-Member -Name "Version" -MemberType NoteProperty -Value (Get-Command $dllPath).FileVersionInfo.FileVersion
    $row | Add-Member -Name "Description" -MemberType NoteProperty -Value (Get-Command $dllPath).FileVersionInfo.FileDescription

    $arrExp += $row
}

# Let's display the array
if (Test-Path Variable:PSise)
{
    $arrExp | Out-GridView
}
else
{
    $arrExp | Format-List
}
</code></pre></div></div>

<h3 id="registry-key-modification-timestamp-by-shaun-hess">Registry key modification timestamp (by Shaun Hess)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> param(            
 [parameter(            
 ValueFromPipeline=$true,            
 ValueFromPipelineByPropertyName=$true)]            
 [Alias("CN","__SERVER","Computer","CNAME")]            
 [string[]]$ComputerName=$env:ComputerName,            
 [string]$Key = "HKLM",            
 [string]$SubKey            
 )  

function Get-RegKeyLastWriteTime {            
 &lt;#
    .SYNOPSIS
	Retrieves the last write time of the supplied registry key
	.DESCRIPTION
	The Registry data that a hive stores in containers are called cells. A cell 
	can hold a key, a value, a security descriptor, a list of subkeys, or a 
	list of key values.
	Get-RegKeyLastWriteTime retrieves the LastWriteTime through a pointer to the
	FILETIME structure that receives the time at which the enumerated subkey was
	last written. Values do not contain a LastWriteTime property, but changes to
	child values update the parent keys lpftLastWriteTime.
	
	The LastWriteTime is updated when a key is created, modified, accessed, or
	deleted.
	.PARAMETER ComputerName
	Computer name to query
	.PARAMETER Key
	Root Key to query
	HKCR - Symbolic link to HKEY_LOCAL_MACHINE \SOFTWARE \Classes.
	HKCU - Symbolic link to a key under HKEY_USERS representing a user's profile
	hive.
	HKLM - Placeholder with no corresponding physical hive. This key contains
	other keys that are hives.
	HKU  - Placeholder that contains the user-profile hives of logged-on
	accounts.
	HKCC - Symbolic link to the key of the current hardware profile
	.PARAMETER SubKey
	Registry Key to query
	.EXAMPLE
	Get-RegKeyLastWriteTime -ComputerName testwks -Key HKLM -SubKey Software
        .EXAMPLE
	Get-RegKeyLastWriteTime -ComputerName testwks1,testwks2 -SubKey Software
	.EXAMPLE
	Get-RegKeyLastWriteTime -SubKey Software\Microsoft
	.EXAMPLE
	"testwks1","testwks2" | Get-RegKeyLastWriteTime -SubKey Software\Microsoft `
	\Windows\CurrentVersion
	.NOTES
	NAME: Get-RegKeyLastWriteTime
	AUTHOR: Shaun Hess
	VERSION: 1.0
	LASTEDIT: 01JUL2011
	LICENSE: Creative Commons Attribution 3.0 Unported License
	(http://creativecommons.org/licenses/by/3.0/)
	.LINK
	http://www.shaunhess.com
	#&gt;            
            
 [CmdletBinding()]            
            
 param(            
 [parameter(            
 ValueFromPipeline=$true,            
 ValueFromPipelineByPropertyName=$true)]            
 [Alias("CN","__SERVER","Computer","CNAME")]            
 [string[]]$ComputerName=$env:ComputerName,            
 [string]$Key = "HKLM",            
 [string]$SubKey            
 )            
            
 BEGIN {            
  switch ($Key) {            
   "HKCR" { $searchKey = 0x80000000} #HK Classes Root            
   "HKCU" { $searchKey = 0x80000001} #HK Current User            
   "HKLM" { $searchKey = 0x80000002} #HK Local Machine            
   "HKU"  { $searchKey = 0x80000003} #HK Users            
   "HKCC" { $searchKey = 0x80000005} #HK Current Config            
   default {            
   "Invalid Key. Use one of the following options:
			HKCR, HKCU, HKLM, HKU, HKCC"}            
  }            
            
  $KEYQUERYVALUE = 0x1            
  $KEYREAD = 0x19            
  $KEYALLACCESS = 0x3F            
 }            
 PROCESS {            
  foreach($computer in $ComputerName) {            
              
$sig0 = @'
[DllImport("advapi32.dll", SetLastError = true)]
  public static extern int RegConnectRegistry(
  	string lpMachineName,
	int hkey,
	ref int phkResult);
'@            
  $type0 = Add-Type -MemberDefinition $sig0 -Name Win32Utils -Namespace RegConnectRegistry -Using System.Text -PassThru            
            
$sig1 = @'
[DllImport("advapi32.dll", CharSet = CharSet.Auto)]
  public static extern int RegOpenKeyEx(
    int hKey,
    string subKey,
    int ulOptions,
    int samDesired,
    out int hkResult);
'@            
  $type1 = Add-Type -MemberDefinition $sig1 -Name Win32Utils `
 -Namespace RegOpenKeyEx -Using System.Text -PassThru            
            
$sig2 = @'
[DllImport("advapi32.dll", EntryPoint = "RegEnumKeyEx")]
extern public static int RegEnumKeyEx(
    int hkey,
    int index,
    StringBuilder lpName,
    ref int lpcbName,
    int reserved,
    int lpClass,
    int lpcbClass,
    out long lpftLastWriteTime);
'@            
  $type2 = Add-Type -MemberDefinition $sig2 -Name Win32Utils `
 -Namespace RegEnumKeyEx -Using System.Text -PassThru            
            
$sig3 = @'
[DllImport("advapi32.dll", SetLastError=true)]
public static extern int RegCloseKey(
    int hKey);
'@            
  $type3 = Add-Type -MemberDefinition $sig3 -Name Win32Utils -Namespace RegCloseKey -Using System.Text -PassThru            
            
            
  $hKey = new-object int            
  $hKeyref = new-object int            
  $searchKeyRemote = $type0::RegConnectRegistry($computer, $searchKey,   [ref]$hKey)            
  $result = $type1::RegOpenKeyEx($hKey, $SubKey, 0, $KEYREAD,   [ref]$hKeyref)            
            
  #initialize variables            
  $builder = New-Object System.Text.StringBuilder 1024            
  $index = 0            
  $length = [int] 1024            
  $time = New-Object Long            
            
  #234 means more info, 0 means success. Either way, keep reading            
  while ( 0,234 -contains $type2::RegEnumKeyEx($hKeyref, $index++,       $builder, [ref] $length, $null, $null, $null, [ref] $time) )            
  {            
      #create output object            
      $o = "" | Select Key, LastWriteTime, ComputerName            
   $o.ComputerName = "$computer"             
      $o.Key = $builder.ToString()            
   # TODO Change to use the time api    
      #Write-host ((Get-Date $time).ToUniversalTime())
      $timezone=[TimeZoneInfo]::Local
      $Offset=$timezone.BaseUtcOffset.TotalHours
      
      $o.LastWriteTime = (Get-Date $time).AddYears(1600).AddHours($Offset)            
      $o            
      #reinitialize for next time through the loop            
      $length = [int] 1024            
      $builder = New-Object System.Text.StringBuilder 1024            
  }            
            
  $result = $type3::RegCloseKey($hKey);
  write-host $builder         
  }            
 }            
} # End Get-RegKeyLastWriteTime function

#write-host $Key $SubKey
#Get-RegKeyLastWriteTime -Key $Key -SubKey $SubKey

Get-RegKeyLastWriteTime -SubKey System\CurrentControlSet\
</code></pre></div></div>

<h3 id="netntlm-downgrade-attack-detection">NetNTLM Downgrade Attack Detection</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\SYSTEM\CurrentControlSet\Control\Lsa /v LMCompatibilityLevel
reg query HKLM\SYSTEM\CurrentControlSet\Control\Lsa /v RestrictSendingNTLMTraffic 
reg query HKLM\SYSTEM\CurrentControlSet\Control\Lsa /v NTLMMinClientSec
</code></pre></div></div>

<p><a href="https://github.com/fox-it/danderspritz-evtx">DanderSpritz eventlogedit</a></p>

<h3 id="oauth-access-token-theft-detection-in-azure">Oauth Access Token Theft Detection in Azure</h3>

<p><a href="https://www.inversecos.com/2022/08/how-to-detect-oauth-access-token-theft.html">Inversecos - How to Detect OAuth Access Token Theft in Azure</a></p>

<h3 id="sans-for509---cloud-forensics-and-azure">SANS FOR509 - Cloud Forensics and Azure</h3>

<ul>
  <li><a href="https://www.sans.org/posters/enterprise-cloud-forensics-incident-response-poster/">Poster</a></li>
  <li><a href="https://github.com/CrowdStrike/CRT">CrowdStrike CRT</a></li>
</ul>

<h3 id="putty-detection">Putty Detection</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKCU\Software\SimonTatham\PuTTY\Sessions /s
</code></pre></div></div>

<h3 id="installed-updates">Installed Updates</h3>

<p>(WMI Quick Fix Engineering)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wmic qfe
</code></pre></div></div>

<h3 id="installed-softwarepackages">Installed Software/Packages</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\ /s /f DisplayName
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Uninstall\ /s /f DisplayName
wmic product get name,version /format:csv
wmic product get /ALL
dism /online /get-packages
get-WmiObject -Class Win32_Product
get-package
</code></pre></div></div>

<p>Powershell: Full List for all users using uninstall keys in registry</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$(Get-ItemProperty HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*; Get-ItemProperty HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*;New-PSDrive -Name HKU -PSProvider Registry -Root Registry::HKEY_USERS| Out-Null;$UserInstalls += gci -Path HKU: | where {$_.Name -match 'S-\d-\d+-(\d+-){1,14}\d+$'} | foreach {$_.PSChildName };$(foreach ($User in $UserInstalls){Get-ItemProperty HKU:\$User\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*});$UserInstalls = $null;try{Remove-PSDrive -Name HKU}catch{};)|where {($_.DisplayName -ne $null) -and ($_.Publisher -ne $null)} | Select DisplayName,DisplayVersion,Publisher,InstallDate,UninstallString |FT
</code></pre></div></div>

<h3 id="process-information">Process information</h3>

<p>(pslist requires sysinternals pslist.exe):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tasklist -v
wmic process list full /format:csv
wmic process get name,parentprocessid,processid /format:csv
wmic process get ExecutablePath,processid /format:csv
wmic process get name,ExecutablePath,processid,parentprocessid /format:csv | findstr /I "appdata"
wmic process where processid=[PID] get parentprocessid
wmic process where processid=[PID] get commandline
wmic process where "commandline is not null and commandline!=''" get name,commandline /format:csv
gwmi win32_process -Filter "name like 'powershell.exe'" | select name,processId,commandline|FL
gwmi win32_process | select name,processId,path,commandline|FL
gwmi win32_process |FL ProcessID,ParentProcessID,CommandLine,@{e={$_.GetOwner().User}}
gwmi win32_process | Sort-Object -Property ProcessID | FL ProcessID,Path,CommandLine,ParentProcessID,@{n="User";e={$_.GetOwner().User}},@{n="ParentProcessPath";e={gps -Id $_.ParentProcessID|Select -exp Path}}
pslist
Get-Process -IncludeUserName
</code></pre></div></div>

<p><a href="https://gist.github.com/JPMinty/f4d60adafdfbc12b0e4226a27bf1dcb0">PowerShell Module to show Process Tree</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import-module .\Get-ProcessTree.ps1
Get-ProcessTree -Verbose | FT Id, Level, IndentedName, ParentId,Path,CommandLine
</code></pre></div></div>

<h3 id="current-process-execution-or-module-loads-from-temporary-directories">Current Process execution or module loads from temporary directories</h3>

<p>Note: This will likely have some false positives as it’s just a wildcard. So in this case using ‘temp’ can come up in words such as ‘ItemProvider’.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gps -Module -ea 0).FileName|Select-String "Appdata","ProgramData","Temp","Users","public"|unique
</code></pre></div></div>

<h3 id="current-process-execution-or-module-loads-from-temporary-directories--hash">Current Process execution or module loads from temporary directories + hash</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$A=((gps -Module -ea 0).FileName|Select-String "Appdata","ProgramData","Temp","Users","public"|sort|unique);foreach ($B in $A) {filehash $B};
$A=((gps).Path|Select-String "Appdata","ProgramData","Temp","Users","public"|sort|unique);foreach ($B in $A) {filehash $B};
</code></pre></div></div>

<h3 id="scan-for-malware-with-windows-defender">Scan for malware with Windows Defender</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"%ProgramFiles%\Windows Defender\MpCmdRun.exe" -Scan -ScanType 1
"%ProgramFiles%\Windows Defender\MpCmdRun.exe" -Scan -ScanType 2
"%ProgramFiles%\Windows Defender\MpCmdRun.exe" -Scan -ScanType 3 -File C:\Users\[username]\AppData\Local\Temp
</code></pre></div></div>

<p>Note: Types are as follows</p>

<ul>
  <li>1: Quick scan</li>
  <li>2: Full system scan</li>
  <li>3: File and directory custom scan</li>
</ul>

<h3 id="check-windows-defender-for-excluded-files-and-default-actions">Check Windows Defender for excluded files and default actions</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SOFTWARE\Microsoft\Windows Defender\Exclusions" /s
Get-ChildItem 'HKLM:\SOFTWARE\Microsoft\Windows Defender\Exclusions'
Get-MpPreference | Select Exclusion*
Get-MpPreference | Select *DefaultAction
</code></pre></div></div>

<h3 id="delete-windows-defender-excluded-files">Delete Windows Defender excluded files</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg delete "HKLM\SOFTWARE\Microsoft\Windows Defender\Exclusions\Paths" /v "[RegkeyValue]"
reg delete "HKLM\SOFTWARE\Microsoft\Windows Defender\Exclusions\Paths"
Remove-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Windows Defender\Exclusions\Paths' -Name "Paths"
</code></pre></div></div>

<h3 id="check-windows-defender-blockquarantine-logs">Check Windows Defender Block/Quarantine Logs</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-Windows Defender/Operational'; Data='Severe'} | FL TimeCreated,Message
</code></pre></div></div>

<h3 id="check-and-set-access-control-lists">Check and Set Access Control Lists</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-Acl -Path 'HKLM:\SOFTWARE\Microsoft\Windows Defender\Exclusions\Paths'|FL
Get-Acl -Path [FileWithRequiredAccess] | Set-Acl -Path 'HKLM:\SOFTWARE\Microsoft\Windows Defender\Exclusions\Paths'
</code></pre></div></div>

<h3 id="change-ace-for-everyone-on-folder-and-subfilesfolders">Change ACE for “everyone” on folder and subfiles/folders</h3>

<h4 id="grant-everyone-full-access">Grant everyone full access</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>icacls "C:\{DESIREDFOLDERPATH}" /grant everyone:(CI)(OI)F /T
</code></pre></div></div>

<h4 id="remove-ace-entries-for-everyone">Remove ACE entries for “everyone”</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>icacls "C:\{DESIREDFOLDERPATH}" /remove everyone /T
</code></pre></div></div>

<h3 id="disable-unwanted-windows-binaries-via-base64-encoding-and-removal">Disable unwanted windows binaries (via Base64 encoding and removal)</h3>

<p>Note: This is one method, not the only way.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certutil -encode C:\windows\system32\mshta.exe C:\windows\system32\mshta.disabled
Get-Acl -Path C:\windows\system32\mshta.exe | Set-Acl -Path C:\windows\system32\mshta.disabled
takeown /f C:\windows\system32\mshta.exe
icacls C:\windows\system32\mshta.exe /grant administrators:F
rm C:\windows\system32\mshta.exe
</code></pre></div></div>

<h3 id="enable-windows-binaries-via-base64-decoding-and-removal">Enable windows binaries (via Base64 decoding and removal)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certutil -decode C:\windows\system32\mshta.disabled C:\windows\system32\mshta.exe
Get-Acl -Path C:\windows\system32\mshta.disabled | Set-Acl -Path C:\windows\system32\mshta.exe
takeown /f C:\windows\system32\mshta.disabled
icacls C:\windows\system32\mshta.disabled /grant administrators:F
rm C:\windows\system32\mshta.disabled
</code></pre></div></div>

<h3 id="make-multiple-files-visible-and-remove-superhidden">Make multiple files visible and remove ‘superhidden’</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci C:\{DESIREDFOLDERPATH} -force -recurse -ea 0 | foreach {$_.attributes = 'Normal'};
attrib -s -h C:\{DESIREDFOLDERPATH}\*.*
</code></pre></div></div>

<h3 id="check-security-descriptor-definition-language-sddl-and-access-control-entries-ace-for-services">Check Security Descriptor Definition Language (SDDL) and Access Control Entries (ACE) for services</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sc sdshow [servicename]
$A=get-service;foreach ($service in $A){$service;sc.exe sdshow $service.Name}
$A=get-service;foreach ($service in $A){$service;sc.exe sdshow $service.Name|Select-String "A;*DC"}
$A=get-service;foreach ($service in $A){$service;sc.exe sdshow $service.Name|Select-String "A;*WD"}
$A=get-service;foreach ($service in $A){$service;sc.exe sdshow $service.Name|Select-String "A;*WO"}
</code></pre></div></div>

<p>More information on <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/ace-strings">ACE Strings</a> and the level of access they can provide, and a breakdown is included below.</p>

<h4 id="syntax-of-security-descriptor-string"><a href="https://learn.microsoft.com/en-us/windows/win32/secauthz/security-descriptor-string-format">Syntax of Security Descriptor String</a>:</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>owner (O:), primary group (G:), DACL (D:), and SACL (S:).
</code></pre></div></div>

<h4 id="syntax-of-ace-string">Syntax of ACE String:</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ace_type;ace_flags;rights;object_guid;inherit_object_guid;account_sid;(resource_attribute)
</code></pre></div></div>

<p>Note: ACE strings are used in the DACL/SACL components of a SDDL.</p>

<h4 id="example-sddl">Example SDDL:</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>D:(A;;CCLCSWRPWPDTLOCRRC;;;SY)
S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)
</code></pre></div></div>

<h4 id="example-sddl-breakdown-from-above">Example SDDL Breakdown (from above):</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	D: = DACL String
	A; = SDDL_ACCESS_ALLOWED (ace_type)
	; = Nil (ace_flags)
	CCLCSWRPWPDTLOCRRC; = Concatenated rights (rights)
		CC = SDDL_CREATE_CHILD
		LC = SDDL_LIST_CHILDREN
		SW = SDDL_SELF_WRITE
		RP = SDDL_READ_PROPERTY
		WP = SDDL_WRITE_PROPERTY
		DT = SDDL_DELETE_TREE
		LO = SDDL_LIST_OBJECT
		CR = SDDL_CRITICAL
		RC = SDDL_READ_CONTROL
	; = Nil (object_guid)
	; = Nil (inherit_object_guid)
	;SY = SDDL_LOCAL_SYSTEM (account_sid)
	
	S: = SACL String
	AU; = SDDL_AUDIT (ace_type)
	FA; = SDDL_AUDIT_FAILURE (ace_flags)
	CCDCLCSWRPWPDTLOCRSDRCWDWO; = Concatenated rights (rights)
		CC = SDDL_CREATE_CHILD
		DC = SDDL_LIST_CHILDREN
		LC = SDDL_SELF_WRITE
		SW = SDDL_READ_PROPERTY
		RP = SDDL_WRITE_PROPERTY
		WP = SDDL_DELETE_TREE
		DT = SDDL_LIST_OBJECT
		LO = SDDL_CRITICAL
		CR = SDDL_READ_CONTROL
		SD = SDDL_STANDARD_DELETE
		RC = SDDL_READ_CONTROL
		WD = SDDL_WRITE_DAC
		WO = SDDL_WRITE_OWNER
	; = Nil (object_guid)
	; = Nil (inherit_object_guid)
	;WD = SDDL_EVERYONE (account_sid)
</code></pre></div></div>

<h3 id="kill-unstoppable-serviceprocess">Kill “Unstoppable” Service/Process</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add HKLM\SYSTEM\CurrentControlSet\Services\{SERVICENAME}\Parameters /V start /T reg_dword /D 4 /f
sc.exe sdset {SERVICENAME} "D:(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;CCLCSWLOCRRC;;;IU)(A;;CCLCSWLOCRRC;;;SU)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)"
Get-Service -Name {SERVICENAME} | Set-Service -Status Paused
sc.exe config {SERVICENAME} start= disabled
Get-Service -Name {SERVICENAME} | Set-Service -Status Stopped
tasklist /FI "IMAGENAME eq {SERVICEEXENAME}"
taskkill /F /t /IM "{SERVICEEXENAME}"
</code></pre></div></div>

<h3 id="obtain-hash-for-all-running-executables">Obtain hash for all running executables</h3>

<p><strong>Issues with spaces in names but supports CMD.exe</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FOR /F %i IN ('wmic process where "ExecutablePath is not null" get ExecutablePath') DO certutil -hashfile %i SHA256 | findstr -v : &gt;&gt; output.txt
</code></pre></div></div>

<p><strong>Powershell (Special thanks Lee Holmes)</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(gps|gi -ea SilentlyContinue|filehash).hash|sort -u
</code></pre></div></div>

<p><strong>My less efficient powershell</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foreach ($process in Get-WmiObject win32_process | where {$_.ExecutablePath -notlike ""}) {Get-FileHash $process.ExecutablePath | Format-List}

foreach ($process in Get-WmiObject win32_process | where {$_.ExecutablePath -notlike ""}) {Get-FileHash $process.ExecutablePath | select Hash -ExpandProperty Hash}

$A = $( foreach ($process in Get-WmiObject win32_process | where {$_.ExecutablePath -notlike ""}) {Get-FileHash $process.ExecutablePath | select Hash -ExpandProperty Hash}) |Sort-Object| Get-Unique;$A
</code></pre></div></div>

<h3 id="obtain-hash-and-established-network-connections-for-running-executables-with-dns-cache">Obtain hash and established network connections for running executables with dns cache</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-NetTCPConnection -State Established | Select RemoteAddress, RemotePort, OwningProcess, @{n="Path";e={(gps -Id $_.OwningProcess).Path}},@{n="Hash";e={(gps -Id $_.OwningProcess|gi|filehash).hash}}, @{n="User";e={(gps -Id $_.OwningProcess -IncludeUserName).UserName}},@{n="DNSCache";e={(Get-DnsClientCache -Data $_.RemoteAddress -ea 0).Entry}}|sort|gu -AS|FT
</code></pre></div></div>

<h3 id="obtain-hash-and-listening-network-connections-for-running-executables">Obtain hash and listening network connections for running executables</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-NetTCPConnection -State LISTEN | Select LocalAddress, LocalPort, OwningProcess, @{n="Path";e={(gps -Id $_.OwningProcess).Path}},@{n="Hash";e={(gps -Id $_.OwningProcess|gi|filehash).hash}}, @{n="User";e={(gps -Id $_.OwningProcess -IncludeUserName).UserName}}|sort|gu -AS|FT
</code></pre></div></div>

<h3 id="obtain-hash-and-possible-tunneled-network-connections-for-running-executables">Obtain hash and possible tunneled network connections for running executables</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-NetTCPConnection -State ESTABLISHED |? LocalAddress -Like "::1" | Select RemoteAddress, RemotePort, OwningProcess, @{n="Path";e={(gps -Id $_.OwningProcess).Path}},@{n="Hash";e={(gps -Id $_.OwningProcess|gi|filehash).hash}}, @{n="User";e={(gps -Id $_.OwningProcess -IncludeUserName).UserName}},@{n="DNSCache";e={(Get-DnsClientCache -Data $_.RemoteAddress).Entry}}|sort|gu -AS|FT
Get-NetTCPConnection -State Established |? LocalAddress -Like "127.0.0.1"| Select RemoteAddress, RemotePort, OwningProcess, @{n="Path";e={(gps -Id $_.OwningProcess).Path}},@{n="Hash";e={(gps -Id $_.OwningProcess|gi|filehash).hash}}, @{n="User";e={(gps -Id $_.OwningProcess -IncludeUserName).UserName}},@{n="DNSCache";e={(Get-DnsClientCache -Data $_.RemoteAddress).Entry}}|sort|gu -AS|FT
Get-NetTCPConnection -State LISTEN |? LocalAddress -Like "127.0.0.1" | Select LocalAddress, LocalPort, OwningProcess, @{n="Path";e={(gps -Id $_.OwningProcess).Path}},@{n="Hash";e={(gps -Id $_.OwningProcess|gi|filehash).hash}}, @{n="User";e={(gps -Id $_.OwningProcess -IncludeUserName).UserName}}|sort|gu -AS|FT
</code></pre></div></div>

<h3 id="obtain-workstation-name-for-tunneled-authentication">Obtain workstation name for tunneled authentication</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4624'; Data='::';} | FL TimeCreated,Message
</code></pre></div></div>

<h3 id="obtain-hash-of-dlls-currently-loaded-by-processes">Obtain hash of DLLs currently loaded by processes</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$A = $(foreach ($dll in gps|select -ExpandProperty modules -ea SilentlyContinue|? FileName -NotLike "C:\Windows\SYSTEM32\*"){Get-FileHash $dll.FileName| select Hash -ExpandProperty Hash})|Sort-Object| Get-Unique;$A
(gps).Modules.FileName | sort -uniq | foreach {filehash $_ -ea 0}
</code></pre></div></div>

<h3 id="obtain-processes-where-binaries-file-version-doesnt-match-os-release">Obtain processes where binaries file version doesn’t match OS Release</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gps -FileVersionInfo -ea 0|? {$_.ProductVersion -notmatch $([System.Environment]::OSVersion.Version|Select -exp Build)}
</code></pre></div></div>

<h3 id="obtain-process-binary-file-external-names">Obtain process binary file external names</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gps -FileVersionInfo -ea 0 | sort -uniq | Select OriginalFilename,InternalName,Filename
gps -module -FileVersionInfo -ea 0 | sort -uniq | Select OriginalFilename,InternalName,Filename
gps -module -FileVersionInfo -ea 0 | sort -uniq | FL *name,*version
</code></pre></div></div>

<h3 id="obtain-processes-running-which-are-running-a-dll">Obtain processes running which are running a DLL</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$A=(gps|select -ExpandProperty modules -ea SilentlyContinue | where {$_.ModuleName -Like 'sechost.dll' -or $_.ModuleName -Like 'ntdll.dll'} | sort -u);if($A[0].Size -ge -1) {foreach ($Module in $A){tasklist /m $Module.ModuleName}};
gps | FL ProcessName, @{l="Modules";e={$_.Modules|Out-String}}
</code></pre></div></div>

<h3 id="obtain-hash-of-unsigned-or-invalid-dlls-currently-loaded-by-processes">Obtain hash of unsigned or invalid DLLs currently loaded by processes</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$A=$(foreach ($dll in gps|select -ExpandProperty modules -ea SilentlyContinue){Get-AuthenticodeSignature $dll.FileName |Where-Object Status -NE "Valid"|Select Path});$B=$(foreach ($dll in $A){Get-FileHash $dll.Path| select Hash -ExpandProperty Hash})|Sort-Object| Get-Unique;$B
</code></pre></div></div>

<h3 id="obtain-list-of-unsigned-dlls-currently-loaded-by-processes">Obtain list of unsigned DLLs currently loaded by processes</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gps | select -exp modules -ea 0 | Select -exp FileName | Get-AuthenticodeSignature|Where-Object Status -NE "Valid"
gps | select -exp modules -ea 0 | Select -exp FileName | Get-AuthenticodeSignature | ? Status -NE "Valid" | FL Path
</code></pre></div></div>

<h3 id="obtain-dll-information-listdlls">Obtain DLL information <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/listdlls">ListDLLs</a></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>listdlls [-r] [-v | -u] [processname|pid]
listdlls [-r] [-v] [-d dllname]
</code></pre></div></div>

<h3 id="unsigned-dlls-loaded-by-processes-using-listdlls">Unsigned DLLs loaded by processes (<a href="https://docs.microsoft.com/en-us/sysinternals/downloads/listdlls">Using ListDLLs</a>)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>listdlls64.exe -u -accepteula
</code></pre></div></div>

<h3 id="obtain-dlls-in-use-by-processes">Obtain DLLs in use by processes</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>listdlls.exe -v processname -accepteula
listdlls.exe -v -d dllname.dll -accepteula
listdlls.exe -d dllname.dll -accepteula
listdlls.exe -v PID -accepteula
</code></pre></div></div>

<h3 id="enable-logging-of-non-non-windows-module-loads-via-wdac-code-integrity">Enable logging of non non-Windows module loads via WDAC code integrity</h3>

<p>Note 1: Special thanks to <a href="https://twitter.com/mattifestation/status/1366435525272481799">Matt Graeber</a> for this.</p>

<p>Note 2: This is based off of a <a href="https://gist.github.com/mgraeber-rc/7b9f4d497d75967afc58209df611508b">Windows Defender Application Control system integrity policy</a> which has been converted on an enterprise system.</p>

<p>On an enterprise system enable it by creating a module load audit policy: https://twitter.com/mattifestation/status/1366435525272481799</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ConvertFrom-CIPolicy Non_Microsoft_UserMode_Load_Audit.xml C:\Windows\System32\CodeIntegrity\SIPolicy.p7b
</code></pre></div></div>

<p>Store the converted policy on a Win10 system to be monitored at: Windows\System32\CodeIntegrity\SIPolicy.p7b</p>

<h3 id="extract-module-dll-sys-and-exe-information-from-wdac-audit-events">Extract Module (DLL, SYS and EXE) information from WDAC Audit Events</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Extract relevant properties from 3076 events
# Modified by Jai Minton @CyberRaiju, based from original work by Matt Graeber @mattifestation 

# On an enterprise system enable it by creating a module load audit policy: https://twitter.com/mattifestation/status/1366435525272481799
	# ConvertFrom-CIPolicy Non_Microsoft_UserMode_Load_Audit.xml C:\Windows\System32\CodeIntegrity\SIPolicy.p7b
# Store the converted policy on a Win10 system to be monitored at: Windows\System32\CodeIntegrity\SIPolicy.p7b
# If you don't have one available you can use a pre-converted one found [here](https://github.com/JPMinty/Misc-Tools/blob/main/Windows-Defender-Application-Control-WDAC/SIPolicy.p7b)

# More information:
# https://gist.githubusercontent.com/mattifestation/de140831d47e15370ba35c1877f39082/raw/8db18ab36723cc9eaf9770c2cadafe46460ff80e/3076EventExtractor.ps1
# https://posts.specterops.io/threat-detection-using-windows-defender-application-control-device-guard-in-audit-mode-602b48cd1c11
# https://github.com/mattifestation/WDACTools

$SigningLevelMapping = @{
[Byte] 0 = 'Unchecked'
[Byte] 1 = 'Unsigned'
[Byte] 2 = 'Enterprise'
[Byte] 3 = 'Custom1'
[Byte] 4 = 'Authenticode'
[Byte] 5 = 'Custom2'
[Byte] 6 = 'Store'
[Byte] 7 = 'Antimalware'
[Byte] 8 = 'Microsoft'
[Byte] 9 = 'Custom4'
[Byte] 0xA = 'Custom5'
[Byte] 0xB = 'DynamicCodegen'
[Byte] 0xC = 'Windows'
[Byte] 0xD = 'WindowsProtectedProcessLight'
[Byte] 0xE = 'WindowsTcb'
[Byte] 0xF = 'Custom6'
}

$CIEvents = Get-WinEvent -FilterHashtable @{ LogName = 'Microsoft-Windows-CodeIntegrity/Operational'; Id = 3076} | ForEach-Object {
	$ScenarioValue = $_.Properties[16].Value.ToString()
	$Scenario = $ScenarioValue
		switch ($Scenario) {
		'0' { $Scenario = 'Kernel-Mode' }
		'1' { $Scenario = 'User-Mode' }
	}
	[PSCustomObject] @{
		TimeCreated = $_.TimeCreated
		MachineName = $_.MachineName
		UserId = $_.UserId
		FileName = $_.Properties[1].Value
		ProcessName = $_.Properties[3].Value
		CertificateSHA1AuthentiCodeHash = [BitConverter]::ToString($_.Properties[8].Value).Replace('-', '')
		CertificateSHA256AuthentiCodeHash = [BitConverter]::ToString($_.Properties[10].Value).Replace('-', '')
		ModuleSHA1Hash = [BitConverter]::ToString($_.Properties[12].Value).Replace('-', '')
		ModuleSHA256Hash = [BitConverter]::ToString($_.Properties[14].Value).Replace('-', '')
		OriginalFileName = $_.Properties[24].Value
		InternalName = $_.Properties[26].Value
		FileDescription = $_.Properties[28].Value
		ProductName = $_.Properties[30].Value
		FileVersion = $_.Properties[31].Value
		SISigningScenario = $Scenario
		RequestedSigningLevel = $SigningLevelMapping[$_.Properties[4].Value]
		ValidatedSigningLevel = $SigningLevelMapping[$_.Properties[5].Value]
		PolicyHash = [BitConverter]::ToString($_.Properties[22].Value).Replace('-', '')
	}
}
$CIEvents
</code></pre></div></div>

<h3 id="determine-handles-on-a-file">Determine handles on a file</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>handle [[-a] [-u] | [-c [handle] [-l] [-y]] | [-s]] [-p [processname]|[pid]] [filename]
handle -a -u -s -p exp
handle windows\system
</code></pre></div></div>

<h3 id="verify-eternalblue-patch-ms17-010-is-installed---microsoft">Verify EternalBlue Patch (MS17-010) is installed - <a href="https://support.microsoft.com/en-us/help/4023262/how-to-verify-that-ms17-010-is-installed">Microsoft</a></h3>

<p>Note: This impacts the SMB 1.0 Server Driver, if you don’t have the below, then it’s not installed. If you do you can use the above to determine patch level.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>get-item C:\Windows\system32\drivers\srv.sys | FL VersionInfo
get-hotfix -id KB&lt;111111&gt;
</code></pre></div></div>

<h3 id="obtain-txt-records-from-recently-resolved-domains">Obtain TXT records from recently resolved domains</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foreach ($domains in Get-DnsClientCache){Resolve-DnsName $domains.Entry -Type "TXT"|Select Strings|? Strings -NotLike ""};
</code></pre></div></div>

<h3 id="check-all-appdata-files-for-unsigned-or-invalid-executables">Check all Appdata files for unsigned or invalid executables</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-ChildItem -Recurse $env:APPDATA\..\*.exe -ea SilentlyContinue| ForEach-object {Get-AuthenticodeSignature $_ -ea SilentlyContinue} | Where-Object {$_.status -ine "Valid"}|Select Status,Path
</code></pre></div></div>

<h3 id="check-for-execuables-in-local-system-user-profile-and-files">Check for execuables in Local System User Profile and Files</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-ChildItem C:\Windows\*\config\systemprofile -recurse -force -ea 0 -include *.exe, *.dll *.lnk
</code></pre></div></div>

<h3 id="investigate-wmi-usage">Investigate WMI Usage</h3>

<p>Note: Requires <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/strings">Strings</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>strings -q C:\windows\system32\wbem\repository\objects.data
</code></pre></div></div>

<h3 id="find-executables-and-scripts-in-path-directories-envpath">Find executables and scripts in Path directories ($env:Path)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-Command * -Type Application | FT -AutoSize
Get-Command -Name * | FL FileVersionInfo
</code></pre></div></div>

<h3 id="powershell-command-history">PowerShell Command History</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-History
</code></pre></div></div>

<h3 id="find-files-createdwritten-based-on-date">Find files created/written based on date</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-ChildItem [file] | Select-Object CreationTime
Get-ChildItem C:\ -recurse -ea SilentlyContinue -force | where-object { $_.CreationTime.Date -match "12/25/2014"}
Get-ChildItem C:\ -recurse -ea SilentlyContinue -force | where-object { $_.LastWriteTime -match "12/25/2014"}
Get-ChildItem C:\ -recurse -ea SilentlyContinue -force | where-object { $_.CreationTime.Hour -gt 2 -and $_.CreationTime.Hour -lt 15}
</code></pre></div></div>

<h3 id="check-running-executables-for-malware-via-virustotal">Check running executables for malware via VirusTotal</h3>

<p><strong>Note: VT Has a rate limit for the Public API so this won’t work if you are using the Public API. All 1 liners require VTAPIKey to be set as your VirusTotal API key</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foreach ($process in Get-WmiObject win32_process | where {$_.ExecutablePath -notlike ""}) {Invoke-RestMethod -Method 'POST' -Uri 'https://www.virustotal.com/vtapi/v2/file/report' -Body @{ resource =(Get-FileHash $process.ExecutablePath | select Hash -ExpandProperty Hash); apikey = "[VTAPIKey]"}}
</code></pre></div></div>

<p><strong>This query uses a 15 second timeout to ensure only 4 queries are submitted a minute</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foreach ($process in Get-WmiObject win32_process | where {$_.ExecutablePath -notlike ""}) {Invoke-RestMethod -Method 'POST' -Uri 'https://www.virustotal.com/vtapi/v2/file/report' -Body @{ resource =(Get-FileHash $process.ExecutablePath | select Hash -ExpandProperty Hash); apikey = "[VTAPIKey]"};Start-Sleep -Seconds 15;}
</code></pre></div></div>

<p><strong>This query uses a 15 second timeout to ensure only 4 queries are submitted a minute and only unique hashes are queried</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$A = $( foreach ($process in Get-WmiObject win32_process | where {$_.ExecutablePath -notlike ""}) {Get-FileHash $process.ExecutablePath | select Hash -ExpandProperty Hash}) |Sort-Object| Get-Unique -AsString; foreach ($process in $A) {Invoke-RestMethod -Method 'POST' -Uri 'https://www.virustotal.com/vtapi/v2/file/report' -Body @{ resource =($process); apikey = "[VTAPIKey]"};Start-Sleep -Seconds 15;} 
</code></pre></div></div>

<h3 id="scan-systems-for-ioaioc-yara">Scan systems for IOA/IOC (Yara)</h3>

<p><a href="https://github.com/Neo23x0/Loki">Loki Scanner</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>loki-upgrader.exe
loki.exe -p [Directory]
</code></pre></div></div>

<p><a href="https://www.crowdstrike.com/resources/community-tools/crowdresponse/">Crowdresponse Scanner</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CrowdResponse -v -i config.txt -o out.xml
</code></pre></div></div>

<p><a href="https://binalyze.com/download/irec/">IREC Tactical</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>IREC.exe --triage-memory
IREC.exe -ad "\\MACHINE\IREC-DIR" --triage-ruleset MyYaraRules --triage-memory 
</code></pre></div></div>

<p><a href="https://github.com/virustotal/yara/releases/latest">Yara</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yara32.exe -d filename=[file defined in ruleset.yar] [ruleset.yar] [file to scan]
yara32.exe -d filename=[svchost.exe] [ruleset.yar] -r [directory to scan]
yara64.exe yararule.yar -r C:
yara64.exe yararule.yar -r C: -f 2&gt; $null
</code></pre></div></div>

<p>Yara Linux</p>

<p>Note: -s shows matching yara strings.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yara rule.yara malware.exe -s
yara rule.yara [Directory] -s
</code></pre></div></div>

<p>For more creation and usage of Yara, refer to <a href="https://www.jaiminton.com/Tutorials/PracticalMalwareAnalysis">PMA Writeup</a></p>

<h3 id="use-snort-to-test-a-created-snort-rule-over-a-pcap">Use Snort to test a created Snort rule over a pcap</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>snort -A fast --pcap-single=./pcap.pcap -c ./strrat.rules -l /var/log/snort
</code></pre></div></div>

<h3 id="kill-malicious-process">Kill malicious process</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wmic process where name="malware.exe" call terminate
wmic process where processid=[PID] delete
taskkill /IM malware.exe
taskkill /PID [PID] /T
</code></pre></div></div>

<p>Note: Call terminate allows you to specify an exit status in terms of a signed integer or a quoted negative value. Both methods essentially function the same by calling TerminateProcess.</p>

<h3 id="dump-full-process-memory">Dump full process memory</h3>

<p>(procdump requires systinternals procdump.exe)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>procdump -ma [processID]
</code></pre></div></div>

<h3 id="live-triage-of-memory">Live Triage of Memory</h3>

<p>Shout-out to Matt Graeber, Jared Atkinson and Joe Desimone for the awesome work that has gone into these scripts. 
Note: Not all tested, appears to work with a standard Meterpreter payload, and by default with Cobalt Strike.</p>

<ul>
  <li><a href="https://github.com/JPMinty/PowerShellArsenal">PowerShellArsenal</a></li>
  <li><a href="https://gist.github.com/JPMinty/beffcd18d8ec06b73643c2f38cde384d">Get-InjectedThread</a></li>
</ul>

<h4 id="locate-possible-shellcode-within-process-via-injected-thread">Locate Possible Shellcode within process via Injected Thread</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Import-Module .\Get-InjectedThread.ps1
Get-InjectedThread
</code></pre></div></div>

<h4 id="obtain-possible-shellcode-within-process-as-hex">Obtain Possible Shellcode within process as Hex</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(Get-InjectedThread|Select -exp Bytes|ForEach-Object ToString X2) -join ''
(Get-InjectedThread|? {$_.ThreadId -match '{PID}'}|Select -exp Bytes|ForEach-Object ToString X2) -join ''
</code></pre></div></div>

<h4 id="obtain-possible-shellcode-within-process-as-hex-1">Obtain Possible Shellcode within process as Hex</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(Get-InjectedThread|Select -exp Bytes|ForEach-Object ToString X2) -join '\x'
(Get-InjectedThread|? {$_.ThreadId -match '{PID}'}|Select -exp Bytes|ForEach-Object ToString X2) -join '\x'
</code></pre></div></div>

<h4 id="basic-memory-analysis-via-powershellarsenal">Basic Memory Analysis via PowerShellArsenal</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import-module .\PowerShellArsenal.psd1
Find-ProcessPEs
Get-ProcessStrings
Get-ProcessMemoryInfo -ProcessID {PID}
Get-VirtualMemoryInfo
</code></pre></div></div>

<h4 id="locate-possible-shellcode-address-space">Locate Possible Shellcode Address Space</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-ProcessMemoryInfo {PID} | ? {$_.AllocationProtect -eq "PAGE_EXECUTE_READWRITE"}
</code></pre></div></div>

<h4 id="find-meterpreter-in-process-memory">Find Meterpreter in Process Memory:</h4>

<p>Ref: <a href="https://github.com/rapid7/metasploit-framework/wiki/Meterpreter">Meterpreter Wiki</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Find-ProcessPEs {PID} | ?{$_.ModuleName -eq "metsrv.dll" -OR $_.ModuleName -eq "ext_server_stdapi.dll" -OR $_.ModuleName -like "ext_server_*.dll"} | FL ProcessID,ModuleName,Imports;
$A=$(gps | Select -exp Id); foreach ($process in $A){Find-ProcessPEs $process | ?{$_.ModuleName -eq "metsrv.dll"} | FL ProcessID,ModuleName,Imports};
$A=$(gps | Select -exp Id);	foreach ($process in $A){Find-ProcessPEs $process | ?{$_.ModuleName -eq "metsrv.dll" | FL ProcessID,ModuleName,Imports};
$A=$(gps | Select -exp Id);	foreach ($process in $A){Find-ProcessPEs $process | ?{$_.ModuleName -eq "metsrv.dll" -OR $_.ModuleName -eq "ext_server_stdapi.dll" -OR $_.ModuleName -like "ext_server_*.dll"} | FL ProcessID,ModuleName,Imports};
</code></pre></div></div>

<h4 id="find-cobalt-strike-in-process-memory">Find Cobalt Strike in Process Memory:</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Find-ProcessPEs {PID} | ?{$_.ModuleName -eq "beacon.dll" -OR $_.ModuleName -eq "beacon x64.dll" -OR $_.ModuleName -eq "beacon.x64.dll"} | FL ProcessID,ModuleName,Imports;
$A=$(gps | Select -exp Id); foreach ($process in $A){Find-ProcessPEs $process | ?{$_.ModuleName -eq "beacon.dll"} | FL ProcessID,ModuleName,Imports};
</code></pre></div></div>

<h3 id="network-connections">Network connections</h3>

<p>(tcpvcon requires sysintenals tcpvcon.exe):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ipconfig /all
netstat –anob
netstat -ano
Tcpvcon -a
</code></pre></div></div>

<h3 id="routing-table-and-arp-cache">Routing table and ARP cache</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>route print
arp -a
Get-NetNeighbor
</code></pre></div></div>

<h3 id="contents-of-dns-resolver">Contents of DNS resolver</h3>

<p>(useful for recent web history)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ipconfig /displaydns
Get-DnsClientCache | FT -AutoSize
</code></pre></div></div>

<h3 id="currently-connected-access-point-name-wifi">Currently connected Access Point name (WiFi)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\system\CurrentControlSet\Services\Dnscache\Parameters\DnsActiveIfs\ /s
netsh wlan show interfaces
</code></pre></div></div>

<h3 id="previously-connected-access-point-names-wifi">Previously connected Access Point names (WiFi)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh wlan show profile
</code></pre></div></div>

<h3 id="current-surrounding-access-point-names-wifi">Current surrounding Access Point names (WiFi)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh wlan show network mode=bssid 
</code></pre></div></div>

<h3 id="extended-network-adapter-configuration-information">Extended network adapter configuration information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\system\CurrentControlSet\Services\Tcpip\Parameters\ /s
reg query HKLM\system\CurrentControlSet\Services\Tcpip6\Parameters\ /s
</code></pre></div></div>

<h3 id="enable-dns-logging">Enable DNS Logging</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wevtutil set-log "Microsoft-Windows-DNS-Client/Operational" /enabled:true
</code></pre></div></div>

<p>OR</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$DNSLogs = 'Microsoft-Windows-DNS-Client/Operational'
$DNSContainer = New-Object System.Diagnostics.Eventing.Reader.EventLogConfiguration $logName
$DNSContainer.IsEnabled=$true
$DNSContainer.SaveChanges()
</code></pre></div></div>

<h3 id="scan-dns-logs">Scan DNS Logs</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-DNS-Client/Operational'; Id='3010';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-DNS-Client/Operational'; Id='3020';} | FL TimeCreated,Message
</code></pre></div></div>

<h3 id="scan-dns-logs-and-output-unique-dns-queries">Scan DNS Logs and output unique DNS Queries</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$events=Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-DNS-Client/Operational'; Id='3020';};
$output = @();
foreach ($Event in $events){
$data = New-Object -TypeName PSObject;
$XML = [xml]$Event.ToXml();
$query=$XML.Event.EventData.Data|?{$_.Name -eq 'QueryName'} | Select -exp InnerText;
$result=$XML.Event.EventData.Data|?{$_.Name -eq 'QueryResults'} | Select -exp InnerText;
$data `
| Add-Member NoteProperty Query "$query" -PassThru `
| Add-Member NoteProperty QueryResults "$result" -PassThru | Out-Null
$output += $data;
}
$output = $output | sort Query | unique -AsString;
$output
</code></pre></div></div>

<h3 id="hostname-to-corresponding-ips-from-list">Hostname to corresponding IPs from list</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$listofhostnames = cat Hostnames.txt;
foreach ($hostname in $listofhostnames){
try{[System.Net.Dns]::gethostaddresses("$hostname")|FT $hostname, IPAddressToString}catch
{}}
</code></pre></div></div>

<h3 id="t1074-data-staging">T1074 Data Staging</h3>

<p>Note: Examples of some known staging directories, lots of false positives likely.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci C:\ProgramData\ -recurse -include .* -ea 0 -force | ?{ $_.PSIsContainer }
gci C:\Windows\Temp -recurse -ea 0 -force | ?{ $_.PSIsContainer }
ls C:\ProgramData\tmp\log.log
ls C:\ProgramData\log.log
ls C:\ProgramData\google\
ls C:\ProgramData\Sun\low
ls env:temp\SMB
ls C:\ProgramData\.rnd
ls C:\inetpub\
</code></pre></div></div>

<h3 id="latest-system-activities">Latest system activities</h3>

<p>(requires Nirsoft’s LastActivityView)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LastActivityView.exe /shtml "LastActivityView.html"
</code></pre></div></div>

<h3 id="driver-information">Driver information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wmic sysdriver list brief /format:csv
driverquery
driverquery /FO list /v
driverquery /si
wmic sysdriver list full
</code></pre></div></div>

<h3 id="process-and-extra-information">Process and extra information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tasklist /m
tasklist /m /fi "pid eq [PID]"
tasklist /svc
wmic process where processid=[PID] get commandline
tasklist /v
</code></pre></div></div>

<h3 id="hosts-file-and-serviceport-mapping">Hosts file and service&gt;port mapping</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>type %SystemRoot%\System32\drivers\etc\hosts
type %SystemRoot%\System32\drivers\etc\services
</code></pre></div></div>

<h3 id="recycle-bin-forensics">Recycle Bin Forensics</h3>

<ul>
  <li>Named as $I = Metadata of file (Info)</li>
  <li>Named as $R = The file contents itself (Recovery)</li>
  <li>Located at %SystemDrive%\$Recycle.Bin in win vista and later commonly (C:\$Recycle.Bin)</li>
  <li>Use dir /a via cmd to show recycle bin SID folders and files</li>
</ul>

<h3 id="dcom-information--firewall-rules">DCOM Information + Firewall Rules</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wmic dcomapp get /all /format:List
netsh advfirewall firewall show rule dir=in name=all | Select-String -Pattern 'dcom' -Context 2,11
</code></pre></div></div>

<h3 id="service-information">Service Information</h3>

<p>(psservice requires sysinternals psservice.exe):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wmic service list full
net start
sc query
wmic loadorder
psservice
</code></pre></div></div>

<h3 id="stop-and-disabledelete-malicious-service">Stop and disable/delete malicious service</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>net stop [servicename]
sc config [servicename] start= disabled
sc delete [servicename]
</code></pre></div></div>

<h3 id="disable-internet-explorer">Disable Internet Explorer</h3>

<p><a href="https://support.microsoft.com/en-us/help/4013567/how-to-disable-internet-explorer-on-windows">More Information: MS Docs</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dism /online /Disable-Feature /FeatureName:Internet-Explorer-Optional-amd64
</code></pre></div></div>

<h3 id="cmd-history">cmd history</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>doskey /history
</code></pre></div></div>

<p>Linux Subsystem for Windows 10 may have history in a location such as:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\[User]\AppData\Local\Packages\CanonicalGroupLimited.UbuntuonWindows_79rhkp1fndgsc\LocalState\rootfs\home\[user]
</code></pre></div></div>

<h3 id="files-greater-than-a-10mb">Files greater than a 10mb</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FOR /R C:\ %i in (*) do @if %~zi gtr 10000000 echo %i %~zi
</code></pre></div></div>

<h3 id="temp-files-greater-than-10mb">Temp files greater than 10mb</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FOR /R C:\Users\[User]\AppData %i in (*) do @if %~zi gtr 10000000 echo %i %~zi
</code></pre></div></div>

<h3 id="locate-process-handles-eg-files-open-by-process">Locate process handles (e.g. files open by process)</h3>
<p><em>Note: Requires handles/handles64.exe from sysinternals</em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>handle64.exe -p [PID/name] -nobanner
handle64.exe -a -p [PID/name] -nobanner
handle64.exe -a -l -p [PID/name] -nobanner
handle64.exe -a -l -u -p keepass -nobanner
</code></pre></div></div>

<h3 id="close-process-handles-eg-files-open-by-process">Close process handles (e.g. files open by process)</h3>
<p><em>Note: Requires handles/handles64.exe from sysinternals</em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>handle64.exe -c [hexhandleref] -p [PID] -nobanner
handle64.exe -c [hexhandleref] -y -p [PID] -nobanner
</code></pre></div></div>

<h3 id="event-logs-between-a-timeframe">Event logs between a timeframe</h3>

<p>This tool is useful for gathering all windows events within a given timeframe: 
<a href="https://github.com/BeanBagKing/EventFinder2">Event Finder2</a></p>

<h3 id="check-audit-policies">Check audit policies</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>auditpol /get /category:*
</code></pre></div></div>

<h3 id="set-logging-on-all-successfailure-events">Set logging on all success/failure events</h3>

<p>(WARNING THIS WILL PRODUCE A LOT OF NOISE, TAILOR TO YOUR NEEDS)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>auditpol /set /category:* /success:enable /failure:enable
</code></pre></div></div>

<h3 id="enable-logging-of-process-creation">Enable logging of process creation</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>auditpol /set /subcategory:"Process Creation" /success:enable /failure:enable
</code></pre></div></div>

<h3 id="scan-process-creation-logs-for-appdata">Scan process creation logs for ‘appdata’</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4688';}| ? {$_.Message -match 'appdata'}|FL TimeCreated, Message
</code></pre></div></div>

<h3 id="parse-process-creation-logs">Parse process creation logs</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ProcessSpawnEvents = Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4688';} | ForEach-Object {
	[PSCustomObject] @{
		TimeCreated = $_.TimeCreated
		MachineName = $_.MachineName
		UserSid = $_.Properties[0].Value
		UserName = $_.Properties[1].Value
		UserDomainName = $_.Properties[2].Value
		SubjectLogonId = $_.Properties[3].Value
		ProcessId = $_.Properties[4].Value
		ProcessName = $_.Properties[5].Value
		TokenElevationType = $_.Properties[6].Value
		ParentProcessId = $_.Properties[7].Value
		CommandLine = $_.Properties[8].Value
		TargetUserSid = $_.Properties[9].Value
		TargetUserName = $_.Properties[10].Value
		TargetDomainName = $_.Properties[11].Value
		TargetLogonId = $_.Properties[12].Value
		ParentProcessName = $_.Properties[13].Value
		MandatoryLabel = $_.Properties[14].Value
	}
}
$ProcessSpawnEvents
</code></pre></div></div>

<h3 id="check-for-windows-security-logging-bypass">Check for Windows Security Logging Bypass</h3>

<p>Special thanks to <a href="https://twitter.com/0gtweet/status/1182516740955226112">Grzegorz Tworek - 0gtweet</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\System\CurrentControlSet\Control\MiniNt
</code></pre></div></div>

<h3 id="check-group-policies">Check group policies</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gpresult /Z /SCOPE COMPUTER
gpresult /Z /SCOPE USER
gpresult /R /SCOPE COMPUTER
gpresult /R /SCOPE USER
gpresult /r /z
ls C:\Users\[username]\AppData\Local\GroupPolicy\DataStore
ls C:\Windows\system32\GroupPolicy\DataStore
</code></pre></div></div>

<h3 id="obtain-mode-settings-for-ports">Obtain mode settings for ports</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mode
</code></pre></div></div>

<h3 id="event-logs-for-offline-analysis">Event Logs for offline analysis</h3>

<p>Event logs can be found: %SystemRoot%\System32\winevt\Logs</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wevtutil epl System [Location]\System.evtx
wevtutil epl Security [Location]\Security.evtx
wevtutil epl Application [Location]\Application.evtx
wevtutil epl "Windows PowerShell" [Location]\Powershell.evtx
</code></pre></div></div>

<p>OR:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>esentutl.exe /y /vss C:\Windows\System32\winevt\Logs\Security.evtx /d [Location]\Security.evtx
</code></pre></div></div>

<p>Copy all event logs:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>XCOPY C:\Windows\System32\winevt\Logs [Location] /i
XCOPY C:\WINDOWS\system32\LogFiles\ [Location] /i
</code></pre></div></div>

<h3 id="user-access-logging-ual-kstrike-parser"><a href="https://github.com/brimorlabs/KStrike">User Access Logging (UAL) KStrike Parser</a></h3>

<p>Note: More information can be found <a href="https://docs.microsoft.com/en-us/windows-server/administration/user-access-logging/manage-user-access-logging">here</a>. Special thanks to Brimor Labs.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>KStrike.py SYSTEMNAME\Current.mdb &gt; Current_mdb.txt
</code></pre></div></div>

<p>mdb Files are found at the below:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%SystemRoot%\Windows\System32\Logfiles\SUM
</code></pre></div></div>

<p>More information available on the <a href="https://www.crowdstrike.com/blog/user-access-logging-ual-overview/">CrowdStrike Blog - Patrick Bennett</a></p>

<h3 id="quickly-scan-event-logs-with-deepbluecli">Quickly scan event logs with <a href="https://github.com/sans-blue-team/DeepBlueCLI">DeepblueCLI</a></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.\DeepBlue.ps1 .\evtx\psattack-security.evtx | FL
</code></pre></div></div>

<h3 id="event-tracing-for-windows-etw">Event Tracing for Windows (ETW).</h3>

<p>Event tracing is how a Provider (an application that contains event tracing instrumentation) creates items within the Windows Event Log for a consumer. This is how event logs are generated, and is also a way they can be tampered with. More information on this architecture can be found below.</p>

<p><a href="https://docs.microsoft.com/en-us/windows/win32/etw/about-event-tracing">Event Tracing Architecture</a></p>

<p>A great <a href="https://medium.com/palantir/tampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63">post by Matt Graeber</a> goes into some depth on how this works and some common ways of interacting with ETW Traces.</p>

<h4 id="list-running-trace-sessions">List Running Trace Sessions</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>logman query -ets
</code></pre></div></div>

<h4 id="list-providers-that-a-trace-session-is-subscribed-to">List Providers That a Trace Session is Subscribed to</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>logman query "EventLog-System" -ets
</code></pre></div></div>

<h4 id="list-all-etw-providers">List all ETW Providers</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>logman query providers
reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\
</code></pre></div></div>

<h4 id="view-providers-process-is-sending-events-to">View providers process is sending events to</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>logman query providers -pid {PID}
</code></pre></div></div>

<h3 id="setup-custom-log-tracing">Setup Custom Log Tracing</h3>

<p>Special thanks to <a href="https://twitter.com/spotheplanet">Spotless</a> for his <a href="https://www.ired.team/miscellaneous-reversing-forensics/etw-event-tracing-for-windows-101">crash course</a></p>

<h4 id="query-providers-available-and-their-keyword-values">Query Providers Available and their keyword values</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>logman query providers
logman query providers Microsoft-Windows-WinHttp
</code></pre></div></div>

<p>Note: Take note of wanted values.</p>

<h4 id="initiate-tracing-session">Initiate Tracing Session</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>logman create trace [TRACENAMEHERE] -ets
logman query [TRACENAMEHERE] -ets
</code></pre></div></div>

<h3 id="update-trace-with-wanted-providers">Update trace with wanted providers</h3>

<p>Note: the mask is the combined values wanted. For example if a keyword was 0x1 and another 0x16 and you wanted both you’d use 0x17.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>logman update [TRACENAMEHERE] -p Microsoft-Windows-WinHttp 0x100000000 -ets
</code></pre></div></div>

<h3 id="delete-subscription-and-providers">Delete Subscription and Providers</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>logman update trace [TRACENAMEHERE] --p Microsoft-Windows-WinHttp 0x100000000 -ets
logman stop [TRACENAMEHERE] -ets
</code></pre></div></div>

<h3 id="event-logtracing-tampering-detection">Event Log/Tracing Tampering Detection</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\SYSTEM\CurrentControlSet\Services\EventLog\ /s /v File
reg query HKLM\SYSTEM\CurrentControlSet\Services\EventLog\ /s /v MaxSize
reg query HKLM\SYSTEM\CurrentControlSet\Services\EventLog\ /s /v Retention
sc.exe query eventlog
gci REGISTRY::HKLM\SYSTEM\CurrentControlSet\Control\WMI\Autologger\ -recurse
reg query HKLM\SYSTEM\CurrentControlSet\control\WMI\AutoLogger\ /s /v enable*
</code></pre></div></div>

<h3 id="timeline-windows-event-logs">Timeline Windows Event Logs.</h3>

<p>An easy way to explore Windows event logs is to dump them into a normalized csv format using EvtxExplorer.</p>

<p><a href="https://ericzimmerman.github.io/#!index.md">EvtxExplorer:</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>EvtxECmd.exe -d "C:\Windows\System32\winevt\Logs" --csv C:\ --csvf AllEvtx.csv
</code></pre></div></div>

<p>From here you can analyse the CSV using Timeline explorer to view relevant information and group by MAPs.</p>

<p><a href="https://ericzimmerman.github.io/#!index.md">TimelineExplorer:</a></p>

<h3 id="super-timeline-a-host">Super Timeline a host:</h3>

<p>This can be done using <a href="https://plaso.readthedocs.io/en/latest/">Plaso (Log2Timeline)</a></p>

<p>Common IIS logs can often be found in the below locations:</p>

<ul>
  <li>%SystemDrive%\inetpub\logs\LogFiles</li>
  <li>%SystemRoot%\System32\LogFiles\W3SVC1</li>
  <li>%SystemDrive%\inetpub\logs\LogFiles\W3SVC1
    <ul>
      <li>Note: replace 1 with the number for your IIS website ID</li>
    </ul>
  </li>
  <li>%SystemDrive%\Windows\System32\LogFiles\HTTPERR</li>
</ul>

<p>Common Apache logs can often be found in the below locations:</p>

<ul>
  <li>/var/log</li>
  <li>/var/log/httpd/access.log</li>
  <li>/var/log/apache/access.log</li>
  <li>/var/log/apache2/access.log</li>
  <li>/var/log/httpd-access.log</li>
</ul>

<p>Other logs can be found in the below, often using the Event Trace Log (ETL) format:</p>

<ul>
  <li>C:\Windows\System32\LogFiles</li>
  <li>C:\Windows\Panther</li>
</ul>

<p>ETL format can be parsed using tracerpt which is included in Windows, some examples below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tracerpt C:\Windows\System32\LogFiles\WMI\Terminal-Services-RPC-Client.etl
tracerpt logfile1.etl logfile2.etl -o logdump.xml -of XML
tracerpt logfile.etl -o logdmp.xml -of XML -lr -summary logdmp.txt -report logrpt.xml
tracerpt logfile1.etl logfile2.etl -o -report
tracerpt logfile.etl counterfile.blg -report logrpt.xml -df schema.xml
tracerpt -rt "NT Kernel Logger" -o logfile.csv -of CSV
</code></pre></div></div>

<p>Software specific logs are often stored in readable formats at any of the following locations.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%AppData%\[softwarename] (e.g. C:\Users\[username]\AppData\Roaming\[softwarename]\)
%LocalAppData%\[softwarename] (e.g. C:\Users\[username]\AppData\Local\[softwarename]\)
%programfiles%\[softwarename] (e.g. C:\Program Files\[softwarename]\)
%programfiles(x86)%\[softwarename] (e.g. C:\Program Files (x86)\[softwarename]\)
</code></pre></div></div>

<p>You may also find useful memory crashdumps at the below:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\[username]\AppData\Local\CrashDumps
C:\Users\[username]\AppData\Local\Microsoft\Windows\WER\
</code></pre></div></div>

<h3 id="security-log-information">Security log information</h3>

<p>Note: Logs and their event codes have changed over time. Most of the references here are for Windows Vista and Server 2008 onwards rather than Windows 2000,XP,Server 2003. More information on them may be added in the future if required.</p>

<p>(psloglist requires psloglist.exe from systinternals):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wevtutil qe security /f:text
eventquery.vbs /L security
wevtutil qe security /f:text | Select-String -Pattern "Event ID: [EventCode]" -Context 2,20
wevtutil qe security /f:text | Select-String -Pattern "Event ID: [EventCode]" -Context 2,20 | findstr "Account Name:"
psloglist -s -x security
</code></pre></div></div>

<p>Note: Some suspicious events - “Event log service was stopped”, “Windows File Protection is not active on this system”, “The MS Telnet Service has started successfully”</p>
<ul>
  <li>Security: 4720 (Account created)</li>
  <li>Security: 4722 (Account enabled)</li>
  <li>Security: 4724 (Password reset)</li>
  <li>Security: 4723 (User changed password)</li>
  <li>Security: 4736 (Account deleted)</li>
  <li>Security: 4781 (Account renamed)</li>
  <li>Security: 4738 (User account change)</li>
  <li>Security: 4688 (A new process has been created)</li>
  <li>Security: 4732 (Account added to a group)</li>
  <li>Security: 4733 (Account removed from a group)</li>
  <li>Security: 1102 (Audit log cleared)</li>
  <li>Security: 4614 (Security System Extension)</li>
  <li>Security: 4672 (Special privileges assigned to new logon)</li>
  <li>Security: 4624 (Account successfully logged on)</li>
  <li>Security: 4698 (Scheduled Task Creation)</li>
  <li>Security: 4702 (Scheduled Task Modified)</li>
  <li>Security: 4699 (Scheduled Task Deleted)</li>
  <li>Security: 4701 (Scheduled Task Disabled)</li>
  <li>Security: 4700 (Scheduled Task Enabled)</li>
  <li>Security: 4697 (Service Installation)</li>
  <li>Security: 4625 (Account failed to log on)</li>
  <li>Security: 4776 (The domain controller attempted to validate credentials for an account)</li>
  <li>Security: 4634 (Account successfully logged off)</li>
  <li>Security: 4740 (A user account was locked out)</li>
  <li>Security: 4767 (A user account was unlocked)</li>
  <li>Security: 4778 (Remote Desktop session reconnected)</li>
  <li>Security: 4779 (Remote desktop session disconnected)</li>
  <li>Security: 4625 (A user account failed to log on)</li>
  <li>Security: 4648 (A logon was attempted using explicit credentials)</li>
  <li>Security: 4768 (A Kerberos authentication ticket (TGT) was requested)
    <ul>
      <li>0x6 (The username doesn’t exist) - Bad username or not yet replicated to DC</li>
      <li>0xC (Start time is later than end time - Restricted workstation)</li>
      <li>0x12 (Account locked out, disabled, expired, restricted, or revoked etc)</li>
    </ul>
  </li>
  <li>Security: 4769 (A Kerberos service ticket was requested)</li>
  <li>Security: 4770 (A Kerberos service ticket was renewed)</li>
  <li>Security: 4771 (Kerberos pre-authentication failed)
    <ul>
      <li>0x10 - Smart card logon is being attempted and the proper certificate cannot be located.</li>
      <li>0x17 - The user’s password has expired.</li>
      <li>0x18 - The wrong password was provided.</li>
    </ul>
  </li>
  <li>Security: Greater than 4720 Eand less than 4764 (Account/group modifications)</li>
</ul>

<h3 id="logon-type-information">Logon type information</h3>
<ul>
  <li>Type: 0 (Used only by System account authentications)</li>
  <li>Type: 2 (Interactive Logon)
    <ul>
      <li>User is at the keyboard.</li>
    </ul>
  </li>
  <li>Type: 3 (Network Authentication/SMB Auth Logon)
    <ul>
      <li>Auth over the network. Note: RDP can fall under this if Network Level Authentication is enabled.</li>
    </ul>
  </li>
  <li>Type: 4 (Batch Logon)
    <ul>
      <li>More often than not from a Scheduled Task.</li>
    </ul>
  </li>
  <li>Type: 5 (Service Logon)
    <ul>
      <li>More often than not from a Service.</li>
    </ul>
  </li>
  <li>Type: 7 (Unlock Logon)
    <ul>
      <li>User is at the keyboard unlocking it after lunch.</li>
    </ul>
  </li>
  <li>Type: 8 (Network Cleartext Logon)
    <ul>
      <li>Basically Logon Type 3 but creds are in the clear.</li>
    </ul>
  </li>
  <li>Type: 9 (New Credentials Logon)
    <ul>
      <li>More often than not from using ‘RunAs’ with the ‘/netonly’ parameter.</li>
    </ul>
  </li>
  <li>Type: 10 (Terminal/RDP Logon Type)
    <ul>
      <li>Logon via Terminal Services/RDP.</li>
    </ul>
  </li>
  <li>Type: 11 (Cached Interactive)
    <ul>
      <li>Logon when unable to connect to domain (Cached Creds locally).</li>
    </ul>
  </li>
  <li>Type: 12 (Cached Remote Interactive)
    <ul>
      <li>Same as RemoteInteractive. This is used for internal auditing.</li>
    </ul>
  </li>
  <li>Type: 13 (Cached Unlock Logon)
    <ul>
      <li>Same as Unlock Logon except with cached creds.</li>
    </ul>
  </li>
</ul>

<h3 id="special-logon-information-4672">Special logon information (4672)</h3>

<table>
  <thead>
    <tr>
      <th>Privilege Name</th>
      <th>Description</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>SeAssignPrimaryTokenPrivilege</td>
      <td>Replace a process-level token</td>
      <td>Required to assign the primary token of a process. With this privilege, the user can initiate a process to replace the default token associated with a started subprocess.</td>
    </tr>
    <tr>
      <td>SeAuditPrivilege</td>
      <td>Generate security audits</td>
      <td>With this privilege, the user can add entries to the security log.</td>
    </tr>
    <tr>
      <td>SeBackupPrivilege</td>
      <td>Back up files and directories</td>
      <td>Required to perform backup operations. With this privilege, the user can bypass file and directory, registry, and other persistent object permissions for the purposes of backing up the system. This privilege causes the system to grant all read access control to any file, regardless of the access control list (ACL) specified for the file. Any access request other than read is still evaluated with the ACL.</td>
    </tr>
    <tr>
      <td>SeCreateTokenPrivilege</td>
      <td>Create a token object</td>
      <td>Allows a process to create a token which it can then use to get access to any local resources when the process uses NtCreateToken() or other token-creation APIs. When a process requires this privilege, we recommend using the LocalSystem account (which already includes the privilege), rather than creating a separate user account and assigning this privilege to it.</td>
    </tr>
    <tr>
      <td>SeDebugPrivilege</td>
      <td>Debug programs</td>
      <td>Required to debug and adjust the memory of a process owned by another account.With this privilege, the user can attach a debugger to any process or to the kernel. We recommend that SeDebugPrivilege always be granted to Administrators, and only to Administrators. Developers who are debugging their own applications do not need this user right. Developers who are debugging new system components need this user right. This user right provides complete access to sensitive and critical operating system components.</td>
    </tr>
    <tr>
      <td>SeEnableDelegationPrivilege</td>
      <td>Enable computer and user accounts to be trusted for delegation</td>
      <td>With this privilege, the user can set the Trusted for Delegation setting on a user or computer object.The user or object that is granted this privilege must have write access to the account control flags on the user or computer object.</td>
    </tr>
    <tr>
      <td>SeImpersonatePrivilege</td>
      <td>Impersonate a client after authentication</td>
      <td>With this privilege, the user can impersonate other accounts.</td>
    </tr>
    <tr>
      <td>SeLoadDriverPrivilege</td>
      <td>Load and unload device drivers</td>
      <td>Required to load or unload a device driver.With this privilege, the user can dynamically load and unload device drivers or other code in to kernel mode. This user right does not apply to Plug and Play device drivers.</td>
    </tr>
    <tr>
      <td>SeRestorePrivilege</td>
      <td>Restore files and directories</td>
      <td>Required to perform restore operations. This privilege causes the system to grant all write access control to any file, regardless of the ACL specified for the file. Any access request other than write is still evaluated with the ACL. Additionally, this privilege enables you to set any valid user or group SID as the owner of a file. With this privilege, the user can bypass file, directory, registry, and other persistent objects permissions when restoring backed up files and directories and determines which users can set any valid security principal as the owner of an object.</td>
    </tr>
    <tr>
      <td>SeSecurityPrivilege</td>
      <td>Manage auditing and security log</td>
      <td>Required to perform a number of security-related functions, such as controlling and viewing audit events in security event log. With this privilege, the user can specify object access auditing options for individual resources, such as files, Active Directory objects, and registry keys.A user with this privilege can also view and clear the security log.</td>
    </tr>
    <tr>
      <td>SeSystemEnvironmentPrivilege</td>
      <td>Modify firmware environment values</td>
      <td>Required to modify the nonvolatile RAM of systems that use this type of memory to store configuration information.</td>
    </tr>
    <tr>
      <td>SeTakeOwnershipPrivilege</td>
      <td>Take ownership of files or other objects</td>
      <td>Required to take ownership of an object without being granted discretionary access. This privilege allows the owner value to be set only to those values that the holder may legitimately assign as the owner of an object. With this privilege, the user can take ownership of any securable object in the system, including Active Directory objects, files and folders, printers, registry keys, processes, and threads.</td>
    </tr>
    <tr>
      <td>SeTcbPrivilege</td>
      <td>Act as part of the operating system</td>
      <td>This privilege identifies its holder as part of the trusted computer base.This user right allows a process to impersonate any user without authentication. The process can therefore gain access to the same local resources as that user.</td>
    </tr>
  </tbody>
</table>

<h3 id="system-log-information">System log information:</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wevtutil qe system /f:text
eventquery.vbs /L system
</code></pre></div></div>

<p>Note: Some useful events -</p>
<ul>
  <li>System: 7030 (Basic Service Operations)</li>
  <li>System: 7040 (The start type of a service was changed from disabled to auto start)</li>
  <li>System: 7045 (Service Was Installed)</li>
  <li>System: 1056 (DHCP Server Oddities)</li>
  <li>System: 10000 (COM Functionality)</li>
  <li>System: 20001 (Device Driver Installation)</li>
  <li>System: 20002 (Remote Access)</li>
  <li>System: 20003 (Service Installation)</li>
</ul>

<h3 id="application-log-information">Application log information</h3>

<p>Many applications output errors to the Windows Application Event Logs. For example an application crash may generate an event, or an error may generate an event of value. It’s worth looking for events with a source relating to a known vulnerable component that may have been exploited. For example the <a href="https://www.cyber.gov.au/acsc/view-all-content/advisories/advisory-2020-004-remote-code-execution-vulnerability-being-actively-exploited-vulnerable-versions-teleriktelerik-ui-sophisticated-actors">Australian Cyber Security Centre</a> makes special note in one of their reports for the following event.</p>

<ul>
  <li>Event ID: 1309</li>
  <li>Source: ASP.NET [version_number]</li>
</ul>

<p>In particular instances of this event with reference to Telerik.Web.UI.IAsyncUploadConfiguration, one can help to identify successful exploitation of a vulnerable Telerik instance.</p>

<p>Another example is looking at successful MsiInstaller events, given malicious MSI files are all too common. Some examples of viewing these in PowerShell is given below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{LogName='Application';ProviderName='MsiInstaller'} | FL
Get-WinEvent -FilterHashtable @{LogName='Application';ProviderName='MsiInstaller';Id='1042'} | FL
Get-WinEvent -FilterHashtable @{LogName='Application';ProviderName='MsiInstaller';Id='11707'} | FL
</code></pre></div></div>

<h3 id="sysmon-log-information">Sysmon log information</h3>

<p>When installed and running the event log is located at: “Applications and Services Logs/Microsoft/Windows/Sysmon/Operational”</p>

<p>Note: Sysmon and a list of up to date events can be found <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon">here</a></p>

<p>Note: A WMI consumer is a management application or script that interacts with the WMI infrastructure. <a href="https://docs.microsoft.com/en-us/windows/desktop/WmiSdk/wmi-architecture">Microsoft Docs - WMI Architecture</a></p>

<ul>
  <li>Sysmon: 1 (Process create)</li>
  <li>Sysmon: 2 (File creation time)</li>
  <li>Sysmon: 3 (Network connection detected)</li>
  <li>Sysmon: 4 (Sysmon service state changed)</li>
  <li>Sysmon: 5 (Process terminated)</li>
  <li>Sysmon: 6 (Driver loaded)</li>
  <li>Sysmon: 9 (Image loaded)</li>
  <li>Sysmon: 10 (Process accessed)</li>
  <li>Sysmon: 11 (File created)</li>
  <li>Sysmon: 12 (Registry object added or deleted)</li>
  <li>Sysmon: 13 (Registry value set)</li>
  <li>Sysmon: 14 (Registry object renamed)</li>
  <li>Sysmon: 15 (File stream created)</li>
  <li>Sysmon: 16 (Sysmon configuration changed)</li>
  <li>Sysmon: 17 (Named pipe created)</li>
  <li>Sysmon: 18 (Named pipe connected)</li>
  <li>Sysmon: 19 (WMI filter)</li>
  <li>Sysmon: 20 (WMI consumer)</li>
  <li>Sysmon: 21 (WMI consumer filter)</li>
  <li>Sysmon: 22 (DNS Query)</li>
  <li>Sysmon: 23 (File Delete)</li>
  <li>Sysmon: 24 (Clipboard Changed)</li>
  <li>Sysmon: 25 (Process Tampering)</li>
  <li>Sysmon: 26 (File Delete)</li>
</ul>

<h4 id="review-sysmon-logs-1-liner-replace-id-value-as-required-from-above">Review Sysmon Logs 1-liner (replace ID value as required from above)</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Sysmon/Operational';ID='1'} | FL TimeCreated, Message
</code></pre></div></div>

<h4 id="parse-process-creation-events-and-display-data">Parse Process Creation Events and Display Data</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$events=Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Sysmon/Operational';ID='1'};
$output = @();
foreach ($Event in $events){
$data = New-Object -TypeName PSObject;
$XML = [xml]$Event.ToXml();
$RuleName=$XML.Event.EventData.Data|?{$_.Name -eq 'RuleName'} | Select -exp InnerText;
$UtcTime=$XML.Event.EventData.Data|?{$_.Name -eq 'UtcTime'} | Select -exp InnerText;
$ProcessGuid=$XML.Event.EventData.Data|?{$_.Name -eq 'ProcessGuid'} | Select -exp InnerText;
$ProcessId=$XML.Event.EventData.Data|?{$_.Name -eq 'ProcessId'} | Select -exp InnerText;
$Image=$XML.Event.EventData.Data|?{$_.Name -eq 'Image'} | Select -exp InnerText;
$FileVersion=$XML.Event.EventData.Data|?{$_.Name -eq 'FileVersion'} | Select -exp InnerText;
$Description=$XML.Event.EventData.Data|?{$_.Name -eq 'Description'} | Select -exp InnerText;
$Product=$XML.Event.EventData.Data|?{$_.Name -eq 'Product'} | Select -exp InnerText;
$Company=$XML.Event.EventData.Data|?{$_.Name -eq 'Company'} | Select -exp InnerText;
$OriginalFileName=$XML.Event.EventData.Data|?{$_.Name -eq 'OriginalFileName'} | Select -exp InnerText;
$CommandLine=$XML.Event.EventData.Data|?{$_.Name -eq 'CommandLine'} | Select -exp InnerText;
$CurrentDirectory=$XML.Event.EventData.Data|?{$_.Name -eq 'CurrentDirectory'} | Select -exp InnerText;
$User=$XML.Event.EventData.Data|?{$_.Name -eq 'User'} | Select -exp InnerText;
$LogonGuid=$XML.Event.EventData.Data|?{$_.Name -eq 'LogonGuid'} | Select -exp InnerText;
$LogonId=$XML.Event.EventData.Data|?{$_.Name -eq 'LogonId'} | Select -exp InnerText;
$TerminalSessionId=$XML.Event.EventData.Data|?{$_.Name -eq 'TerminalSessionId'} | Select -exp InnerText;
$IntegrityLevel=$XML.Event.EventData.Data|?{$_.Name -eq 'IntegrityLevel'} | Select -exp InnerText;
$Hashes=$XML.Event.EventData.Data|?{$_.Name -eq 'Hashes'} | Select -exp InnerText;
$ParentProcessGuid=$XML.Event.EventData.Data|?{$_.Name -eq 'ParentProcessGuid'} | Select -exp InnerText;
$ParentProcessId=$XML.Event.EventData.Data|?{$_.Name -eq 'ParentProcessId'} | Select -exp InnerText;
$ParentImage=$XML.Event.EventData.Data|?{$_.Name -eq 'ParentImage'} | Select -exp InnerText;
$ParentCommandLine=$XML.Event.EventData.Data|?{$_.Name -eq 'ParentCommandLine'} | Select -exp InnerText;
$ParentUser=$XML.Event.EventData.Data|?{$_.Name -eq 'ParentUser'} | Select -exp InnerText;
$data `
| Add-Member NoteProperty RuleName "$RuleName" -PassThru `
| Add-Member NoteProperty UtcTime "$UtcTime" -PassThru `
| Add-Member NoteProperty ProcessGuid "$ProcessGuid" -PassThru `
| Add-Member NoteProperty ProcessId "$ProcessId" -PassThru `
| Add-Member NoteProperty Image "$Image" -PassThru `
| Add-Member NoteProperty FileVersion "$FileVersion" -PassThru `
| Add-Member NoteProperty Description "$Description" -PassThru `
| Add-Member NoteProperty Product "$Product" -PassThru `
| Add-Member NoteProperty Company "$Company" -PassThru `
| Add-Member NoteProperty OriginalFileName "$OriginalFileName" -PassThru `
| Add-Member NoteProperty CommandLine "$CommandLine" -PassThru `
| Add-Member NoteProperty CurrentDirectory "$CurrentDirectory" -PassThru `
| Add-Member NoteProperty User "$User" -PassThru `
| Add-Member NoteProperty LogonGuid "$LogonGuid" -PassThru `
| Add-Member NoteProperty LogonId "$LogonId" -PassThru `
| Add-Member NoteProperty TerminalSessionId "$TerminalSessionId" -PassThru `
| Add-Member NoteProperty IntegrityLevel "$IntegrityLevel" -PassThru `
| Add-Member NoteProperty Hashes "$Hashes" -PassThru `
| Add-Member NoteProperty ParentProcessGuid "$ParentProcessGuid" -PassThru `
| Add-Member NoteProperty ParentProcessId "$ParentProcessId" -PassThru `
| Add-Member NoteProperty ParentImage "$ParentImage" -PassThru `
| Add-Member NoteProperty ParentCommandLine "$ParentCommandLine" -PassThru `
| Add-Member NoteProperty ParentUser "$ParentUser" -PassThru | Out-Null
$output += $data;
}
$output = $output | sort UtcTime | unique -AsString;
$output
</code></pre></div></div>

<h4 id="parse-dns-query-events-and-display-data">Parse DNS Query Events and Display Data</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$events=Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Sysmon/Operational';ID='22'};
$output = @();
foreach ($Event in $events){
$data = New-Object -TypeName PSObject;
$XML = [xml]$Event.ToXml();
$RuleName=$XML.Event.EventData.Data|?{$_.Name -eq 'RuleName'} | Select -exp InnerText;
$UtcTime=$XML.Event.EventData.Data|?{$_.Name -eq 'UtcTime'} | Select -exp InnerText;
$ProcessGuid=$XML.Event.EventData.Data|?{$_.Name -eq 'ProcessGuid'} | Select -exp InnerText;
$ProcessId=$XML.Event.EventData.Data|?{$_.Name -eq 'ProcessId'} | Select -exp InnerText;
$QueryName=$XML.Event.EventData.Data|?{$_.Name -eq 'QueryName'} | Select -exp InnerText;
$QueryResults=$XML.Event.EventData.Data|?{$_.Name -eq 'QueryResults'} | Select -exp InnerText;
$Image=$XML.Event.EventData.Data|?{$_.Name -eq 'Image'} | Select -exp InnerText;
$User=$XML.Event.EventData.Data|?{$_.Name -eq 'User'} | Select -exp InnerText;
$data `
| Add-Member NoteProperty RuleName "$RuleName" -PassThru `
| Add-Member NoteProperty UtcTime "$UtcTime" -PassThru `
| Add-Member NoteProperty ProcessGuid "$ProcessGuid" -PassThru `
| Add-Member NoteProperty ProcessId "$ProcessId" -PassThru `
| Add-Member NoteProperty QueryName "$QueryName" -PassThru `
| Add-Member NoteProperty QueryResults "$QueryResults" -PassThru `
| Add-Member NoteProperty Image "$Image" -PassThru `
| Add-Member NoteProperty User "$User" -PassThru | Out-Null
$output += $data;
}
$output = $output | sort UtcTime | unique -AsString;
$output
</code></pre></div></div>

<h3 id="active-directory-investigation">Active Directory Investigation</h3>

<p>Note: Live information can be found using <a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/cc732952(v=ws.11)">DSQuery</a> or <a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/cc772217(v=ws.11)">Netdom</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dsquery computer
dsquery user
dsquery contact
dsquery domainroot -inactive 4
dsquery group
dsquery ou
dsquery site
dsquery server
dsquery quota
dsquery *
	- dsquery * -limit 999999999
netdom query fsmo
netdom query trust
netdom query pdc
netdom query DC
netdom query server
netdom query workstation
netdom query OU
</code></pre></div></div>

<h4 id="nt-directory-services-directory-information-tree-file-ntdsdit">NT Directory Services Directory Information Tree File (ntds.dit)</h4>

<p>Active Directory Database file containing all schema, domain, configuration information (e.g. users, IP, computers, domain trusts etc)</p>

<ul>
  <li>%SystemRoot%\NTDS\ntds.dit</li>
  <li>%SystemRoot%\System32\ntds.dit
    <ul>
      <li>File created only when promoting certain OS to a DC, and seldom used.</li>
    </ul>
  </li>
</ul>

<h4 id="edblog">Edb.log</h4>

<p>10MB transaction log used to store temporary data before it is sent to the ntds.dit database.</p>

<ul>
  <li>%SystemRoot%\NTDS\Edb.log</li>
</ul>

<h4 id="edbxxxxxlog">Edbxxxxx.log</h4>

<p>Additional transaction log files if the main edb.log file gets larger than 10MB without being flushed to ntds.dit.</p>

<ul>
  <li>%SystemRoot%\NTDS\edbxxxxx.log</li>
</ul>

<h4 id="edbchk">Edb.chk</h4>

<p>Checkpoint file used to determine how much of the transaction logs have been sent to the ntdis.dit database.</p>

<ul>
  <li>%SystemRoot%\NTDS\edb.chk</li>
</ul>

<h4 id="resxlogresxjrs">Resx.log/Resx.jrs</h4>

<p>Reserved log files in case the hard drive fills up, at which point these files will be used (ideally they should never be used).</p>

<ul>
  <li>%SystemRoot%\NTDS\res1.log</li>
  <li>%SystemRoot%\NTDS\res2.log</li>
</ul>

<h4 id="tempedb">Temp.edb</h4>

<p>Temporary file to store information during in progress transactions.</p>

<ul>
  <li>%SystemRoot%\NTDS\temp.edb</li>
</ul>

<h4 id="schemaini">Schema.ini</h4>

<p>Initialises the ntds.dit file when the domain controller is created, and is then never used again.</p>

<ul>
  <li>%SystemRoot%\NTDS\schema.ini</li>
</ul>

<h4 id="investigation-of-ntdsdit">Investigation of ntds.dit</h4>

<p>Obtaining this file can be done using any of the following and also requires the SYSTEM hive to decrypt (note: ntdsutil may not work on older AD servers).</p>

<p>(Output will be under C:\Audit)</p>

<p>ntdsutil</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ntdsutil "activate instance ntds" ifm "create full C:\Audit" quit quit
</code></pre></div></div>

<p>vssadmin</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vssadmin create shadow /for=C:
mkdir C:\Audit
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy[Number]\Windows\ntds\ntds.dit C:\Audit\ntds.dit
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy[Number]\Windows\System32\config\SYSTEM C:\Audit\SYSTEM
vssadmin delete shadows /shadow=[ShadowCopyID]
</code></pre></div></div>

<p>Other ‘less legitimate’ replication methods can be found detailed on the <a href="https://adsecurity.org/?p=2398#MimikatzDCSync">AD Security Blog by Sean Metcalf</a></p>
<ul>
  <li>Or by using <a href="https://github.com/clymb3r/PowerShell/blob/master/Invoke-NinjaCopy/Invoke-NinjaCopy.ps1">Invoke-NinjaCopy</a></li>
</ul>

<p>Repair the file if required:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>esentutl /p /o C:\Audit\ntds.dit
</code></pre></div></div>

<p>Analysing this file offline can be done with tactics such as:</p>

<ul>
  <li><a href="https://blog.ropnop.com/extracting-hashes-and-domain-info-from-ntds-dit/">Ropnop - Extract Hashes and Domain Info</a></li>
</ul>

<h3 id="origami-pdf-malicious-pdf-analysis">Origami-PDF (Malicious PDF Analysis)</h3>

<p><a href="https://github.com/gdelugre/origami">Github Download</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pdfextract malware.pdf
</code></pre></div></div>

<h3 id="more-malicious-pdfdoc-analysis">More Malicious PDF/Doc Analysis</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pdfid.py malware.pdf
pdfparser.py malware.pdf
pdfparser.py malware.pdf --object [number] --filter --raw --dump file.[extension]
oledump.py file.[extension]
oledump.py file.[extension] --select [number] --vbadecompress
</code></pre></div></div>

<h3 id="exiftool-image-analysis">Exiftool (Image Analysis)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exiftool malware.jpeg
</code></pre></div></div>

<h3 id="dump-all-thumbnails-from-a-jpg-image-to-a-folder">Dump all thumbnails from a jpg image to a folder</h3>

<p>Thanks to <a href="https://exiftool.org/forum/index.php?topic=7227.0">Phil Harvey</a></p>

<p>Note: This may be useful for finding evidence of photo manipulation</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exiftool -a -b -W FOLDERNAME/%f_%t%-c.%s -preview:all IMAGENAME.jpg
</code></pre></div></div>

<h3 id="rdp-cache-images">RDP Cache images</h3>

<p>This can be used to display some fragments of images which a user could see when operating on a server using the Windows RDP.
The cache files are located: %USERPROFILE%\AppData\Local\Microsoft\Terminal Server Client\Cache\</p>

<p>These can be parsed using <a href="https://github.com/ANSSI-FR/bmc-tools">BMC-Tools</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bmc-tools.py -s ./ -d ./output
bmc-tools.py -s ./ -d ./output -o -b 	
</code></pre></div></div>

<h3 id="rdp-terminal-services-activity">RDP (Terminal Services) Activity</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query 'HKU\{SID}\Software\Microsoft\Terminal Server Client' /s
</code></pre></div></div>

<h3 id="rdp-terminal-services-configuration">RDP (Terminal Services) Configuration</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /s
</code></pre></div></div>

<h4 id="check-if-terminal-services-enabled">Check if Terminal Services Enabled</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections
</code></pre></div></div>

<h4 id="check-if-one-session-per-user-has-been-modified">Check if one session per user has been modified</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fSingleSessionPerUser
</code></pre></div></div>

<h4 id="check-if-port-number-has-been-modified">Check if port number has been modified</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\Wds\rdpwd\Tds\tcp" /v PortNumber
reg query "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v PortNumber
</code></pre></div></div>

<h3 id="host-firewall-information">Host Firewall information:</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh firewall show config
advfirewall firewall show rule name=all verbose
</code></pre></div></div>

<h3 id="model-of-motherboard-and-hardware-information">Model of motherboard and hardware information:</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wmic baseboard get product,manufacturer
wmic desktopmonitor get /all /format:list
wmic baseboard get /all /format:list
wmic bios get /all /format:list
wmic cpu get /all /format:list
</code></pre></div></div>

<h3 id="monitoring-of-open-files">Monitoring of open files:</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openfiles /local on
</code></pre></div></div>

<h3 id="check-bitlocker-encryption">Check Bitlocker Encryption</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>manage-bde -status
</code></pre></div></div>

<p>OR Powershell:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-BitLockerVolume
</code></pre></div></div>

<h3 id="list-open-files">List open files</h3>

<p>(this needs to have been enabled first and the PC rebooted, psfiles requires sysinternals psfile.exe)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openfiles /query
psfile
</code></pre></div></div>

<h3 id="display-proxy-information">Display proxy information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh winhttp show proxy
</code></pre></div></div>

<h3 id="disconnect-open-files-based-on-username">Disconnect open files based on username:</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openfiles /disconnect /a username	
</code></pre></div></div>

<p>Powershell (some with WMI). Note: Namespace is a group of classes belonging to the same management environment. Most important is the CIMV2 child which is the most common.</p>

<h3 id="powershell-commands">Powershell Commands</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>help get-wmiobject
</code></pre></div></div>

<h3 id="service-information-1">Service information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WmiObject win32_service | select Name, DisplayName, State, PathName
Get-Service
</code></pre></div></div>

<h3 id="view-named-pipes">View Named Pipes</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[System.IO.Directory]::GetFiles("\\.\pipe\")
get-childitem \\.\pipe\
dir \\.\pipe\
</code></pre></div></div>

<h3 id="harden-system-from-iso-phishing">Harden System from ISO Phishing</h3>

<p><a href="https://malicious.link/post/2022/blocking-iso-mounting/">Special Thanks - Mubix</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add "HKEY_CLASSES_ROOT\Windows.IsoFile\shell\mount" /v ProgrammaticAccessOnly /t REG_SZ
reg add "HKEY_CLASSES_ROOT\Windows.VhdFile\shell\mount" /v ProgrammaticAccessOnly /t REG_SZ
</code></pre></div></div>

<h3 id="harden-system-from-lateral-movementprivesc">Harden System from Lateral Movement/privesc</h3>

<p>Note: These may inadvertently break communication of devices and should be tested. It may also require a restart.</p>

<h4 id="disable-remote-interaction-with-services">Disable remote interaction with services</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add "HKLM\SYSTEM\CurrentControlSet\Control" /v DisableRemoteScmEndpoints /t REG_DWORD /d 1 /f
</code></pre></div></div>

<h4 id="disable-remote-interaction-with-scheduled-tasks">Disable remote interaction with scheduled tasks</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule" /v DisableRpcOverTcp /t REG_DWORD /d 1 /f
</code></pre></div></div>

<h4 id="disable-rdp-access">Disable RDP access</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 1 /f 
</code></pre></div></div>

<h4 id="disable-dcom">Disable DCOM</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add "HKLM\SOFTWARE\Microsoft\Ole" /v EnableDCOM /t REG_SZ /d N /f
</code></pre></div></div>

<h4 id="disable-admin-shares">Disable Admin Shares</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add "HKLM\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v "AutoShareWks" /t REG_DWORD /d 0 /f 
reg add "HKLM\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v "AutoShareServer" /t REG_DWORD /d 0 /f
</code></pre></div></div>

<h4 id="disable-printer-spooler-service-printnightmare-rce--lpe-mitigation">Disable Printer Spooler Service (PrintNightmare RCE &amp; LPE Mitigation)</h4>

<p>Note: <a href="https://twitter.com/gentilkiwi/status/1412483747321192451">Flow chart</a> kindly provided by Benjamin Delpy</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Stop-Service -Name Spooler -Force
Set-Service -Name Spooler -StartupType Disabled
reg add "HKLM\SYSTEM\CurrentControlSet\Services\Spooler" /v Start /t REG_DWORD /d 4 /f
</code></pre></div></div>

<h4 id="prevent-system-from-writing-new-print-dll-printnightmare-rce--lpe-mitigation">Prevent SYSTEM from writing new print DLL (PrintNightmare RCE &amp; LPE Mitigation)</h4>

<p>Special thanks to <a href="https://blog.truesec.com/2021/06/30/fix-for-printnightmare-cve-2021-1675-exploit-to-keep-your-print-servers-running-while-a-patch-is-not-available/">truesec</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$Path = "C:\Windows\System32\spool\drivers"
$Acl = (Get-Item $Path).GetAccessControl('Access')
$Ar = New-Object  System.Security.AccessControl.FileSystemAccessRule("System", "Modify", "ContainerInherit, ObjectInherit", "None", "Deny")
$Acl.AddAccessRule($Ar)
Set-Acl $Path $Acl
</code></pre></div></div>

<h4 id="disable-remote-printing-printnightmare-rce-mitigation">Disable Remote Printing (PrintNightmare RCE mitigation)</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Printers" /v RegisterSpoolerRemoteRpcEndPoint /t REG_DWORD /d 2 /f
</code></pre></div></div>

<h4 id="enable-warning-on-pointandprint-and-uac-printnightmare-lpe-mitigation">Enable Warning on PointAndPrint and UAC (PrintNightmare LPE mitigation)</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint" /v NoWarningNoElevationOnInstall /t REG_DWORD /d 0 /f
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint" /v NoWarningNoElevationOnUpdate /t REG_DWORD /d 0 /f
reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v EnableLUA /t REG_DWORD /d 1 /f
</code></pre></div></div>

<h4 id="deny-vulnerable-netlogon-connections-prevent-zerologon-cve-2020-1472">Deny vulnerable Netlogon connections (Prevent ZeroLogon CVE-2020-1472)</h4>

<p>Note: This should be run on a DC or relevant policy applied. It requires the August 11, 2020 update. Full mitigation advice can be found <a href="https://support.microsoft.com/en-us/help/4557222/how-to-manage-the-changes-in-netlogon-secure-channel-connections-assoc">here</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add "HKLM\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters" /v FullSecureChannelProtection /t REG_DWORD /d 1 /f
</code></pre></div></div>

<p>It should be noted the following System events relate to this and should be reviewed:</p>

<ul>
  <li>Event IDs 5827 and 5828 in the System event log, if ZeroLogon connections are denied.</li>
  <li>Event IDs 5830 and 5831 in the System event log, if ZeroLogon connections are allowed by “Domain controller: Allow vulnerable Netlogon secure channel connections” group policy.</li>
  <li>Event ID 5829 in the System event log, if ZeroLogon vulnerable Netlogon secure channel connection is allowed.</li>
</ul>

<h4 id="rename-mshtmldll-cve-2021-40444-mitigation">Rename mshtml.dll (CVE-2021-40444 Mitigation)</h4>

<p>Note: This will render any application which leverages mshtml.dll for rendering HTML content unable to do so (including mshta.exe - yay). At this stage the MSHTML (Trident) engine should not be leveraged by many applications and <a href="https://techcommunity.microsoft.com/t5/windows-it-pro-blog/internet-explorer-11-desktop-app-retirement-faq/ba-p/2366549">Microsoft recommends future app development not use the MSHTML (Trident) engine</a>. Some examples of what do use it include .chm files and software mentioned <a href="https://en.wikipedia.org/wiki/Trident_%28layout_engine%29">here</a></p>

<ul>
  <li>
    <p>Run cmd.exe as Administrator.</p>

    <p>takeown /F mshtml.dll
  icacls mshtml.dll /grant administrators:F
  move mshtml.dll mshtml2.dll
  cd ../SysWOW64
  takeown /F mshtml.dll
  icacls mshtml.dll /grant administrators:F
  move mshtml.dll mshtml2.dll</p>
  </li>
</ul>

<h4 id="delete-ms-msdt-association-cve-2022-30190follina-mitigation">Delete ms-msdt association (CVE-2022-30190/Follina Mitigation)</h4>

<p>From <a href="https://msrc-blog.microsoft.com/2022/05/30/guidance-for-cve-2022-30190-microsoft-support-diagnostic-tool-vulnerability/">MSRC</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg delete HKEY_CLASSES_ROOT\ms-msdt /f
</code></pre></div></div>

<h4 id="stop-server-responsible-for-inter-process-communication-calls">Stop Server Responsible for Inter-process Communication Calls</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>net stop server
</code></pre></div></div>

<h4 id="delete-admin-shares">Delete Admin Shares</h4>

<p>Note: This may break some application communication and admin functionality. It may also be temporary as Windows has been known to recreate them. Always test.</p>

<ul>
  <li>C$ = Default share on systems ‘C’ drive.</li>
  <li>IPC$ = Default Inter-process communication share (used by named pipes)</li>
  <li>
    <p>ADMIN$ = Default share for remote administration (used by PsExec)</p>

    <p>net share C$ /delete
  net share IPC$ /delete
  net share ADMIN$ /delete</p>
  </li>
</ul>

<h4 id="disable-anonymous-access-to-named-pipes">Disable Anonymous Access to Named Pipes</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg add "HKLM\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters" /v "RestrictNullSessAccess" /t "REG_DWORD" /d 1 /f
</code></pre></div></div>

<p>Notes on named pipes:</p>

<ul>
  <li>Named pipes are used for communication between processes, this includes a process from a remote system.</li>
  <li>A named pipe can be created by anyone.</li>
  <li>By enabling ‘RestrictNullSessAccess’ you stop anonymous network logons from accessing named pipes on your system.</li>
  <li>If a process has the ‘SeImpersonatePrivilege’ (or equivalent) privilege assigned and creates a named pipe, it may be able to impersonate the user context of anyone who connects to its named pipe if it then acts as the named pipe server.
    <ul>
      <li>The client of a named pipe, RPC, or DDE connection can control the impersonation level that the server of the named pipe can impersonate, ref: <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/impersonation-levels">Microsoft</a>
        <ul>
          <li>This doesn’t apply if the connection is remote, in that instance the permissions are set by the server.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Any service running through the Service Control Manager (SCM), or Component Object Model (COM) specified to run under a certain account, automatically has impersonate privileges.</li>
  <li>When creating a child process using ‘CreateProcessWithToken’ the secondary logon service ‘seclogon’ needs to be running or else this will fail.</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Impersonation level</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>SecurityAnonymous</td>
      <td>The server cannot impersonate or identify the client.</td>
    </tr>
    <tr>
      <td>SecurityIdentification</td>
      <td>The server can get the identity and privileges of the client, but cannot impersonate the client.</td>
    </tr>
    <tr>
      <td>SecurityImpersonation</td>
      <td>The server can impersonate the client’s security context on the local system.</td>
    </tr>
    <tr>
      <td>SecurityDelegation</td>
      <td>The server can impersonate the client’s security context on remote systems.</td>
    </tr>
  </tbody>
</table>

<h4 id="disable-ole-objects-in">Disable OLE objects in</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Set-ItemProperty HKCU:\Software\Microsoft\Office\*\*\Security -Name PackagerPrompt -Type DWORD -Value 2
Set-ItemProperty REGISTRY::HKU\*\Software\Microsoft\Office\*\*\Security -Name PackagerPrompt -Type DWORD -Value 2
</code></pre></div></div>

<h3 id="process-wmi-objects">Process WMI objects</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>get-wmiobject -list | where {$_.name -like "*process*"}
</code></pre></div></div>

<h3 id="process-information-1">Process information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WmiObject win32_process|select processname,ProcessId,CommandLine
Get-WmiObject win32_process -Filter "name like '%powershell.exe'" | select processId,commandline|FL
Get-Process
</code></pre></div></div>

<h3 id="baseline-processes-and-services">Baseline processes and services</h3>

<p>(Used to compare new process/services)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-Process | Export-Clixml -Path C:\Users\User\Desktop\process.xml
Get-Service | Export-Clixml -Path C:\Users\User\Desktop\service.xml
$edproc = Import-Clixml -Path C:\Users\User\Desktop\process.xml
$edproc1 = Import-Clixml -Path C:\Users\User\Desktop\process1.xml
$edservice = Import-Clixml -Path C:\Users\User\Desktop\service.xml
$edservice1 = Import-Clixml -Path C:\Users\User\Desktop\service1.xml
Compare-Object $edproc $edproc1 -Property processname
Compare-Object $edservice $edservice1 -Property servicename
</code></pre></div></div>

<h3 id="view-and-interact-with-shadow-copies-must-be-run-from-elevated-cmdexe">View and interact with shadow copies (MUST BE RUN FROM ELEVATED CMD.exe)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vssadmin list shadows | findstr "VolumeShadowCopy"
mklink /d shadow \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy2\
dir shadow
rmdir shadow
</code></pre></div></div>

<p>With a linked shadow copy we can copy pagefile.sys using the below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir C:\Audit
robocopy shadow C:\Audit pagefile.sys
attrib -s -h C:\Audit\pagefile.sys
</code></pre></div></div>

<h3 id="create-shadow-copy-for-c-drive">Create Shadow Copy for C: drive</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vssadmin create shadow /for=C:
</code></pre></div></div>

<h3 id="other-shadow-copy-techniques">Other Shadow Copy Techniques</h3>

<p>In Windows 7 or certain other OS you may not have access to use ‘vssadmin create’. As such some trickery may be required. In Windows 7 we can create a scheduled task (to execute with System privileges) and use it to create a Shadow Copy with Microsoft DLLs, this simulates the activity of creating a ‘System Restore Point’. This can also be done with psexec if you wish to install the psexec service.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>schtasks /ru "SYSTEM" /Create /SC DAILY /ST "00:00" /TN "\Microsoft\Windows\SystemRestore\SR" /TR "%windir%\system32\rundll32.exe /d srrstr.dll,ExecuteScheduledSPPCreation" /f
schtasks /run /TN \Microsoft\Windows\SystemRestore\SR
vssadmin list shadows
</code></pre></div></div>

<p>If you want to remove the scheduled task so it doesn’t run daily, use:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>schtasks /delete /TN \Microsoft\Windows\SystemRestore\SR /f
</code></pre></div></div>

<p>You can also back it up using <a href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/wbadmin-start-backup">wbadmin</a>, but it’s a bit more intricate. The below example should backup C drive to E drive.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wbadmin start backup -backupTarget:E: -include:c:
</code></pre></div></div>

<h3 id="tcp-connections">TCP Connections</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-NetTCPConnection –State Established
</code></pre></div></div>

<h3 id="list-of-ipv4-addresses-who-have-connected-rdp">List of IPV4 addresses who have connected (RDP)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -Log 'Microsoft-Windows-TerminalServices-LocalSessionManager/Operational' | select -exp Properties | where {$_.Value -like '*.*.*.*' } | sort Value -u 
</code></pre></div></div>

<h3 id="powershell-logs">Powershell logs</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -LogName "Windows Powershell"
</code></pre></div></div>

<h3 id="event-logs-available">Event logs available</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-EventLog -list
Get-WinEvent -Listlog * | Select RecordCount,LogName 
Get-WinEvent -Listlog *operational | Select RecordCount,LogName
wmic nteventlog list brief
</code></pre></div></div>

<h3 id="event-logs-per-application-source">Event Logs per Application Source</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-EventLog Application | Select -Unique Source
Get-WinEvent -FilterHashtable @{LogName='Application';} -ea 0 | Select -exp ProviderName | sort | unique
Get-WinEvent -FilterHashtable @{ LogName='Application'; ProviderName='Outlook'}
Get-WinEvent -FilterHashtable @{ LogName='Application'; ProviderName='MsiInstaller'}
Get-WinEvent -FilterHashtable @{ LogName='OAlerts';} | FL TimeCreated, Message
</code></pre></div></div>

<h3 id="event-logs-per-severity-source">Event Logs per Severity Source</h3>

<h4 id="critical-logs">Critical Logs</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Application'; Level='1';}
</code></pre></div></div>

<h4 id="error-logs">Error Logs</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Application'; Level='2';}
</code></pre></div></div>

<h4 id="warning-logs">Warning Logs</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Application'; Level='3';}
</code></pre></div></div>

<h4 id="information-logs">Information Logs</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Application'; Level='4';}
</code></pre></div></div>

<h3 id="live-event-log-filtering">Live Event Log Filtering</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$Before = Get-Date 01/07/19;
$After = Get-Date 31/05/19;

Get-WinEvent -FilterHashtable @{ LogName='Security'; StartTime=$After; EndTime=$Before; Id='4624'; Data='127.0.0.1'} | Select -ExpandProperty Message

Get-WinEvent -FilterHashtable @{ LogName='Security'; StartTime=$After; EndTime=$Before; Id='4624'; Data='127.0.0.1'} | Select TimeCreated,Message | Select-String -Pattern "0x621EFDC", "0x825225F"

Get-WinEvent -FilterHashtable @{ LogName='Security'; StartTime=$After; EndTime=$Before; Id='4624'; Data='127.0.0.1'} | Select -ExpandProperty Message &gt; [location]\log.txt;
cat [location]\log.txt | Select-String -Pattern "Subject:", "New Logon:", "Process information","Network Information:" -Context 0,4;

Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-SmbClient/Connectivity';} | Select Timecreated,LogName,Message | where {$_.message -like "*Failed to establish a network connection*"} |FL

Get-WinEvent -FilterHashtable @{ LogName='*SMB*'; Data="[IP/HostName]"} | Select Timecreated,LogName,Message |FL

Get-WinEvent -FilterHashtable @{ LogName='*SMB*';} | Select Timecreated,LogName,Message | where {$_.message -like "*[IP/Hostname]*"} |FL

Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4624'; Data='3'} | where {$_.message -match '0x1F260F3E' } | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4624'; Data='3'} | where {$_.TimeCreated.ToString() -match ('28/10/2019')}|FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4624'; Data='2'} | where {$_.TimeCreated.ToString() -match ('28/10/2019 11:22')}
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4624'; Data='127.0.0.1'} | where {$_.TimeCreated.ToString() -match ('28/10/2019') -and $_.Message -match 'user' } | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4624'; Data='NTLM';} -MaxEvents 6 | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4624'; Data='127.0.0.1'} | where {$_.TimeCreated -ge (get-date).addDays(-3) -and $_.TimeCreated.ToString() -match ('11:04') -and $_.Message -match 'user' } | FL TimeCreated,Message
</code></pre></div></div>

<h3 id="find-authenticating-userasset-for-remote-service-creation-lateral-movement">Find Authenticating user/asset for remote service creation (lateral movement)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$After = (get-date).addDays(-3);
$Time = Get-WinEvent -FilterHashtable @{ LogName='System'; Id='7045';} | ? {$_.Message -match "MALWARE.exe"} | Select -exp TimeCreated;
foreach ($Event in $Time){
	$Event;
	Get-WinEvent -FilterHashtable @{ LogName='Security'; StartTime=$After; Id='4624';} | ? {$_.TimeCreated -ge $Event.AddSeconds(-2) -AND $_.TimeCreated -le $Event.AddSeconds(+2)} | FL TimeCreated,Message;
};
</code></pre></div></div>

<h4 id="locate-possible-kerberoastkerberos-based-attacks">Locate possible Kerberoast/Kerberos based attacks</h4>

<p>Note: When looking at kerberos listing, RC4-HMAC encryption is generally anomalous and may be indicative of kerberoasting.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4769'; Data='0x17'} | FL TimeCreated, Message
klist
reg query "HKLM\System\CurrentControlSet\Control\Lsa\Kerberos\Parameters" /v "allowtgtsessionkey"
</code></pre></div></div>

<h3 id="extract-useful-fields-from-legacy-logs">Extract useful fields from Legacy Logs</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$A=Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4624'; Data='127.0.0.1'} | where {$_.TimeCreated -ge (get-date).addDays(-3) -and $_.Message -match 'INSERT DESIRED INFO HERE' };
ForEach ($Event in $A){$Event.TimeCreated;$Event.Message|findstr /i /C:"Logon Type:";$Event.Message|findstr /i /C:"Security ID:";$Event.Message|findstr /i /C:"Account Name:";$Event.Message|findstr /i /C:"Account Domain:";$Event.Message|findstr /i /C:"Process ID:";$Event.Message|findstr /i /C:"Process Name:";$Event.Message|findstr /i /C:"Workstation Name:";$Event.Message|findstr /i /C:"Source Network Address:";$Event.Message|findstr /i /C:"Source Port:";echo "`n";};
</code></pre></div></div>

<p>Note: You can modify the second string to carve out wanted information, some examples below.</p>

<h4 id="find-user-authenticating">Find User Authenticating</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ForEach ($Event in $A){$Event.TimeCreated;$Event.Message|findstr /i /C:"Account Name:";$Event.Message|findstr /i /C:"Account Domain:";echo "`n";};
</code></pre></div></div>

<h4 id="find-ipport-authenticating">Find IP/Port Authenticating</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ForEach ($Event in $A){$Event.TimeCreated;$Event.Message|(findstr /i /C:"Source Network Address:";$Event.Message|findstr /i /C:"Source Port:";)|findstr -v "-";echo "`n";};
</code></pre></div></div>

<hr>

<p>** Note: In the following section filter based on time for reduction of noise <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/get-date">Get-Date</a>.</p>

<p>e.g. get something like the below and add them to the FilterHashTable: StartTime=$After; EndTime=$Before;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$Date = (Get-Date).AddDays(-2)
$Before = Get-Date 01/07/19;
$After = Get-Date 31/05/19;
</code></pre></div></div>

<hr>

<h3 id="remote-desktop-lateral-movement-detection-destinations">Remote Desktop Lateral Movement Detection (Destinations)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4624'; Data='10'} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4778';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4779';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-RemoteDesktopServices-RdpCoreTS/Operational'; Id='98';} | FL Message,ProcessId,TimeCreated
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-RemoteDesktopServices-RdpCoreTS/Operational'; Id='131';} | FL Message,ProcessId,TimeCreated
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-TerminalServices-LocalSessionManager/Operational'; Id='21';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-TerminalServices-LocalSessionManager/Operational'; Id='22';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-TerminalServices-LocalSessionManager/Operational'; Id='25';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-TerminalServices-LocalSessionManager/Operational'; Id='41';} | FL TimeCreated,Message
ls C:\Windows\Prefetch\rdpclip.exe*.pf
ls C:\Windows\Prefetch\tstheme.exe*.pf
</code></pre></div></div>

<h3 id="map-network-shares-lateral-movement-detection-destinations">Map Network Shares Lateral Movement Detection (Destinations)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4624'; Data='3'} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4672';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4776';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4768';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4769';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='5140';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='5140'; Data='\\*\C$'} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='5145';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='5140';} | FL TimeCreated,Message
</code></pre></div></div>

<h3 id="psexec-lateral-movement-detection-destinations">PsExec Lateral Movement Detection (Destinations)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4624'; Data='3'} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4624'; Data='2'} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4672';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='5140'; Data='\\*\ADMIN$'} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='System'; Id='7045'; Data='PSEXESVC'} | FL TimeCreated,Message
reg query HKLM\SYSTEM\CurrentControlSet\Services\PSEXESVC
reg query HKLM\SYSTEM\CurrentControlSet\Services\
ls C:\Windows\Prefetch\psexesvc.exe*.pf
</code></pre></div></div>

<h3 id="scheduled-tasks-lateral-movement-detection-destinations">Scheduled Tasks Lateral Movement Detection (Destinations)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4624'; Data='3'} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4672';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4698';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4702';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4699';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4700';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4701';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-TaskScheduler/Maintenance'; Id='106';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-TaskScheduler/Maintenance'; Id='140';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-TaskScheduler/Maintenance'; Id='141';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-TaskScheduler/Maintenance'; Id='200';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-TaskScheduler/Maintenance'; Id='201';} | FL TimeCreated,Message
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks" /s
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks" /s /v Actions
Get-ChildItem -path 'registry::HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks\' | Get-ItemProperty | FL Path, Actions
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tree"
gci -path C:\Windows\System32\Tasks\ -recurse -File
</code></pre></div></div>

<h3 id="services-lateral-movement-detection-destinations">Services Lateral Movement Detection (Destinations)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4624'; Data='3'} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4697';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='System'; Id='7034';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='System'; Id='7035';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='System'; Id='7036';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='System'; Id='7040';} | FL TimeCreated,Message 
Get-WinEvent -FilterHashtable @{ LogName='System'; Id='7045';} | FL TimeCreated,Message
reg query 'HKLM\SYSTEM\CurrentControlSet\Services\'
</code></pre></div></div>

<h3 id="wmiwmic-lateral-movement-detection-destinations">WMI/WMIC Lateral Movement Detection (Destinations)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4624'; Data='3'} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4672';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4624'; Data='3'} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-WMI-Activity/Operational'; Id='5857';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-WMI-Activity/Operational'; Id='5860';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-WMI-Activity/Operational'; Id='5861';} | FL TimeCreated,Message
C:\Windows\System32\wbem\Repository
ls C:\Windows\Prefetch\wmiprvse.exe*.pf
ls C:\Windows\Prefetch\mofcomp.exe*.pf
</code></pre></div></div>

<h3 id="powershell-lateral-movement-detection-destinations">PowerShell Lateral Movement Detection (Destinations)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4624'; Data='3'} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Security'; Id='4672';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-PowerShell/Operational'; Id='4103';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-PowerShell/Operational'; Id='4104';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-PowerShell/Operational'; Id='53504';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Windows PowerShell'; Id='400';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Windows PowerShell'; Id='403';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Windows PowerShell'; Id='800';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-WinRM/Operational'; Id='91';} | FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{ LogName='Microsoft-Windows-WinRM/Operational'; Id='168';} | FL TimeCreated,Message
ls C:\Windows\Prefetch\wsmprovhost.exe*.pf
cat $env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
</code></pre></div></div>

<h3 id="extra-information">Extra Information</h3>

<p><strong>Program Compatibility Assistant (PCA) (Windows 11 Pro 22H2 and later)</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Windows\appcompat\pca\PcaAppLaunchDic.txt
C:\Windows\appcompat\pca\PcaGeneralDb0.txt
C:\Windows\appcompat\pca\PcaGeneralDb1.txt
</code></pre></div></div>

<p>Note: Special thanks to Andrew Rathburn, and Lucas Gonzalez who <a href="https://aboutdfir.com/new-windows-11-pro-22h2-evidence-of-execution-artifact/">publicised this</a>, and <code class="language-plaintext highlighter-rouge">rancio#4162</code> who first discovered and raised the question on it.</p>

<p><strong>AmCache</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Windows\AppCompat\Programs\Amcache.hve 
Amcache.hve\Root\File\{Volume GUID}\#######
</code></pre></div></div>

<p><strong>ShimCache</strong>
	C:\Windows\System32\config\SYSTEM 
	HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\AppCompatCache</p>

<p><strong>Prefetch</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls C:\Windows\Prefetch\evil.exe*.pf
</code></pre></div></div>

<p><strong>Connected Devices Platform (Timelining)</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci C:\Users\*\AppData\Local\ConnectedDevicesPlatform -recurse
</code></pre></div></div>

<h3 id="user-accounts-and-logon-information">User accounts and logon information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WmiObject Win32_UserProfile
</code></pre></div></div>

<h3 id="share-information">Share information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WmiObject Win32_Share
net share
wmic share list brief
wmic netuse get Caption, DisplayType, LocalName, Name, ProviderName, Status
</code></pre></div></div>

<h3 id="list-alternate-data-streams-in-current-dir-and-view-them">List Alternate Data Streams in current Dir and view them</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gi * -s *
gc [FILENAME] -s [ADSNAME]
</code></pre></div></div>

<h3 id="list-alternate-data-streams-in-text-files-within-appdata">List Alternate Data Streams in text files within AppData</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-ChildItem -Recurse -Path $env:APPDATA\..\ -include *.txt -ea SilentlyContinue|gi -s *|Select Stream -ea SilentlyContinue| Where-Object {$_.Stream -ine ":`$DATA"}
</code></pre></div></div>

<h3 id="use-alternate-data-streams-to-find-download-location">Use Alternate Data Streams to find download location</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>get-item * -stream *|Where-Object {$_.Stream -ine ":`$DATA"}|cat
get-item C:\Users\Username\Downloads\* -stream *|Where-Object {$_.Stream -ine ":`$DATA"}|cat
$a=(gci -rec -path C:\users\user\downloads -ea 0 | gi -s Zone.Identifier -ea 0 | ? {$_.Length -ge '27'});foreach ($b in $a){$b.FileName;$b|cat}
$a=(get-item * -stream Zone.Identifier -ea 0 | ? {$_.Length -ge '27'});foreach ($b in $a){$b.FileName;$b|cat}
gci -Recurse -Path $env:APPDATA\..\ -include *.txt -ea SilentlyContinue |gi -s *| Where-Object {$_.Stream -ine ":`$DATA"}|cat
</code></pre></div></div>

<h3 id="general-notes">General Notes</h3>

<p>Under <strong>%SystemRoot%\System32\config</strong> the below registry hives are some of the most important to obtain. Additionally taking these files from within the RegBack directory also assists in comprehensive analysis should any anti-forensics activities have modified these registries.</p>

<ul>
  <li>DEFAULT</li>
  <li>SAM</li>
  <li>SECURITY</li>
  <li>SOFTWARE</li>
  <li>SYSTEM</li>
</ul>

<p>Under <strong>%SystemDrive%\Users[name]</strong> there is also a <strong>NTUSER.DAT</strong> file which becomes HKEY_CURRENT_USER into the Registry when a user logs on, and this is very important to obtain. There’s also a UsrClass.dat file which can be found: <strong>%USERPROFILE%\AppData\Local\Microsoft\Windows\UsrClass.dat</strong></p>

<h3 id="gather-artifacts">Gather artifacts</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg save HKLM\SAM [LOCATION]\SAM 
reg save HKLM\SYSTEM [LOCATION]\SYSTEM
reg save HKLM\SECURITY [LOCATION]\SECURITY
reg save HKLM\SOFTWARE [LOCATION]\SOFTWARE
</code></pre></div></div>

<h3 id="powershell-execution-log">Powershell execution log</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat C:\Users\[name]\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline
</code></pre></div></div>

<h3 id="analyse-document-for-macros">Analyse document for macros</h3>

<p>Using <a href="https://github.com/decalage2/oletools/wiki/olevba">olevba</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>olevba [Document]
</code></pre></div></div>

<h3 id="capture-powershell-memdump-and-analyse">Capture powershell memdump and analyse</h3>

<p>Using Procdump from sysinternals:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>procdump -ma [PowershellPID]
</code></pre></div></div>

<h3 id="recent-execution-of-programs">Recent execution of programs</h3>

<ul>
  <li>Prefetch Located at : %SystemRoot%\Prefetch\</li>
  <li>RecentFileCache.bcf Located at : %SystemRoot%\AppCompat\Programs\</li>
  <li>Amcache.hve (reg hive) Located at : %SystemRoot%\AppCompat\Programs\</li>
  <li>Program Compatibility Assistant (PCA) (Windows 11 Pro 22H2 and later) Located at:
    <ul>
      <li>%SystemRoot%\appcompat\pca\PcaAppLaunchDic.txt</li>
      <li>%SystemRoot%\appcompat\pca\PcaGeneralDb0.txt</li>
      <li>%SystemRoot%\appcompat\pca\PcaGeneralDb1.txt</li>
    </ul>
  </li>
</ul>

<p>Or query a lot of run programs from program compatibility assistant:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-ItemProperty "REGISTRY::HKCU\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Compatibility Assistant\Store"
Get-ItemProperty "REGISTRY::HKCU\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Layers"
</code></pre></div></div>

<h3 id="programs-specifically-set-to-run-as-admin">Programs specifically set to run as admin</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKU\{SID}\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Layers" /s /f RUNASADMIN
reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Layers" /s /f RUNASADMIN
</code></pre></div></div>

<h4 id="windows-indexing-service">Windows Indexing Service</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\ProgramData\Microsoft\Search\Data\Applications\Windows\windows.edb
</code></pre></div></div>

<ul>
  <li><a href="https://www.nirsoft.net/utils/ese_database_view.html">ESE Database View</a></li>
  <li><a href="http://www.edgemanage.emmet-gray.com/Articles/ViewESE.html">View ESE Database</a></li>
</ul>

<h3 id="programs-accessing-windows-features-such-as-webcam-and-microphone">Programs Accessing Windows Features such as Webcam and Microphone</h3>

<p>Special thanks to Zack (svch0st) for his <a href="https://medium.com/@7a616368/can-you-track-processes-accessing-the-camera-and-microphone-7e6885b37072">Medium Post</a></p>

<h4 id="all-windows-features-including-start-and-stop-timestamps">All Windows Features Including Start and Stop Timestamps</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$a=$(gci REGISTRY::HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\ -recurse | FT -AutoSize | Out-String);$a.replace("#","\")
reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\ /s /f LastUsed
</code></pre></div></div>

<h4 id="programs-using-webcam">Programs Using Webcam</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$a=$(gci REGISTRY::HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\webcam -recurse | Select PSChildName | Out-String);$a.replace("#","\")
</code></pre></div></div>

<h4 id="programs-using-microphone">Programs Using Microphone</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$a=$(gci REGISTRY::HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore\microphone -recurse | Select PSChildName | Out-String);$a.replace("#","\")
</code></pre></div></div>

<h3 id="usn-journal-any-changes-to-ntfs-volume">USN Journal (any changes to NTFS volume)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fsutil usn readjournal C: &gt; USN.txt
</code></pre></div></div>

<h3 id="ntfs-index-attributes-i30-file-made-up-of-index_root-index_allocation-attributes">NTFS Index Attributes ($I30 file made up of $INDEX_ROOT, $INDEX_ALLOCATION attributes)</h3>

<h4 id="indxparse"><a href="https://github.com/williballenthin/INDXParse">INDXParse</a></h4>

<h4 id="indxripper"><a href="https://github.com/harelsegev/INDXRipper">INDXRipper</a></h4>

<h4 id="indx2csv"><a href="https://github.com/jschicht/Indx2Csv">Indx2Csv</a></h4>

<h3 id="link-file-analysis">Link File Analysis</h3>

<p>LNK Files Located at:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\*\AppData\Roaming\Microsoft\Windows\Recent
</code></pre></div></div>

<p>Using <a href="https://ericzimmerman.github.io/#!index.md">LECmd</a> to parse Link metadata.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LECmd.exe -f {fileDirectory}\filename.lnk
</code></pre></div></div>

<p>Of interest is information such as:</p>

<ul>
  <li>MachineID (NetBIOS name)</li>
  <li>MAC Address</li>
  <li>MAC Vendor</li>
  <li>Timestamps</li>
  <li>Volume Droid</li>
  <li>Volume Droid Birth</li>
  <li>File Droid</li>
  <li>File Droid Birth</li>
</ul>

<p><a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-shllink/16cb4ca1-9339-4d0c-a68d-bf1d6cc0f943">File format specification</a></p>

<h3 id="jump-lists-analysis">Jump Lists Analysis</h3>

<p>Jump List Files Located at:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\*\AppData\Roaming\Microsoft\Windows\Recent\AutomaticDestinations
</code></pre></div></div>

<p>A rough PowerShell 1-liner to gather information on previous opened directories and files is below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$Files=$(cat C:\Users\*\AppData\Roaming\Microsoft\Windows\Recent\*Destinations\*.*Destinations-ms);$Files.Split("``")|Select-String "Storage" | findstr -v "1SPSU"|findstr -v "?"
</code></pre></div></div>

<h3 id="srum-analysis">SRUM Analysis</h3>

<p>System Resource Usage Monitor Located at: %systemroot%\System32\sru\SRUDB.dat</p>

<p>Great tool to parse to csv: <a href="https://github.com/MarkBaggett/srum-dump">SRUM-Dump</a></p>

<h3 id="background-activity-moderator-bamdam">Background Activity Moderator (BAM/DAM)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SYSTEM\CurrentControlSet\Services\bam\UserSettings" /s
reg query "HKLM\SYSTEM\CurrentControlSet\Services\dam\UserSettings" /s
reg query "HKLM\SYSTEM\CurrentControlSet\Services\bam\UserSettings" /s /v *.exe
reg query "HKLM\SYSTEM\CurrentControlSet\Services\dam\UserSettings" /s /v *.exe
</code></pre></div></div>

<h3 id="windows-10-mail-app-forensics">Windows 10 Mail App Forensics</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%LocalAppData%\Comms\Unistore\data\0 - Windows phone data
%LocalAppData%\Comms\Unistore\data\2 - Contact lists
%LocalAppData%\Comms\Unistore\data\3 - Contents/body of email
%LocalAppData%\Comms\Unistore\data\5 - Calendar invitations
%LocalAppData%\Comms\Unistore\data\7 - Email attachments
</code></pre></div></div>

<h3 id="capture-packets-with-netsh">Capture packets with netsh</h3>

<p>Note: You will need to use something like etl2pcapng to convert these captures to a cap file for analysis with Wireshark <a href="https://github.com/microsoft/etl2pcapng/releases">Download</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh trace start persistent=yes capture=yes tracefile=c:\temp\packetcapture.etl
netsh trace stop
</code></pre></div></div>

<h3 id="capture-packets-with-powershell">Capture Packets with PowerShell</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>New-NetEventSession -Name "Capture" -CaptureMode SaveToFile -LocalFilePath "c:\temp\packetcapture.etl"
Add-NetEventProvider -Name "Microsoft-Windows-TCPIP" -SessionName "Capture"
Add-NetEventPacketCaptureProvider -SessionName "Capture"
Start-NetEventSession -Name "Capture"
</code></pre></div></div>

<h3 id="stop-capturing-packets-with-powershell">Stop Capturing Packets with PowerShell</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-NetEventSession
Stop-NetEventSession -Name Capture
Remove-NetEventSession
</code></pre></div></div>

<h3 id="convert-etl-file-to-pcap">Convert ETL File to PCAP</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>etl2pcapng.exe c:\temp\packetcapture.etl c:\temp\packetcapture.pcapng
</code></pre></div></div>

<h2 id="ntuserdat-important-registry-entries">NTUSER.DAT Important Registry entries:</h2>

<h3 id="recent-execution-of-programs-gui">Recent execution of programs (GUI)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer
</code></pre></div></div>

<ul>
  <li>\RecentDocs <em>(Notes recent files run, most commonly .lnk files)</em></li>
  <li>\UserAssist <em>(Notes files run and number of times run. Values are ROT13 encoded)</em>,
    <ul>
      <li>CEBFF5CD is Executable File Execution</li>
      <li>F4E57C4B is Shortcut File Execution</li>
    </ul>
  </li>
  <li>\TypedPaths <em>(Notes file locations visited using Windows Explorer address bar)</em></li>
  <li>\RunMRU <em>(Notes recent commands executed through the ‘run’ program)</em></li>
  <li>\ComDlg32 <em>(Last file path visited)</em>
    <ul>
      <li>\LastVisitedPidlMRU <em>(Last PID which was ‘Most Recently Used’, e.g. the binaries used to open a file)</em></li>
      <li>\OpenSavePidlMRU <em>(Last Saved PID file which was ‘Most Recently Used’, location of a file opened by a binary)</em></li>
    </ul>
  </li>
  <li>\WordWheelQuery <em>(Keywords searched for from the START menu bar)</em></li>
  <li>\FeatureUsage\AppBadgeUpdated (Every Time Task Bar Application Gets Notification and Badge Updates)</li>
  <li>\FeatureUsage\AppLaunch (Every Time Task Bar Application Which is Pinned is Launched)</li>
  <li>\FeatureUsage\AppSwitched (Every Time Task Bar Application Left Clicked)</li>
  <li>\FeatureUsage\ShowJumpView (Every Time Task Bar Application Right Clicked)</li>
  <li>\FeatureUsage\TrayButtonClicked (Every Time Relevant Button on Task Bar is Clicked)</li>
</ul>

<p>You can get the names of recently run files from UserAssist by using ROT13 across them, we can do this quickly in Powershell by using a script from BornToBeRoot and some scriptfu:</p>

<p><a href="https://github.com/JPMinty/PowerShell/blob/master/Scripts/Convert-ROT13.ps1">Convert-ROT13.ps1</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$A=$(gci REGISTRY::HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\UserAssist\*\Count | Select -exp Property);foreach ($B in $A){.\Convert-ROT13.ps1 -Rot 13 $B|Select -exp Text}
</code></pre></div></div>

<p>Or for those who don’t want to run it over every entry individually.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$A=$(gci REGISTRY::HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\UserAssist\*\Count | Select -exp Property)|Out-String;.\Convert-ROT13.ps1 -Rot 13 $A|Select -exp Text
</code></pre></div></div>

<h3 id="recent-appslast-visited-mru">Recent Apps/Last Visited MRU</h3>

<p>Note: OpenSavePidlMRU is in hex and will need to be decoded</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKCU\Software\Microsoft\Windows\Current Version\Search\RecentApps"
reg query "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSavePidlMRU" /s
</code></pre></div></div>

<h3 id="execution-of-sysinternals-tool">Execution of Sysinternals Tool</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKCU\Software\Sysinternals\ /s /v EulaAccepted
reg query HKU\SID\Software\Sysinternals\ /s /v EulaAccepted
</code></pre></div></div>

<h3 id="recent-internet-explorer-history">Recent Internet Explorer History</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKCU\Software\Microsoft\Internet Explorer\TypedURLs"
C:\Users\username\AppData\Local\Microsoft\Windows\History\Low\History.IE5\
C:\Users\username\AppData\Local\Microsoft\Windows\History\
C:\Users\username\AppData\Roaming\Microsoft\Internet Explorer\UserData\Low
C:\Users\username\AppData\Local\Microsoft\Windows\WebCache\Internet Explorer\WebCacheV01.dat
</code></pre></div></div>

<p><a href="https://www.nirsoft.net/utils/ie_cache_viewer.html">IE Cache Viewer</a>
<a href="https://www.foxtonforensics.com/browser-history-viewer/">Browser History Viewer</a>
<a href="https://www.nirsoft.net/utils/ese_database_view.html">ESE Database View</a>
<a href="https://www.nirsoft.net/utils/browsing_history_view.html">Browsing History View</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>esentutl.exe /y /vss C:\Users\Username\AppData\Local\Microsoft\Windows\WebCache\WebCacheV01.dat /d C:\Location\WebCacheV01.dat
</code></pre></div></div>

<h3 id="google-chrome-service-workers">Google Chrome Service Workers</h3>

<p>“A service worker is a script that your browser runs in the background, separate from a web page, opening the door to features that don’t need a web page or user interaction.” - <a href="https://developers.google.com/web/fundamentals/primers/service-workers/">Service Worker Reference</a></p>

<p>Service Workers control popups and push notifications received from websites. As this can be used to trick users into taking actions such as opening pages with redirects, installing malware and more these have been included and can be found at the below:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>In Browser: chrome://serviceworker-internals/
C:\Users\[username]\AppData\Local\Google\Chrome\User Data\Default\Service Worker\ScriptCache
C:\Users\[username]\AppData\Local\Google\Chrome\User Data\Default\Preferences
</code></pre></div></div>

<h3 id="recent-chrome-history">Recent Chrome History</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'C:\Users\Username\AppData\Local\Google\Chrome\User Data\Default\history'
</code></pre></div></div>

<p>Note: This is stored as a SQL database which can be easily examined using a tool like sqlite3 which is available on MacOS and Linux. Example below to scan user downloads:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlite3 -line [HISTORYFILE] 'SELECT * FROM Downloads;' | grep -i '[keyword to search for]' -A 10
</code></pre></div></div>

<h3 id="recent-firefox-history">Recent Firefox History</h3>

<p><a href="https://support.mozilla.org/en-US/kb/profiles-where-firefox-stores-user-data#w_what-information-is-stored-in-my-profile">More Information</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\username\AppData\Roaming\Mozilla\Firefox\Profiles\*\
</code></pre></div></div>

<h3 id="recent-edge-history">Recent Edge History</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\Username\AppData\Local\Packagaes\Microsoft.MicrosoftEdge_xxxx\AC\#!001\MicrosoftEdge\Cache\
C:\Users\Username\AppData\Local\Packagaes\Microsoft.MicrosoftEdge_xxxx\AC\MicrosoftEdge\User\Default\Recovery\Active\
C:\Users\Username\AppData\Local\Microsoft\Windows\WebCache\WebCacheV01.dat
</code></pre></div></div>

<h3 id="check-root-certificate-store">Check Root Certificate Store</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\SOFTWARE\Microsoft\SystemCertificates\ROOT\Certificates\
reg query HKCU\SOFTWARE\Microsoft\SystemCertificates\ROOT\Certificates\
reg query HKU\{SID}\SOFTWARE\Microsoft\SystemCertificates\ROOT\Certificates\
reg query HKLM\Software\Policies\Microsoft\SystemCertificates\Root\Certificates\
reg query HKCU\Software\Policies\Microsoft\SystemCertificates\Root\Certificates\
reg query HKU\{SID}\Software\Policies\Microsoft\SystemCertificates\Root\Certificates\
</code></pre></div></div>

<h3 id="thumbnail-cache">Thumbnail Cache</h3>

<p><a href="https://github.com/thumbcacheviewer/thumbcacheviewer">Thumbcacheviewer</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\Username\AppData\Local\Microsoft\Windows\Explorer
</code></pre></div></div>

<h3 id="shellbags">Shellbags</h3>

<p>Shellbags can be used to verify the previous existance of files which have been deleted. This is used by the OS to store information about a file location’s customisation e.g. look, feel, size, sorting files method, colour etc and resides after files have been deleted. 
Shellbags Explorer or ShellBagsView can be used to parse this information.</p>

<p>HKCU\SOFTWARE\Microsoft\Windows\Shell</p>

<ul>
  <li>\BagMRU</li>
  <li>\Bags</li>
</ul>

<p>BagsMRU contains the database of folders and their saved settings by windows.</p>

<h3 id="usrclassdat-shellbags">UsrClass.dat Shellbags</h3>

<p>Additional shellbags files can be found in UsrClass.dat</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HKCU\SOFTWARE\Classes 
%USERPROFILE%\AppData\Local\Microsoft\Windows\UsrClass.dat
</code></pre></div></div>

<h2 id="software-hive-registry-entries">SOFTWARE Hive Registry Entries</h2>

<h3 id="common-startup-locations">Common startup locations</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run 
HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Runonce
HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunonceEx
</code></pre></div></div>

<h3 id="network-information">Network Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList
	\Signatures
		\Unmanaged 
			(record DefaultGatewayMac, DnsSuffix, FirstNetwork(SSID), ProfileGUID)
		\Managed
	\Nla\Cache
	Profiles

HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\HomeGroup
HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles\[GUID]
	0x06 = Wired
	0x17 = Broadband
	0x47 = Wireless
</code></pre></div></div>

<p>Gather information via Live Queries:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Signatures\Unmanaged" /s
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles" /s
</code></pre></div></div>

<h3 id="gather-wifi-passwords">Gather WiFi Passwords</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netsh wlan show profile
netsh wlan show profile name={NAME} key=clear
netsh wlan export profile interface=* key=clear
ls C:\ProgramData\Microsoft\Wlansvc\Profiles\Interfaces\*\* | cat
</code></pre></div></div>

<h3 id="networks-connecteddisconnected-tofrom-and-mac-address">Networks connected\disconnected to\from and mac address</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-NetworkProfile/Operational'; Id='10000';}|FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-NetworkProfile/Operational'; Id='10001';}|FL TimeCreated,Message
Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-DHCP*'; Id='50067';}|FL TimeCreated,Message
Get-WmiObject win32_networkadapterconfiguration | FL description, macaddress
</code></pre></div></div>

<h3 id="get-host-mac-addresses">Get host Mac Addresses</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>getmac
</code></pre></div></div>

<h3 id="lookup-mac-addressorganizationally-unique-identifier-oui">Lookup MAC Address/Organizationally Unique Identifier (OUI)</h3>

<p>A number of ways to do this but one of the most accurate is from the <a href="https://regauth.standards.ieee.org/standards-ra-web/pub/view.html#registries">IEEE Webpage</a>.
You can interact directly with their REST API to get the results you want in JSON format. To do so via PowerShell, just change the ‘text’ top the first 3 digits of the MAC Address (The OUI):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12;Invoke-WebRequest -Uri "https://services13.ieee.org/RST/standards-ra-web/rest/assignments/?registry=MAC&amp;text=08-00-27&amp;sortby=organization&amp;sortorder=asc&amp;size=10" | Select -exp content;
</code></pre></div></div>

<h2 id="useful-wireshark-filters">Useful Wireshark filters</h2>

<h3 id="all-traffic-to-or-from-an-ip">All traffic to or from an IP</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ip.addr == {IP}
</code></pre></div></div>

<h3 id="all-tcp-traffic-on-a-port">All TCP traffic on a port</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcp.port == {port}
</code></pre></div></div>

<h3 id="all-traffic-from-an-ip">All traffic from an IP</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ip.src == {IP}
</code></pre></div></div>

<h3 id="all-traffic-to-an-ip">All traffic to an IP</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ip.dst == {IP}
</code></pre></div></div>

<h3 id="http-or-dns-traffic">HTTP or DNS Traffic</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http || dns
</code></pre></div></div>

<h3 id="clientdc-traffic-filtering-noise">Client&gt;DC traffic filtering noise</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb || nbns || dcerpc || nbss || dns
</code></pre></div></div>

<h3 id="tcp-issues-flags">TCP issues (flags)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcp.analysis.flags
</code></pre></div></div>

<h3 id="tcp-protocol-flags-present">TCP protocol flags (present)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcp.flags.syn == 1
tcp.flags.ack == 1
</code></pre></div></div>

<h3 id="encrypted-traffic">Encrypted Traffic</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ssh || tls)
</code></pre></div></div>

<h3 id="follow-tcp-stream">Follow TCP Stream</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcp.stream == {StreamNum}
</code></pre></div></div>

<h3 id="tcp-packets-for-string">TCP packets for string</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcp contains {String}
</code></pre></div></div>

<h3 id="http-codes">HTTP codes</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http.response.code == 400
http.response.code == 200
http.response.code == 404
http.response.code == 500
</code></pre></div></div>

<h3 id="user-agent-withoutwith-case-sensitivity">User agent, without/with case sensitivity</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http.user_agent matches "firefox"
http.user_agent matches "(?-i)firefox"
</code></pre></div></div>

<h3 id="addresses-on-subnet-by-iphostname">Addresses on subnet by IP/Hostname</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ip.addr == 172.217.167.78/16
ip.addr eq hostname/24
</code></pre></div></div>

<h3 id="tls-handshakes-shows-certificate-information">TLS Handshakes (Show’s certificate information)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tls.handshake.type == 11
</code></pre></div></div>

<h3 id="filter-based-on-server-type">Filter based on server type</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http.server == "Apache"
</code></pre></div></div>

<h2 id="wireshark-key-tips-and-tricks-by-brad-duncan">Wireshark Key Tips and Tricks by Brad Duncan</h2>

<ul>
  <li><a href="https://www.wireshark.org/docs/man-pages/wireshark-filter.html">General Wireshark Filter Reference</a></li>
  <li><a href="https://www.wireshark.org/docs/dfref/">Full Wireshark Display Filter Reference</a></li>
  <li><a href="https://unit42.paloaltonetworks.com/unit42-customizing-wireshark-changing-column-display/">Customizing Wireshark – Changing Your Column Display</a></li>
  <li><a href="https://unit42.paloaltonetworks.com/using-wireshark-display-filter-expressions/">Using Wireshark – Display Filter Expressions</a></li>
  <li><a href="https://unit42.paloaltonetworks.com/using-wireshark-identifying-hosts-and-users/">Using Wireshark: Identifying Hosts and Users</a></li>
  <li><a href="https://unit42.paloaltonetworks.com/using-wireshark-exporting-objects-from-a-pcap/">Using Wireshark: Exporting Objects from a Pcap</a></li>
  <li><a href="https://unit42.paloaltonetworks.com/wireshark-tutorial-examining-trickbot-infections/">Wireshark Tutorial: Examining Trickbot Infections</a></li>
  <li><a href="https://unit42.paloaltonetworks.com/wireshark-tutorial-examining-ursnif-infections/">Wireshark Tutorial: Examining Ursnif Infections</a></li>
</ul>

<h2 id="decrypting-encrypted-packets">Decrypting Encrypted Packets</h2>

<p>This can be done in a few ways:</p>

<p>Man-in-the-middle (MITM)</p>
<ul>
  <li><a href="https://github.com/moxie0/sslstrip">MITM Through SSLStrip</a></li>
  <li><a href="https://mitmproxy.org/">MITM Through mitmproxy</a></li>
</ul>

<p><a href="https://wiki.wireshark.org/TLS#Using_the_.28Pre.29-Master-Secret">Using the (Pre)-Master-Secret SSLKEYLOGFILE</a>
<a href="https://docs.microsoft.com/en-us/archive/blogs/nettracer/decrypting-ssltls-sessions-with-wireshark-reloaded">Using an RSA Private Key</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tshark -nr pcapfile -o ssl.keylog_file:./random.keylog -T fields -e http2.headers.cookie
</code></pre></div></div>

<h2 id="using-tshark-to-analyse-pcaps">Using tshark to analyse pcaps</h2>

<p>Note: The above filters can be used with the below techniques by specifying ‘-Y’ and using a capture filter, or ‘-R’ and using a read/display filter (only use if doing multiple passes of file).  Different outputs are specified using ‘-T’.</p>

<h3 id="merging-multiple-pcap-files">Merging multiple pcap files</h3>

<p>Note: <a href="https://www.wireshark.org/docs/man-pages/mergecap.html">mergecap</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mergecap /[directory]/*.pcap -w /[directory]/capture.pcap
</code></pre></div></div>

<h3 id="list-unique-ip-sources-in-pcap">List Unique IP Sources in Pcap</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tshark -T fields -r 'capture.pcap' -e ip.src | sort -u
</code></pre></div></div>

<h3 id="list-unique-ip-sources-and-destination-for-http-traffic">List Unique IP Sources and Destination for HTTP traffic</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tshark -T fields -r 'capture.pcap' -e ip.src -e ip.dst -Y "http" | sort -u
</code></pre></div></div>

<h3 id="live-dns-request-and-responses-on-wifi">Live DNS Request and Responses on WiFi</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tshark -i wlan0 -T fields -f "src port 53" -n -e dns.qry.name -e dns.resp.addr	
</code></pre></div></div>

<h3 id="extract-all-objectsfiles-from-supported-protocols">Extract All Objects/Files from Supported Protocols</h3>

<p>Note: This will create a folder called ‘exported’ and put the results in there</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tshark -r 'capture.pcap' --export-objects http,exported
tshark -r 'capture.pcap' --export-objects dicom,exported
tshark -r 'capture.pcap' --export-objects imf,exported
tshark -r 'capture.pcap' --export-objects smb,exported
tshark -r 'capture.pcap' --export-objects tftp,exported
</code></pre></div></div>

<h3 id="list-uris-accessed">List URIs Accessed</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tshark -T fields -r capture.pcap -e http.host -e ip.dst -e http.request.full_uri -Y "http.request"
</code></pre></div></div>

<h3 id="get-http-post-requests-and-output-to-json">Get HTTP POST Requests and Output to JSON</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tshark -T json -r capture.pcap -Y "http.request.method == POST"
</code></pre></div></div>

<h3 id="export-objects">Export objects</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tshark -r capture.pcap --export-objects http,[folderName]
tshark -r capture.pcap --export-objects dicom,[folderName]
tshark -r capture.pcap --export-objects tftp,[folderName]
tshark -r capture.pcap --export-objects imf,[folderName]
tshark -r capture.pcap --export-objects smb,[folderName]
</code></pre></div></div>

<h3 id="list-post-request-parameters">List POST Request Parameters</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tshark -r victim.pcap -Y "ip.src == [IP] &amp;&amp; http.request.method == POST" -T fields -e frame.time -e ip.src -e http.host -e http.request.uri -e urlencoded-form.key -e urlencoded-form.value
</code></pre></div></div>

<h2 id="using-tcpdump-to-analyse-cut-out-pcaps">Using tcpdump to analyse (cut out) pcaps</h2>

<h3 id="packets-containing-syn--ack-flags">Packets containing Syn &amp; Ack Flags</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump -r file.pcap "tcp[tcpflags] &amp; (tcp-syn|tcp-ack) == tcp-syn|tcp-ack" -w /targetfile.pcap	
</code></pre></div></div>

<h3 id="packets-containing-only-syn-flag">Packets containing only Syn Flag</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump -r file.pcap "tcp[tcpflags] == tcp-syn" -w /targetfile.pcap	
</code></pre></div></div>

<h3 id="packets-containing-only-syn-and-ack-flags">Packets containing only Syn and Ack Flags</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump -r file.pcap "tcp[tcpflags] == tcp-syn|tcp-ack" -w /targetfile.pcap	
</code></pre></div></div>

<h2 id="system-hive-registry-entries">SYSTEM Hive Registry Entries</h2>

<h3 id="usb-information">USB Information</h3>

<p>USB information is commonly found within the Windows Event Logs from Storage Service and Partition diagnostics on Windows 10 and later:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Microsoft-Windows-Storsvc/Diagnostic
Microsoft-Windows-Partition/Diagnostic
</code></pre></div></div>

<p>Example query last USB inserted:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$a=(Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Storsvc/Diagnostic';Id='1001'} -MaxEvents 1);
($a) | select -exp TimeCreated;	($a).Properties | select -exp Value;
</code></pre></div></div>

<p>Example query USB removed:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$a=(Get-WinEvent -FilterHashtable @{LogName='Microsoft-Windows-Partition/Diagnostic';} -MaxEvents 1);
($a) | select -exp TimeCreated;	($a).Properties | select -exp Value;
</code></pre></div></div>

<p>Outside of this, the registry has a number of artifacts:</p>

<ul>
  <li>
    <p>HKLM\SOFTWARE\Microsoft\Windows Portable Devices\Devices
Note: Find Serial # and then look for FriendlyName to obtain the Volume Name of the USB device</p>
  </li>
  <li>HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\EMDMgmt
    <ul>
      <li>Key will ONLY be present if system drive is NOT SSD</li>
      <li>Traditionally used for ReadyBoost</li>
      <li>Find Serial # to obtain the Volume Serial Numberof the USB deviceoThe Volume Serial Number will be in decimal - convert to hex</li>
      <li>You can find complete history of Volume Serial Numbers here, even if the device has been formatted multiple times. The USB device’s Serial # will appear multiple times, each with a different Volume Serial Number generated on each format.</li>
    </ul>
  </li>
  <li>HKLM\SYSTEM\MountedDevices
    <ul>
      <li>Find Serial # to obtain the Drive Letter of the USB device</li>
      <li>Find Serial # to obtain the Volume GUID of the USB device</li>
    </ul>
  </li>
</ul>

<p>Using the VolumeGUID found in SYSTEM\MountedDevices, you can find the user that actually mounted the USB device:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NTUSER.DAT\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Mountpoints2
</code></pre></div></div>

<p>USB Times:</p>

<ul>
  <li>First time device is connected</li>
  <li>Last time device is connected</li>
  <li>Removal time</li>
</ul>

<p><strong>Live System</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HKLM\SYSTEM\CurrentControlSet\Enum\USBSTOR (Class ID/Serial Number)
HKLM\SYSTEM\CurrentControlSet\Enum\USB (VID/PID)
HKLM\SYSTEM\CurrentControlSet\Control\DeviceContainers\*
</code></pre></div></div>

<p>Some quick 1-liners:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reg query HKLM\SYSTEM\CurrentControlSet\Enum\SWD\WPDBUSENUM\ /s /f FriendlyName
reg query HKLM\SYSTEM\CurrentControlSet\Enum\USBSTOR\ /s /f FriendlyName
reg query HKLM\SYSTEM\CurrentControlSet\Enum\USB\ /s /f FriendlyName
reg query HKLM\SYSTEM\CurrentControlSet\Enum\USBSTOR\
reg query HKLM\SYSTEM\CurrentControlSet\Enum\USB\
reg query HKLM\SYSTEM\CurrentControlSet\Enum\SWD\WPDBUSENUM\
reg query HKLM\SYSTEM\CurrentControlSet\Control\DeviceContainers\ /s /f "USB"
</code></pre></div></div>

<p>Live System pnputil for all devices and interfaces</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pnputil /enum-devices
pnputil /enum-interfaces
</code></pre></div></div>

<p><strong>Forensic Image</strong>
(Determine Control Set Number from HKLM\SYSTEM\Select\ -&gt; Current Value)
HKLM\SYSTEM\ControlSet00x\Enum\USBSTOR (Class ID/Serial Number)
HKLM\SYSTEM\ControlSet00x\Enum\USB (VID/PID)</p>

<p>Note: VID/PID information can be found online. Subdirectories under USB and USBSTOR provide unique USB identifiers (if the &amp; is near the end), if it is near the start they do not conform to MS standards and it is unique to the given PC only.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HKLM\SYSTEM\CurrentControlSet\Enum\USBSTOR\Ven_Prod_Version\USB iSerial#\Properties\{GUID}\####
</code></pre></div></div>

<ul>
  <li>0064 = First Install</li>
  <li>0066 = Last Connected</li>
  <li>0067 = Last Removal</li>
</ul>

<p><a href="https://github.com/woanware/usbdeviceforensics">More Information</a></p>

<h3 id="os-information">OS Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation
HKLM\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName
 	HKLM\SYSTEM\CurrentControlSet\services\LanmanServer\Shares
HKLM\SYSTEM\CurrentControlSet\FileSystem
	NtfsDisableLastAccessUpdate set at 0x1 means that access time stamps are turned OFF by default
</code></pre></div></div>

<h3 id="network-information-1">Network Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wmic nic get /all /format:list
wmic nicconfig get /all /format:list

HKLM\SYSTEM\CurrentControlSet\services\Tcpip\Parameters\Interfaces
	Display interfaces and their IP address configuration (using interface GUID)
</code></pre></div></div>

<h3 id="prefetch-information">Prefetch Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management\PrefetchParameters
	0=Disabled
	1=Application prefetching enabled
	3=Application and Boot prefetching enabled (default)
</code></pre></div></div>

<p><a href="https://ericzimmerman.github.io/#!index.md">Prefetch Parser</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PECmd.exe -d "C:\Windows\Prefetch"
PECmd.exe -d "C:\Windows\Prefetch" --csv "c:\temp" --csvf Prefetch.csv
gci C:\Windows\Prefetch\
</code></pre></div></div>

<p><a href="https://github.com/analyzeDFIR/analyzePF">analyzePF</a>
<a href="https://www.nirsoft.net/utils/win_prefetch_view.html">WinPrefetchView</a></p>

<h3 id="superfetch-information">Superfetch Information</h3>

<ul>
  <li>HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management\PrefetchParameters /v EnableSuperfetch
    <ul>
      <li>0=Disabled</li>
      <li>1=Booting only</li>
      <li>2=Applications</li>
      <li>3=Application and Boot</li>
    </ul>
  </li>
</ul>

<p>Find relevant files:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gci C:\Windows\Prefetch\ -recurse -include *.db, *.trx
</code></pre></div></div>

<h2 id="powershell-host-based-investigation-and-containment-techniques">PowerShell Host Based Investigation and Containment Techniques</h2>

<p>Note: I thoroughly recommend looking at maintaining an accurate log of all actions taken through the use of PowerShell host based IR and Containment. To do so I recommend reading <a href="https://devblogs.microsoft.com/powershell/powershell-the-blue-team/">PowerShell ♥ the Blue Team</a>. This will allow you to log all actions taken through this type of IR Framework. Other alternatives for larger scale response include:</p>

<h3 id="powerforensics"><a href="https://powerforensics.readthedocs.io/en/latest/">PowerForensics</a></h3>
<h3 id="google-rapid-response"><a href="https://github.com/google/grr">Google Rapid Response</a></h3>
<h3 id="kansa-powershell-ir-framework"><a href="https://github.com/davehull/Kansa">Kansa PowerShell IR Framework</a></h3>

<p>Google Rapid Response comes in the form of a Server &gt; Client architecture but is very flexible.</p>

<ul>
  <li><a href="https://grr-doc.readthedocs.io/en/latest/index.html">GRR Docs</a></li>
</ul>

<p>Kansa is a modular PowerShell IR Framework which can be used across multiple hosts in parallel.</p>

<h3 id="enable-ps-remoting-using-psexec">Enable PS Remoting using PsExec</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>psexec.exe \\TARGET -s powershell Enable-PSRemoting -Force;
</code></pre></div></div>

<p>OR for public network setup (less security)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>psexec.exe \\TARGET -s powershell Enable-PSRemoting -SkipNetworkProfileCheck -Force;
</code></pre></div></div>

<h3 id="confirm-trusted-hosts-list-if-required">Confirm trusted hosts list if required</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-Item WSMan:\localhost\Client\TrustedHosts
Set-Item WSMan:\localhost\Client\TrustedHosts -Value 'ASSET1,ASSET2'
</code></pre></div></div>

<h3 id="quick-remote-response-no-auditlogging">Quick Remote Response (no audit/logging)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Enter-PSSession -ComputerName SERVER -Credential [name]
</code></pre></div></div>

<h3 id="setup-logging-for-ir">Setup logging for IR</h3>

<p>Note: If you enter a PSSession, the logging won’t persist, so you will need to enable it on the remote host and pull the file back afterwards. Otherwise refer to PowerShell ♥ the Blue Team mentioned above.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Start-Transcript -Path "C:\[location]\investigation-1.log" -NoClobber
</code></pre></div></div>

<p><a href="https://b2dfir.blogspot.com/2018/11/windows-powershell-remoting-host-based.html">Thanks Barnaby Skeggs</a></p>

<h3 id="establish-remote-session">Establish Remote Session</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$s1 = New-PSsession -ComputerName remotehost -SessionOption (New-PSSessionOption -NoMachineProfile) -ErrorAction Stop
</code></pre></div></div>

<h3 id="enter-or-exit-remote-session">Enter or exit remote session</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Enter-PSSession -Session $s1
Exit-PSSEssion
</code></pre></div></div>

<h3 id="issuing-remote-commandshell">Issuing remote command/shell</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Invoke-Command -ScriptBlock {whoami} -Session $s1
Invoke-Command -file file.ps1 -Session $s1
</code></pre></div></div>

<h3 id="retrievingdownloading-files">Retrieving/downloading files</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Copy-Item -Path "[RemoteHostFilePath]" -Destination "[LocalDestination]" -FromSession $s1
</code></pre></div></div>

<h3 id="checking-for-running-processes">Checking for running processes</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Invoke-Command -ScriptBlock {Get-Process} -Session $s1
</code></pre></div></div>

<h3 id="query-registry-keys">Query Registry Keys</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Invoke-Command -ScriptBlock {Get-ItemProperty -Path HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run} -Session $s1
</code></pre></div></div>

<h3 id="pcap-collection">PCAP collection</h3>
<p>*Note: Script and pcap should be located under: C:\Windows\System32 or your user directory.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Invoke-Command -ScriptBlock {ipconfig} -Session $s1

Invoke-Command -ScriptBlock {
$url = "https://raw.githubusercontent.com/nospaceships/raw-socket-sniffer/master/raw-socket-sniffer.ps1"
Invoke-WebRequest -Uri $url `
	-OutFile "raw-socket-sniffer.ps1"
PowerShell.exe -ExecutionPolicy bypass .\raw-socket-sniffer.ps1 `
	-InterfaceIp "[RemoteIPv4Address]
	-CaptureFile "capture.cap"
	} -Session $s1
</code></pre></div></div>

<h3 id="blocking-a-domain">Blocking a domain</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Invoke-Command -ScriptBlock { Add-Content C:\Windows\System32\drivers\etc\hosts "`n127.0.0.1 bad.com"} -Session $s1
</code></pre></div></div>

<h3 id="blocking-an-ip">Blocking an IP</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Invoke-Command -ScriptBlock {New-NetFirewallRule -DisplayName "Block_Malicious_IP" -Direction Outbound –LocalPort Any -Protocol TCP -Action Block -RemoteAddress 173.182.192.43}  -Session $s1
</code></pre></div></div>

<h3 id="unblocking-an-ip">Unblocking an IP</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Invoke-Command -ScriptBlock {Remove-NetFirewallRule -DisplayName "Block_Malicious_IP"} -Session $s1
</code></pre></div></div>

<h3 id="quarantining-a-host-using-firewall">Quarantining a host using Firewall</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Invoke-Command -ScriptBlock {New-NetFirewallRule -DisplayName InfoSec_Quarantine -Direction Outbound -Enabled True -LocalPort Any -RemoteAddress Any -Action Block} -Session $s1
</code></pre></div></div>

<h3 id="creating-an-ou-to-quarantine-a-host-into">Creating an OU to quarantine a host into</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import-module ActiveDirectory
New-ADOrganizationalUnit -Name "Quarantined" -Path "DC=CORP,DC=COM"
</code></pre></div></div>

<p>Or</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dsadd ou "ou=Quarantined,dc=CORP,dc=COM"
</code></pre></div></div>

<h3 id="moving-an-ad-object-into-a-quarantine-ou">Moving an AD Object into a quarantine OU</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Move-ADObject -Identity "CN=[USERNAME],OU=Marketing,DC=CORP,DC=com" -TargetPath "OU=Quarantined,DC=CORP,DC=com"
</code></pre></div></div>

<h3 id="quarantining-a-host-using-dcom">Quarantining a host using DCOM</h3>

<p>Note: Another method which is a little more DANGEROUS is to disable DCOM on this host and restart which will stop something using DCOM to spread TO this host. 
This will likely break some aspects of it communicating on the domain, and also your ability to respond so it’s not recommended, but this is a possible solution for a host which is to be thoroughly contained before being investigated once an asset is returned (for example for re-imaging). This can be reversed by changing this registry key back to Y.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Invoke-Command -ScriptBlock {reg add HKLM\SOFTWARE\Microsoft\Ole /v EnableDCOM /t REG_SZ /d N /f; shutdown /r /f;} -Session $s1
</code></pre></div></div>

<h3 id="remove-a-quarantined-host">Remove a quarantined host</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Invoke-Command -ScriptBlock {Remove-NetFirewallRule -DisplayName InfoSec_Quarantine} -Session $s1
</code></pre></div></div>

<h3 id="disable-admin-shares-1">Disable Admin Shares</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Invoke-Command -ScriptBlock {Red add "HKLM\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /V "AutoShareWks" /T "REG_DWORD" /D "0" /F } -Session $s1
Invoke-Command -ScriptBlock {restart-service Lanmanserver -Force} -Session $s1
</code></pre></div></div>

<h3 id="credentials-and-exposure">Credentials and Exposure</h3>

<p>When investigating a compromised asset, it’s important to know what remote triage methods leave your credentials on the infected endpoint, and what ones don’t.
Reference can be found on <a href="https://docs.microsoft.com/en-us/windows-server/identity/securing-privileged-access/securing-privileged-access-reference-material#administrative-tools-and-logon-types">Microsoft Documentation</a></p>

<table>
  <thead>
    <tr>
      <th>Connection Method</th>
      <th>Logon Type</th>
      <th>Reusable credentials on destination</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Logon via console</td>
      <td>Interactive</td>
      <td>Y</td>
      <td>Includes hardware remote access/network KVM/lights-out cards</td>
    </tr>
    <tr>
      <td>RUNAS</td>
      <td>Interactive</td>
      <td>Y</td>
      <td>Nil</td>
    </tr>
    <tr>
      <td>RUNAS/NETWORK</td>
      <td>NewCredentials</td>
      <td>Y</td>
      <td>Clones LSA session, but uses new creds when connecting to network resources.</td>
    </tr>
    <tr>
      <td>Remote Desktop</td>
      <td>RemoteInteractive</td>
      <td>Y</td>
      <td>Nil</td>
    </tr>
    <tr>
      <td>Remote Desktop Failure</td>
      <td>RemoteInteractive</td>
      <td>N</td>
      <td>Only stored briefly</td>
    </tr>
    <tr>
      <td>Net Use * \SERVER</td>
      <td>Network</td>
      <td>N</td>
      <td>Nil</td>
    </tr>
    <tr>
      <td>Net Use * \ SERVER /user</td>
      <td>Network</td>
      <td>N</td>
      <td>Nil</td>
    </tr>
    <tr>
      <td>MMC snap-ins to remote computer</td>
      <td>Network</td>
      <td>N</td>
      <td>Nil</td>
    </tr>
    <tr>
      <td>PowerShell WinRM</td>
      <td>Network</td>
      <td>N</td>
      <td>e.g. Enter-PSSession SERVER</td>
    </tr>
    <tr>
      <td>PowerShell WinRM with CredSSP</td>
      <td>NetworkClearText</td>
      <td>Y</td>
      <td>e.g. New-PSSession SERVER -Authentication Credssp -Credential PWD</td>
    </tr>
    <tr>
      <td>PsExec without explicit creds</td>
      <td>Network</td>
      <td>N</td>
      <td>e.g. PsExec \SERVER cmd</td>
    </tr>
    <tr>
      <td>PsExec with explicit creds</td>
      <td>Network&amp;Interactive</td>
      <td>Y</td>
      <td>PsExec \SERVER -u USER -p PWD cmd</td>
    </tr>
    <tr>
      <td>Remote Registry</td>
      <td>Network</td>
      <td>N</td>
      <td>Nil</td>
    </tr>
    <tr>
      <td>Remote Desktop Gateway</td>
      <td>Network</td>
      <td>N</td>
      <td>Authenticating to Remote Desktop Gateway</td>
    </tr>
    <tr>
      <td>Scheduled Task</td>
      <td>Batch</td>
      <td>Y</td>
      <td>Also saved as LSA secret on disk</td>
    </tr>
    <tr>
      <td>Tools as Service</td>
      <td>Service</td>
      <td>Y</td>
      <td>Also saved as LSA secret on disk</td>
    </tr>
    <tr>
      <td>Vuln Scanners</td>
      <td>Network</td>
      <td>N</td>
      <td>Most use Network logons; however, those that don’t have the risk of creds on destination.</td>
    </tr>
    <tr>
      <td>IIS “Basic Authentication”</td>
      <td>NetworkCleartext</td>
      <td>Y</td>
      <td>Nil</td>
    </tr>
    <tr>
      <td>IIS “Integrated Windows Authentication”</td>
      <td>Network</td>
      <td>N</td>
      <td>NTLM/Kerberos Providers</td>
    </tr>
  </tbody>
</table>

<hr>

<h4 id="cached-credentials">Cached Credentials</h4>

<p>Cached credentials are located within a system’s registry at:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HKEY_LOCAL_MACHINE\SECURITY\Cache
</code></pre></div></div>

<h3 id="kerberos-tickets-and-exposure">Kerberos Tickets and Exposure</h3>

<p>Special thanks to <a href="https://cert.europa.eu/static/WhitePapers/CERT-EU_SWP_17-002_Lateral_Movements.pdf">Cert EU</a> for this.
When comparing Pass-the-Hash to Pass-the-Ticket attacks, the following key differences apply:</p>

<ul>
  <li>Administrative privileges are required to steal credentials, but NOT to use an obtained Kerberos ticket.</li>
  <li>A password change does NOT make Kerberos tickets invalid.	By default Kerberos has a max lifetime of 10hrs before the ticket must be renewed, and a max renewal time of 7 days after being granted.</li>
</ul>

<p>Due to this disabling accounts may not be enough to prevent ongoing compromise, and you may have to purge the users kerberos ticket. Locate the user in question using ‘sessions’ and purge by specifying the user session prior to logging them off.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>klist.exe sessions
klist purge –li 0x2e079217 
query user
logoff [session id]
</code></pre></div></div>

<h2 id="windows-memory-forensics">Windows Memory Forensics</h2>

<h3 id="volatility-2x-basics">Volatility 2.x Basics</h3>

<p>(Note: Depending on what version of volatility you are using and where you may need to substitute volatility with vol.py if there’s no alias setup)</p>

<h4 id="find-out-what-profiles-you-have-available">Find out what profiles you have available</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility --info
</code></pre></div></div>

<h4 id="find-out-the-originating-os-profile-to-be-used-from-the-memory-dump">Find out the originating OS profile to be used from the memory dump.</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem imageinfo
volatility -f memorydump.mem kdbgscan
</code></pre></div></div>

<h4 id="determine-what-plugins-are-available-for-use">Determine what plugins are available for use.</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] -h
</code></pre></div></div>

<h4 id="check-what-processes-were-running">Check what processes were running.</h4>

<p>(Note: Any entires for svchost.exe should always have services.exe as a parent process and parameters such as /k should always be present)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] pslist
volatility -f memorydump.mem --profile=[profilename] psscan
volatility -f memorydump.mem --profile=[profilename] tree
</code></pre></div></div>

<h4 id="check-what-commands-have-been-run-and-their-output">Check what commands have been run and their output.</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] cmdscan
volatility -f memorydump.mem --profile=[profilename] consoles
</code></pre></div></div>

<h4 id="dump-process-files-which-were-running-from-memory">Dump process files which were running from memory.</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] procdump -p [processid] --dump-dir=./
</code></pre></div></div>

<h4 id="dump-the-memory-associated-with-a-process-file">Dump the memory associated with a process file.</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] memdump -p [processid] --dump-dir=./
</code></pre></div></div>

<h4 id="dump-all-cached-files-from-memory">Dump all cached files from memory.</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] dumpfiles --dump-dir=./
</code></pre></div></div>

<h4 id="check-what-drivers-or-kernal-modules-were-unloaded-or-hidden">Check what drivers or kernal modules were unloaded or hidden.</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] modscan
</code></pre></div></div>

<h4 id="check-what-network-connectivity-has-occurred">Check what network connectivity has occurred.</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] netscan
</code></pre></div></div>

<h4 id="check-what-network-connectivity-has-occurred-windows-xpserver-2003">Check what network connectivity has occurred (Windows XP/Server 2003).</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] connections
volatility -f memorydump.mem --profile=[profilename] conscan
volatility -f memorydump.mem --profile=[profilename] sockets
volatility -f memorydump.mem --profile=[profilename] sockscan
</code></pre></div></div>

<h4 id="check-what-information-exists-within-registry-from-memory">Check what information exists within registry from memory.</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] hivelist
volatility -f memorydump.mem --profile=[profilename] hivescan
volatility -f memorydump.mem --profile=[profilename] hivedump --dump-dir=./
volatility -f memorydump.mem --profile=[profilename] userassist
volatility -f memorydump.mem --profile=[profilename] shellbags
volatility -f memorydump.mem --profile=[profilename] shimcache
volatility -f memorydump.mem --profile=[profilename] shimcachemem
</code></pre></div></div>

<h4 id="check-internet-explorer-browsing-history">Check internet explorer browsing history</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] iehistory
</code></pre></div></div>

<h4 id="check-for-files-in-memory-dump">Check for files in memory dump</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] filescan
</code></pre></div></div>

<h4 id="dump-files-based-on-offset">Dump files based on offset</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] dumpfiles -Q [offsetfromfilescan] --dump-dir=./
</code></pre></div></div>

<h4 id="scan-memory-with-yara-rule">Scan memory with Yara Rule</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] yarascan -y rule.yara
</code></pre></div></div>

<h4 id="duplicate-image-space-out-as-a-raw-dd-file">Duplicate image space out as a raw DD file</h4>

<p>(e.g. dump files such as hiberfil.sys memory from memory).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] imagecopy
</code></pre></div></div>

<h4 id="dump-timelined-artifacts-from-memory">Dump timelined artifacts from memory.</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] timeliner
</code></pre></div></div>

<h4 id="detect-persistence-mechanisms-using-winesap">Detect persistence mechanisms using Winesap</h4>

<ul>
  <li><a href="http://www.dfrws.org/sites/default/files/session-files/characteristics_and_detectability_of_windows_auto-start_extensibility_points_in_memory_forensics.pdf">Research Paper</a></li>
  <li>
    <p><a href="https://gitlab.unizar.es/rrodrigu/winesap">Volatility Plugin - Winesap</a></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  volatility -f memdump.mem --profile=[profile] autoruns
  volatility --plugins=./winesap/plugin -f memdump.mem --profile=[profile] autoruns
  volatility --plugins=./winesap/plugin -f memdump.mem --profile=[profile] autoruns --match
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="compare-memory-dump-to-known-good-memory-dump">Compare memory dump to known good memory dump.</h4>

<ul>
  <li>
    <p><a href="https://github.com/csababarta/volatility_plugins">csababarta plugins</a></p>

    <p>volatility -f infected.mem –profile=[profilename] processbl -B clean.mem -U 2&gt;/dev/null
  volatility -f infected.mem –profile=[profilename] servicebl -B clean.mem -U 2&gt;/dev/null
  volatility -f infected.mem –profile=[profilename] driverbl -B clean.mem -U 2&gt;/dev/null</p>
  </li>
</ul>

<h4 id="output-visual-dot-file-to-view-process-tree">Output visual .dot file to view process tree</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] psscan --output=dot --output-file=psscan.dot
volatility -f memorydump.mem --profile=[profilename] tree --output=dot --output-file=pstree.dot
dot -Tpng pstree.dot -o pstree.png
dot -Tpng pstree.dot -o psscan.png
</code></pre></div></div>

<h3 id="volatility-3x-basics">Volatility 3.x Basics</h3>

<p>Note: <a href="https://github.com/volatilityfoundation/volatility3/">Version 3 of Volatility</a> was released in November 2019 which changes the Volatility usage and syntax. More information on V3 of Volatility can be found on <a href="https://volatility3.readthedocs.io/en/latest/basics.html">ReadTheDocs</a>.</p>

<p>A list of common plugins are:</p>

<ul>
  <li>linux.bash.Bash</li>
  <li>linux.check_afinfo.Check_afinfo</li>
  <li>linux.check_syscall.Check_syscall</li>
  <li>linux.elfs.Elfs</li>
  <li>linux.lsmod.Lsmod</li>
  <li>linux.lsof.Lsof</li>
  <li>linux.malfind.Malfind</li>
  <li>linux.proc.Maps</li>
  <li>linux.pslist.PsList</li>
  <li>linux.pstree.PsTree</li>
  <li>mac.bash.Bash</li>
  <li>mac.check_syscall.Check_syscall</li>
  <li>mac.check_sysctl.Check_sysctl</li>
  <li>mac.check_trap_table.Check_trap_table</li>
  <li>mac.ifconfig.Ifconfig</li>
  <li>mac.lsmod.Lsmod</li>
  <li>mac.lsof.lsof</li>
  <li>mac.malfind.Malfind</li>
  <li>mac.netstat.Netstat</li>
  <li>mac.proc_maps.Maps</li>
  <li>mac.psaux.Psaux</li>
  <li>mac.pslist.PsList</li>
  <li>mac.pstree.PsTree</li>
  <li>mac.tasks.Tasks</li>
  <li>mac.timers.Timers</li>
  <li>mac.trustedbsd.trustedbsd</li>
  <li>windows.cmdline.CmdLine</li>
  <li>windows.dlldump.DllDump</li>
  <li>windows.dlllist.DllList</li>
  <li>windows.driverirp.DriverIrp</li>
  <li>windows.driverscan.DriverScan</li>
  <li>windows.filescan.FileScan</li>
  <li>windows.handles.Handles</li>
  <li>windows.info.Info</li>
  <li>windows.malfind.Malfind</li>
  <li>windows.moddump.ModDump</li>
  <li>windows.modscan.ModScan</li>
  <li>windows.modules.Modules</li>
  <li>windows.mutantscan.MutantScan</li>
  <li>windows.poolscanner.PoolScanner</li>
  <li>windows.procdump.ProcDump</li>
  <li>windows.pslist.PsList</li>
  <li>windows.psscan.PsScan</li>
  <li>windows.pstree.PsTree</li>
  <li>windows.registry.certificates.Certificates</li>
  <li>windows.registry.hivedump.HiveDump</li>
  <li>windows.registry.hivelist.HiveList</li>
  <li>windows.registry.hivescan.HiveScan</li>
  <li>windows.registry.printkey.PrintKey</li>
  <li>windows.registry.userassist.UserAssist</li>
  <li>windows.ssdt.SSDT</li>
  <li>windows.statistics.Statistics</li>
  <li>windows.strings.Strings</li>
  <li>windows.symlinkscan.SymlinkScan</li>
  <li>windows.vaddump.VadDump</li>
  <li>windows.vadinfo.VadInfo</li>
  <li>windows.virtmap.VirtMap</li>
  <li>timeliner.Timeliner</li>
</ul>

<h4 id="check-memory-image-information">Check Memory Image Information</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/bin/python3.6 vol.py -f /home/user/samples/mem.bin windows.info.Info
</code></pre></div></div>

<h4 id="check-list-of-kernel-drivers">Check List of Kernel Drivers</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/bin/python3.6 vol.py -f /home/user/samples/mem.bin windows.modules.Modules
</code></pre></div></div>

<h4 id="check-list-of-kernel-drivers-incl-previously-unloaded-and-hidden">Check List of Kernel Drivers (incl previously unloaded and hidden)</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/bin/python3.6 vol.py -f /home/user/samples/mem.bin windows.modscan.ModScan
</code></pre></div></div>

<h4 id="dump-list-of-kernel-drivers-to-files">Dump List of Kernel Drivers to Files</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/bin/python3.6 vol.py -f /home/user/samples/mem.bin windows.moddump.ModDump
</code></pre></div></div>

<h4 id="dump-list-of-running-processes-to-files">Dump List of Running Processes to Files</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/bin/python3.6 vol.py -f /home/user/samples/mem.bin windows.procdump.ProcDump
</code></pre></div></div>

<h4 id="check-process-list-of-running-processes">Check Process List of Running Processes</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/bin/python3.6 vol.py -f /home/user/samples/mem.bin windows.pslist.PsList
</code></pre></div></div>

<h4 id="check-process-tree-of-running-processes">Check Process Tree of Running Processes</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/bin/python3.6 vol.py -f /home/user/samples/mem.bin windows.pstree.PsTree
</code></pre></div></div>

<h4 id="check-running-processes-from-eprocess-blocks">Check Running Processes from EPROCESS blocks</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/bin/python3.6 vol.py -f /home/user/samples/mem.bin windows.psscan.PsScan
</code></pre></div></div>

<h4 id="check-running-processes-for-possible-shellcodeinjection-via-page_execute_readwrite">Check Running Processes for possible shellcode/injection via PAGE_EXECUTE_READWRITE</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/bin/python3.6 vol.py -f /home/user/samples/mem.bin windows.malfind.Malfind
</code></pre></div></div>

<h4 id="check-processes-and-their-command-lines">Check processes and their command lines</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/bin/python3.6 vol.py -f /home/user/samples/mem.bin windows.cmdline.CmdLine
</code></pre></div></div>

<h4 id="check-for-files-which-exist-in-memory">Check for files which exist in memory</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/bin/python3.6 vol.py -f /home/user/samples/mem.bin windows.filescan.FileScan
</code></pre></div></div>

<h2 id="miscellaneous-tools-and-notes">Miscellaneous Tools and Notes</h2>

<p><a href="https://ericzimmerman.github.io/#!index.md">Eric Zimmerman has excellent widely used libraries and tools</a></p>

<h3 id="regripper"><a href="https://github.com/keydet89/RegRipper3.0">RegRipper</a></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rip.pl -r NTUSER.DAT -f ntuser | less.
rip.pl -r SAM -f sam | less
rip.exe -l
rip.exe -r C:\Users\User\ntuser.dat -p userassist
</code></pre></div></div>

<h3 id="kape"><a href="https://learn.duffandphelps.com/kape">Kape</a></h3>
<p><em>Note:</em> <a href="https://www.youtube.com/watch?v=L9H1uj2HSb8">Video Tutorial</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kape.exe --tsource C --target RegistryHives --tdest "[location]"
kape.exe --tsource \\server\directory --target !ALL --tdest "[location]" --vhdx LOCALHOST
</code></pre></div></div>

<h3 id="chainsaw"><a href="https://github.com/cyb3rpeace/chainsaw">Chainsaw</a></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./chainsaw search mimikatz -i evtx_attack_samples/
./chainsaw search -t 'Event.System.EventID: =4104' evtx_attack_samples/
./chainsaw search -e "DC[0-9].insecurebank.local" evtx_attack_samples --json
./chainsaw hunt evtx_attack_samples/ -s sigma_rules/ --mapping mappings/sigma-event-logs-all.yml
</code></pre></div></div>

<h3 id="hayabusa"><a href="https://github.com/Yamato-Security/hayabusa">Hayabusa</a></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hayabusa.exe csv-timeline -l -o results.csv
hayabusa.exe json-timeline -l -o results.json
hayabusa.exe logon-summary -l -o results.csv
hayabusa.exe csv-timeline -d D:\capture\EVTX_Files -o results.csv
hayabusa.exe json-timeline -d D:\capture\EVTX_Files -o results.json
hayabusa.exe logon-summary -d D:\capture\EVTX_Files -o results.csv
</code></pre></div></div>

<h3 id="shimcaheparser"><a href="https://github.com/mandiant/ShimCacheParser">ShimCaheParser</a></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ShimCacheParser.py -h
ShimCacheParser.py -i SYSTEM --BOM 
</code></pre></div></div>

<h3 id="appcompatcacheparser"><a href="https://ericzimmerman.github.io/#!index.md">AppCompatCacheParser</a></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AppCompatCacheParser.exe --csv .\ -t
</code></pre></div></div>

<h3 id="amcacheparser"><a href="https://ericzimmerman.github.io/#!index.md">AmCacheParser</a></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AmcacheParser.exe --csv .\ -f .\Amcache.hve
</code></pre></div></div>

<h3 id="windows-10-timeline-database-parser"><a href="https://ericzimmerman.github.io/#!index.md">Windows 10 Timeline Database Parser</a></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WxTCmd.exe -f "C:\Users\[username]\AppData\Local\ConnectedDevicesPlatform\L.[username]\ActivitiesCache.db" --csv .
</code></pre></div></div>

<h3 id="bulk-extractor"><a href="http://downloads.digitalcorpora.org/downloads/bulk_extractor/">Bulk Extractor</a></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bulk_extractor64.exe -o [outputdir] memdump.mem
</code></pre></div></div>

<h3 id="forensicdots"><a href="https://www.forensicdots.de/">ForensicDots</a></h3>

<p>Note: Can be used to determine the <a href="https://en.wikipedia.org/wiki/Machine_Identification_Code">Machine Identification Code</a> of a Printer.</p>

<h3 id="cyber-chef"><a href="https://gchq.github.io/CyberChef/">Cyber Chef</a></h3>

<p>The Cyber Swiss Army Knife - a web app for encryption, encoding, compression and data analysis.
Note: This was created by an analyst at the GCHQ which is part of the UKs National Cyber Security Centre. The source is actively maintained on <a href="https://github.com/gchq/CyberChef">Github</a></p>

<h3 id="urlscan"><a href="https://urlscan.io/">URLScan</a></h3>

<p>A “sandbox for the web”. One of the most widely used, freely available URL scanners which provides a breakdown of technologies used on a website, safebrowsing score, screenshots, redirects, hosting information and certificates, and much more.</p>

<h3 id="redirect-tracker"><a href="https://www.websiteplanet.com/webtools/redirected/?url=">Redirect Tracker</a></h3>

<p>Note: Thanks to Alejandra for sharing this.</p>

<p>Can be used to see any redirects that will likely occur with a description on each response code to help with analysis when accessing a URL e.g. a shortened URL such as bitly links.</p>

<h3 id="unshorten-me"><a href="https://unshorten.me/">Unshorten Me</a></h3>

<p>Can be used to see the end result of a shortened URL that will likely occur along with a screenshot.</p>

<h3 id="malware-hash-registry---team-cymru"><a href="https://hash.cymru.com/">Malware Hash Registry - Team Cymru</a></h3>

<p>Check malware hashes against the Team Cymru database</p>

<h3 id="virustotal"><a href="https://www.virustotal.com/gui/home/search">VirusTotal</a></h3>

<p>Check malware hashes against the VirusTotal database</p>

<h3 id="mitre-attck-framework"><a href="https://attack.mitre.org/">MITRE ATT&amp;CK® Framework</a></h3>

<p>Globally-accessible knowledge base of adversary tactics and techniques based on real-world observations.</p>

<h3 id="lolbas-project"><a href="https://lolbas-project.github.io/">LOLBAS Project</a></h3>

<p>The goal of the LOLBAS project is to document every binary, script, and library that can be used for Living Off The Land techniques.</p>

<h3 id="gtfobins"><a href="https://gtfobins.github.io/">GTFOBins</a></h3>

<p>GTFOBins is a curated list of Unix binaries that can be used to bypass local security restrictions in misconfigured systems.</p>

<h3 id="malapiio"><a href="https://malapi.io/">MalAPI.io</a></h3>

<p>MalAPI.io maps Windows APIs to common techniques used by malware.</p>

<h3 id="lots-project"><a href="https://lots-project.com/">LOTS-Project</a></h3>

<p>Attackers are using popular legitimate domains when conducting phishing, C&amp;C, exfiltration and downloading tools to evade detection. LOTS-Project aims to list websites that allow attackers to use their domain or subdomain.</p>

<h3 id="filesecio"><a href="https://filesec.io/">Filesec.io</a></h3>

<p>Repository of file extensions being used by attackers.</p>

<h3 id="loldriversio"><a href="https://www.loldrivers.io/">LOLDrivers.io</a></h3>

<p>Sometimes referred to as BYOVD, Living Off The Land Drivers is a community-driven project that provides a curated list of all Windows drivers that have been found abused by adversaries to bypass security controls and execute malicious code.</p>

<h3 id="echotrail"><a href="https://www.echotrail.io/insights">EchoTrail</a></h3>

<p>Look up description, commonality, behavior, and more associated with an executable file name or hash</p>

<h3 id="winbindex"><a href="https://winbindex.m417z.com/">Winbindex</a></h3>

<p>An index of Windows binaries and files including: location, metadata of file, what build it’s found in and much more</p>

<h3 id="osquery"><a href="https://www.osquery.io/">OSQuery</a></h3>

<p>Open source agent used to query endpoints in a live response fashion.</p>

<h3 id="velociraptor"><a href="https://www.velocidex.com/docs/">Velociraptor</a></h3>

<p>Digital forensic and Incident Response tool to enhance visibility on endpoints.</p>

<h3 id="vipermonkey"><a href="https://github.com/kirk-sayre-work/ViperMonkey">ViperMonkey</a></h3>

<p>Visual Basic emulation engine used to analyze and deobfuscate malicious VBA macros.</p>

<h3 id="pcapxray"><a href="https://github.com/Srinivas11789/PcapXray">PcapXray</a></h3>

<p>Plot network traffic from pcap file into visual diagram</p>

<h4 id="parse-and-interpret-vba-macros">Parse and interpret VBA macros</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vmonkey phishing.docm
</code></pre></div></div>

<h4 id="faster-output">Faster output</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pypy vmonkey.py -s phishing.docm
</code></pre></div></div>

<h4 id="less-verbose-output">Less verbose output</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vmonkey -l warning phishing.docm
</code></pre></div></div>

<h3 id="xlm-macro-deobfuscator"><a href="https://github.com/DissectMalware/XLMMacroDeobfuscator">XLM Macro Deobfuscator</a></h3>

<h4 id="parse-and-interpret-hidden-xlm-macros-excel-40-macros">Parse and interpret hidden XLM Macros (Excel 4.0 Macros)</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xlmdeobfuscator --file malware.xlsm
</code></pre></div></div>

<p>Note: Using a tool such as <a href="http://b2xtranslator.sourceforge.net/snapshots/BiffView.zip">BiffView</a> we’re able to view BOUNDSHEET records to find hidden sheets. This is indicated by ‘02 01’ hex values at the 5th and 6th offset.</p>

<p>Changing 02 to 00 makes these hidden spreadsheets visible without having to run any macros.</p>

<h3 id="mounting-image-files-in-linux">Mounting image files in linux</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /mnt/windows
imageMounter.py
ImageMounter.py -s [imagefile] /mnt/windows
cd /mnt/windows
</code></pre></div></div>

<p>OR</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /mnt/windows
sudo apt install libguestfs-tools
sudo virt-list-filesystems [vhdx file]
sudo guestmount -a [vhdx file] -m /dev/[filesystemabove] -r /mnt/windows -o allow_other
</code></pre></div></div>

<h3 id="mounting-image-files-in-windows">Mounting image files in Windows</h3>

<ul>
  <li><a href="https://arsenalrecon.com/downloads/">Arsenal Image Mounter</a></li>
  <li><a href="https://accessdata.com/product-download/ftk-imager-version-4-2-1">FTK Imager</a></li>
  <li><a href="https://www.sleuthkit.org/autopsy/download.php">Autopsy</a></li>
</ul>

<h3 id="unpack-binary-packed-with-upx">Unpack binary packed with UPX</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>upx -d PackedProgram.exe
</code></pre></div></div>

<h3 id="scan-exchange-for-phishing-emails">Scan exchange for phishing emails</h3>

<p>Disclaimer: Always test before running against live systems. For those running Office365 <a href="https://docs.microsoft.com/en-us/office365/securitycompliance/search-for-and-delete-messages-in-your-organization">this documentation</a> may be more useful.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># This is used to authenticate yourself and connect to the exchange server
$UserCredential = Get-Credential
$Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri http://EXCHANGEHOSTFQDN/PowerShell/ -Credential $UserCredential
Import-PSSession $Session -DisableNameChecking

# This is used to confirm the mailboxes accessible and modules available
Get-Mailbox
Get-Module

# This is used to remove emails from a mailbox and move them to an administrator mailbox as a backup
Search-Mailbox -Identity "NAME" | Search-Mailbox -SearchQuery 'Subject:"SUBJECT LINE"' -TargetMailbox "ADMINBACKUPMAILBOX" -TargetFolder "BACKUPFOLDER" -DeleteContent

# This is used to run a report on anyone who received an email with a malicious attachment and log this information in an administrator mailbox
Get-Mailbox -ResultSize unlimited | Search-Mailbox -SearchQuery attachment:trojan* -TargetMailbox "ADMINBACKUPMAILBOX" -TargetFolder "BACKUPFOLDER" -LogOnly -LogLevel Full

# This is used to disconnect from the established powershell session
Remove-PSSession $Session
</code></pre></div></div>

<h3 id="common-dll-information">Common DLL Information</h3>

<table>
  <thead>
    <tr>
      <th>DLL</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Kernel32.dll</td>
      <td>(Windows Kernel) This is a very common DLL that contains core functionality, such as access and manipulation of memory, files, and hardware.</td>
    </tr>
    <tr>
      <td>Advapi32.dll</td>
      <td>(Advanced API) This DLL provides access to advanced core Windows components such as the Service Manager and Registry.</td>
    </tr>
    <tr>
      <td>Ntdll.dll</td>
      <td>(NT Layer) This DLL is the interface to the Windows kernel. Executables rarely import this file directly, although it is always imported indirectly by Kernel32.dll. If an executable deliberately imports this, it means that the author wanted to use functionality not normally available to Windows programs. Some tasks, such as hiding functionality or manipulating processes, will use this interface.</td>
    </tr>
    <tr>
      <td>User32.dll</td>
      <td>(Windows User) This DLL contains all the user interface components, such as buttons, scroll bars, and components for controlling and responding to user actions.</td>
    </tr>
    <tr>
      <td>Wininet.dll</td>
      <td>(Windows Internet API) This DLL contains high level networking functions. These implement protocols such as FTP, HTTP, and NTP.</td>
    </tr>
    <tr>
      <td>Gdi32.dll</td>
      <td>(Graphics Device Interface) This DLL contains functions used for displaying and manipulating graphics.</td>
    </tr>
    <tr>
      <td>WSock32.dll and Ws2_32.dll</td>
      <td>(Windows Sockets API) These are networking DLLs. A program that accesses either of these will likely connect to a network or perform network related tasks.</td>
    </tr>
    <tr>
      <td>urlmon.dll</td>
      <td>(OLE32 Extensions for Win32) This DLL contains functions for COM-based networking. It is used by Internet Explorer and many other applications similar to the Windows Sockets API; however, it is at a higher level than the Windows Sockets API and Windows Internet API and has many elements prefilled.</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>When analysing a binary, small amount of strings present and minimal imported functions help confirm that it is a packed binary.</li>
</ul>

<h3 id="show-processes-with-networking-functions">Show processes with networking functions</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tasklist /m WSock32.dll
tasklist /m Ws2_32.dll
tasklist /m Wininet.dll
tasklist /m winhttp.dll
gps | ?{$_.Modules -like '*WSock32.dll*' -OR $_.Modules -like '*Ws2_32.dll*' -OR $_.Modules -like '*Wininet.dll*' -OR $_.Modules -like '*winhttp.dll*' }|FL Id, ProcessName
</code></pre></div></div>

<h3 id="show-processes-importing-the-remote-access-api">Show processes importing the Remote Access API</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tasklist /m RASAPI32.dll
</code></pre></div></div>

<h3 id="show-processes-importing-the-task-scheduler-api">Show processes importing the task scheduler API</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tasklist /m taskschd.dll
tasklist /m mstask.dll
</code></pre></div></div>

<h3 id="show-processes-importing-the-windows-media-instrumentation-api">Show processes importing the Windows Media Instrumentation API</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tasklist /m wbem*
tasklist /m wmi*
</code></pre></div></div>

<h2 id="windows-memory-analysis-example-process-with-volatility">Windows Memory Analysis (Example Process with Volatility)</h2>

<p>Identify memory OS information</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem imageinfo
</code></pre></div></div>

<p>Identify suspicious running processes</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] pstree
</code></pre></div></div>

<p>Show suspicious running processes based on names.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] pstree | egrep 'winlogon|lsass|services'
volatility -f memorydump.mem --profile=[profilename] psscan
</code></pre></div></div>

<p>Show any malicious or suspicious processes requiring investigation</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] malfind
</code></pre></div></div>

<p>Show any Process Hollowing (Hollow Process Injection)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] hollowfind
</code></pre></div></div>

<p>Dump suspicious process executables from memory</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] procdump -p [processid] --dump-dir=./
</code></pre></div></div>

<p>Parse the Master File Table</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f [memoryDump] mftparser -C --output-file=output.txt
</code></pre></div></div>

<p>Reassemble raw hex of file under $DATA back into original file from dump.raw file.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xxd -r dump.raw &gt; [filename.originalextension]
</code></pre></div></div>

<p>Compare hashes with known detections e.g. VirusTotal.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sha256 [filename]
https://www.virustotal.com
</code></pre></div></div>

<p>Create a timeline of events.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>volatility -f memorydump.mem --profile=[profilename] timeliner
volatility -f memorydump.mem --profile=[profilename] timeliner --hive=SECURITY
volatility -f memorydump.mem --profile=[profilename] timeliner --type=Registry
</code></pre></div></div>

<h3 id="windows-memory-analysis-dump-using-windbg">Windows Memory Analysis (dump) using Windbg</h3>

<p>Using <a href="https://github.com/comaeio/SwishDbgExt">Comaeio SwishDbgExt</a> you are able to better analyse Windows Crash (DMP) files using Windbg. To do this, download the latest release, run windbg, load the correct dll and then run a command. At the time of writing there are:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>!load X:\FullPath\SwishDbgExt.dll 

!help             - Displays information on available extension commands
!ms_callbacks     - Display callback functions
!ms_checkcodecave - Look for used code cave
!ms_consoles      - Display console command's history 
!ms_credentials   - Display user's credentials (based on gentilwiki's mimikatz) 
!ms_drivers       - Display list of drivers
!ms_dump          - Dump memory space on disk
!ms_exqueue       - Display Ex queued workers
!ms_fixit         - Reset segmentation in WinDbg (Fix "16.kd&gt;")
!ms_gdt           - Display GDT
!ms_hivelist      - Display list of registry hives
!ms_idt           - Display IDT
!ms_lxss          - Display lsxx entries
!ms_malscore      - Analyze a memory space and returns a Malware Score Index (MSI) - (based on Frank Boldewin's work)
!ms_mbr           - Scan Master Boot Record (MBR)
!ms_netstat       - Display network information (sockets, connections, ...)
!ms_object        - Display list of object
!ms_process       - Display list of processes
!ms_readkcb       - Read key control block
!ms_readknode     - Read key node
!ms_readkvalue    - Read key value
!ms_regcheck      - Scan for suspicious registry entries
!ms_scanndishook  - Scan and display suspicious NDIS hooks
!ms_services      - Display list of services
!ms_ssdt          - Display service descriptor table (SDT) functions
!ms_store         - Display information related to the Store Manager (ReadyBoost)
!ms_timers        - Display list of KTIMER
!ms_vacbs         - Display list of cached VACBs
!ms_verbose       - Turn verbose mode on/off
!ms_yarascan      - Scan process memory using yara rules
</code></pre></div></div>

<h4 id="other-inbuilt-windbg-commands-useful-for-single-process-memory-dump-analysis">Other inbuilt WindBG commands (Useful for single-process memory dump analysis)</h4>

<p>Get Address memory information</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>!address
</code></pre></div></div>

<p>Get All Thread Information</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~*
</code></pre></div></div>

<p>Get Current Thread Information</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~.
</code></pre></div></div>

<p>Get information from each frame of thread stack</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>!for_each_frame db
!for_each_frame dv -t -v
!for_each_frame dt -b
</code></pre></div></div>

<p>Recursively dump PEB of process</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dt ntdll!_PEB @$peb -r
</code></pre></div></div>

<p>Create Dump</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.dump D:\Downloads\test\test.dmp
</code></pre></div></div>

<p>DLL/Module Information</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>!dlls
lm
x *!
!lmi [ModuleName]
</code></pre></div></div>

<p>Get stacks for all threads</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>!uniqstack
</code></pre></div></div>

<p>Search Heap for String to view in memory</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>!address -f:Heap -c:"s -u %1 %2 \"http\""
</code></pre></div></div>

<p>Search for String across all memory</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>s -a 0 L?FFFFFFFF "StringToFind"
s -u 0 L?FFFFFFFF "StringToFind"
</code></pre></div></div>

<p>List nearest module to address</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ln [address]
ln 7c951782
</code></pre></div></div>

<p>Quick analysis</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>!analyze -v
</code></pre></div></div>

<h3 id="normal-process-relationship-hierarchy-geneology">Normal Process Relationship Hierarchy (Geneology)</h3>

<p><a href="https://digital-forensics.sans.org/media/DFPS_FOR508_v4.6_4-19.pdf">Excellent SANS Reference</a></p>

<p><strong>Old:</strong></p>

<p>System</p>
<ul>
  <li>smss.exe
    <ul>
      <li>winlogon.exe (upon smss.exe exiting)
        <ul>
          <li>userinit.exe
            <ul>
              <li>explorer.exe (upon userinit.exe exiting)</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>wininit.exe (upon smss.exe exiting)
        <ul>
          <li>lsass.exe</li>
          <li>services.exe
            <ul>
              <li>svchost.exe</li>
              <li>taskhost.exe</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>crss.exe</li>
    </ul>
  </li>
</ul>

<p><strong>Windows 10:</strong></p>

<p>System</p>
<ul>
  <li>smss.exe
    <ul>
      <li>winlogon.exe (upon smss.exe exiting)
        <ul>
          <li>userinit.exe
            <ul>
              <li>explorer.exe (upon userinit.exe exiting)</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>wininit.exe (upon smss.exe exiting)
        <ul>
          <li>lsass.exe</li>
          <li>lsaiso.exe (credential guard only)</li>
          <li>services.exe
            <ul>
              <li>svchost.exe
                <ul>
                  <li>taskhostw.exe</li>
                  <li>runtimebroker.exe</li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>crss.exe</li>
    </ul>
  </li>
</ul>

<h3 id="extra-notes">Extra notes</h3>

<p>Be mindful of the below:</p>

<ul>
  <li>svchost.exe should always have services.exe pid as ppid and a service associated with it.</li>
  <li>there should never be more than 1 lsass.exe process.</li>
  <li>lsass.exe should always have a parent of winlogon.exe (WinXP and older) or Wininit.exe (Vista or newer).</li>
  <li>pslist and pstree follow a ‘Double Linked List’ which malware can ‘unlink’ itself from thus hiding the process.</li>
  <li>psscan looks instead for ‘EPROCESS blocks’ which is memory associated with a windows process.</li>
  <li>Discrepencies between these 2 areas can indicate the process hollowing has occurred.
    <ul>
      <li>VAD = Virtual Address Descriptor which lives in kernel memory.</li>
      <li>PEB = Process Environment Block which lives in process memory.</li>
    </ul>
  </li>
  <li>PAGE_EXECUTE_READWRITE protection indicates memory marked as executable, which may indicate potential shellcode was used or injected.</li>
  <li>Process hollowing essentially pauses and duplicates a legitimate process, replaces the executable memory with something malicious, and then resumes the process. Process Injection on the other hand injects malicious code into an already running process which causes that process to execute the code.</li>
</ul>

<hr>

<h1 id="linux-cheat-sheet">Linux Cheat Sheet</h1>

<hr>

<h2 id="dumping-memory">Dumping Memory</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dd if=/dev/kmem of=/root/kmem
dd if=/dev/mem of=/root/mem
</code></pre></div></div>

<p><a href="https://github.com/504ensicsLabs/LiME/releases">LiME</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo insmod ./lime.ko "path=./Linmen.mem format=raw"
</code></pre></div></div>

<p><a href="https://github.com/Velocidex/c-aff4/releases/">LinPMem</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./linpmem -o memory.aff4
./linpmem memory.aff4 -e PhysicalMemory -o memory.raw
</code></pre></div></div>

<h2 id="taking-image">Taking Image</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fdisk -l
dd if=/dev/sda1 of=/[outputlocation]
</code></pre></div></div>

<h2 id="misc-useful-tools">Misc Useful Tools</h2>

<p><a href="https://github.com/SekoiaLab/Fastir_Collector_Linux">FastIR</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python ./fastIR_collector_linux.py
</code></pre></div></div>

<p><a href="https://github.com/rebootuser/LinEnum/blob/master/LinEnum.sh">LinEnum</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./linenum.sh
./linenum.sh -t
</code></pre></div></div>

<h2 id="live-triage">Live Triage</h2>

<h3 id="system-information-1">System Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>date
uname –a
lsb_release -a
hostname
cat /proc/version
lsmod
</code></pre></div></div>

<h3 id="account-information">Account Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /etc/passwd
cat /etc/shadow
cat /etc/sudoers
cat /etc/sudoers.d/*
cut -d: -f1 /etc/passwd
getent passwd | cut -d: -f1
compgen -u
</code></pre></div></div>

<h3 id="current-user">Current user</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>whoami
who
</code></pre></div></div>

<h3 id="last-logged-on-users">Last logged on users</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>last
lastb
cat /var/log/auth.log
</code></pre></div></div>

<h3 id="initialisation-files">Initialisation Files</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /etc/bash.bashrc
cat ~/.bash_profile 
cat ~/.bashrc 
</code></pre></div></div>

<h3 id="environment-and-startup-programs">Environment and Startup Programs</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>env
cat /etc/profile
ls /etc/profile.d/
cat /etc/profile.d/*
</code></pre></div></div>

<h3 id="scheduled-tasks">Scheduled Tasks</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls /etc/cron.*
ls /etc/cron.*/*
cat /etc/cron.*/*
cat /etc/crontab
crontab -l
</code></pre></div></div>

<h3 id="commands-that-can-be-run-as-root-or-user">Commands That Can Be Run As Root or User</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo -l
</code></pre></div></div>

<h3 id="ssh-keys-and-authorised-users">SSH Keys and Authorised Users</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /etc/ssh/sshd_config
</code></pre></div></div>

<p>Note: This specifies where the SSH daemon will look for keys. Generally this will be as below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls /home/*/.ssh/*
cat /home/*/.ssh/id_rsa.pub
cat /home/*/.ssh/authorized_keys
</code></pre></div></div>

<h3 id="sudoers-file-who-who-can-run-commands-as-a-different-user">Sudoers File (who who can run commands as a different user)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /etc/sudoers
</code></pre></div></div>

<h3 id="configuration-information">Configuration Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls /etc/*.d
cat /etc/*.d/*
</code></pre></div></div>

<h3 id="network-connections--socket-stats">Network Connections / Socket Stats</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netstat
netstat -apetul
netstat -plan
netstat -plant
netstat -naote
ss
ss -l
ss -ta
ss -tp
</code></pre></div></div>

<h3 id="dns-information-for-domain">DNS Information for Domain</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dig www.jaiminton.com a
dig www.jaiminton.com any
dig www.jaiminton.com ns
dig www.jaiminton.com soa
dig www.jaiminton.com hinfo
dig www.jaiminton.com txt
dig +short www.jaiminton.com
</code></pre></div></div>

<h3 id="ips-allowed-to-perform-domain-transfer">IPs Allowed to Perform Domain Transfer</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /etc/bind/named.conf.local
</code></pre></div></div>

<h3 id="specify-ip-to-use-for-domain-transfer">Specify IP To Use For Domain Transfer</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dig @127.0.0.1 domain.here axfr -b [IP]
</code></pre></div></div>

<h3 id="ip-table-information">IP Table Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls /etc/iptables
cat /etc/iptables/*.v4
cat /etc/iptables/*.v6
iptables -L
</code></pre></div></div>

<h3 id="use-iptables-for-filtering">Use IPTables For Filtering</h3>

<p><a href="https://andreafortuna.org/2019/05/08/iptables-a-simple-cheatsheet/">AndreaFortuna Cheatsheet</a></p>

<h3 id="network-configuration">Network Configuration</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ifconfig -a
</code></pre></div></div>

<h3 id="difference-between-2-files">Difference Between 2 Files</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>diff [file1] [file2]
</code></pre></div></div>

<h3 id="browser-plugin-information">Browser Plugin Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls -la ~/.mozilla/plugins
ls -la /usr/lib/mozilla/plugins
ls -la /usr/lib64/mozilla/plugins
ls -la ~/.config/google-chrome/Default/Extensions/
</code></pre></div></div>

<h3 id="kernel-modules-and-extensions">Kernel Modules and Extensions/</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls -la /lib/modules/*/kernel/*
</code></pre></div></div>

<h3 id="file-permissions">File Permissions</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-rw-r-x-wt 1 fred fred 0 Aug 10 2019 /home/fred/malware
|[-][-][-]- [---][---]
| |  |  | |   |    |
| |  |  | |   |    *-----------------&gt; 7. Group
| |  |  | |   *----------------------&gt; 6. Owner
| |  |  | *--------------------------&gt; 5. Alternate Access Method
| |  |  *----------------------------&gt; 4. Others Permissions
| |  *-------------------------------&gt; 3. Group Permissions
| *----------------------------------&gt; 2. Owner Permissions
*------------------------------------&gt; 1. File Type
</code></pre></div></div>

<p><a href="https://www.guru99.com/file-permissions.html">File Permissions in Linux</a></p>

<h3 id="decode-base64-encoded-file">Decode base64 Encoded File</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>base64 -d [filename]
echo [b64stream] | base64 -d
</code></pre></div></div>

<h3 id="process-information-2">Process Information</h3>

<table>
  <tbody>
    <tr>
      <td>ps [simple</td>
      <td>list</td>
      <td>output</td>
      <td>threads</td>
      <td>misc</td>
      <td>all]’</td>
    </tr>
  </tbody>
</table>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ps -s
ps -l
ps -o
ps -t
ps -m
ps -a
ps -ax
top
</code></pre></div></div>

<h3 id="size-of-file-bytes">Size Of File (Bytes)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wc -c [file]
</code></pre></div></div>

<h3 id="ip-making-most-requests-in-access-log">IP Making Most Requests in Access Log</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cut -d " " -f 1 access.log | sort | uniq -c | sort -n -k 1,1
</code></pre></div></div>

<h3 id="count-of-unique-ips-in-access-log">Count of Unique IPs in Access Log</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cut -d " " -f 1 access.log | sort -u | wc -l
</code></pre></div></div>

<h3 id="unique-user-agents-in-access-log">Unique User Agents in Access Log</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>awk -F \" '{ print $6 }' access.log | sort -u
</code></pre></div></div>

<h3 id="most-requested-urls-for-post-request-in-access-log">Most Requested URLs For POST Request in Access Log</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>awk -F \" '{ print $2 }' access.log | grep "POST" | sort | uniq -c | sort -n -k 1,1
</code></pre></div></div>

<h3 id="lines-in-file">Lines In File</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wc -l [file]
</code></pre></div></div>

<h3 id="search-files-recursively-in-directory-for-keyword">Search files recursively in directory for keyword</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>grep -H -i -r "password" /
</code></pre></div></div>

<h3 id="process-tree">Process Tree</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ps -auxwf
</code></pre></div></div>

<h3 id="open-files-and-space-usage">Open Files and space usage</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lsof
du
</code></pre></div></div>

<h3 id="pluggable-authentication-modules-pam">Pluggable Authentication Modules (PAM)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /etc/pam.d/sudo
cat /etc/pam.conf
ls /etc/pam.d/
</code></pre></div></div>

<h3 id="disk--partition-information">Disk / Partition Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fdisk -l
</code></pre></div></div>

<h3 id="fulle-path-for-command-in-environment-variables">Fulle Path For Command in environment variables</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>which [softwarename]
</code></pre></div></div>

<h3 id="system-calls--network-traffic"><a href="https://bytefreaks.net/gnulinux/how-to-capture-all-network-traffic-of-a-single-process">System Calls / Network Traffic</a></h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>strace -f -e trace=network -s 10000 [PROCESS WITH ARGUMENTS];
strace -f -e trace=network -s 10000 -p [PID];
</code></pre></div></div>

<h3 id="strings-present-in-file">Strings Present In File</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>strings [filepath]
strings -e b [filepath]
</code></pre></div></div>

<p>Note: Below material with thanks to <a href="https://blog.apnic.net/2019/10/14/how-to-basic-linux-malware-process-forensics-for-incident-responders/">Craig Rowland - Sandfly Security</a></p>

<h3 id="detailed-process-information">Detailed Process Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls -al /proc/[PID]
</code></pre></div></div>

<p><strong>Note:</strong></p>

<ul>
  <li>CWD = Current Working Directory of Malware</li>
  <li>EXE = Binary location and whether it has been deleted</li>
  <li>Most Common Timestamp = When process was created</li>
</ul>

<h3 id="recover-deleted-binary-which-is-currently-running">Recover deleted binary which is currently running</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp /proc/[PID]/exe /[destination]/[binaryname]
</code></pre></div></div>

<h3 id="capture-binary-data-for-review">Capture Binary Data for Review</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp /proc/[PID]/ /[destination]/[PID]/
</code></pre></div></div>

<h3 id="binary-hash-information">Binary hash information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sha1sum /[destination]/[binaryname]
md5sum /[destination]/[binaryname]
</code></pre></div></div>

<h3 id="process-command-line-information">Process Command Line Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /proc/[PID]/cmdline
cat /proc/[PID]/comm
</code></pre></div></div>

<p><strong>Note:</strong></p>

<ul>
  <li>Significant differences in the above 2 outputs and the specified binary name under /proc/[PID]/exe can be indicative of malicious software attempting to remain undetected.</li>
</ul>

<h3 id="process-environment-variables-incl-user-who-ran-binary">Process Environment Variables (incl user who ran binary)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>strings /proc/[PID]/environ
cat /proc/[PID]/environ
</code></pre></div></div>

<h3 id="process-file-descriptorsmaps-what-the-process-is-accessing-or-using">Process file descriptors/maps (what the process is ‘accessing’ or using)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls -al /proc/[PID]/fd
cat /proc/[PID]/maps
</code></pre></div></div>

<h3 id="process-stackstatus-information-may-reveal-useful-elements">Process stack/status information (may reveal useful elements)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /proc/[PID]/stack
cat /proc/[PID]/status
</code></pre></div></div>

<h3 id="deleted-binaries-which-are-still-running">Deleted binaries which are still running</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls -alr /proc/*/exe 2&gt; /dev/null |  grep deleted
</code></pre></div></div>

<h3 id="process-working-directories-including-common-targeted-directories">Process Working Directories (including common targeted directories)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls -alr /proc/*/cwd
ls -alr /proc/*/cwd 2&gt; /dev/null | grep tmp
ls -alr /proc/*/cwd 2&gt; /dev/null | grep dev
ls -alr /proc/*/cwd 2&gt; /dev/null | grep var
ls -alr /proc/*/cwd 2&gt; /dev/null | grep home
</code></pre></div></div>

<h3 id="using-jq-to-analyse-json">Using JQ To Analyse JSON</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat people.json | jq '.[] | select((.name.first == "Fred") or (.name.last == "John"))'
cat people.json | jq '.[] | select((.name.first == "Fred") or (.name.last == "John"))'|@csv
</code></pre></div></div>

<h3 id="hidden-directories-and-files">Hidden Directories and Files</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find / -type d -name ".*"
</code></pre></div></div>

<h3 id="immutable-files-and-directories-often-suspicious">Immutable Files and Directories (Often Suspicious)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lsattr / -R 2&gt; /dev/null | grep "\----i"
</code></pre></div></div>

<h3 id="suidsgid-and-sticky-bit-special-permissions">SUID/SGID and Sticky Bit Special Permissions</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find / -type f \( -perm -04000 -o -perm -02000 \) -exec ls -lg {} \;
</code></pre></div></div>

<h3 id="file-and-directories-with-no-usergroup-name">File and Directories with no user/group name</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find / \( -nouser -o -nogroup \) -exec ls -lg  {} \;
</code></pre></div></div>

<h3 id="file-types-in-current-directory">File types in current directory</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>file * -p
</code></pre></div></div>

<h3 id="executables-on-file-system">Executables on file system</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find / -type f -exec file -p '{}' \; |  grep ELF
</code></pre></div></div>

<h3 id="hidden-executables-on-file-system">Hidden Executables on file system</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find / -name ".*" -exec file -p '{}' \; | grep ELF
</code></pre></div></div>

<h3 id="files-modified-within-the-past-day">Files modified within the past day</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find / -mtime -1
</code></pre></div></div>

<h3 id="find-files-for-a-particular-user">Find files for a particular user</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find /home/ -user fred -type f
</code></pre></div></div>

<h3 id="persistent-areas-of-interest">Persistent Areas of Interest</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/etc/rc.local
/etc/initd
/etc/rc*.d
/etc/modules
/etc/cron*
/var/spool/cron/*
/usr/lib/cron/
/usr/lib/cron/tabs
</code></pre></div></div>

<h3 id="audit-logs">Audit Logs</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls -al /var/log/*
ls -al /var/log/*tmp
utmpdump /var/log/btmp
utmpdump /var/run/utmp
utmpdump /var/log/wtmp
</code></pre></div></div>

<h3 id="installed-software-packages">Installed Software Packages</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls /usr/bin/
ls /usr/local/bin/
</code></pre></div></div>

<hr>
<h1 id="macos-cheat-sheet">MacOS Cheat Sheet</h1>

<ul>
  <li><a href="https://twitter.com/iamevltwin">Sarah Edwards</a></li>
  <li><a href="https://www.mac4n6.com/">Mac4n6</a></li>
  <li><a href="https://sansorg.egnyte.com/dl/zngSJguNqj">SANS FOR518 Reference Sheet</a></li>
  <li><a href="https://forensics.wiki/mac_os_x_10.9_artifacts_location/">Mac OS X 10.9 Forensics Wiki</a></li>
  <li><a href="https://forensics.wiki/mac_os_x/">Mac OS X Forensics Wiki</a></li>
  <li><a href="https://docs.google.com/spreadsheets/d/1X2Hu0NE2ptdRj023OVWIGp5dqZOw-CfxHLOW_GNGpX8/edit#gid=1317205466">Mac OS X Forensics Artifacts Spreadsheet</a></li>
</ul>

<h2 id="dumping-memory-1">Dumping Memory</h2>

<p><a href="https://github.com/wrmsr/pmem/tree/master/OSXPMem">OSXPMem</a></p>

<p><a href="https://github.com/google/rekall/releases/download/1.7.2rc1/rekall-OSX-1.7.2rc1.zip">MacPmem</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo kextload MacPmem.kext
sudo dd if=/dev/pmem of=memorydump.raw
</code></pre></div></div>

<h2 id="live-mac-ir--triage">Live Mac IR / Triage</h2>

<h3 id="system-information-2">System Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>date
sw_vers
uname –a
hostname
cat /System/Library/CoreServices/SystemVersion.plist
cat /private/var/log/daily.out
cat /Library/preferences/.Globalpreferences.plist
sysadminctl -filesystem status
</code></pre></div></div>

<h3 id="network-connections-1">Network Connections</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netstat –an
netstat –anf
lsof -i
</code></pre></div></div>

<h3 id="routing-table">Routing Table</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netstat –rn
</code></pre></div></div>

<h3 id="network-information-2">Network Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>arp –an
ndp -an
ifconfig
</code></pre></div></div>

<h3 id="open-files">Open Files</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lsof
</code></pre></div></div>

<h3 id="file-system-usage">File System Usage</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo fs_usage
sudo fs_usage [process] 
sudo fs_usage -f network
sudo fs_usage pid [PID]
</code></pre></div></div>

<h3 id="bash-history">Bash History</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat ~/.bash_history
history
</code></pre></div></div>

<h3 id="user-logins">User Logins</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>who -a
w
last
</code></pre></div></div>

<h3 id="list-of-users">List of users</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dscl . -list /Users
</code></pre></div></div>

<h3 id="user-information">User information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dscl . -read /Users/[username]
dscl . -readall /Users
</code></pre></div></div>

<h3 id="running-processes">Running Processes</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ps aux
</code></pre></div></div>

<h3 id="extended-running-process-information">Extended Running Process Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>launchctl procinfo [PID]
</code></pre></div></div>

<h3 id="system-profiler">System Profiler</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>system_profiler -xml -detaillevel full &gt; systemprofiler.spx
</code></pre></div></div>

<h3 id="persistent-locations">Persistent Locations</h3>

<h4 id="quick-overview-knockknock"><a href="https://www.objective-see.com/products/knockknock.html">Quick Overview (KnockKnock)</a></h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./KnockKnock.app/Contents/MacOS/KnockKnock -whosthere &gt; /path/to/some/file.json
</code></pre></div></div>

<h4 id="xpc-services">XPC Services</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls Applications/[application].app/Contents/XPCServices/
cat Applications/[application].app/Contents/XPCServices/*.xpc/Contents/Info.plist
ls ~/System/Library/XPCServices/
</code></pre></div></div>

<h4 id="launch-agents--launch-daemons">Launch Agents &amp; Launch Daemons</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls /Library/LaunchAgents/
ls /System/Library/LaunchAgents/
ls /System/Library/LaunchDaemons/
ls /Library/LaunchDaemons/
ls /users/*/Library/LaunchAgents/
launchctl list
launchctl print gui/[UID]
launchctl print system
</code></pre></div></div>

<h4 id="loginitems">LoginItems</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat ~/Library/Preferences/com.apple.loginitems.plist
ls [application].app/Contents/Library/LoginItems/
</code></pre></div></div>

<h3 id="disable-persistent-launch-daemon">Disable Persistent Launch Daemon</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo launchctl unload -w /Library/LaunchDaemons/[name].plist
sudo launchctl stop /Library/LaunchDaemons/[name].plist
</code></pre></div></div>

<h3 id="web-browsing-preferences">Web Browsing Preferences</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat ~/Library/Preferences/com.apple.Safari.plist 
ls ~/Library/Application Support/Google/Chrome/Default/Preferences
ls ~/Library/Application Support/Firefox/Profiles/********.default/prefs.js
</code></pre></div></div>

<h3 id="safari-internet-history">Safari Internet History</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat ~/Library/Safari/Downloads.plist
cat ~/Library/Safari/History.plist 
cat ~/Library/Safari/LastSession.plist
ls ~/Library/Caches/com.apple.Safari/Webpage Previews/ 
sqlite3 ~/Library/Caches/com.apple.Safari/Cache.db  
</code></pre></div></div>

<h3 id="chrome-internet-history">Chrome Internet History</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls ~/Library/Application Support/Google/Chrome/Default/History
ls ~/Library/Caches/Google/Chrome/Default/Cache/
ls ~/Library/Caches/Google/Chrome/Default/Media Cache/
</code></pre></div></div>

<h3 id="firefox-internet-history">Firefox Internet History</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlite3 ~/Library/Application Support/Firefox/Profiles/********.default/places.sqlite 
sqlite3 ~/Library/Application Support/Firefox/Profiles/********.default/downloads.sqlite
sqlite3 ~/Library/Application Support/Firefox/Profiles/********.default/formhistory.sqlite
ls ~/Library/Caches/Firefox/Profiles/********.default/Cache
</code></pre></div></div>

<h3 id="apple-email">Apple Email</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat ~/Library/Mail/V2/MailData/Accounts.plist
ls ~/Library/Mail/V2/
ls ~/Library/Mail Downloads/
ls ~/Downloads
cat ~/Library/Mail/V2/MailData/OpenAttachments.plist
</code></pre></div></div>

<h3 id="temporary--cached">Temporary / Cached</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls /tmp
ls /var/tmp 
ls /Users/[user]/Library/Caches/Java/tmp
ls /Users/[user]/Library/Caches/Java/cache
	/Applications/Utilities/Java Preferences.app
</code></pre></div></div>

<h3 id="system-and-audit-logs">System and Audit Logs</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls /private/var/log/asl/
ls /private/var/audit/
cat /private/var/log/appfirewall.log
ls ~/Library/Logs
ls /Library/Application Support/[app] 
ls /Applications/ 
ls /Library/Logs/
</code></pre></div></div>

<h3 id="specific-log-analysis">Specific Log Analysis</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bzcat system.log.1.bz2 
system.log.0.bz2 &gt;&gt; system_all.log 
cat system.log &gt;&gt; system_all.log
syslog -f [file]
syslog –T utc –F raw –d /asl
syslog -d /asl
praudit –xn /var/audit/*
sudo log collect
log show
log stream
</code></pre></div></div>

<h3 id="files-quarantined">Files Quarantined</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls ~/Library/Preferences/com.apple.LaunchServices.QuarantineEvents.V2
ls ~/Library/Preferences/com.apple.LaunchServices.QuarantineEvents 
</code></pre></div></div>

<h3 id="user-accounts--password-shadows">User Accounts / Password Shadows</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls /private/var/db/dslocal/nodes/Default/users/ 
ls /private/var/db/shadow/[User GUID]
</code></pre></div></div>

<h3 id="pluggable-authentication-modules-pam-1">Pluggable Authentication Modules (PAM)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /etc/pam.d/sudo
cat /etc/pam.conf
ls /etc/pam.d/
</code></pre></div></div>

<h3 id="file-fingerprintingreversing">File Fingerprinting/Reversing</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>file [filename]
xxd [filename]
nm -arch x86_64 [filename]
otool -L [filename]
sudo vmmap [pid]
sudo lsof -p [pid]
xattr –xl [file]
</code></pre></div></div>

<h3 id="connected-disks-and-partitions">Connected Disks and Partitions</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>diskutil list
diskutil info [disk]
diskutil cs
ap list
gpt –r show 
gpt -r show -l
</code></pre></div></div>

<h3 id="disk-file-image-information">Disk File Image Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hdiutil imageinfo *.dmg
</code></pre></div></div>

<h3 id="user-keychain-information">User Keychain Information</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>security list-keychains
security dump-keychains -d [keychain]
</code></pre></div></div>

<h3 id="spotlight-metadata">Spotlight Metadata</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mdimport –X | -A
mdls [file]
</code></pre></div></div>

<h3 id="extract-download-location-from-extended-attribute">Extract download location from Extended Attribute</h3>

<p>Note: This is essentially the ‘ADS’ of the MacOS world.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xattr -p com.apple.metadata:kMDItemWhereFroms filename.dmg | xxd -r -p | plutil -p -
</code></pre></div></div>

<h3 id="locate-historical-file-names-from-extended-attribute">Locate historical file names from Extended Attribute</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xattr -p com.apple.genstore.origdisplayname filename
</code></pre></div></div>

<h2 id="bonus-valuable-links">Bonus Valuable Links</h2>

<ul>
  <li><a href="https://attack.mitre.org/">MITRE ATT&amp;CK™</a></li>
  <li><a href="https://car.mitre.org/">MITRE Cyber Analytics Repository</a></li>
  <li><a href="https://redcanary.com/atomic-red-team/">Atomic Red Team</a></li>
  <li><a href="https://github.com/meirwah/awesome-incident-response">Awesome Incident Response</a></li>
  <li><a href="https://github.com/Cugu/awesome-forensics">Awesome Forensics</a></li>
  <li><a href="https://github.com/n0fate/mac-osx-forensics">Mac OSX Forensics</a></li>
  <li><a href="https://github.com/pstirparo/mac4n6">Unofficial Mac 4n6 Resources</a></li>
  <li><a href="https://ss64.com/osx/">Apple macOS command line (OS X bash)</a></li>
  <li><a href="https://www.mac4n6.com/">Mac4n6</a></li>
</ul>

<h1 id="special-thanks">Special Thanks</h1>
<ul>
  <li><a href="https://www.youtube.com/13cubed">13Cubed</a></li>
  <li><a href="https://www.youtube.com/watch?v=HcUMXxyYsnw">John Strand Windows Live Forensics</a></li>
  <li>Blue Team Field Manual - Alan White &amp; Ben Clark</li>
  <li><a href="https://www.dfir.training/resources/downloads/windows-registry">DFIR Training Windows Registry</a></li>
  <li><a href="http://blog.commandlinekungfu.com/">Commandlinekungfu</a></li>
  <li><a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc787567(v=ws.10)">Microsoft Audit Logon Events</a></li>
  <li><a href="https://docs.microsoft.com/en-us/windows/desktop/CIMWin32Prov/win32-logonsession">Windows Dev Win32_LogonSession</a></li>
  <li><a href="https://www.youtube.com/watch?v=cYphLiySAC4">Black Hills Information Security Windows Memory Forensics</a></li>
  <li><a href="https://forensicswiki.org/wiki/Main_Page">Forensics Wiki</a></li>
  <li><a href="https://wiki.wireshark.org/DisplayFilters">Wireshark Wiki</a></li>
  <li><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon">Microsoft Sysmon</a></li>
  <li><a href="https://github.com/AustralianCyberSecurityCentre/windows_event_logging">ACSC Github</a></li>
  <li><a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/command-line-arguments-windows-defender-antivirus">Windows Defender Docs</a></li>
  <li><a href="https://mikefrobbins.com/2013/12/19/using-powershell-to-remove-phishing-emails-from-user-mailboxes-on-an-exchange-server/">Mikefrobbins</a></li>
  <li><a href="https://docs.microsoft.com/en-us/office365/securitycompliance/search-for-and-delete-messagesadmin-help">Microsoft Office365</a></li>
  <li><a href="https://docs.microsoft.com/en-us/powershell/module/exchange/mailboxes/search-mailbox">Microsoft Exchange</a></li>
  <li><a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4768">Microsoft Threat Protection</a></li>
  <li><a href="https://adsecurity.org/?page_id=1821">ADsecurity</a></li>
  <li><a href="https://twitter.com/wincmdfu">Windows cmd fu</a></li>
  <li><a href="https://www.crowdstrike.com/blog/kovter-killer-how-to-remediate-the-apt-of-clickjacking/">Crowdstrike</a></li>
  <li><a href="https://blogs.technet.microsoft.com/tip_of_the_day/2015/03/28/tip-of-the-day-reading-the-usn-journal/">Technet Blog</a></li>
  <li><a href="https://tools.ietf.org/html/rfc3227#section-2.1">IETF RFC3227</a></li>
  <li><a href="https://www.cybereason.com/blog/adobe-worm-faker-uses-lolbins-and-dynamic-techniques-to-deliver-customized-payloads">Cybereason Adobe Worm</a></li>
  <li><a href="https://medium.com/@melanijan93/windows-10-mail-app-forensics-39025f5418d2">Melanijan93 Windows 10 mail forensics</a></li>
  <li><a href="https://www.cybereason.com/blog/triple-threat-emotet-deploys-trickbot-to-steal-data-spread-ryuk-ransomware">Cybereason Trickbot</a></li>
  <li><a href="https://www.datadigitally.com/2019/06/retrieving-memory-image-remotely.html">Bryan Ambrose</a></li>
  <li><a href="https://twitter.com/Lee_Holmes">Lee Holmes</a></li>
  <li><a href="https://www.bsk-consulting.de/2014/08/28/scan-system-files-manipulations-yara-inverse-matching-22/">Florian Roth</a></li>
  <li><a href="https://www.blackhat.com/docs/us-15/materials/us-15-Graeber-Abusing-Windows-Management-Instrumentation-WMI-To-Build-A-Persistent%20Asynchronous-And-Fileless-Backdoor-wp.pdf">Matt Graeber</a></li>
  <li><a href="https://social.technet.microsoft.com/wiki/contents/articles/4242.wmi-discovery-using-powershell.aspx">Vasily Gusev</a></li>
  <li><a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4672">MS Docs 4672</a></li>
  <li><a href="https://www.pdq.com/blog/modifying-the-registry-users-powershell/">Kris</a></li>
  <li><a href="https://twitter.com/barnabyskeggs">Barnaby Skeggs</a></li>
  <li><a href="https://twitter.com/iamevltwin">Sarah Edwards</a></li>
  <li><a href="https://medium.com/@fahimhossain_16989/adding-startup-scripts-to-launch-daemon-on-mac-os-x-sierra-10-12-6-7e0318c74de1">Fahim Hossain</a></li>
  <li><a href="https://www.linuxnix.com/linux-directory-structure-explainedetc-folder/">Surendra Anne</a></li>
  <li><a href="https://digital-forensics.sans.org/media/SANS_Poster_2018_Hunt_Evil_FINAL.pdf">SANS Hunt Evil</a></li>
  <li><a href="https://blog.apnic.net/2019/10/14/how-to-basic-linux-malware-process-forensics-for-incident-responders/">Craig Rowland - Sandfly Security</a></li>
  <li><a href="https://blogs.msdn.microsoft.com/servergeeks/2014/10/14/active-directory-files-and-their-functions/">Habibar Rahmen - MSDN Blog</a></li>
  <li><a href="https://az4n6.blogspot.com/2014/10/timestomp-mft-shenanigans.html">Mari DeGrazia</a></li>
  <li><a href="https://www.a12d404.net/windows/2019/10/30/schedsvc-persist-without-task.html">Markus Piéton</a></li>
  <li><a href="https://github.com/sbousseaden/Slides/blob/master/Windows%20DFIR%20Events.pdf">Samir</a></li>
  <li><a href="https://twitter.com/SBousseaden/status/1243711784101515274/photo/1">Samir - Persistence</a></li>
  <li><a href="https://www.fireeye.com/blog/threat-research/2019/12/breaking-the-rules-tough-outlook-for-home-page-attacks.html">FireEye</a></li>
  <li><a href="https://www.microsoft.com/en-us/download/details.aspx?id=36036">Microsoft-Mitigating Pass-the-Hash Attacks</a></li>
  <li><a href="https://www.slideshare.net/bsmuir/windows-10-forensics-os-evidentiary-artefacts">Brent Muir - Windows 10 Forensics</a></li>
  <li><a href="https://dfironthemountain.wordpress.com/2018/12/06/locked-file-access-using-esentutl-exe/">Mike Carey - Locked File Access Using ESENTUTL.exe</a></li>
  <li><a href="https://github.com/BornToBeRoot">BornToBeRoot</a></li>
  <li><a href="https://malware-traffic-analysis.net/tutorials/index.html">Malware-Traffic-Analysis - Brad Duncan</a></li>
  <li><a href="https://adsecurity.org/?p=3458">ADsecurity - Detecting Kerberoasting Activity</a></li>
  <li><a href="https://github.com/eladshamir/Internal-Monologue">eladshamir - Internal-Monologue</a></li>
  <li><a href="https://posts.specterops.io/defenders-think-in-graphs-too-part-1-572524c71e91">Jared Atkinson - Defenders think in graphs too</a></li>
  <li><a href="https://blog.xpnsec.com/exploring-mimikatz-part-1/">Adam Chester</a></li>
  <li><a href="https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/more-excel-4-0-macro-malspam-campaigns/">Diana Lopera - Trustwave</a></li>
  <li><a href="https://medium.com/@7a616368/can-you-track-processes-accessing-the-camera-and-microphone-7e6885b37072">svch0st</a></li>
  <li><a href="https://www.cyber.gov.au/acsc/view-all-content/advisories/advisory-2020-004-remote-code-execution-vulnerability-being-actively-exploited-vulnerable-versions-telerik-ui-sophisticated-actors">AustralianCyberSecurityCentre Advisory 2020-004</a></li>
  <li><a href="https://www.microsoft.com/security/blog/2016/06/14/wheres-the-macro-malware-author-are-now-using-ole-embedding-to-deliver-malicious-files/?source=mmpc">Microsoft - Where’s the Macro?</a></li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><svg class="svg-inline--fa fa-tags fa-w-20 fa-fw" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tags" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" data-fa-i2svg=""><path fill="currentColor" d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"></path></svg><!-- <i class="fas fa-fw fa-tags" aria-hidden="true"></i> --> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#cheatsheet" class="page__taxonomy-item" rel="tag">Cheatsheet</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#dfir" class="page__taxonomy-item" rel="tag">DFIR</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#forensics" class="page__taxonomy-item" rel="tag">Forensics</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#incident" class="page__taxonomy-item" rel="tag">Incident</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#ir" class="page__taxonomy-item" rel="tag">IR</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#response" class="page__taxonomy-item" rel="tag">Response</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><svg class="svg-inline--fa fa-folder-open fa-w-18 fa-fw" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="folder-open" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M572.694 292.093L500.27 416.248A63.997 63.997 0 0 1 444.989 448H45.025c-18.523 0-30.064-20.093-20.731-36.093l72.424-124.155A64 64 0 0 1 152 256h399.964c18.523 0 30.064 20.093 20.73 36.093zM152 224h328v-48c0-26.51-21.49-48-48-48H272l-64-64H48C21.49 64 0 85.49 0 112v278.046l69.077-118.418C86.214 242.25 117.989 224 152 224z"></path></svg><!-- <i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> --> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#cheatsheet" class="page__taxonomy-item" rel="tag">Cheatsheet</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#dfir" class="page__taxonomy-item" rel="tag">DFIR</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><svg class="svg-inline--fa fa-calendar-alt fa-w-14 fa-fw" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="calendar-alt" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M0 464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V192H0v272zm320-196c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM192 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM64 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM400 64h-48V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H160V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H48C21.5 64 0 85.5 0 112v48h448v-48c0-26.5-21.5-48-48-48z"></path></svg><!-- <i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> --> Updated:</strong> <time datetime="2024-03-23T00:00:00+00:00">March 23, 2024</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=CyberRaiju&amp;text=Digital+Forensics+and+Incident+Response%20https%3A%2F%2Fwww.jaiminton.com%2Fcheatsheet%2FDFIR%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><svg class="svg-inline--fa fa-twitter fa-w-16 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg><!-- <i class="fab fa-fw fa-twitter" aria-hidden="true"></i> --><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.jaiminton.com%2Fcheatsheet%2FDFIR%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><svg class="svg-inline--fa fa-facebook fa-w-14 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M448 56.7v398.5c0 13.7-11.1 24.7-24.7 24.7H309.1V306.5h58.2l8.7-67.6h-67v-43.2c0-19.6 5.4-32.9 33.5-32.9h35.8v-60.5c-6.2-.8-27.4-2.7-52.2-2.7-51.6 0-87 31.5-87 89.4v49.9h-58.4v67.6h58.4V480H24.7C11.1 480 0 468.9 0 455.3V56.7C0 43.1 11.1 32 24.7 32h398.5c13.7 0 24.8 11.1 24.8 24.7z"></path></svg><!-- <i class="fab fa-fw fa-facebook" aria-hidden="true"></i> --><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.jaiminton.com%2Fcheatsheet%2FDFIR%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><svg class="svg-inline--fa fa-linkedin fa-w-14 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg><!-- <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> --><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/reverse-engineering/dark-tortilla" class="pagination--pager" title="Dark Tortilla Crypter - Malware Analysis Lab
">Previous</a>
    
    
      <a href="/reverse-engineering/havoc-demon-hunting" class="pagination--pager" title="Havoc Demon Hunting - Malware Analysis Lab
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope="" itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/LummaC2.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/reverse-engineering/lummac2" rel="permalink">LummaC2 - Malware Analysis Lab
</a>
      
    </h2>
    
      <p class="page__meta"><svg class="svg-inline--fa fa-clock fa-w-16" aria-hidden="true" focusable="false" data-prefix="far" data-icon="clock" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"></path></svg><!-- <i class="far fa-clock" aria-hidden="true"></i> --> 




  30 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Analysis of a RAR file which leads to the discovery of malicious Github repositories designed to distribute malware.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope="" itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/formbookdownloader.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/reverse-engineering/formbook-downloader" rel="permalink">FormBook Downloader - Malware Analysis Lab
</a>
      
    </h2>
    
      <p class="page__meta"><svg class="svg-inline--fa fa-clock fa-w-16" aria-hidden="true" focusable="false" data-prefix="far" data-icon="clock" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"></path></svg><!-- <i class="far fa-clock" aria-hidden="true"></i> --> 




  18 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Analysis of a LNK which acts as a FormBook download cradle hosted on a compromised WordPress website.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope="" itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/amos-stealer.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/reverse-engineering/atomic-macos-stealer-amos" rel="permalink">Atomic MacOS Stealer (AMOS) - Malware Analysis Lab
</a>
      
    </h2>
    
      <p class="page__meta"><svg class="svg-inline--fa fa-clock fa-w-16" aria-hidden="true" focusable="false" data-prefix="far" data-icon="clock" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"></path></svg><!-- <i class="far fa-clock" aria-hidden="true"></i> --> 




  23 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Analysis of Atomic MacOS Stealer (AMOS) distributed through fake Homebrew domains
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope="" itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/wasabiwallet.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/reverse-engineering/wasabi-cryptoshuffler-turs" rel="permalink">Cryptoshuffler/TURS Agent - Malware Analysis Lab
</a>
      
    </h2>
    
      <p class="page__meta"><svg class="svg-inline--fa fa-clock fa-w-16" aria-hidden="true" focusable="false" data-prefix="far" data-icon="clock" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"></path></svg><!-- <i class="far fa-clock" aria-hidden="true"></i> --> 




  19 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Analysis of a backoored Wasabi Wallet installer and how it deploys TURS Agent onto a system
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><input type="text" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term...">
    <div id="results" class="results"></div></div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://app.hackthebox.com/profile/10636" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-box fa-w-16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="box" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M509.5 184.6L458.9 32.8C452.4 13.2 434.1 0 413.4 0H272v192h238.7c-.4-2.5-.4-5-1.2-7.4zM240 0H98.6c-20.7 0-39 13.2-45.5 32.8L2.5 184.6c-.8 2.4-.8 4.9-1.2 7.4H240V0zM0 224v240c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48V224H0z"></path></svg><!-- <i class="fas fa-box" aria-hidden="true"></i> --> Hack The Box</a></li>
        
      
        
          <li><a href="https://twitter.com/CyberRaiju" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-twitter-square fa-w-14 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter-square" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-48.9 158.8c.2 2.8.2 5.7.2 8.5 0 86.7-66 186.6-186.6 186.6-37.2 0-71.7-10.8-100.7-29.4 5.3.6 10.4.8 15.8.8 30.7 0 58.9-10.4 81.4-28-28.8-.6-53-19.5-61.3-45.5 10.1 1.5 19.2 1.5 29.6-1.2-30-6.1-52.5-32.5-52.5-64.4v-.8c8.7 4.9 18.9 7.9 29.6 8.3a65.447 65.447 0 0 1-29.2-54.6c0-12.2 3.2-23.4 8.9-33.1 32.3 39.8 80.8 65.8 135.2 68.6-9.3-44.5 24-80.6 64-80.6 18.9 0 35.9 7.9 47.9 20.7 14.8-2.8 29-8.3 41.6-15.8-4.9 15.2-15.2 28-28.8 36.1 13.2-1.4 26-5.1 37.8-10.2-8.9 13.1-20.1 24.7-32.9 34z"></path></svg><!-- <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> --> Twitter</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/JaiMinton" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-linkedin fa-w-14" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg><!-- <i class="fab fa-linkedin" aria-hidden="true"></i> --> LinkedIN</a></li>
        
      
        
          <li><a href="https://github.com/JPMinty" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-github fa-w-16 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg=""><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><!-- <i class="fab fa-fw fa-github" aria-hidden="true"></i> --> GitHub</a></li>
        
      
        
          <li><a href="https://www.youtube.com/@cyberraiju/featured" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-youtube fa-w-18 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="youtube" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" data-fa-i2svg=""><path fill="currentColor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg><!-- <i class="fab fa-fw fa-youtube" aria-hidden="true"></i> --> YouTube</a></li>
        
      
        
          <li><a href="https://infosec.exchange/@CyberRaiju" rel="nofollow noopener noreferrer"><svg class="svg-inline--fa fa-mastodon fa-w-14" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="mastodon" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 417 512" data-fa-i2svg=""><path fill="currentColor" d="M417.8 179.1c0-97.2-63.7-125.7-63.7-125.7-62.5-28.7-228.5-28.4-290.4 0 0 0-63.7 28.5-63.7 125.7 0 115.7-6.6 259.4 105.6 289.1 40.5 10.7 75.3 13 103.3 11.4 50.8-2.8 79.3-18.1 79.3-18.1l-1.7-36.9s-36.3 11.4-77.1 10.1c-40.4-1.4-83-4.4-89.6-54-.6-4.4-.9-9-.9-13.9 85.6 20.9 158.6 9.1 178.7 6.7 56.1-6.7 105-41.3 111.2-72.9 9.8-49.8 9-121.5 9-121.5zm-75.1 125.2h-46.6V190.1c0-49.7-64-51.6-64 6.9v62.5h-46.3V197c0-58.5-64-56.6-64-6.9v114.2H75.1c0-122.1-5.2-147.9 18.4-175 25.9-28.9 79.8-30.8 103.8 6.1l11.6 19.5 11.6-19.5c24.1-37.1 78.1-34.8 103.8-6.1 23.7 27.3 18.4 53 18.4 175z"></path></svg><!-- <i class="fab fa-mastodon" aria-hidden="true"></i> --> Mastodon</a></li>
        
      
        
      
        
      
    
  </ul>  
<div class="page__footer-copyright">© 2024 Jai Minton.</div>

      </div></footer>
    </div>
    <div>
    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements="" defer="" src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>



    </div>
  <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'89424b27e8ef27bc',t:'MTcxODQ1MTcxMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><iframe height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: medium; visibility: hidden;"></iframe><script defer="" src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon="{&quot;rayId&quot;:&quot;89424b27e8ef27bc&quot;,&quot;r&quot;:1,&quot;version&quot;:&quot;2024.4.1&quot;,&quot;token&quot;:&quot;96762cd668614a10963969fc4e520d9b&quot;}" crossorigin="anonymous"></script>


</body></html>