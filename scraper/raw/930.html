<html lang="en" class="no-js"><head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script><script type="text/javascript" async="" src="https://www.googletagmanager.com/gtag/js?id=G-8ZWH0MMPDF&amp;l=dataLayer&amp;cx=c"></script><script type="text/javascript">var BOOTSTRAP_VERSION ="lumen";
	var BOOTSTRAP_JS_HEAD =1;
	var BOOTSTRAP_CDN_ENABLE =0; var BOOTSTRAP_NAVBAR_TYPE =0; var BOOTSTRAP_LOGO_OPTION =0; var BOOTSTRAP_NAVBAR =1; var BootstrapInputFix =true;var BootstrapNavbarLineHeightFix =true;var BOOTSTRAP_EDT= 0; </script>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Virus Bulletin :: VB2019 paper: Rich Headers: leveraging this mysterious artifact of the PE format</title>
<meta name="description" content="Ever since the release of Visual Studio 97 SP3, Microsoft has placed an undocumented chunk of data between the DOS and PE headers of every native Portable Executable (PE) binary produced by its linker without any possibility to opt out. The data contains information about the build environment and the scale of the project, stored in a simple yet effective way using blocks of the following values: a product identifier, its build number, and the number of times it was used during the build process. Several research papers on this topic have been released over the years, but we feel that it has never been used to its full potential by the security industry.">
<meta name="generator" content="concrete5 - 5.6.3.5">
<script type="text/javascript">
var CCM_DISPATCHER_FILENAME = '/index.php';
var CCM_CID = 6690;
var CCM_EDIT_MODE = false;
var CCM_ARRANGE_MODE = false;
var CCM_IMAGE_PATH = "/concrete/images";
var CCM_TOOLS_PATH = "/index.php/tools/required";
var CCM_BASE_URL = "https://www.virusbulletin.com";
var CCM_REL = "";

</script>
<link rel="shortcut icon" href="/files/8914/5459/9485/VBIcon.png" type="image/x-icon">
<link rel="icon" href="/files/8914/5459/9485/VBIcon.png" type="image/x-icon">
<link rel="stylesheet" type="text/css" href="/concrete/css/ccm.base.css">
<script type="text/javascript" src="/concrete/js/jquery.js"></script>
<script type="text/javascript" src="/concrete/js/ccm.base.js"></script>
<script type="text/javascript">
var COOKIES_ALLOWED=false;
</script>
<link rel="stylesheet" type="text/css" href="/packages/free_cookies_disclosure/css/cookies_disclosure.css">
<!--[if lte IE 8]><link rel="stylesheet" type="text/css" href="/packages/free_cookies_disclosure/css/cookies_disclosure_ie.css" /><![endif]-->
<script type="text/javascript">
var COOKIES_DISCLOSURE_HIDE_INTERVAL=10;
</script>
<script type="text/javascript" src="/packages/free_cookies_disclosure/js/disclosure_hide.js"></script>
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/lumen/bootstrap.css">
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/lumen/bootstrap-overwrites.css">
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/members.css">
<script type="text/javascript" src="/packages/bootstrap/js/common/prettify.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css" href="/libraries/css/jquery.fancybox.css">
<script type="text/javascript" src="/libraries/js/jquery.fancybox.pack.js"></script>
<link rel="stylesheet" media="screen" type="text/css" href="/files/cache/css/bootstrap/typography.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js" integrity="sha512-ZwR1/gSZM3ai6vCdI+LVF1zSq/5HznD3ZSTk7kajkaj4D292NLuduDCO1c/NT8Id+jE58KYLKT7hXnbtryGmMg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script type="text/javascript" src="/index.php/tools/packages/free_cookies_disclosure/disclosure_i18n_js"></script>
<script type="text/javascript" src="/packages/free_cookies_disclosure/js/disclosure_ajax_form.js"></script>
<link rel="stylesheet" type="text/css" href="/concrete/blocks/page_list/view.css">
<link rel="stylesheet" type="text/css" href="/blocks/expand_collapse_toc/templates/vbexpand/view.css">
<script type="text/javascript" src="/blocks/expand_collapse_toc/js/jquery.color.js"></script>
<script type="text/javascript" src="/blocks/expand_collapse_toc/js/jquery.ba-hashchange.js"></script>
<script type="text/javascript" src="/blocks/expand_collapse_toc/js/expand.js"></script>
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/blocks/search/templates/VB_global_search/view.css">
<link rel="stylesheet" type="text/css" href="/packages/travisn_spacer/css/ccm.tnspacer.css">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<link rel="stylesheet" type="text/css" href="https://google-code-prettify.googlecode.com/svn/loader/prettify.css">
<!--[if gte IE 9]>
<script src="/packages/bootstrap/js/common/modernizr.js"></script>
<![endif]-->

<!--[if lt IE 9]>	
	
	<script src="/packages/bootstrap/js/common/html5shiv.js"></script>
	<script src="/packages/bootstrap/js/common/respond.min.js"></script>
	
<![endif]-->
<style type="text/css">.fancybox-margin{margin-right:0px;}</style></head>
<body data-spy="scroll" data-target=".bs-sidebar">

<div class="navbar  navbar-fixed-top navbar-default  bs-docs-nav">
<div class="navbar-inner">
<div class="container"><div class="row"><div class="col-sm-4 col-md-4 logo-position-1 col-logo">
<div class="navbar-header">
<button type="button" class="navbar-toggle btn_navbar_custom btn btn-default">
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button><div class="mobile-clearfix"></div><div class="navbar-brand navbar-brand-area"><a href="/"><img border="0" class="ccm-image-block" alt="" src="/files/4614/4535/7515/logo-big.png" width="339" height="92"></a></div> </div>
</div><div class="col-sm-8 col-md-8 logo-position-1 col-nav"> <div class="nav-collapse collapse nav_collapse_custom navbar-collapse"> <div style="clear:both"></div>
<div class="vb-global-search-div">
<form action="/index.php/global-search-results/" method="get">
<fieldset>
<input name="search_paths[]" type="hidden" value="">
<input name="query" type="text" class="vb-global-search form-control" placeholder="Search site...">
<input name="submit" type="submit" value="Search!" style="display:none" class="btn btn-default">
</fieldset>
</form>
</div>
<div class="tnSpacer" style="height:48px"></div>
<ul class="nav nav-pills"><li class=" nav-first nav-item-6299"><a href="/newsletter/" target="_self" class=" nav-first nav-item-6299 ">Newsletter</a></li><li class=" nav-item-260"><a href="/conference/" target="_self" class=" nav-item-260 ">VB Conference</a></li><li class=" nav-item-166"><a href="/testing/" target="_self" class=" nav-item-166 ">VB Testing</a></li><li class=" nav-path-selected active nav-item-160"><a href="/virusbulletin/" target="_self" class=" nav-path-selected active nav-item-160 ">Bulletin</a></li><li class=" nav-last nav-item-130"><a href="/blog/" target="_self" class=" nav-last nav-item-130 ">Blog</a></li></ul> </div>
</div>
</div><div class="clearfix"></div>
</div>
</div>
</div>
<div class="navbar-top-fixed-space " style="margin-top: 130px;"><div class="clearfix"></div></div>

<div class="container m-top-20">
<div class="row">
<div class="col-md-9 col-sm-9 col-lg-9">
<h1><a class="chapter" name="h1-vb2019-paper-rich-headers-leveraging-mysterious-artifact-pe-format"></a>VB2019 paper: Rich Headers: leveraging this mysterious artifact of the PE format</h1>
<h3><a class="chapter" name="h3-michal-poslusny-amp-peter-kalnai"></a>Michal Poslušný &amp; Peter Kálnai</h3>
<p><em>ESET, Czech Republic</em></p>
<hr>
<p>&nbsp;</p>
<div class="ccm-expand-collapse-toc">
<div id="ccm-expand-collapse-toc-title-15180" class="ccm-expand-collapse-toc-title ccm-expand-collapse-toc-closed" data-expander-speed="500">Table of contents</div><div id="ccm-expand-collapse-toc-content-15180" class="ccm-expand-collapse-toc-content" style="height: 865px; display: none;"><p><a class="toc-level2" href="#h2-abstract">Abstract</a><br> <a class="toc-level2" href="#h2-introduction">Introduction</a><br> <a class="toc-level3" href="#h3-structure">The structure</a><br> <a class="toc-level3" href="#h3-xor-key-checksum">XOR key (checksum)</a><br> <a class="toc-level3" href="#h3-behaviour">Behaviour</a><br> <a class="toc-level3" href="#h3-statistics">Statistics</a><br> <a class="toc-level2" href="#h2-use-cases">Use cases</a><br> <a class="toc-level3" href="#h3-levels-similarity">Levels of similarity</a><br> <a class="toc-level4" href="#h4-identical-rich-headers">Identical Rich Headers</a><br> <a class="toc-level4" href="#h4-identical-xor-keys">Identical XOR keys</a><br> <a class="toc-level4" href="#h4-identical-prodids-builds-unsorted">Identical ProdIDs + builds (unsorted)</a><br> <a class="toc-level4" href="#h4-identical-prodids-builds-sorted">Identical ProdIDs + builds (sorted)</a><br> <a class="toc-level4" href="#h4-specific-values-queryconjunction-various-prodids">Specific values query/conjunction of various ProdIDs</a><br> <a class="toc-level3" href="#h3-anomalies">Anomalies</a><br> <a class="toc-level4" href="#h4-invalid-rich-header-values">Invalid Rich Header values</a><br> <a class="toc-level4" href="#h4-duplicate-rich-header-values">Duplicate Rich Header values</a><br> <a class="toc-level4" href="#h4-invalid-xor-key-checksum">Invalid XOR key checksum</a><br> <a class="toc-level4" href="#h4-rich-header-offset">Rich Header offset</a><br> <a class="toc-level4" href="#h4-pe-optional-header-linker-information-mismatch">PE Optional Header linker information mismatch</a><br> <a class="toc-level4" href="#h4-imports">Imports</a><br> <a class="toc-level4" href="#h4-resources">Resources</a><br> <a class="toc-level3" href="#h3-apt-malware">APT malware</a><br> <a class="toc-level4" href="#h4-win32industroyer-amp-win32exaramel">Win32/Industroyer &amp; Win32/Exaramel</a><br> <a class="toc-level4" href="#h4-win3264nukesped">Win{32,64}/NukeSped</a><br> <a class="toc-level3" href="#h3-crimeware">Crimeware</a><br> <a class="toc-level4" href="#h4-win32kasidet">Win32/Kasidet</a><br> <a class="toc-level4" href="#h4-win3264dridex">Win{32,64}/Dridex</a><br> <a class="toc-level5" href="#h5-win3264dridex-v1-v2-amp-v3-20142015">Win{32,64}/Dridex v1, v2 &amp; v3 (2014 – 2015)</a><br> <a class="toc-level5" href="#h5-win3264dridex-v3-2016">Win{32,64}/Dridex v3 (2016)</a><br> <a class="toc-level5" href="#h5-win3264dridex-v4-20172018">Win{32,64}/Dridex v4 (2017 – 2018)</a><br> <a class="toc-level5" href="#h5-win3264dridex-v5v2-20182019">Win{32,64}/Dridex v5(v2) (2018 – 2019)</a><br> <a class="toc-level4" href="#h4-win3264sathurbot">Win{32,64}/Sathurbot</a><br> <a class="toc-level4" href="#h4-malware-packers">Malware packers</a><br> <a class="toc-level3" href="#h3-rich-headers-amp-yara">Rich Headers &amp; YARA</a><br> <a class="toc-level2" href="#h2-conclusion">Conclusion</a><br> <a class="toc-level2" href="#h2-references">References</a></p><p>&nbsp;</p></div></div>
<h2><a class="chapter" name="h2-abstract"></a>Abstract</h2>
<p>Ever since the release of <em>Visual Studio 97 SP3</em>, <em>Microsoft</em> has placed an undocumented chunk of data between the DOS and PE headers of every native Portable Executable (PE) binary produced by its linker without any possibility to opt out. The data contains information about the build environment and the scale of the project, stored in a simple yet effective way using blocks of the following values: a product identifier, its build number, and the number of times it was used during the build process. Several research papers on this topic have been released over the years, coming up with the name ‘Rich Header’ and shedding some light on its purpose and structure, but we feel that it has never been used to its full potential by the security industry.</p>
<p>When an analyst encounters a rare custom malware sample involved in, say, an APT, and is clutching at straws to draw conclusions about the case, this mysterious structure could provide some reasonable clues. Not only does it reveal the type of components involved in the project behind the malware and the build tools used, but, forming an abounding set of variations, it also helps with locating similar samples. We introduce a hierarchy of similarity levels, together with real-world examples where they have successfully been applied.</p>
<p>For various crimeware kits, which are (re)distributed on a daily basis, the header could indicate whether their source code is available more widely or under the control of a single actor. Moreover, the headers from their encapsulating malware packers often manifest their own anomalies and could cluster a larger set of samples of the same nature. These inconsistencies could easily be identified and turned into heuristics based on the situation, such as: an unusual offset or the size of the header, an invalid identifier or its combination with the build version, the image size not corresponding to the magnitude of the project, etc.</p>
<p>We will also showcase our in-house designed database infrastructure and the tooling we’ve built around it: similarity lookup, a rule-based notification system for malware hunting and the detection of anomalies. The database currently holds the Rich Header information for tens of millions of executables and continuously processes a live feed of new, incoming files. It is currently growing by ~180,000 unique records per day.</p>
<p>&nbsp;</p>
<h2><a class="chapter" name="h2-introduction"></a>Introduction</h2>
<p>PE ‘Rich Headers’ were introduced with the release of <em>Visual Studio 97 SP3</em>. <em>Microsoft</em> didn’t announce that it had implemented such a feature or give a reason for its introduction, and never released any kind of documentation for it, so we cannot really be sure about its original purpose, but it seems that Microsoft simply wanted to have some sort of development environment fingerprint stored in the executables, or perhaps to help with diagnostics and debugging. Regardless of the original intent, the Rich Header has proved to be a very valuable block of data for malware researchers, where a few hundred bytes, when interpreted correctly, can be used as a very strong factor for attribution and detection.</p>
<p><img src="/files/cache/c6c288fa23753ccf4035e528a08907eb_f4322.jpg" alt="01-rich-headers.jpg" width="840" height="310"><span class="centered-caption">Figure 1: PE binary with Rich Headers highlighted.</span></p>
<p>&nbsp;</p>
<h3><a class="chapter" name="h3-structure"></a>The structure</h3>
<p>The meaning of the ‘header’ is actually quite straightforward. In Figure 2 we can see the structure of the header, as described by <em>Microsoft</em> in the W<em>indows 2000</em> source code leak [<a href="#ref1">1</a>]. The data is inserted after the <span class="monospace">IMAGE_DOS_HEADER</span> and its stub and before the beginning of the PE header (<span class="monospace">IMAGE_NT_HEADERS</span> structure).</p>
<p>Its end is marked by the <span class="monospace">Rich</span> keyword (0x68636952) followed by an XOR key DWORD, which was used to encrypt the rest of the header. The beginning of the plaintext header is marked by the <span class="monospace">DanS</span> keyword (0x536E6144), followed by padding of three null DWORDs.</p>
<p><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/8215/7562/4378/02_rich_Win2K_src_marked.png" alt="02_rich_Win2K_src_marked.png" width="636" height="597"><span class="centered-caption">Figure 2: Rich Headers definition in Microsoft Windows 2000 source code leak.</span></p>
<p>As we can see in Figure 2, the data is an array of simple 64-bit <span class="monospace">PRODITEM</span> structures that consist of two 32-bit fields: <span class="monospace">dwProdid</span> and <span class="monospace">dwCount</span>. The <span class="monospace">dwProdid</span> field is a combination of a product identifier (<span class="monospace">ProdID</span>) and its corresponding <span class="monospace">Build</span> number and can be considered as two separate 16-bit values.</p>
<p><span class="monospace">ProdID</span> represents a product from the <em>Visual Studio</em> development toolchain – these include objects like linkers, C/C++ compilers, MASM, resources, imports, implibs, etc. One is assigned to every object file upon creation and eventually all <span class="monospace">ProdID</span>s from every object file used in a project are collected and written into the resulting binary, by the linker, during the linking process.</p>
<p>Since <span class="monospace">ProdID</span>s are an enumeration of numerical values, it is quite hard to identify their meaning on their own. Luckily, we can find the values and their corresponding names in the Visual Studio installation directory in one of the <span class="monospace">msobj.lib</span> binaries. For example, Figure 3 shows the <span class="monospace">msobj140-msvcrt.lib</span> file, which can be found in <em>Visual Studio 2015 – 2019</em>, and which contains a list of all <span class="monospace">ProdID</span> values followed by their names.</p>
<p><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/8715/7562/4582/03_msvobj_far_prodIDs.png" alt="03_msvobj_far_prodIDs.png" width="616" height="261"><span class="centered-caption">Figure 3: <span class="monospace">ProdID</span> names as found in the <span class="monospace">msobj.lib</span> binary.</span></p>
<p>The easiest way to find the Rich Header is to look for the <span class="monospace">Rich</span> DWORD between the DOS and PE header (which marks the end of the Rich Header), extract the following XOR key DWORD and go backwards, XORing the data until the decrypted <span class="monospace">DanS</span> DWORD is reached.</p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/03c3af62dab93b40d6e3ed5ce689a3ee_f4325.png" alt="04_table.png" width="640" height="586"><span class="centered-caption"> Figure 4: The unencrypted Rich Headers structure.</span></p>
<p>&nbsp;</p>
<h3><a class="chapter" name="h3-xor-key-checksum"></a>XOR key (checksum)</h3>
<p>The XOR key used for encryption of the Rich Header is a unique four-byte value generated for every executable built by a <em>Microsoft</em> compiler (linker). The value is a checksum of the DOS header, the DOS stub and plaintext Rich Header data. The checksum calculation algorithm can be found in the <span class="monospace">IMAGE::CbBuildProdidBlock</span> function in <em>Visual Studio</em>’s <span class="monospace">link.exe</span> binary. A code snippet is shown in Figure 5.</p>
<p><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/7915/7562/4756/05_link_exe_checksum_snippet.png" alt="05_link_exe_checksum_snippet.png" width="591" height="287"> <span class="centered-caption">Figure 5: XOR key generation in Microsoft’s Visual Studio 2019 linker executable.</span></p>
<p>Since the checksum algorithm consists of a simple addition and 32-bit rotate left, it can produce collisions. We have identified a few cases where the collision happens for one of two specific reasons.</p>
<p>The first case is when two projects contain identical <span class="monospace">PRODITEM</span> entries, but in a different order. This is not necessarily unwanted behaviour and might even be intended by its designer. Both samples in Table 1 have the XOR key 0xAEB29219 [<a href="#ref2">2</a>].</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td class="monospace">kb.dll (2010-12-6 13:36:13)</td>
<td class="monospace">phpF746.exe (2017-11-19 7:7:58)</td>
</tr>
<tr>
<td class="monospace">prodidMasm614&nbsp;&nbsp; | b8444 | 1<br>prodidLinker512 | b8078 | 9</td>
<td class="monospace">prodidLinker512&nbsp; | b8078 | 9<br>prodidMasm614&nbsp;&nbsp;&nbsp; | b8444 | 1</td>
</tr>
</tbody>
</table>
<p>&nbsp;<span class="centered-caption">Table 1: XOR key collision example – order of <span class="monospace">PRODITEM</span>s.</span></p>
<p>Another common case is due to the 32-bit rotation used in the algorithm (<span class="monospace">ProdID</span> + build is rotated by its count). If two projects have identical <span class="monospace">ProdID</span> and build but different counts whose delta is a multiple of 32, the resulting checksum will be identical. Table 2 is another example of two samples that also have the XOR key 0xAEB29219.</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td class="monospace">moar.exe (2017-5-9 10:24:58)</td>
<td class="monospace">phpF746.exe (2017-11-19 7:7:58)</td>
</tr>
<tr>
<td class="monospace">prodidLinker512 | b8078 | <span style="color: #ff0000;">41</span><br>prodidMasm614&nbsp;&nbsp; | b8444 | 1</td>
<td class="monospace">prodidLinker512 | b8078 | <span style="color: #ff0000;">9</span><br>prodidMasm614&nbsp;&nbsp; | b8444 | 1</td>
</tr>
</tbody>
</table>
<p>&nbsp;<span class="centered-caption">Table 2: XOR key collision example – counts delta.</span></p>
<p>&nbsp;</p>
<h3><a class="chapter" name="h3-behaviour"></a>Behaviour</h3>
<p>Rich Headers reflect the nature and scale of the project and simply by looking at the <span class="monospace">ProdID</span> names, we can see the various features used in the project like imports, resources, or whether the project was written in Assembly, C, C++ or (pre .NET) Visual Basic, and approximately how large the project is, based on the product counts.</p>
<p>Rich Headers tend to change over time in an actively developed project – new <span class="monospace">ProdID</span>s may appear and their counts often increase as new source files and other resources are added to the project, and with regular updates to <em>Visual Studio</em> the build numbers can change too. When changing a development environment completely (e.g. upgrading from <em>VS2010</em> to <em>VS2015</em>) <span class="monospace">ProdID</span>s will also change for the equivalent in the new version.</p>
<p>&nbsp;</p>
<h3><a class="chapter" name="h3-statistics"></a>Statistics</h3>
<p>The most important question when talking about how useful Rich Headers may be is ‘How often do they actually appear in executables?’ If Rich Headers appeared only in a small portion of files, they would not be a very useful feature. Luckily, this is not the case: when looking at our large malicious dataset consisting of roughly one million unique malicious Win32 and Win64 native binaries (no .NET), we found that 73.20% of the PEs contain a Rich Header.</p>
<p>Of the 26.80% of files that do not contain a Rich Header, many are produced by other compilers (Turbo C++, MinGW GCC, Clang, etc.), or are developed in a completely different environment such as Delphi or Go. When such files are discarded, the percentage of PEs containing Rich Headers rises to 83.30%. At this point, the absence of a Rich Header is caused by explicit removal by malware authors or custom packers, etc. For our clean dataset of 120,000 samples, the representation goes as high as 94.20% and 98.50% when taking out other compilers.</p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/824799c90414edb3d1bd953f389f7ec2_f4327.png" alt="06_piechart1.png" width="600" height="329"> <span class="centered-caption">Figure 6: Representation of Rich Headers in our malicious dataset.</span></p>
<p>We expect this number to decrease slowly over time, as malware authors become more aware of this feature and will try to obfuscate or remove the header completely. A more rapid shift would happen if <em>Microsoft</em> decided to drop this feature completely in some subsequent version of <em>Visual Studio</em>, but as of the recent release of <em>Visual Studio 2019</em>, Rich Headers are still generated by the linker.</p>
<p>&nbsp;</p>
<h2><a class="chapter" name="h2-use-cases"></a>Use cases</h2>
<h3><a class="chapter" name="h3-levels-similarity"></a>Levels of similarity</h3>
<h4><a class="chapter" name="h4-identical-rich-headers"></a>Identical Rich Headers</h4>
<p>This is the strongest link between two files in terms of Rich Header similarity. Considering how often the Rich Headers may change in an actively developed project, it is not the best method of long-term detection of future samples from a given project (a good analogy is hash-based detection of malicious files). That being said, it can still be very handy in various cases.</p>
<p>The most common case is the simple matching of the Rich Headers of an unknown file to those of some known malware to quickly identify if the file is malicious (rather like looking up a hash on <em>VirusTotal</em>). Rich Headers can remain unchanged for weeks or even months in the development cycle of a specific project, so a complete match with older or even newer versions of the project can still happen if the sample set is good enough.</p>
<p>Another useful case is possible thanks to the fact that commercial protectors like <em>Enigma Protector</em>, <em>Themida</em> and <em>VMProtect</em> preserve the Rich Headers of the original file. This means that when we get our hands on, say, a <em>Themida</em>-protected file, we could potentially look up the original, non-packed payload by searching for identical Rich Headers and vice versa. This is especially valuable considering that most of these protectors change the nature of the file completely and there are no links preserved between the code or data of the original payload. Malware authors sometimes use multiple commercial packers to pack their payloads – we were able to identify the protected samples of a family called Predator Stealer [<a href="#ref3">3</a>] (Win32/Spy.Agent.{PQC,PQK}) and to attribute several custom Lazarus tools in [<a href="#ref4">4</a>] (Win64.NukeSped.{AA,AB}).</p>
<p>A similar strategy can also be applied to less advanced malware packers that also tend either to preserve the original Rich Header of the payload or to supplement the resulting packed file with their own.</p>
<p>Sometimes the Rich Header might intentionally be misplaced – there is a well-known case reported by <em>Kaspersky</em> [<a href="#ref5">5</a>] (and also presented at <em>Virus Bulletin</em> [<a href="#ref6">6</a>]), where a component of Olympic Destroyer contained a copy of the complete Rich Headers from a file previously attributed to the Lazarus toolset. This is widely considered to have been a false flag implemented by the attackers to place the blame on a different actor. On the other hand, it might very well have been an Easter egg, testing the attention of malware researchers. In the past there have also been cases of malware packers that copied the header from a legitimate <span class="monospace">explorer.exe</span>.</p>
<p>For a quick matching, it is best to calculate and store a hash of the Rich Header. In our project we use an indexed CRC64 for a blazingly fast lookup.</p>
<p>&nbsp;</p>
<h4><a class="chapter" name="h4-identical-xor-keys"></a>Identical XOR keys</h4>
<p>Matching XOR keys have very similar use cases to matching Rich Headers. The advantage of using the XOR key instead of a custom hash is in it being more widely used and being supported by widespread community tools like YARA, and integrated into <em>VirusTotal</em> hunting rules. The disadvantages lie in the fact that the value might artificially/explicitly be changed and in the potential key collisions that we explained in the previous section.</p>
<p>Knowing that the XOR keys are basically a checksum of the DOS header, DOS stub and Rich Header, we can quickly establish that, as a malware project evolves, the key value may change fairly often (with even a single incremental change in the Rich Header count), so it is not a very useful feature when trying to track a project over a longer period of time.</p>
<p>On the other hand, as stated above, a malware packer is a specific project and, in many cases, shares an identical Rich Header across many packed samples. We have found several values that covered reasonable clusters, e.g. 0x8F44CEBF, 0xAEB29219, 0x8A17753B, 0xD4F1AE19, 0x887F83A7 (with the CRC64 hash varying within each key!).</p>
<p>There are several XOR keys associated with well-known formats, as listed in Table 3. They can be found in clean as well as malicious datasets and might be useful for a quick identification of the format.</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td class="monospace">Visual Basic 6.0</td>
<td class="monospace">0x886973F3, 0x8869808D, 0x88AA42CF, 0x88AA2A9D, 0x89A99A19, 0x88CECC0B, 0x8897EBCB, 0xAC72CCFA, 0x1AAAA993, 0xD05FECFB, 0x183A2CFD, 0xACCF9994, 0xC757AD0B, 0xA7EEAD02, 0xD1197995, 0x83CDAD4, 0x8917A389, 0x88CEA841, 0x8917DE83, 0x89AA0373, 0x8ACD8739, 0x8D156179, 0x8ACE4D53, 0x8897FE31, 0x91A515F9, 0xD1983193, 0x8D16E113, 0x9AC47EF9, 0x91A80893, 0xAD0350F9, 0xD180F4F9, 0xAD0EF593, 0x9ACA5793, 0x9ACA5793</td>
</tr>
<tr>
<td class="monospace">NSIS</td>
<td class="monospace">0xD28650E9, 0x38BF1A05, 0x6A2AD175, 0xD246D0E9, 0x371742A2, 0xAB930178, 0x69EAD975, 0x69EB1175, 0xFB2414A1, 0xFB240DA1</td>
</tr>
<tr>
<td class="monospace">MASM 6.14 <br>build 8444</td>
<td class="monospace">0x88737619, 0x89A56EF9</td>
</tr>
<tr>
<td class="monospace">WinRar SFX</td>
<td class="monospace">0xC47CACAA, 0xFDAFBB1F, 0xD3254748, 0x557B8C97, 0x8DEFA739, 0x723F06DE, 0x16614BC7</td>
</tr>
<tr>
<td class="monospace">Autoit</td>
<td class="monospace">0xBEAFE369, 0xC1FC1252, 0xCDA605B9, 0xA9CBC717, 0x8FEDAD28, 0x273B0B7D, 0xECFA7F86</td>
</tr>
<tr>
<td class="monospace">Microsoft Cabinet File</td>
<td class="monospace">0x43FACBB6</td>
</tr>
<tr>
<td class="monospace">NTkernelPacker</td>
<td class="monospace">0x377824C3</td>
</tr>
<tr>
<td class="monospace">Thinstall</td>
<td class="monospace">0x8B6DF331</td>
</tr>
<tr>
<td class="monospace">MoleBox Ultra v4</td>
<td class="monospace">0x8CABE24D</td>
</tr>
</tbody>
</table>
<p class="centered-caption">Table 3: Various XOR keys associated with known formats.</p>
<p>&nbsp;</p>
<h4><a class="chapter" name="h4-identical-prodids-builds-unsorted"></a>Identical ProdIDs + builds (unsorted)</h4>
<p>Disregarding the counts and matching only the files with identical <span class="monospace">ProdID</span>s and build numbers also turned out to be a very effective way of looking up similar files. The bigger the project, the more effective this method is, and it should be considered for samples with at least five Rich Header records.</p>
<p>In the case of the KillDisk-ed casino in Central America [<a href="#ref7">7</a>] we found a 64-bit executable with the internal name <span class="monospace">res.dll</span>. Another file was later acquired, with all metadata pointing to the same threat actor. Despite being Themida-protected and statically completely different (except for the agreement of PE timestamps), the set of <span class="monospace">ProdID</span>s together with builds were identical and did not match any clean files – see Table 4 (both detected as Win64/NukeSped.Z). This inspired us to index the sequence of pairs (<span class="monospace">ProdID</span>, build) as they are located in the header, omitting the counts. The CRC64 checksum of unsorted sequences of these pairs reliably identified several clusters of related malicious projects: not only when the single count of <span class="monospace">prodidImports0</span> varied (Win64/CoinMiner.DN, 0x105E60A5B349F444), but also when multiple counts did (Win32/Pterodo, 0x745E73E5045EE80E or Win32/Kryptik.GTXI, 0x613D0D87DAF1658F).</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td class=" monospace">rds.dll (2016-10-24 8:32:11)</td>
<td class=" monospace">res.dll (2016-10-24 8:32:11)</td>
</tr>
<tr>
<td class=" monospace">prodidUtc1600_LTCG_CPP| b40219 | 9 <br>prodidUtc1600_CPP&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | 27 <br>prodidUtc1600_C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | <span style="color: #ff0000;">100</span><br>prodidMasm1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | <span style="color: #ff0000;">15</span> <br>prodidLinker1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | 1 <br>prodidExport1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | 1 <br>prodidImplib900&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b30729 | 9 <br>prodidImport0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b0&nbsp;&nbsp;&nbsp;&nbsp; | <span style="color: #ff0000;">130</span></td>
<td class=" monospace">prodidUtc1600_LTCG_CPP| b40219 | 9 <br>prodidUtc1600_CPP&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | 27 <br>prodidUtc1600_C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | <span style="color: #ff0000;">94</span><br>prodidMasm1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | <span style="color: #ff0000;">9</span> <br>prodidLinker1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | 1 <br>prodidExport1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | 1 <br>prodidImplib900&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b30729 |&nbsp;9 <br>prodidImport0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b0&nbsp;&nbsp;&nbsp;&nbsp; | <span style="color: #ff0000;">131</span></td>
</tr>
</tbody>
</table>
<p>&nbsp;<span class="centered-caption">Table 4: Similar metadata from two Themida-protected 64-bit Lazarus backdoors.</span></p>
<p>&nbsp;</p>
<h4><a class="chapter" name="h4-identical-prodids-builds-sorted"></a>Identical ProdIDs + builds (sorted)</h4>
<p>The situation gets more complicated when searching for files from the same project that have different architectures. Rich Headers tend to be almost identical between 32-bit and 64-bit equivalents of an application, but sometimes the <span class="monospace">ProdID</span>s are in a slightly different order. This led us to a new similarity level, namely the CRC64 checksum of the sequence of <span class="monospace">ProdID</span>s and their builds sorted by the <span class="monospace">ProdID</span> values to compare the Rich Header regardless of the order. Again, the counts were omitted.</p>
<p>This turned out to be useful in many cases, for example when we encountered several almost identical samples of Win/GreyEnergy [<a href="#ref8">8</a>], each for a different architecture, having the same <span class="monospace">ProdID</span>s, but in a slightly different order.</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td class=" monospace">zlib_x86.dll, zlibwapi_x86.dll</td>
<td class=" monospace">zlib_x64.dll, zlibwapi_x64.dll</td>
</tr>
<tr>
<td class="monospace">
<p>prodidAliasObj1000&nbsp;&nbsp;&nbsp; | b20115 | 5</p>
<p>prodidUtc1600_CPP&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | 25</p>
<p>prodidMasm1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | <span style="color: #ff0000;">17</span></p>
<p>prodidUtc1600_C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | <span style="color: #ff0000;">110</span></p>
<p>prodidImplib900&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b30729 | 3</p>
<p>prodidImport0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b0&nbsp;&nbsp;&nbsp;&nbsp; |<span style="color: #ff0000;">[87-88]</span></p>
<p>prodidUtc1600_LTCG_CPP| b40219 | <span style="color: #ff0000;">22</span></p>
<p>prodidExport1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b40219 |&nbsp; 1</p>
<p>prodidLinker1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b40219 |&nbsp; 1</p>
</td>
<td class="monospace">
<p>prodidAliasObj1000&nbsp;&nbsp;&nbsp;&nbsp; | b20115 | 5 <br>prodidUtc1600_CPP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | 25 <br>prodidUtc1600_C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | <span style="color: #ff0000;">107</span></p>
<p>prodidMasm1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | <span style="color: #ff0000;">9</span></p>
<p>ProdidImplib900&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b30729 | 3 <br>prodidImport0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b0&nbsp;&nbsp;&nbsp;&nbsp; | <span style="color: #ff0000;">[88-89]</span></p>
<p>prodidUtc1600_LTCG_CPP | b40219 | <span style="color: #ff0000;">[22-23]</span></p>
<p>prodidExport1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | 1</p>
<p>prodidLinker1000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | b40219 | 1</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp; <span class="centered-caption">Table 5: Similar metadata from Win32/GreyEnergy payloads for both platforms.</span></p>
<p>&nbsp;</p>
<h4><a class="chapter" name="h4-specific-values-queryconjunction-various-prodids"></a>Specific values query/conjunction of various ProdIDs</h4>
<p>While matching identical Rich Headers is nice and can be useful in many cases, for a more robust lookup we need some variability. This can be achieved by searching for combinations of specific <span class="monospace">ProdID</span>s combined with builds and a range of counts based on a value from the underlying sample. If such a query is constructed in a smart way, it can easily yield many older and/or newer samples from the same project with slightly different Rich Headers as development progressed. For example, given a file that contains <span class="monospace">prodidUtc1600_CPP</span> build 40219 with a count of 48, we might search for all files with <span class="monospace">prodidUtc1600_CPP</span> build 40219 and a count between 42 and 54. So far we have not found a generic approach for how best to construct these queries and instead use our ‘instincts’ that we have acquired over time while working with Rich Headers.</p>
<p>For example, there were cases of a two-stage threat when the dropper and the payload were projects of very similar size, e.g. Win32/Exaramel [<a href="#ref9">9</a>]. Both files were 32-bit, so the order of <span class="monospace">ProdID</span>s was identical and counts very similar, with the exception of one additional <span class="monospace">ProdID</span> in the payload, as seen in Table 6.</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td class=" monospace">xml.exe (2018-4-13 08:36:04)</td>
<td class=" monospace">wsmprovav.exe (2018-4-13 08:35:52)</td>
</tr>
<tr>
<td class=" monospace">prodidUtc1900_CPP | b24215 | <span style="color: #ff0000;">3</span><br>prodidUtc1900_CPP | b24123 | <span style="color: #ff0000;">33</span> <br>prodidUtc1900_C&nbsp;&nbsp; | b24215 | <span style="color: #ff0000;">7</span> <br>prodidUtc1900_C&nbsp;&nbsp; | b24123 | 17 <br>prodidMasm1400 &nbsp;&nbsp; | b24123 | <span style="color: #ff0000;">18</span> <br>prodidLinker1400&nbsp; | b24215 | 1 <br>prodidCvtres1400&nbsp; | b24210 | 1 <br>prodidUtc1810_CPP | b40116 | <span style="color: #ff0000;">121</span><br>prodidUtc1810_C&nbsp;&nbsp; | b40116 | 24 <br>prodidMasm1210 &nbsp;&nbsp; | b40116 | 9 <br>prodidResource &nbsp;&nbsp; | b0&nbsp;&nbsp;&nbsp;&nbsp; | 1 <br>prodidImplib900&nbsp;&nbsp; | b30729 | <span style="color: #ff0000;">9</span> <br>prodidImport0&nbsp;&nbsp;&nbsp;&nbsp; | b0&nbsp;&nbsp;&nbsp;&nbsp; | 109</td>
<td class=" monospace">prodidUtc1900_CPP | b24215 |&nbsp; <span style="color: #ff0000;">1</span> <br>prodidUtc1900_CPP | b24123 | <span style="color: #ff0000;">29</span> <br>prodidUtc1900_C&nbsp;&nbsp; | b24215 | <span style="color: #ff0000;">11</span> <br>prodidUtc1900_C&nbsp;&nbsp; | b24123 | 17 <br>prodidMasm1400&nbsp;&nbsp;&nbsp; | b24123 | <span style="color: #ff0000;">17</span> <br>prodidLinker1400&nbsp; | b24215 |&nbsp; 1 <br>prodidCvtres1400&nbsp; | b24210 |&nbsp; 1 <br>prodidUtc1810_CPP | b40116 | <span style="color: #ff0000;">120</span> <br>prodidUtc1810_C&nbsp;&nbsp; | b40116 | 24 <br>prodidMasm1210&nbsp;&nbsp;&nbsp; | b40116 |&nbsp; 9 <br>prodidResource&nbsp;&nbsp;&nbsp; | b0&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; 1 <br>prodidImplib900&nbsp;&nbsp; | b30729 | <span style="color: #ff0000;">25</span> <br><span style="color: #ff0000;">prodidUtc1500_C&nbsp;&nbsp; | b30729 | 4 </span><br>prodidImport0&nbsp;&nbsp;&nbsp;&nbsp; | b0&nbsp;&nbsp;&nbsp;&nbsp; |200</td>
</tr>
</tbody>
</table>
<p class="centered-caption">Table 6: Similar metadata for the dropper and the payload of Win32/Exaramel.</p>
<p>One should always try to keep the number of items in the query to a bare minimum to distinguish different projects, but at the same time leave some space for potential changes. Generally, ProdIDs containing ‘_CPP’ or ‘_C’ should be prioritized in the search as they tend to have the biggest count variability and the count distance could be around +/- 10%.</p>
<p>&nbsp;</p>
<h3><a class="chapter" name="h3-anomalies"></a>Anomalies</h3>
<p>Basing detection on Rich Header similarity or adding it as a feature to existing detection systems is a great thing. Another potential use case is heuristic detection based on anomalies and inconsistencies that suggest the file has been tampered with, or that there is something wrong with it, and that should generally be brought to the attention of a researcher. Such an anomaly obviously does not instantly mean a given file is malicious, but it might be useful to flag files worthy of closer examination by an analyst. Anomalies are especially common in relation to various packers and other obfuscation strategies commonly found in malware, as they are usually the result of tampering with the original file.</p>
<p>In the following subsections we look at the most common anomalies we have observed in the wild.</p>
<p>&nbsp;</p>
<h4><a class="chapter" name="h4-invalid-rich-header-values"></a>Invalid Rich Header values</h4>
<p>This is the most obvious anomaly – since the range of valid <span class="monospace">ProdID</span>s is known, we can easily identify files that have non-existent values (at the moment, with the release of <em>Visual Studio 2019</em>, all values larger than 0x010e (<span class="monospace">prodidUtc1900_POGO_O_CPP</span>) can be considered invalid). This could be applied to the build number as well, as each <span class="monospace">ProdID</span> has only a specific range of valid build numbers, although this would require quite a lot of work due to having to gather all possible build numbers for each <span class="monospace">ProdID</span>. Finally, we could also check for suspicious count values, as for valid projects they are generally in the tens or hundreds and very rarely in the thousands, so finding a valid <span class="monospace">ProdID</span> with a count greater than a million could be an indicator too.</p>
<p>&nbsp;</p>
<h4><a class="chapter" name="h4-duplicate-rich-header-values"></a>Duplicate Rich Header values</h4>
<p>Every file with a Rich Header can only have a single, unique combination of <span class="monospace">ProdID</span> and a build number. This is obvious, as the number of those records is represented by the count field instead, so duplicate records are invalid behaviour. Around 1.19% of files in our malicious dataset contain duplicate records. There is not a single one in the clean dataset.</p>
<p>&nbsp;</p>
<h4><a class="chapter" name="h4-invalid-xor-key-checksum"></a>Invalid XOR key checksum</h4>
<p>Since we know how the checksum is calculated, the supplied XOR key can easily be verified. If the value is incorrect, we can assume that there is potentially something wrong. In our malicious dataset 9.06% files have an invalid XOR key value, while in the clean dataset only around 0.95% do.</p>
<p>&nbsp;</p>
<h4><a class="chapter" name="h4-rich-header-offset"></a>Rich Header offset</h4>
<p>The Rich Header offset is the position in the PE at which the header begins. It is based on the size of the DOS stub, as it begins right after that, so its value varies with the DOS stub. Since most files nowadays do not use the DOS part of the PE at all, they have the widely known default ‘<em>This program cannot be run in DOS mode</em>’ stub generated by the compiler, and thanks to that, in most files the Rich Header starts at file offset 0x80. While the mentioned starting position is present in ~99% of cases, there are many, even valid, cases where the offset differs, so it is not a good idea to look for Rich Headers based on this offset (like YARA does [<a href="#ref10">10</a>]). Out of 120,000 real-world clean applications with Rich Headers in our clean dataset, only 0.06% do not match the offset 0x80. The distribution for our malicious dataset can be seen in Figure 7.</p>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="/files/cache/a180a7886620293527e6773b88da969d_f4328.PNG" alt="07_piechart2.PNG" width="760" height="405"><span class="centered-caption"> Figure 7: Distribution of Rich Header offsets in our malicious dataset.</span></p>
<p>There are a few relatively common offsets that can be found even in clean, legitimate projects like some kernel drivers (probably caused by an alignment issue, because even the default stub is aligned to 512 bytes). On the other hand, there are also several offsets that are used by a specific malware family or software project (those we have identified are listed in Table 7), which could be one of the ways to identify new samples or at least used as an indicator.</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td><strong>Offset</strong></td>
<td><strong>Example</strong></td>
<td><strong>Comment</strong></td>
</tr>
<tr>
<td>0x40</td>
<td>Various</td>
<td>The null DOS stub</td>
</tr>
<tr>
<td>0x48</td>
<td>Various</td>
<td>The minimal valid DOS stub</td>
</tr>
<tr>
<td>0x60</td>
<td>Win32/Adware.WintionalityChecker</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>0x68</td>
<td>Win32/TrojanDownloader.Waski</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>0x8C</td>
<td>Win32/Adware.Virtumonde</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>0xE0</td>
<td>Win32/TrojanDropper.Agent.NJV</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>0x100</td>
<td>ESET modules</td>
<td>Clean</td>
</tr>
<tr>
<td>0x200</td>
<td>Various</td>
<td>Some kernel drivers</td>
</tr>
<tr>
<td>0x2A8</td>
<td>PKSFX Self Extract Utility by PKWARE Inc.</td>
<td>Clean</td>
</tr>
<tr>
<td>0x600</td>
<td>Win32/Adware.Trymedia</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<p class="centered-caption">Table 7: Various types of Rich Header offsets.</p>
<p>&nbsp;</p>
<h4><a class="chapter" name="h4-pe-optional-header-linker-information-mismatch"></a>PE Optional Header linker information mismatch</h4>
<p>The version of a linker used for building the file is also stored in the <span class="monospace">MajorLinkerVersion</span> and <span class="monospace">MinorLinkerVersion</span> fields inside the PE Optional Header. Comparing this version to the linker version found in Rich Headers (i.e. <span class="monospace">prodidLinker800</span> should have Optional Header linker version set to 8.0) is also a good way to find inconsistencies, packed files, tampered Rich Headers and so on.</p>
<p>There are a few such anomalies caused by known packers – for example, the Armadillo packer changes the Optional Header linker version to 83.82, but does not alter the Rich Header.</p>
<p>&nbsp;</p>
<h4><a class="chapter" name="h4-imports"></a>Imports</h4>
<p>The <span class="monospace">prodidImport0</span> identifier is related to the number of functions in the PE import directory. The values are not always equal but correlate highly and tend to be very close together. A large difference between the number of imports and the count of <span class="monospace">prodidImport0</span>, or its complete absence in the Rich Header when imports are present, and vice versa, could be a sign of a packed file or a faked Rich Header.</p>
<p>&nbsp;</p>
<h4><a class="chapter" name="h4-resources"></a>Resources</h4>
<p>When an executable contains a resource directory populated with resources, it should always be reflected in the Rich Header by containing <span class="monospace">prodidCvtresXXXX</span>, where XXXX is the version of <em>Visual Studio</em> used. The count should always be 1, regardless of the number of resources the file has. For example, when building a project that has any kind of resource included in <em>Visual Studio 2015</em> (14.0), the resulting binary should always contain <span class="monospace">prodidCvtres1400</span> = 1 (in our malicious dataset, 4.12% of files have a <span class="monospace">prodidCvtresXXXX</span> count other than 1; in our clean dataset this applies to only 0.01% of files).</p>
<p>There are multiple ideas for potential heuristics:</p>
<ol>
<li>Files with <span class="monospace">prodidCvtresXXXX</span> having a count not equal to 1</li>
<li>Files with resources not containing the <span class="monospace">Cvtres</span> identifier and vice versa</li>
<li>The version of <span class="monospace">prodidCvtresXXXX</span> not corresponding with the linker version/other <span class="monospace">ProdID</span>s, i.e. the file having <span class="monospace">prodidCvtres1400</span> and <span class="monospace">prodidLinker1200</span>.</li>
</ol>
<p>&nbsp;</p>
<h3><a class="chapter" name="h3-apt-malware"></a>APT malware</h3>
<p>In this section we provide some examples where Rich Header metadata has provided interesting information and extended our overall knowledge about executables from APT toolsets. This is not the first attempt to look at Rich Headers and their usability in APT research [<a href="#ref11">11</a>].</p>
<p>&nbsp;</p>
<h4><a class="chapter" name="h4-win32industroyer-amp-win32exaramel"></a>Win32/Industroyer &amp; Win32/Exaramel</h4>
<p>The article [<a href="#ref9">9</a>] uncovered strong code similarities between the Win32/Industroyer main backdoor (introduced to the world in [<a href="#ref12">12</a>]) and one of the backdoors (Win32/Exaramel) used by TeleBots, the group behind the massive NotPetya (Win32/Diskcoder.C) ransomware outbreak. Taking an additional look at the Rich Headers metadata, it turns out that there is additional similarity at the project development and build level – see Table 8.</p>
<table class="table table-bordered monospace" border="0">
<tbody>
<tr>
<td class="monospace">prodidMasm1210&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; b40116 =&nbsp;&nbsp; 9<br>prodidUtc1810_CPP&nbsp;&nbsp;&nbsp;&nbsp; b40116 = 120<br>prodidUtc1810_C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; b40116 =&nbsp; 24<br>prodidMasm1400&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; b24123 =&nbsp; 17<br>prodidUtc1900_CPP&nbsp;&nbsp;&nbsp;&nbsp; b24123 =&nbsp; 29<br>prodidUtc1900_C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; b24123 =&nbsp; 17<br>prodidImplib900&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; b30729 = [15-25]<br>prodidImport0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; b0&nbsp;&nbsp;&nbsp;&nbsp; = [140-200]<br>prodidCvtres1400&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; b24210 =&nbsp;&nbsp; 1 <br>prodidLinker1400&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; b24215 =&nbsp;&nbsp; 1</td>
</tr>
</tbody>
</table>
<p class="centered-caption">Table 8: Rule based on the Rich Header values common to Industroyer and Exaramel.</p>
<p>&nbsp;</p>
<h4><a class="chapter" name="h4-win3264nukesped"></a>Win{32,64}/NukeSped</h4>
<p>This is<em> ESET</em>’s detection name for samples from the Lazarus toolset. It is well known that the toolset is large, heterogeneous from various points of view, and all the sources are kept close. In [<a href="#ref4">4</a>] we tried to group executables based on their Rich Header characteristics and the version of the <em>Microsoft</em> linker used. As a result, two main Lazarus tool subgroups were identified, namely the first one using<em> VS 98</em> for 32-bit compilations and <em>VS 2010</em> for 64-bit, and the second one using <em>VS 2010</em> for both. However, several anomalous combinations were discovered too, e.g. one typical malicious project compiled as a 32-bit binary in <em>VS 98</em> and as a 64-bit binary in <em>VS 2013</em>. In Table 9 there are two examples of queries that successfully identified malicious clusters without causing an uncomfortable level of noise.</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td class="monospace">prodidUtc1600_C&nbsp;&nbsp; &nbsp;b40219 = [50-300] <br>prodidImports&nbsp;&nbsp; &nbsp;b0&nbsp;&nbsp; &nbsp;= [227-228] <br>prodidImplib900&nbsp;&nbsp; &nbsp;b30729 = 23 <br>prodidAliasObj1000&nbsp;&nbsp; &nbsp;b20115 = 7</td>
</tr>
<tr>
<td class="monospace">prodidUtc1500_C&nbsp;&nbsp; &nbsp;b30729 &nbsp;&nbsp; &nbsp;= 8 <br>prodidExport1000&nbsp;&nbsp; &nbsp;b40219 &nbsp;&nbsp; &nbsp;= 1 <br>prodidUtc1600_C&nbsp;&nbsp; &nbsp;b40219 &nbsp;&nbsp; &nbsp;= [142-145] <br>prodidUtc1600_CPP&nbsp;&nbsp; &nbsp;b40219 &nbsp;&nbsp; &nbsp;= [61-62]</td>
</tr>
</tbody>
</table>
<p class="centered-caption">Table 9: Win{32,64}/NukeSped detection rule.</p>
<p>Win32/CrisisHT</p>
<p>This is ESET’s detection name for samples from the spyware kit operated and sold by the infamous Italian software company Hacking Team. In [<a href="#ref13">13</a>] many aspects of the threat are considered, e.g. the clustering of the toolset based on the attached code-signing certificates. In Table 10 we illustrate clustering based on the Rich Header values. The ‘SPC’ version looks like a testing concept built by an unrelated team – a consequence of the source code leaks in July 2015.</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td rowspan="2"><strong>Certificate</strong></td>
<td rowspan="2"><strong>PE Timestamp</strong></td>
<td style="text-align: center;" colspan="5"><strong><span class="monospace">prodidUtcXXXX_CPP</span> and build values</strong></td>
<td rowspan="2"><strong>Import0</strong></td>
</tr>
<tr>
<td><strong>1600_CPP <br>b40219</strong></td>
<td><strong>1600_CPP<br>b30319</strong></td>
<td><strong>1700_CPP<br>b50929</strong></td>
<td><strong>1800_CPP<br>b21005</strong></td>
<td><strong>1900_CPP<br>b24123</strong></td>
</tr>
<tr>
<td>Raffaele Carnacina</td>
<td>16.9.2015</td>
<td>&nbsp;</td>
<td>38</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>170</td>
</tr>
<tr>
<td>Raffaele Carnacina</td>
<td>19.10.2015</td>
<td>&nbsp;</td>
<td>64</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>247</td>
</tr>
<tr>
<td>Raffaele Carnacina</td>
<td>19.10.2015</td>
<td>&nbsp;</td>
<td>38</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>169</td>
</tr>
<tr>
<td>Raffaele Carnacina</td>
<td>5.11.2015</td>
<td>38</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>168</td>
</tr>
<tr>
<td>Raffaele Carnacina</td>
<td>17.11.2015</td>
<td>64</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>247</td>
</tr>
<tr>
<td>SPC</td>
<td>5.1.2016</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>49</td>
<td>&nbsp;</td>
<td>163</td>
</tr>
<tr>
<td>Raffaele Carnacina</td>
<td>18.1.2016</td>
<td>38</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>170</td>
</tr>
<tr>
<td>Raffaele Carnacina</td>
<td>24.3.2016</td>
<td>&nbsp;</td>
<td>64</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>247</td>
</tr>
<tr>
<td>Raffaele Carnacina</td>
<td>24.3.2016</td>
<td>&nbsp;</td>
<td>38</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>169</td>
</tr>
<tr>
<td>ADD Audit</td>
<td>17.6.2016</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>70</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>251</td>
</tr>
<tr>
<td>ADD Audit</td>
<td>1.9.2016</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>70</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>250</td>
</tr>
<tr>
<td>ADD Audit</td>
<td>19.12.2016</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>44</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>177</td>
</tr>
<tr>
<td>ADD Audit</td>
<td>28.4.2017</td>
<td>38</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>170</td>
</tr>
<tr>
<td>ADD Audit</td>
<td>28.4.2017</td>
<td>64</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>259</td>
</tr>
<tr>
<td>Ziber Ltd</td>
<td>28.6.2017</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>57</td>
<td>293</td>
</tr>
<tr>
<td>Media Lid</td>
<td>28.6.2017</td>
<td>40</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>184</td>
</tr>
<tr>
<td>Ziber Ltd</td>
<td>9.10.2017</td>
<td>40</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>190</td>
</tr>
<tr>
<td>Ziber Ltd</td>
<td>18.10.2017</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>57</td>
<td>299</td>
</tr>
</tbody>
</table>
<p class="centered-caption">Table 10: CrisisHT samples clustered by C++ compiler version Rich Header data.</p>
<p>&nbsp;</p>
<h3><a class="chapter" name="h3-crimeware"></a>Crimeware</h3>
<h4><a class="chapter" name="h4-win32kasidet"></a>Win32/Kasidet</h4>
<p>Kasidet (a.k.a. Neutrino bot) is a crime kit with many capabilities which is sold on underground forums and is popular for its relatively cheap price. The crime kit is distributed via a special builder containing the compiled stub of Neutrino bot. In Table 11 we showcase the evolution of four <span class="monospace">ProdID</span>s that represent the projects. Each colour band represents a unique stub that was distributed by various cybercriminal groups [<a href="#ref14">14</a>].</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td>&nbsp;</td>
<td><strong>PE Timestamp</strong></td>
<td><strong>prodidUtc1500_C</strong></td>
<td><strong>prodidImplib900</strong></td>
<td><strong>prodidImport0</strong></td>
<td><strong>prodidUtc1600_CPP</strong></td>
</tr>
<tr>
<td>MiningRats 04</td>
<td>25.07.2017</td>
<td>1</td>
<td>25</td>
<td>175</td>
<td>44</td>
</tr>
<tr>
<td>LethicGuys 08</td>
<td>21.10.2017</td>
<td>1</td>
<td>29</td>
<td>179</td>
<td>46</td>
</tr>
<tr>
<td>Redirectors 01</td>
<td>25.10.2017</td>
<td>1</td>
<td>29</td>
<td>179</td>
<td>46</td>
</tr>
<tr>
<td>LethicGuys 09</td>
<td>31.10.2017</td>
<td>1</td>
<td>29</td>
<td>179</td>
<td>47</td>
</tr>
<tr>
<td>LethicGuys 10</td>
<td>07.11.2017</td>
<td>4</td>
<td>31</td>
<td>185</td>
<td>49</td>
</tr>
<tr>
<td>Redirectors 03</td>
<td>07.11.2017</td>
<td>4</td>
<td>31</td>
<td>185</td>
<td>49</td>
</tr>
<tr>
<td>LethicGuys 11</td>
<td>16.11.2017</td>
<td>4</td>
<td>31</td>
<td>185</td>
<td>49</td>
</tr>
<tr>
<td>Redirectors 04</td>
<td>16.11.2017</td>
<td>4</td>
<td>31</td>
<td>185</td>
<td>49</td>
</tr>
<tr>
<td>Redirectors 05</td>
<td>17.11.2017</td>
<td>4</td>
<td>31</td>
<td>185</td>
<td>49</td>
</tr>
<tr>
<td>MiningRats 07</td>
<td>05.01.2018</td>
<td>4</td>
<td>31</td>
<td>185</td>
<td>49</td>
</tr>
<tr>
<td>MiningRats 08</td>
<td>08.01.2018</td>
<td>4</td>
<td>31</td>
<td>185</td>
<td>49</td>
</tr>
<tr>
<td>MiningRats 09</td>
<td>12.01.2018</td>
<td>3</td>
<td>31</td>
<td>196</td>
<td>50</td>
</tr>
<tr>
<td>LethicGuys 13</td>
<td>13.01.2018</td>
<td>3</td>
<td>31</td>
<td>196</td>
<td>50</td>
</tr>
<tr>
<td>LethicGuys 14</td>
<td>15.01.2018</td>
<td>3</td>
<td>31</td>
<td>196</td>
<td>50</td>
</tr>
<tr>
<td>ProxyGuys 01</td>
<td>16.01.2018</td>
<td>3</td>
<td>31</td>
<td>196</td>
<td>50</td>
</tr>
<tr>
<td>MiningRats 10</td>
<td>20.01.2018</td>
<td>3</td>
<td>31</td>
<td>196</td>
<td>50</td>
</tr>
<tr>
<td>LethicGuys 15</td>
<td>21.01.2018</td>
<td>3</td>
<td>31</td>
<td>196</td>
<td>50</td>
</tr>
<tr>
<td>LethicGuys 16</td>
<td>21.01.2018</td>
<td>3</td>
<td>31</td>
<td>196</td>
<td>50</td>
</tr>
<tr>
<td>MiningRats 11</td>
<td>30.01.2018</td>
<td>3</td>
<td>29</td>
<td>193</td>
<td>49</td>
</tr>
<tr>
<td>ProxyGuys 02</td>
<td>04.02.2018</td>
<td>3</td>
<td>29</td>
<td>193</td>
<td>49</td>
</tr>
<tr>
<td>TinukeFareit 01</td>
<td>09.02.2018</td>
<td>3</td>
<td>29</td>
<td>193</td>
<td>49</td>
</tr>
<tr>
<td>LethicGuys 17</td>
<td>16.02.2018</td>
<td>3</td>
<td>29</td>
<td>193</td>
<td>49</td>
</tr>
<tr>
<td>LethicGuys 18</td>
<td>22.02.2018</td>
<td>3</td>
<td>29</td>
<td>193</td>
<td>49</td>
</tr>
<tr>
<td>LethicGuys 19</td>
<td>25.02.2018</td>
<td>3</td>
<td>29</td>
<td>193</td>
<td>49</td>
</tr>
<tr>
<td>LethicGuys 20</td>
<td>26.02.2018</td>
<td>3</td>
<td>29</td>
<td>193</td>
<td>49</td>
</tr>
<tr>
<td>Redirectors 06</td>
<td>16.03.2018</td>
<td>3</td>
<td>29</td>
<td>193</td>
<td>49</td>
</tr>
<tr>
<td>Redirectors 07</td>
<td>19.03.2018</td>
<td>3</td>
<td>29</td>
<td>193</td>
<td>49</td>
</tr>
<tr>
<td>LethicGuys 21</td>
<td>22.03.2018</td>
<td>3</td>
<td>29</td>
<td>193</td>
<td>49</td>
</tr>
<tr>
<td>LethicGuys 22&nbsp;</td>
<td>22.03.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>193</td>
<td>49</td>
</tr>
<tr>
<td>LethicGuys 23&nbsp;</td>
<td>02.04.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>194</td>
<td>49</td>
</tr>
<tr>
<td>ProxyGuys 03&nbsp;</td>
<td>02.04.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>194</td>
<td>49</td>
</tr>
<tr>
<td>LethicGuys 24&nbsp;</td>
<td>05.04.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>194</td>
<td>49</td>
</tr>
<tr>
<td>TinukeFareit 02&nbsp;</td>
<td>08.04.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>194</td>
<td>49</td>
</tr>
<tr>
<td>TinukeFareit 03</td>
<td>23.04.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>194</td>
<td>49</td>
</tr>
<tr>
<td>TinukeFareit 04</td>
<td>02.05.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>194</td>
<td>49</td>
</tr>
<tr>
<td>Arsonists 01&nbsp;</td>
<td>07.05.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>194</td>
<td>49</td>
</tr>
<tr>
<td>TinukeFareit 05&nbsp;</td>
<td>19.05.2018&nbsp;</td>
<td>3</td>
<td>27</td>
<td>192</td>
<td>49</td>
</tr>
<tr>
<td>Arsonists 021&nbsp;</td>
<td>21.05.2018&nbsp;</td>
<td>3</td>
<td>27</td>
<td>192</td>
<td>49</td>
</tr>
<tr>
<td>TinukeFareit 061&nbsp;</td>
<td>21.05.2018&nbsp;</td>
<td>3</td>
<td>27</td>
<td>192</td>
<td>49</td>
</tr>
<tr>
<td>LethicGuys 25&nbsp;</td>
<td>23.05.2018&nbsp;</td>
<td>3</td>
<td>27</td>
<td>192</td>
<td>49</td>
</tr>
<tr>
<td>ProxyGuys 04&nbsp;</td>
<td>06.06.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>223</td>
<td>54</td>
</tr>
<tr>
<td>Arsonists 022&nbsp;</td>
<td>10.06.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>223</td>
<td>49</td>
</tr>
<tr>
<td>LethicGuys 26&nbsp;</td>
<td>14.06.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>224</td>
<td>54</td>
</tr>
<tr>
<td>TinukeFareit 062&nbsp;</td>
<td>19.06.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>224</td>
<td>55</td>
</tr>
<tr>
<td>TinukeFareit 07&nbsp;</td>
<td>05.07.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>224</td>
<td>55</td>
</tr>
<tr>
<td>MiningRats 12&nbsp;</td>
<td>26.08.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>241</td>
<td>56</td>
</tr>
<tr>
<td>LethicGuys 27&nbsp;</td>
<td>03.09.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>241</td>
<td>56</td>
</tr>
<tr>
<td>Arsonists 03&nbsp;</td>
<td>18.09.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>241</td>
<td>56</td>
</tr>
<tr>
<td>LethicGuys 28&nbsp;</td>
<td>18.09.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>241</td>
<td>56</td>
</tr>
<tr>
<td>ProxyGuys 05&nbsp;</td>
<td>18.09.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>241</td>
<td>56</td>
</tr>
<tr>
<td>TinukeFareit 08&nbsp;</td>
<td>20.09.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>241</td>
<td>56</td>
</tr>
<tr>
<td>MiningRats 13&nbsp;</td>
<td>11.10.2018&nbsp;</td>
<td>3</td>
<td>29</td>
<td>241</td>
<td>56</td>
</tr>
</tbody>
</table>
<p class="centered-caption">Table 11: The evolution of the Win32/Kasidet project.</p>
<p>Table 12 lists the Rich Header search rules we use to cover the prevalent Neutrino bot version 5.4.</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td>
<p class="monospace">prodidUtc1500_C b30729 = [1-4]</p>
<p class="monospace">prodidUtc1500_CPP b30729 = 1</p>
<p class="monospace">prodidImplib900 b30729 = [25-31]</p>
<p class="monospace">prodidimport0 b0 = [175-241]</p>
<p class="monospace">prodidUtc1600_C b40219 = 5</p>
<p><span class="monospace">prodidUtc1600_CPP b40219 = [44-56</span>]</p>
</td>
</tr>
</tbody>
</table>
<p class="centered-caption">Table 12: Win32/Kasidet version 5.4 detection rule.</p>
<p>&nbsp;</p>
<h4><a class="chapter" name="h4-win3264dridex"></a>Win{32,64}/Dridex</h4>
<p>It seems that, at any given time, this infamous banking trojan is actively being developed by a single entity, as all the samples from a given time period/campaign have the same Rich Headers. The development environment has changed at least four times. This could mean that the authors updated their tools or that the source code has changed hands and has either been sold or passed to someone else. The detection rules for various versions can be found in Table 13.</p>
<p>&nbsp;</p>
<h5><a class="chapter" name="h5-win3264dridex-v1-v2-amp-v3-20142015"></a>Win{32,64}/Dridex v1, v2 &amp; v3 (2014 – 2015)</h5>
<p>The initial versions of the Dridex banking trojan were developed in<em> Visual Studio 2010</em>. The rule should cover all samples from version 1.100 all the way until 3.102, which is over a year-long period between July 2014 and September 2015. We have collected 75 unique builds based on this search and, based on the gaps in the versions of samples we were missing, it could potentially cover over 270 unique versions.</p>
<p>&nbsp;</p>
<h5><a class="chapter" name="h5-win3264dridex-v3-2016"></a>Win{32,64}/Dridex v3 (2016)</h5>
<p>After version 3.102 the development environment changed slightly for the rest of the v3 development cycle and both 32-bit and 64-bit versions between v3.145 (November 2015) and v3.258 (September 2016) can be covered by the rule.</p>
<p>&nbsp;</p>
<h5><a class="chapter" name="h5-win3264dridex-v4-20172018"></a>Win{32,64}/Dridex v4 (2017 – 2018)</h5>
<p>Dridex version 4 introduced a few major changes including the infamous Atom bombing technique that made the headlines back in 2017 as well as a major development environment towards <em>Visual Studio 2015</em>. The rule covers the versions between v4.43 and v4.87 and reliably covers both 32-bit and 64-bit samples.</p>
<p>&nbsp;</p>
<h5><a class="chapter" name="h5-win3264dridex-v5v2-20182019"></a>Win{32,64}/Dridex v5(v2) (2018 – 2019)</h5>
<p>Another shift in the development environment of this malware. This time there has been an interesting shift in the versioning as well – instead of an expected version 5 it has been set back to version 2. This could indicate a change in the ownership of the source code or a change of the developer responsible for the malware. The rule should cover the most recent versions (v2.68 and newer).</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td>Versions 1, 2 and 3 (2014 - 2015)</td>
<td class="monospace">prodidUtc1500_CPP b30729 = 1<br>prodidMasm1000&nbsp;&nbsp;&nbsp; b40219 = [23-26]<br>prodidUtc1600_C&nbsp;&nbsp; b40219 = [99-143]<br>prodidUtc1600_CPP b40219 = [32-48]<br>prodidUnknown&nbsp;&nbsp;&nbsp;&nbsp; b0&nbsp;&nbsp;&nbsp;&nbsp; = 1</td>
</tr>
<tr>
<td>Version 3 (2016)</td>
<td class="monospace">prodidImplib900&nbsp;&nbsp; b30729 = [3-5]<br>prodidImport0&nbsp;&nbsp;&nbsp;&nbsp; b0&nbsp;&nbsp;&nbsp;&nbsp; = [1-2]<br>prodidUtc1500_C&nbsp;&nbsp; b30729 = 1<br>prodidExport1000&nbsp; b40219 = 1<br>prodidUnknown&nbsp;&nbsp;&nbsp;&nbsp; b0&nbsp;&nbsp;&nbsp;&nbsp; = 1</td>
</tr>
<tr>
<td>Version 4 (2017 – 2018)</td>
<td class="monospace">prodidUtc1900_C&nbsp;&nbsp; b24215 = [22-23]<br>prodidUtc1900_CPP b24215 = [58-60]<br>prodidLinker1400&nbsp; b24215 = 1</td>
</tr>
<tr>
<td>Version 5 (v2) (2018 – 2019)</td>
<td class="monospace">prodidUtc1500_C&nbsp;&nbsp; b30729 = 4<br>prodidImplib900&nbsp;&nbsp; b30729 = 5<br>prodidImport0&nbsp;&nbsp;&nbsp;&nbsp; b0&nbsp;&nbsp;&nbsp;&nbsp; = 6<br>prodidLinker1400&nbsp; b24215 = 1<br>prodidUnknown&nbsp;&nbsp;&nbsp;&nbsp; b0&nbsp;&nbsp;&nbsp;&nbsp; = 90</td>
</tr>
</tbody>
</table>
<p class="centered-caption">Table 13: Win{32,64}/Dridex detection rules.</p>
<p>&nbsp;</p>
<h4><a class="chapter" name="h4-win3264sathurbot"></a>Win{32,64}/Sathurbot</h4>
<p>This name represents botnets spreading via password attacks on <em>WordPress</em> sites [<a href="#ref15">15</a>]. The malware is a large project which is compiled for both 32- and 64-bit <em>Windows</em> platforms. Table 14 shows the evolution of the build environment (internal DLL name, PE Timestamp and <span class="monospace">ProdID</span>s representing the source files).</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td rowspan="2">&nbsp;</td>
<td>&nbsp;</td>
<td style="text-align: center;" colspan="5">prodidUtcXXXX_CPP</td>
</tr>
<tr>
<td>PE TS</td>
<td>1600_CPP b40219</td>
<td>1600_CPP b30319</td>
<td>1600_LTCG_CPP b30319</td>
<td>1700_CPP b50929</td>
<td>1800_CPP b20806</td>
</tr>
<tr>
<td>PerformanceMonitor.dll</td>
<td>22.4.2015</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>59</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>PerformanceMonitor.dll</td>
<td rowspan="2">27.4.2015</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>60</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>PerformanceMonitor.dll</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>59</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>PerformanceMonitor.dll</td>
<td rowspan="2">14.5.2015</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>60</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>PerformanceMonitor.dll</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>59</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>PerformanceMonitor.dll</td>
<td rowspan="2">21.6.2015</td>
<td>&nbsp;</td>
<td>92</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>PerformanceMonitor.dll</td>
<td>&nbsp;</td>
<td>91</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>PerformanceMonitor.dll</td>
<td>8.7.2015</td>
<td>&nbsp;</td>
<td>92</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>PerformanceMonitor.dll</td>
<td>30.7.2015</td>
<td>&nbsp;</td>
<td>91</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>PerformanceMonitor.dll</td>
<td>4.8.2015</td>
<td>&nbsp;</td>
<td>91</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>PerformanceMonitor.dll</td>
<td rowspan="2">18.8.2015</td>
<td>&nbsp;</td>
<td>89</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>PerformanceMonitor.dll</td>
<td>&nbsp;</td>
<td>88</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>PerformanceMonitor.dll</td>
<td>27.8.2015</td>
<td>&nbsp;</td>
<td>88</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>PerformanceMonitor.dll</td>
<td>15.9.2015</td>
<td>&nbsp;</td>
<td>89</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>PerformanceMonitor.dll</td>
<td>8.2.2016</td>
<td>89</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>PerformanceMonitor.dll</td>
<td>18.2.2016</td>
<td>89</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>performanceMonitor_64.dll</td>
<td>31.3.2016</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>84</td>
</tr>
<tr>
<td>performanceMonitor_32.dll</td>
<td rowspan="2">29.06.2016</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>83</td>
</tr>
<tr>
<td>performanceMonitor_64.dll</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>84</td>
</tr>
<tr>
<td>performanceMonitor_32.dll</td>
<td>31.8.2016</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>83</td>
</tr>
<tr>
<td>performanceMonitor_32.dll</td>
<td>24.10.2016</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>83</td>
</tr>
<tr>
<td>performanceMonitor_64.dll</td>
<td>29.12.2016</td>
<td>&nbsp;</td>
<td>69</td>
<td>97</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>performanceMonitor_32.dll</td>
<td>13.1.2017</td>
<td>&nbsp;</td>
<td>68</td>
<td>97</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>performanceMonitor_32.dll</td>
<td rowspan="2">16.2.2017</td>
<td>&nbsp;</td>
<td>68</td>
<td>97</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>performanceMonitor_64.dll</td>
<td>&nbsp;</td>
<td>69</td>
<td>97</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>performanceMonitor_64.dll</td>
<td>10.3.2017</td>
<td>&nbsp;</td>
<td>69</td>
<td>97</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>performanceMonitor_64.dll</td>
<td>21.3.2017</td>
<td>&nbsp;</td>
<td>69</td>
<td>97</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>performanceMonitor_64.dll</td>
<td>27.5.2017</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>79</td>
</tr>
<tr>
<td>performanceMonitor_64.dll</td>
<td>7.11.2017</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>79</td>
</tr>
</tbody>
</table>
<p class="centered-caption">Table 14: The evolution of Win{32,64}/Sathurbot.</p>
<p>It is not possible to conclude with high confidence that there is more than a single entity operating the source code. However, the produced executables suggest that<em> Visual Studio</em> is switched regularly. The merged PE timestamp of two samples into one cell with a single date means a consecutive compilation for both 32- and 64-bit platforms that differed by just a few seconds. The order of this compilation varied as well.</p>
<p>&nbsp;</p>
<h4><a class="chapter" name="h4-malware-packers"></a>Malware packers</h4>
<p>The main purpose of malware packers is to provide a container for malware families with features like polymorphism, anti-analysis and obfuscation. Because of these features, malware packers often display abnormal static properties and their Rich Headers are no exception.</p>
<p>The first interesting case was a validly signed, highly polymorphic obfuscator detected as Win32/Kryptik.GSLI. In May 2019, hundreds of unique samples were distributed in the wild, with Win32/TrojanDownloader.Zurgop.CY as the protected payload. We discovered these campaigns because the <span class="monospace">prodidCvtres500</span> identifier contained anomalously high counts. After collecting many related files, we found that the rules in Table 15 identified the cluster very well.</p>
<table class="table table-bordered" border="0">
<tbody>
<tr>
<td class=" monospace">
<p>prodidMasm613 b7299 = [12-13]</p>
<p>prodidUtc12_C b9782 = 63</p>
<p>prodidLinker512 b8034 = 11</p>
<p>prodidUtc12_CPP b9782 = 2</p>
</td>
</tr>
</tbody>
</table>
<p class="centered-caption">Table 15: Detection query for Win32/Kryptik.GSLI.</p>
<p>Later, we identified another extremely polymorphic malware packer. The shared static properties include two <span class="monospace">.version</span> PE sections of 1,024 bytes each, a file version of 1.0.0.1 and legal copyright starting with <span class="monospace">Copyright (C) 2018</span>. The rest of the features seem randomly generated. We described the cluster with the relatively simple rule conjunction seen in Table 16.</p>
<table class="table table-bordered">
<tbody>
<tr>
<td class="monospace">
<p>prodidUtc1500_CPP b21022 = 37</p>
<p>prodidMasm900 b21022 = 17</p>
<p>prodidUtc1500_C b21022 = [112-120]</p>
<p>prodidUtc1500_LTCG_CPP b21022 = 1</p>
<p>prodidCvtres900 b21022 = 1</p>
</td>
</tr>
</tbody>
</table>
<p class="centered-caption">Table 16: Detection query for the malware packer shared across many malware families.</p>
<p>There were many malware families protected with this packer, including the following (for further examples see [01]):</p>
<ul>
<li>Win32/PSW.Delf.OSF (aka Azorult)</li>
<li>Win/Spy.Kronosbot</li>
<li>Win32/TrojanDownloader.Zurgop.DA</li>
<li>Win32/Filecoder.Spora</li>
<li>Win32/Agent.TFY (a backdoor written in <em>GoLang</em>)</li>
<li>MSIL/Spy.Baldr</li>
<li>Win32/Ramnit.BV (a virus)</li>
<li>Win32/Spy.Ursnif.CY</li>
</ul>
<p>&nbsp;</p>
<h3><a class="chapter" name="h3-rich-headers-amp-yara"></a>Rich Headers &amp; YARA</h3>
<p>YARA is a great tool for malware researchers, incident responders and security engineers that has become an industry standard for hunting malware and the classification of unknown samples. Hence, being able to write YARA rules based on Rich Headers would be a great way to share our findings with the rest of the world.</p>
<p>Although YARA does support parsing of Rich Headers and the PE module has a few Rich Header-related fields, at the time of writing (June 2019) there are a few critical drawbacks that greatly limit its usability [<a href="#ref16">16</a>].</p>
<p>First, as seen in its source code in Figure 8, YARA incorrectly assumes that the Rich Header always starts at the common offset 0x80 [<a href="#ref10">10</a>] and will not work for any Rich Header at a different offset. This can easily be fixed and is not that big an issue, since as stated above, over 99% of files with Rich Headers tend to have them at that offset.</p>
<p><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/6815/7563/1873/08_yara_rich_offset_src.png" alt="08_yara_rich_offset_src.png" width="587" height="316"> <span class="centered-caption">Figure 8: YARA’s implementation of Rich Headers lookup.</span></p>
<p>The bigger problem is the YARA Rich Header-related API, which is very simple and insufficient for any effective Rich Header-related rules. The <span class="monospace">version</span> and <span class="monospace">toolid</span> functions can only look whether a specific <span class="monospace">ProdID</span> and build is present in the Rich Header, but are unable to query its count values, which are the most crucial attribute in most useful searches. The announcement of YARA’s <span class="monospace">toolid</span> function can be seen in Figure 9.</p>
<p><img class="framed" style="display: block; margin-left: auto; margin-right: auto;" src="/files/5315/7563/1899/09_yara_docs_version_toolid.png" alt="09_yara_docs_version_toolid.png" width="664" height="406"></p>
<p class="centered-caption">Figure 9: YARA PE module Rich Headers API documentation.</p>
<p>The APIs would be much more useful if instead of the existence of a given <span class="monospace">ProdID</span>, the <span class="monospace">toolid</span> and <span class="monospace">version</span> interfaces returned the count (or null), which then could be compared against a ranged interval. This would greatly enhance YARA’s Rich Header-related capabilities and would enable more complete leverage of the Rich Header format. We hope to contribute to the YARA project and to help to improve the Rich Header-related functionality in the near future.</p>
<p>&nbsp;</p>
<h2><a class="chapter" name="h2-conclusion"></a>Conclusion</h2>
<p>We started our project with low expectations, thinking that there must be a reason the Rich Headers feature is overlooked and not widely utilized. Over time, we became more and more impressed with how much could be achieved by searching for feature clusters based on such a small part of an executable, and how powerful it can be when leveraged correctly.</p>
<p>The space of Rich Header features has an extremely fast lookup and is ‘rich’ indeed, in the sense that the detection queries for chosen parts of APT toolsets or crimeware kits identified the clusters well and with a low level of noise. Because of the nature of the information, false positives may occur, however the erroneous verdicts seem to be intuitive: clean projects of small magnitude, shared executable containers and, surprisingly, different malicious families as well. We believe this kind of static feature may also be utilized in machine-learning algorithms, to assist in deciding maliciousness, and this is the subject of future work.</p>
<p>Sharing publicly the various techniques malware researchers use to track cybercriminal actors usually causes an obvious reaction: avoidance. In the case of the Rich Header that may be a Pyrrhic victory – any interference with this delicate structure, such as wiping it or substituting it, will produce obvious, easily detectable anomalies just asking for closer attention from our malware analysts.</p>
<p>Rich Headers are definitely not a silver bullet that will change the security industry, but they could be a nice and very helpful addition to current detection and hunting methods and systems. We feel that this undocumented structure deserves more attention than it currently receives across the field and imagine that, in the not too distant future, we may see Rich Header YARA rules appearing in malware analysis IoC listings and the like.</p>
<p>&nbsp;</p>
<h2><a class="chapter" name="h2-references"></a>References</h2>
<p><a class=" anchor" name="ref1"></a>[1] <a href="https://github.com/AyalaRs/win/blob/master/private/sdktools/vctools/langapi/include/prodids.h" target="_blank">https://github.com/AyalaRs/win/blob/master/private/sdktools/vctools/langapi/include/prodids.h</a>.</p>
<p><a class=" anchor" name="ref2"></a>[2] ESET GitHub. SHA256 hashes of mentioned files. <a href="https://github.com/eset/malware-ioc/tree/master/rich_headers" target="_blank">https://github.com/eset/malware-ioc/tree/master/rich_headers</a>.</p>
<p><a class=" anchor" name="ref3"></a>[3] GReAT. A predatory tale: Who’s afraid of the thief? Securelist.com. March 2019. <a href="https://securelist.com/a-predatory-tale/89779/" target="_blank">https://securelist.com/a-predatory-tale/89779/</a>.</p>
<p><a class=" anchor" name="ref4"></a>[4] Kálnai, P.; Poslušný, M. Lazarus Group: a mahjong game played with different sets of tiles, Virus Bulletin International Conference 2018, Montreal. <a href="https://www.virusbulletin.com/uploads/pdf/magazine/2018/VB2018-Kalnai-Poslusny.pdf" target="_blank">https://www.virusbulletin.com/uploads/pdf/magazine/2018/VB2018-Kalnai-Poslusny.pdf</a>.</p>
<p><a class=" anchor" name="ref5"></a>[5] Kaspersky GReAT. The devil’s in the Rich header. March 2018. <a href="https://securelist.com/the-devils-in-the-rich-header/84348/" target="_blank">https://securelist.com/the-devils-in-the-rich-header/84348/</a>.</p>
<p><a class=" anchor" name="ref6"></a>[6] Rascagnères, P.; Mercer, W. Who wasn’t responsible for Olympic Destroyer. Virus Bulletin International Conference 2018, Montreal. <a href="https://www.virusbulletin.com/uploads/pdf/magazine/2018/VB2018-Rascagneres-Mercer.pdf" target="_blank">https://www.virusbulletin.com/uploads/pdf/magazine/2018/VB2018-Rascagneres-Mercer.pdf</a>.</p>
<p><a class=" anchor" name="ref7"></a>[7] Kálnai, P.; Cherepanov, A. Lazarus KillDisks Central American casino. April 2018. <a href="https://www.welivesecurity.com/2018/04/03/lazarus-killdisk-central-american-casino/" target="_blank">https://www.welivesecurity.com/2018/04/03/lazarus-killdisk-central-american-casino/</a>.</p>
<p><a class=" anchor" name="ref8"></a>[8] Cherepanov, A. GREYENERGY: A successor to BlackEnergy. October 2018. <a href="https://www.welivesecurity.com/wp-content/uploads/2018/10/ESET_GreyEnergy.pdf" target="_blank">https://www.welivesecurity.com/wp-content/uploads/2018/10/ESET_GreyEnergy.pdf</a>.</p>
<p><a class=" anchor" name="ref9"></a>[9] Cherepanov, A.; Lipovský, R. New Telebots backdoor linking Industroyer and notPetya. WeLiveSecurity.com. October 2018. <a href="https://www.welivesecurity.com/2018/10/11/new-telebots-backdoor-linking-industroyer-notpetya/" target="_blank">https://www.welivesecurity.com/2018/10/11/new-telebots-backdoor-linking-industroyer-notpetya/</a>.</p>
<p><a class=" anchor" name="ref10"></a>[10] <a href="https://github.com/VirusTotal/yara/blob/master/libyara/modules/pe.c#L190" target="_blank">https://github.com/VirusTotal/yara/blob/master/libyara/modules/pe.c#L190</a>.</p>
<p><a class=" anchor" name="ref11"></a>[11] Webster, G.D.; Kolosnjaji, B.; von Pentz, Ch.; Kirsch, J.; Hanif, Z.D.; Zarras, A.; Eckert, C. Finding the Needle: A Study of the PE32 Rich Header and Respective Malware Triage. In: Proceedings of the International Conference on Detection of Intrusions and Malware, and Vulnerability Assessment. Springer, pp. 119--138, 2017. <a href="https://www.sec.in.tum.de/i20/publications/finding-the-needle-a-study-of-the-pe32-rich-header-and-respective-malware-triage" target="_blank">https://www.sec.in.tum.de/i20/publications/finding-the-needle-a-study-of-the-pe32-rich-header-and-respective-malware-triage</a>.</p>
<p><a class=" anchor" name="ref12"></a>[12] Cherepanov, A. Win32/Industroyer a new threat to industrial control systems. WeLiveSecurity.com. June 2017. <a href="https://www.welivesecurity.com/wp-content/uploads/2017/06/Win32_Industroyer.pdf" target="_blank">https://www.welivesecurity.com/wp-content/uploads/2017/06/Win32_Industroyer.pdf</a>.</p>
<p><a class=" anchor" name="ref13"></a>[13] Kafka, F. From Hacking Team to Hacked Team to…? Virus Bulletin International Conference 2018, Montreal. <a href="https://www.virusbulletin.com/uploads/pdf/magazine/2018/VB2018-Kafka.pdf" target="_blank">https://www.virusbulletin.com/uploads/pdf/magazine/2018/VB2018-Kafka.pdf</a>.</p>
<p><a class=" anchor" name="ref14"></a>[14] Soucek, J.; Tomanek, J.; Kálnai, P. Collecting Malicious Particles from Neutrino botnets. The Journal on Cybercrime &amp; Digital Investigations, Botconf 2018 Conference proceedings, <a href="https://journal.cecyf.fr/ojs/index.php/cybin/article/view/22/24" target="_blank">https://journal.cecyf.fr/ojs/index.php/cybin/article/view/22/24</a>.</p>
<p><a class=" anchor" name="ref15"></a>[15] ESET Research: Sathurbot: Distributed WordPress password attack. WeLiveSecurity.com. April 2017. <a href="https://www.welivesecurity.com/2017/04/06/sathurbot-distributed-wordpress-password-attack/" target="_blank">https://www.welivesecurity.com/2017/04/06/sathurbot-distributed-wordpress-password-attack/</a>.</p>
<p><a class=" anchor" name="ref16"></a>[16] YARA PE module documentation. <a href="https://yara.readthedocs.io/en/v3.7.0/modules/pe.html" target="_blank">https://yara.readthedocs.io/en/v3.7.0/modules/pe.html</a>.</p> </div>
<div class="col-md-3 col-sm-3 col-lg-3">
<p><a href="/uploads/pdf/magazine/2019/VB2019-Kalnai-Poslusny.pdf" target="_blank"><img src="/uploads/images/buttons/pdf-download-button.jpg" alt="Download PDF" width="262" height="45"></a></p>
<div id="NDPHPBlock13359" class="NDPHPBlock">
<div style="width: 100%;"><div style="float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;"><center><a target="_blank" title="Tweet this!" href="https://twitter.com/share?text=VB2019 paper: Rich Headers: leveraging this mysterious artifact of the PE format&amp;url=https://www.virusbulletin.com/virusbulletin/2020/01/vb2019-paper-rich-headers-leveraging-mysterious-artifact-pe-format"><img src="/uploads/images/buttons/twitter.png" alt="twitter.png" width="45" height="45" class="responsive"></a></center></div><div style="float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;"><center><a target="_blank" title="Share on Facebook" href="https://www.facebook.com/sharer.php?u=https://www.virusbulletin.com/virusbulletin/2020/01/vb2019-paper-rich-headers-leveraging-mysterious-artifact-pe-format"><img src="/uploads/images/buttons/fb.png" alt="fb.png" width="45" height="45" class="responsive"></a></center></div><div style="float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;"><center><a target="_blank" title="Share on LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.virusbulletin.com/virusbulletin/2020/01/vb2019-paper-rich-headers-leveraging-mysterious-artifact-pe-format&amp;title=VB2019 paper: Rich Headers: leveraging this mysterious artifact of the PE format"><img src="/uploads/images/buttons/linkedin.png" alt="linkedin.png" width="45" height="45" class="responsive"></a></center></div><div style="float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;"><center><a target="_blank" title="Share on Hacker News" href="https://news.ycombinator.com/submitlink?u=https://www.virusbulletin.com/virusbulletin/2020/01/vb2019-paper-rich-headers-leveraging-mysterious-artifact-pe-format&amp;t=VB2019 paper: Rich Headers: leveraging this mysterious artifact of the PE format"><img src="/uploads/images/buttons/hackernews.png" alt="hackernews.png" width="45" height="45" class="responsive"></a></center></div><div style="float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;"><center><a target="_blank" title="reddit this!" href="https://www.reddit.com/submit?url=https://www.virusbulletin.com/virusbulletin/2020/01/vb2019-paper-rich-headers-leveraging-mysterious-artifact-pe-format"><img src="/uploads/images/buttons/reddit.png" alt="reddit.png" width="45" height="45" class="responsive"></a></center></div></div></div><p>&nbsp;</p>
<h2>Latest articles:</h2>
<div class="ccm-page-list">
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2023/10/nexus-android-banking-botnet-compromising-cc-panels-and-dissecting-mobile-appinjects/" target="_self">Nexus Android banking botnet – compromising C&amp;C panels and dissecting mobile AppInjects</a>
</h3>
<div class="ccm-page-list-description">
Aditya Sood &amp; Rohit Bansal provide details of a security vulnerability in the Nexus Android botnet C&amp;C panel that was exploited to compromise the C&amp;C panel in order to gather threat intelligence, and present a model of mobile AppInjects. </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2022/04/cryptojacking-fly-teamtnt-using-nvidia-drivers-mine-cryptocurrency/" target="_self">Cryptojacking on the fly: TeamTNT using NVIDIA drivers to mine cryptocurrency</a>
</h3>
<div class="ccm-page-list-description">
TeamTNT is known for attacking insecure and vulnerable Kubernetes deployments in order to infiltrate organizations’ dedicated environments and transform them into attack launchpads. In this article Aditya Sood presents a new module introduced by… </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/12/collector-stealer-russian-origin-credential-and-information-extractor/" target="_self">Collector-stealer: a Russian origin credential and information extractor</a>
</h3>
<div class="ccm-page-list-description">
Collector-stealer, a piece of malware of Russian origin, is heavily used on the Internet to exfiltrate sensitive data from end-user systems and store it in its C&amp;C panels. In this article, researchers Aditya K Sood and Rohit Chaturvedi present a 360… </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/06/fighting-fire-fire/" target="_self">Fighting Fire with Fire</a>
</h3>
<div class="ccm-page-list-description">
In 1989, Joe Wells encountered his first virus: Jerusalem. He disassembled the virus, and from that moment onward, was intrigued by the properties of these small pieces of self-replicating code. Joe Wells was an expert on computer viruses, was partly… </div>
<h3 class="ccm-page-list-title">
<a href="/virusbulletin/2021/04/run-your-malicious-vba-macros-anywhere/" target="_self">Run your malicious VBA macros anywhere!</a>
</h3>
<div class="ccm-page-list-description">
Kurt Natvig wanted to understand whether it’s possible to recompile VBA macros to another language, which could then easily be ‘run’ on any gateway, thus revealing a sample’s true nature in a safe manner. In this article he explains how he recompiled… </div>
</div>
<p><br><a class="btn btn-block btn-warning" href="/virusbulletin/archive">Bulletin Archive</a></p> </div>
</div>
</div>

<footer class="bs-footer" role="contentinfo">
<div class="container">
<div class="bs-social">
<div class="row ">
<div class="col-md-3">
<p><a title="About Us" href="/about-vb/about-us/">About us</a></p>
<p><a title="Contact Us" href="/about-vb/contact-us/">Contact us</a></p>
<p><a title="Advisory Board" href="/about-vb/advisory-board/">Advisory board</a></p>
<p><a title="Press" href="/about-vb/press/">Press information</a></p>
<p><a title="Security Events Calendar" href="/resources/calendar/">Security events calendar</a></p>
<p><a title="Newsletter" href="/newsletter/">Virus Bulletin newsletter</a></p> </div>
<div class="col-md-3">
<p><a title="VB Testing" href="/testing/">Testing</a></p>
<p><a title="VB100" href="/testing/vb1001/">VB100</a></p>
<p><a title="VBSpam" href="/testing/vbspam/">VBSpam</a></p>
<p><a title="VBWeb" href="/testing/vbweb/">VBWeb</a></p>
<p><a title="Consultancy Services" href="/testing/consultancy-services/">Consultancy services</a></p>
<p><a title="The Spammers' Compendium" href="/resources/spammerscompendium/">Spammers' Compendium</a></p> </div>
<div class="col-md-3">
<p><a title="VB2023" href="/conference/vb2023/">VB2023 (London)</a></p>
<p><a title="VB2022" href="/conference/vb2022/">VB2022 (Prague)</a></p>
<p><a title="VB2021 localhost" href="/conference/vb2021/">VB2021 localhost</a></p>
<p><a title="VB2020 localhost" href="/conference/vb2020/">VB2020 localhost</a></p>
<p><a title="VB2019" href="/conference/vb2019/">VB2019 (London)</a></p>
<p><a title="Conference Archive" href="/conference/vb-conference-archive/">Older conferences</a></p> </div>
<div class="col-md-3">
<div class="row">
<table style="float: right;" border="0">
<tbody>
<tr>
<td align="center"><a href="/rss" target="_blank"><img title="Get our blog updates" src="/uploads/images/buttons/rss-square-gray.png" alt="rss.png" width="35" height="35"></a></td>
<td>&nbsp;</td>
<td align="center"><a href="https://twitter.com/virusbtn" target="_blank"><img class="bhtmbxoyxwpzahwcvxnw" title="Visit us on Twitter" src="/uploads/images/buttons/twitter-square-gray.png" alt="twitter.png" width="35" height="35"></a></td>
<td>&nbsp;</td>
<td align="center"><a href="https://www.linkedin.com/company/virus-bulletin" target="_blank"><img class="bhtmbxoyxwpzahwcvxnw" title="Visit us on LinkedIn" src="/uploads/images/buttons/linkedin-square-gray.png" alt="linkedin.png" width="35" height="35"></a></td>
<td>&nbsp;</td>
<td align="center"><a href="https://www.facebook.com/virusbulletin" target="_blank"><img title="Visit us on Facebook" src="/uploads/images/buttons/fb-square-gray.png" alt="twitter.png" width="35" height="35"></a></td>
<td>&nbsp;</td>
<td align="center"><a href="https://www.youtube.com/user/virusbtn" target="_blank"><img title="Visit us on Youtube" src="/uploads/images/buttons/youtube-square-gray.png" alt="youtube.png" width="35" height="35"></a></td>
</tr>
</tbody>
</table>
</div> </div>
</div>
<div class="row ">
<div class="col-md-12">
</div>
</div>
</div>
</div>
</footer>

<footer class="bs-footer2" role="contentinfo">
<div class="container">
<div class="bs-social2">
<div class="row ">
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
<div class="col-md-3">
</div>
</div>
<div class="row ">
<div class="col-md-12">
<p style="text-align: left;">©1989-2024 Virus Bulletin.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a title="Privacy Policy" href="/about-vb/privacy-policy/">Privacy policy</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a title="Cookies" href="/about-vb/privacy-policy/cookies/">Cookies</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a title="Terms and Conditions" href="/about-vb/terms-and-conditions/">Terms and Conditions</a></p> </div>
</div>
</div>
</div>
</footer>

<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-21876594-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-21876594-2', { 'anonymize_ip': true });
</script><script type="text/javascript" src="/libraries/js/fancybox.load.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/app.js"></script>
<div id="ccm-cookiesDisclosure" class="disclosure-bottom" style="height: 162px;">
<div class="disclosure-container">
<div class="disclosure-content">
<p> We have placed cookies on your device in order to improve the functionality of this site, as outlined in our <a href="/about-vb/privacy-policy/cookies" target="_blank">cookies policy</a>. However, you may delete and block all cookies from this site and your use of the site will be unaffected. By continuing to browse this site, you are agreeing to Virus Bulletin's use of data as outlined in our <a href="/about-vb/privacy-policy/" target="_blank">privacy policy</a>.</p>
</div>
<div class="disclosure-form">
<form action="/index.php/cookies_disclosure/" method="POST">
<input type="hidden" name="allowCookies" value="1">
<div class="button">
<input class="btn btn-info btn-sm" type="submit" name="submit" value="I understand. Don't show this message again!">
</div>
</form>
</div>
<div class="ccm-spacer">&nbsp;</div>
</div>
</div>

<a href="#" id="toTop" class="btn btn-primary" style="display: none;"><span id="toTopHover"></span><span class="glyphicon glyphicon-chevron-up"></span></a></body></html>