<html class=" mod-js mod-rgba mod-backgroundsize mod-textshadow mod-csstransforms"><head>
		<meta charset="utf-8">
		<title>Public Diffie-Hellman Parameter Service/Tool | 2 Ton Digital</title>
		<meta name="keywords" content="linux x86_64 assembler library assembly language library HeavyThing sshtalk dhtool webslap rwasa toplip hnwatch">
		<meta name="author" content="Jeff Marrison">
		<meta name="viewport" content="width=device-width,initial-scale=1.0">
		<meta property="og:type" content="article">
		<meta property="og:image" content="https://2ton.com.au/images/oglogo.png">
		<link rel="apple-touch-icon" href="/images/oglogo.png">
		<link rel="icon" type="image/png" href="//2ton.com.au/icon.png">
		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Inconsolata|Source+Sans+Pro:700|Merriweather:400,400italic" type="text/css">
		<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" type="text/css">
		<link rel="stylesheet" href="//2ton.com.au/ht.css" type="text/css">
		<script type="text/javascript" async="" src="https://www.googletagmanager.com/gtag/js?id=G-7GP2Q7XWQ8&amp;cx=c&amp;_slc=1"></script><script async="" src="//www.google-analytics.com/analytics.js"></script><script src="//2ton.com.au/modernizr.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59221937-1', 'auto');
  ga('send', 'pageview');

  // begin 2ton.com.au XHR for download counters:
  function commify(i) {
    return i.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  }
  function counterData(data) {
    var xx = document.getElementById('librarydownloads');
    xx.innerHTML='Library downloaded '+commify(data.library) + ' times';
    var x = document.getElementById('librarydlcount');
    x.style.display = 'block';
  };

  var xhr = new XMLHttpRequest();
  xhr.open('GET', '//2ton.com.au/counters', true);
  xhr.onreadystatechange = function() {
    if (xhr.readyState == 4) { // DONE
      if (xhr.status == 200) {
        counterData(JSON.parse(xhr.responseText));
      }
    }
  };
  xhr.send();
  // end 2ton.com.au XHR

</script>
	</head>
	<body class="lf-article">
		<nav id="lf-navbar">
			<div id="lf-homeicon">
				<a class="lf-logo" rel="author" href="/"></a>
			</div>
			<div id="lf-menubar">
				<ul>
					<li><a href="/Products/">Products</a></li>
					<li><a href="/videos/">Videos</a></li>
					<li><a href="/Services/">Services</a></li>
					<li><a href="/safeprimes/">Safe Primes</a></li>
					<li><a href="/rants_and_musings/">Rants &amp; Musings</a></li>
				</ul>
			</div>
		</nav>
		<div id="lf-search-results">
			<div id="lf-search-results-results"></div>
			<span id="lf-search-results-close" class="lf-sprite-slimbox-close"></span>
		</div>
		<div id="lf-pages">
			<div id="lf-page"><div class="lf-scrolling-header"></div>
				<article>
					<header>
						<h1>Public Diffie-Hellman Parameter Service/Tool</h1>
						<div id="lf-sideblock">
							
							<nav id="lf-links">
								<div class="lf-link" id="downloadlink">
									<p>Download HeavyThing</p>
									<ul><li><a href="/HeavyThing-1.24.tar.gz">HeavyThing-1.24.tar.gz</a></li><li><a href="/library_as_html/ChangeLog.html">ChangeLog</a></li></ul>
								</div>
								<div class="lf-link">
									<p>SHA256: 77bb53d7717d825515f159a3794808e1edf46ca6b515a1686df3dd6b8a94432d</p>
								</div>
								<div class="lf-link" style="display: block;" id="librarydlcount">
									<p id="librarydownloads">Library downloaded 19,699 times</p>
								</div>
								<div class="lf-link">
									<p>Get flat assembler</p>
									<ul><li><a href="https://flatassembler.net/download.php">flatassembler.net</a></li></ul>
								</div>
								<div class="lf-link">
									<p>Community</p>
									<ul><li><a href="https://board.flatassembler.net/">board.flatassembler.net</a></li></ul>
								</div>
								<div class="lf-link lf-share">
									<p>Share this page</p>
									<ul>
										<li><a class="lf-sprite-twitter" href="https://twitter.com/share?url=https%3A%2F%2F2ton.com.au%2Fdhtool%2F&amp;via=2TonDigital&amp;text=Public%20Diffie-Hellman%20Parameter%20Service/Tool%20-%202%20Ton%20Digital" title="Share on Twitter">Twitter</a></li>
										<li><a class="lf-sprite-facebook" href="https://www.facebook.com/sharer.php?u=https%3A%2F%2F2ton.com.au%2Fdhtool%2F&amp;t=Public%20Diffie-Hellman%20Parameter%20Service/Tool%20-%202%20Ton%20Digital" title="Share on Facebook">Facebook</a></li>
										<li><a class="lf-sprite-google" href="https://plus.google.com/share?url=https%3A%2F%2F2ton.com.au%2Fdhtool%2F" title="Share on Google">Google</a></li>
										<li><a class="lf-sprite-reddit" href="https://www.reddit.com/submit?url=https%3A%2F%2F2ton.com.au%2Fdhtool%2F&amp;title=Public%20Diffie-Hellman%20Parameter%20Service/Tool%20-%202%20Ton%20Digital" title="Share on reddit">reddit</a></li>
										<li><a class="lf-sprite-hackernews" href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2F2ton.com.au%2Fdhtool%2F&amp;t=Public%20Diffie-Hellman%20Parameter%20Service/Tool%20-%202%20Ton%20Digital" title="Share on Hacker News">Hacker News</a></li>
										<li><a class="lf-sprite-mail" href="mailto:?subject=Public%20Diffie-Hellman%20Parameter%20Service/Tool%20-%202%20Ton%20Digital&amp;body=https%3A%2F%2F2ton.com.au%2Fdhtool%2F" title="Share by email">Email</a></li>
									</ul>
								</div>

							</nav>
						</div>
					</header>
					<div id="lf-main">
<p id="oct2018update">
	<strong>UPDATE October 2018:</strong> Since our safe prime database has gotten so large, we have released a <a href="/safeprimes/">new API and safe prime</a> page. We will continue to support both API versions so nothing breaks, but you are encouraged to explore and make use of the new features. Our <a href="#service">Public DH parameter service</a> has been running continuously since late May, 2015. Counts as at October 22nd, 2018 for each prime size:
	</p><ul>
		<li>2048 bits: ~1,100,000 safe primes</li>
		<li>3072 bits: ~465,000 safe primes</li>
		<li>4096 bits: ~525,000 safe primes</li>
		<li>8192 bits: ~ 82,000 safe primes</li>
	</ul>
<p></p>
<p id="intro">
	In light of the [updated: then] recent <a href="https://www.schneier.com/blog/archives/2015/05/the_logjam_and_.html">Logjam</a> discussions, periodic creating and updating of OpenSSH, OpenSSL, and OpenVPN Diffie-Hellman parameters has a renewed sense of importance. We already had our own DH parameter generation tools and have been using them for many moons, but when discussing same with some of our clients, the consensus was that it would be nice if there were a public and free service that generated a constant stream of new safe primes and generators in a format that would be easily scriptable for periodic updates/replacements for all OpenSSL based uses, as well as OpenSSH installations.
</p>
<p>
	To answer that call, we have created a public <strong>dhparam/SSH moduli</strong> service, in addition to releasing <strong>dhtool</strong>, the underlying program that generates the safe primes and generators, as well as providing options to verify them. Details of the service itself are provided below, but first we feel it is important to discuss the notion of what constitutes a suitable generator. Put simply, we followed the Wei Dai method, as he stated: "find g such that g is a quadratic residue mod p." OpenSSL/OpenSSH parameters are quadratic nonresidues, and as a result, if you run <code>openssl dhparam -check</code> against parameters generated by dhtool (and thus the services presented here as well), it will complain about <code>DH_NOT_SUITABLE_GENERATOR</code> or that it cannot verify the generator. To get an idea of what this is all about and really means, this <a href="http://crypto.stackexchange.com/questions/12961/diffie-hellman-parameter-check-when-g-2-must-p-mod-24-11">stackexchange post</a> appears to cover it in one. To summarize, OpenSSL prefers to leak one bit by using quadratic nonresidues rather than limit the DH shared secret to half the possible values. Wei Dai, RFC3526, and ourselves prefer to limit the DH shared secret to half the possible values (in part because the shared secret is relative in size to the modulus itself unlike the private exponents which are typically much smaller). The difference in choice appears small and we are unable to find any conclusive evidence that one is better than the other, but we cannot overlook Wei Dai's choices here and decided to follow suit with him rather than OpenSSL.
</p>
<div class="toc">
	<ul>
		<li><a href="#intro">Introduction</a></li>
		<li><a href="#trust">Trust/Underlying Methods</a></li>
		<li><a href="#download">Download</a></li>
		<li><a href="#service">Public DH parameter service</a></li>
		<li><a href="#dhtool">The dhtool utility</a></li>
	</ul>
</div>
<h1 id="trust">Trust/Underlying Methods</h1>
<p>
	Letting someone else generate any parameters for your own Diffie-Hellman encryption process certainly does introduce the possibility of malicious/intentionally bad Diffie-Hellman moduli. All of the <strong>dhtool</strong> relevant code sections are readily available to peruse, review and verify. Specifically, <strong>dhtool</strong> first finds a suitable prime q without extensive prime number verification, and then performs quick checks of its 2q+1 would-be safe prime counterpart. If both numbers appear to be prime without exhaustive verification, then exhaustive verification commences and each of q and 2q+1 are both subjected to 192 rounds of Miller-Rabin primality testing. While the Handbook of Applied Cryptography states specifically that all we are really doing is increasing the running time required in this final stage, we feel that the extra rounds of Miller-Rabin testing are worth it for semi-static DH parameters. Considering we don't wish to run actual proof tests on each of the generated parameters, HAC states: "Since the error probability of primes can be efficiently brought down to acceptably low levels (see Note 4.49 but note the dependence on t), there appears to be no reason for mandating the use of provable primes over probable primes." Our choice of t=192 is in our opinion "acceptably low level." Once the safe prime and its Sophie Germain counterpart are verified per the aforementioned, we then select our generator. See the introductory paragraphs above for commentary on our choice to ensure that g is a quadratic residue mod p.
</p>
<p>
	We are a registered Australian business, and have no interest in generating malicious numbers. Still, given the nature of how these DH parameters are intended to be used, we encourage you to verify our own outputs as well as to review the code itself as to how we are generating these should you have any doubts. As to why we have chosen to make the service freely available, there is no additional cost to us in providing the service to the public at large versus generating these only for our own use (the generation process runs in constant time regardless of how many/whether anyone actually downloads them).
</p>
<h1 id="download">Download dhtool</h1>
<p>
	The binary and source for <strong>dhtool</strong> is bundled with the <a href="/HeavyThing/">HeavyThing</a> library itself if you are interested in verifying existing <code>dhparam</code> files, or <code>/etc/ssh/moduli</code> files, or generating ones yourself. The download link for our library is in the <a href="#downloadlink">top right</a> of every page on our site, along with the SHA256 sum of the download itself. If you have downloaded the same version and your SHA256 does not match, it has been modified by parties other than ourselves.
</p>
<h1 id="service">The public DH parameter service</h1>
<p>
	We have dedicated 48 CPU cores to the task of continuously generating 2048, 3072, 4096 and 8192 bit DH parameters, and the public service we present here allows access to the most-recent 128 of each. Anyone familiar with generating these safe primes will be well-aware of the long runtimes associated with the larger parameters, which is in part why we feel a public service to do this is useful. A quick and simple example can be seen in-browser: <a href="https://2ton.com.au/dhparam/2048">Click here for the most recent 2048 bit dhparam PEM file</a>. Details of the service options are provided below, but in addition to providing PEM files suitable for use with OpenSSL/OpenVPN, we also present all of the most-recent DH parameters as an OpenSSH compatible moduli file: <a href="https://2ton.com.au/dhparam/2048/ssh">Click here for the most recent OpenSSH moduli file version</a>.
</p>
<p>
	This makes it easy to acquire and update DH parameters via simple command line scripts (<code>curl</code>, <code>wget</code>, etc.) The base url of the service is <code>https://2ton.com.au/dhparam/BITSIZE</code> where BITSIZE is one of 2048, 3072, 4096, 8192. Without specifying any additional options, the URL for a given BITSIZE will return the most-recently-generated DH parameter file (in PEM format suitable for use with OpenSSL/OpenVPN). The service also accepts a trailing <code>/ssh</code> option to produce <code>/etc/ssh/moduli</code> compatible output of ALL of the most-recent 128 DH parameters. If you are interested in accessing a specific index among them, you can also add a trailing <code>/INDEX</code> option to the end of the base URL, where INDEX is a value between 0 and 127 inclusive, 0 being the most-recent, 127 being the least-recent. Depending on the size of the parameters themselves and how many CPU cores we dedicated to generating each size determines the update frequency (and thus how old the least-recent one is). At the time of this writing, we have dedicated 1 CPU core to 2048 bit parameters, 3 CPU cores to 3072 bit parameters, 8 CPU cores to 4096 bit parameters, and 36 CPU cores to 8192 bit parameters. As a result, the average span of 2048 bit parameters (most-recent to least-recent time span) is approximately 3 hours. If you grab the <code>/ssh</code> version, that includes UTC timestamps at the beginning of each line in descending order so you can get an idea of the actual age and update frequencies that we are generating. The 8192 bit paramaters OTOH are considerably more expensive to generate, and the average generation time is somewhere around every 30 minutes. Specific command line examples follow:
</p>
<div class="codehilite"><pre><span class="go"># to acquire the latest 2048 bit dhparam:</span>
<span class="gp">$</span> curl https://2ton.com.au/dhparam/2048
<span class="go"># similarly for other bit sizes</span>
<span class="gp">$</span> curl https://2ton.com.au/dhparam/3072
<span class="gp">$</span> curl https://2ton.com.au/dhparam/4096
<span class="gp">$</span> curl https://2ton.com.au/dhparam/8192
<span class="go"># To acquire the 4th most recent 2048 bit dhparam:</span>
<span class="gp">$</span> curl https://2ton.com.au/dhparam/2048/3
<span class="go"># To acquire the latest 4096 bit /etc/ssh/moduli file:</span>
<span class="gp">$</span> curl https://2ton.com.au/dhparam/4096/ssh
</pre></div>
<h1 id="dhtool">dhtool Utility</h1>
<p>
	The service described above is fed by an indefinite <code>bash while:;</code> loop that runs our own <strong>dhtool</strong> program to generate DH parameters. This can be used to generate and verify standard <code>dhparam</code> PEM files, as well as convert a DH PEM file to an <code>/etc/ssh/moduli</code> compatible line, as well as verify the contents of an entire <code>/etc/ssh/moduli</code> file. Usage examples follow.
</p>
<h2 id="usage">Usage and options</h2>
<div class="codehilite"><pre><span class="gp">$</span> ./dhtool
<span class="go">Usage:</span>
<span class="go">To create a new DH parameter file (similar to openssl dhparam):</span>
<span class="go">./dhtool [-XX] SIZE</span>
<span class="go">Where SIZE is size in bits of the safe prime you want, XX specifies how many cores to use</span>

<span class="go">To verify an existing dhparam file, -or- an OpenSSH moduli file:</span>
<span class="go">./dhtool filename</span>

<span class="go">To convert an existing dhparam file to an OpenSSH moduli compatible line:</span>
<span class="go">./dhtool -convert filename</span>
</pre></div>
<h2 id="createnew">Creating new DH parameters</h2>
<div class="codehilite"><pre><span class="go">./dhtool [-XX] SIZE</span>
</pre></div>
<p>
	By default, <strong>dhtool</strong> will use all available CPU cores. The <code>-XX</code> can be used to limit this to lower numbers, and sanity checks are performed on the value that is passed. While our public service only accepts 2048, 3072, 4096, and 8192 bit sizes, <strong>dhtool</strong> can be used to produce any bit size you want. Please note however that if you want to generate HUGE DH parameters, you will need to adjust the <code>bigint_maxwords</code> setting and recompile dhtool.
</p>
<h2 id="verifyone">Verifying an existing DH parameter file or SSH moduli</h2>
<div class="codehilite"><pre><span class="go">./dhtool filename</span>
</pre></div>
<p>
	By passing <strong>dhtool</strong> a filename, either a DH parameter file in PKCS#3 PEM format, or an <code>/etc/ssh/moduli</code> file, <strong>dhtool</strong> will perform rigorous verification of the safe prime, its Sophie Germain counterpart, as well as determine whether the generator(s) are quadratic residues mod p, and if not, presents an alternative that is. (You'll note that with all OpenSSL generated DH parameters, our verifier will state such and provide an alternative generator).
</p>
<h2 id="convertssh">Converting a PEM file to SSH compatible moduli line</h2>
<div class="codehilite"><pre><span class="go">./dhtool -convert filename</span>
</pre></div>
<p>
	By passing <strong>dhtool</strong> a PEM filename with the <code>-convert</code> option, it will convert the PEM format to a line suitable for inclusion in an <code>/etc/ssh/moduli</code> file. Please note that in doing so, all fields except the Time, Generator, and Modulus are hard coded.
</p>

					</div>
				</article>
			</div>
		</div>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
		<script src="//2ton.com.au/luffy.js" async=""></script>
		<footer>
			<div>
				<h3>External Goodies:</h3>
				<ul>
					<li><a href="https://flatassembler.net/">flat assembler</a></li>
					<li><a href="http://www.agner.org/optimize/">All Hail Agner Fog's Bibles</a></li>
					<li><a href="http://www.cryptopp.com/">Crypto++</a></li>
					<li><a href="http://www.intel.com/content/www/us/en/processors/architectures-software-developer-manuals.html">Intel x86_64 docs</a></li>
				</ul>
			</div>
			<address class="vcard author">© 2015-2019
				<a class="fn email" href="mailto:admin@2ton.com.au">2 Ton Digital</a>
			</address>
		</footer>
	

<div id="lfb-overlay" style="display: none;"></div><div id="lfb-center" style="display: none;"><div id="lfb-close" class="lf-sprite-slimbox-close"></div><div id="lfb-image"><div style="position: relative;"><a id="lfb-prevlink" href="#"><span id="lfb-prevlink-ico" class="lf-sprite-slimbox-left"></span></a><a id="lfb-nextlink" href="#"><span id="lfb-nextlink-ico" class="lf-sprite-slimbox-right"></span></a></div></div></div></body></html>