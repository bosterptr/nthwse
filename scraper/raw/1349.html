<html lang="en-US" class="js_active vc_desktop vc_transform vc_transform vc_transform wf-opensans-n3-active wf-opensans-n4-active wf-opensans-n6-active wf-opensans-n7-active wf-opensans-n8-active wf-opensans-i3-active wf-opensans-i4-active wf-opensans-i6-active wf-opensans-i7-active wf-opensans-i8-active wf-montserrat-n4-active wf-montserrat-n7-active wf-adamina-n4-active wf-active"><head>
<link rel="shortcut icon" href="https://azeria-labs.com/favicon.ico">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Heap Exploitation Part 1: Understanding the Glibc Heap Implementation |  Azeria Labs</title>
<link href="https://fonts.googleapis.com/css?family=Orbitron" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
<!-- Mobile Specific Metas & Favicons -->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, user-scalable=1"><!-- WordPress Stuff -->
                        <script type="text/javascript" async="" src="https://www.googletagmanager.com/gtag/js?id=G-PFZX4BN7JZ&amp;cx=c&amp;_slc=1"></script><script async="" src="https://www.google-analytics.com/analytics.js"></script><script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.3/webfont.js" type="text/javascript" async=""></script><script>
                            /* You can add more configuration options to webfontloader by previously defining the WebFontConfig with your options */
                            if ( typeof WebFontConfig === "undefined" ) {
                                WebFontConfig = new Object();
                            }
                            WebFontConfig['google'] = {families: ['Open+Sans:300,400,600,700,800,300italic,400italic,600italic,700italic,800italic', 'Montserrat:400,700', 'Adamina:400&amp;subset=latin']};

                            (function() {
                                var wf = document.createElement( 'script' );
                                wf.src = 'https://ajax.googleapis.com/ajax/libs/webfont/1.5.3/webfont.js';
                                wf.type = 'text/javascript';
                                wf.async = 'true';
                                var s = document.getElementsByTagName( 'script' )[0];
                                s.parentNode.insertBefore( wf, s );
                            })();
                        </script>
                        <meta name="robots" content="max-image-preview:large">
<link rel="alternate" type="application/rss+xml" title="Azeria Labs » Feed" href="https://azeria-labs.com/feed/">
<link rel="alternate" type="application/rss+xml" title="Azeria Labs » Comments Feed" href="https://azeria-labs.com/comments/feed/">
<meta property="og:title" content="Heap Exploitation Part 1: Understanding the Glibc Heap Implementation"><meta property="og:type" content="article"><meta property="og:url" content="https://azeria-labs.com/heap-exploitation-part-1-understanding-the-glibc-heap-implementation/"><meta property="og:site_name" content="Azeria-Labs"><meta property="og:image" content="https://azeria-labs.com/promo.png"><script type="text/javascript">
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/azeria-labs.com\/wp-includes\/js\/wp-emoji-release.min.js"}};
/*! This file is auto-generated */
!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){p.clearRect(0,0,i.width,i.height),p.fillText(e,0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(t,0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(p&&p.fillText)switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s("\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!s("\ud83c\uddfa\ud83c\uddf3","\ud83c\uddfa\u200b\ud83c\uddf3")&&!s("\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!s("\ud83e\udef1\ud83c\udffb\u200d\ud83e\udef2\ud83c\udfff","\ud83e\udef1\ud83c\udffb\u200b\ud83e\udef2\ud83c\udfff")}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(e=t.source||{}).concatemoji?c(e.concatemoji):e.wpemoji&&e.twemoji&&(c(e.twemoji),c(e.wpemoji)))}(window,document,window._wpemojiSettings);
</script>
<style type="text/css">img.wp-smiley,img.emoji{display:inline!important;border:none!important;box-shadow:none!important;height:1em!important;width:1em!important;margin:0 .07em!important;vertical-align:-.1em!important;background:none!important;padding:0!important}</style>
	<link rel="stylesheet" id="wp-block-library-css" href="https://azeria-labs.com/wp-includes/css/dist/block-library/A.style.min.css.pagespeed.cf.1qpRdvAQUt.css" type="text/css" media="all">
<link rel="stylesheet" id="classic-theme-styles-css" href="https://azeria-labs.com/wp-includes/css/A.classic-themes.min.css.pagespeed.cf.ILQxq27NYr.css" type="text/css" media="all">
<style id="global-styles-inline-css" type="text/css">body{--wp--preset--color--black:#000;--wp--preset--color--cyan-bluish-gray:#abb8c3;--wp--preset--color--white:#fff;--wp--preset--color--pale-pink:#f78da7;--wp--preset--color--vivid-red:#cf2e2e;--wp--preset--color--luminous-vivid-orange:#ff6900;--wp--preset--color--luminous-vivid-amber:#fcb900;--wp--preset--color--light-green-cyan:#7bdcb5;--wp--preset--color--vivid-green-cyan:#00d084;--wp--preset--color--pale-cyan-blue:#8ed1fc;--wp--preset--color--vivid-cyan-blue:#0693e3;--wp--preset--color--vivid-purple:#9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple:linear-gradient(135deg,rgba(6,147,227,1) 0%,#9b51e0 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan:linear-gradient(135deg,#7adcb4 0%,#00d082 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange:linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red:linear-gradient(135deg,rgba(255,105,0,1) 0%,#cf2e2e 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray:linear-gradient(135deg,#eee 0%,#a9b8c3 100%);--wp--preset--gradient--cool-to-warm-spectrum:linear-gradient(135deg,#4aeadc 0%,#9778d1 20%,#cf2aba 40%,#ee2c82 60%,#fb6962 80%,#fef84c 100%);--wp--preset--gradient--blush-light-purple:linear-gradient(135deg,#ffceec 0%,#9896f0 100%);--wp--preset--gradient--blush-bordeaux:linear-gradient(135deg,#fecda5 0%,#fe2d2d 50%,#6b003e 100%);--wp--preset--gradient--luminous-dusk:linear-gradient(135deg,#ffcb70 0%,#c751c0 50%,#4158d0 100%);--wp--preset--gradient--pale-ocean:linear-gradient(135deg,#fff5cb 0%,#b6e3d4 50%,#33a7b5 100%);--wp--preset--gradient--electric-grass:linear-gradient(135deg,#caf880 0%,#71ce7e 100%);--wp--preset--gradient--midnight:linear-gradient(135deg,#020381 0%,#2874fc 100%);--wp--preset--duotone--dark-grayscale:url(#wp-duotone-dark-grayscale);--wp--preset--duotone--grayscale:url(#wp-duotone-grayscale);--wp--preset--duotone--purple-yellow:url(#wp-duotone-purple-yellow);--wp--preset--duotone--blue-red:url(#wp-duotone-blue-red);--wp--preset--duotone--midnight:url(#wp-duotone-midnight);--wp--preset--duotone--magenta-yellow:url(#wp-duotone-magenta-yellow);--wp--preset--duotone--purple-green:url(#wp-duotone-purple-green);--wp--preset--duotone--blue-orange:url(#wp-duotone-blue-orange);--wp--preset--font-size--small:13px;--wp--preset--font-size--medium:20px;--wp--preset--font-size--large:36px;--wp--preset--font-size--x-large:42px;--wp--preset--spacing--20:.44rem;--wp--preset--spacing--30:.67rem;--wp--preset--spacing--40:1rem;--wp--preset--spacing--50:1.5rem;--wp--preset--spacing--60:2.25rem;--wp--preset--spacing--70:3.38rem;--wp--preset--spacing--80:5.06rem;--wp--preset--shadow--natural:6px 6px 9px rgba(0,0,0,.2);--wp--preset--shadow--deep:12px 12px 50px rgba(0,0,0,.4);--wp--preset--shadow--sharp:6px 6px 0 rgba(0,0,0,.2);--wp--preset--shadow--outlined:6px 6px 0 -3px rgba(255,255,255,1) , 6px 6px rgba(0,0,0,1);--wp--preset--shadow--crisp:6px 6px 0 rgba(0,0,0,1)}:where(.is-layout-flex){gap:.5em}body .is-layout-flow>.alignleft{float:left;margin-inline-start:0;margin-inline-end:2em}body .is-layout-flow>.alignright{float:right;margin-inline-start:2em;margin-inline-end:0}body .is-layout-flow>.aligncenter{margin-left:auto!important;margin-right:auto!important}body .is-layout-constrained>.alignleft{float:left;margin-inline-start:0;margin-inline-end:2em}body .is-layout-constrained>.alignright{float:right;margin-inline-start:2em;margin-inline-end:0}body .is-layout-constrained>.aligncenter{margin-left:auto!important;margin-right:auto!important}body .is-layout-constrained > :where(:not(.alignleft):not(.alignright):not(.alignfull)){max-width:var(--wp--style--global--content-size);margin-left:auto!important;margin-right:auto!important}body .is-layout-constrained>.alignwide{max-width:var(--wp--style--global--wide-size)}body .is-layout-flex{display:flex}body .is-layout-flex{flex-wrap:wrap;align-items:center}body .is-layout-flex>*{margin:0}:where(.wp-block-columns.is-layout-flex){gap:2em}.has-black-color{color:var(--wp--preset--color--black)!important}.has-cyan-bluish-gray-color{color:var(--wp--preset--color--cyan-bluish-gray)!important}.has-white-color{color:var(--wp--preset--color--white)!important}.has-pale-pink-color{color:var(--wp--preset--color--pale-pink)!important}.has-vivid-red-color{color:var(--wp--preset--color--vivid-red)!important}.has-luminous-vivid-orange-color{color:var(--wp--preset--color--luminous-vivid-orange)!important}.has-luminous-vivid-amber-color{color:var(--wp--preset--color--luminous-vivid-amber)!important}.has-light-green-cyan-color{color:var(--wp--preset--color--light-green-cyan)!important}.has-vivid-green-cyan-color{color:var(--wp--preset--color--vivid-green-cyan)!important}.has-pale-cyan-blue-color{color:var(--wp--preset--color--pale-cyan-blue)!important}.has-vivid-cyan-blue-color{color:var(--wp--preset--color--vivid-cyan-blue)!important}.has-vivid-purple-color{color:var(--wp--preset--color--vivid-purple)!important}.has-black-background-color{background-color:var(--wp--preset--color--black)!important}.has-cyan-bluish-gray-background-color{background-color:var(--wp--preset--color--cyan-bluish-gray)!important}.has-white-background-color{background-color:var(--wp--preset--color--white)!important}.has-pale-pink-background-color{background-color:var(--wp--preset--color--pale-pink)!important}.has-vivid-red-background-color{background-color:var(--wp--preset--color--vivid-red)!important}.has-luminous-vivid-orange-background-color{background-color:var(--wp--preset--color--luminous-vivid-orange)!important}.has-luminous-vivid-amber-background-color{background-color:var(--wp--preset--color--luminous-vivid-amber)!important}.has-light-green-cyan-background-color{background-color:var(--wp--preset--color--light-green-cyan)!important}.has-vivid-green-cyan-background-color{background-color:var(--wp--preset--color--vivid-green-cyan)!important}.has-pale-cyan-blue-background-color{background-color:var(--wp--preset--color--pale-cyan-blue)!important}.has-vivid-cyan-blue-background-color{background-color:var(--wp--preset--color--vivid-cyan-blue)!important}.has-vivid-purple-background-color{background-color:var(--wp--preset--color--vivid-purple)!important}.has-black-border-color{border-color:var(--wp--preset--color--black)!important}.has-cyan-bluish-gray-border-color{border-color:var(--wp--preset--color--cyan-bluish-gray)!important}.has-white-border-color{border-color:var(--wp--preset--color--white)!important}.has-pale-pink-border-color{border-color:var(--wp--preset--color--pale-pink)!important}.has-vivid-red-border-color{border-color:var(--wp--preset--color--vivid-red)!important}.has-luminous-vivid-orange-border-color{border-color:var(--wp--preset--color--luminous-vivid-orange)!important}.has-luminous-vivid-amber-border-color{border-color:var(--wp--preset--color--luminous-vivid-amber)!important}.has-light-green-cyan-border-color{border-color:var(--wp--preset--color--light-green-cyan)!important}.has-vivid-green-cyan-border-color{border-color:var(--wp--preset--color--vivid-green-cyan)!important}.has-pale-cyan-blue-border-color{border-color:var(--wp--preset--color--pale-cyan-blue)!important}.has-vivid-cyan-blue-border-color{border-color:var(--wp--preset--color--vivid-cyan-blue)!important}.has-vivid-purple-border-color{border-color:var(--wp--preset--color--vivid-purple)!important}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background:var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple)!important}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background:var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan)!important}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background:var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange)!important}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background:var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red)!important}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background:var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray)!important}.has-cool-to-warm-spectrum-gradient-background{background:var(--wp--preset--gradient--cool-to-warm-spectrum)!important}.has-blush-light-purple-gradient-background{background:var(--wp--preset--gradient--blush-light-purple)!important}.has-blush-bordeaux-gradient-background{background:var(--wp--preset--gradient--blush-bordeaux)!important}.has-luminous-dusk-gradient-background{background:var(--wp--preset--gradient--luminous-dusk)!important}.has-pale-ocean-gradient-background{background:var(--wp--preset--gradient--pale-ocean)!important}.has-electric-grass-gradient-background{background:var(--wp--preset--gradient--electric-grass)!important}.has-midnight-gradient-background{background:var(--wp--preset--gradient--midnight)!important}.has-small-font-size{font-size:var(--wp--preset--font-size--small)!important}.has-medium-font-size{font-size:var(--wp--preset--font-size--medium)!important}.has-large-font-size{font-size:var(--wp--preset--font-size--large)!important}.has-x-large-font-size{font-size:var(--wp--preset--font-size--x-large)!important}.wp-block-navigation a:where(:not(.wp-element-button)){color:inherit}:where(.wp-block-columns.is-layout-flex){gap:2em}.wp-block-pullquote{font-size:1.5em;line-height:1.6}</style>
<link rel="stylesheet" id="contact-form-7-css" href="https://azeria-labs.com/wp-content/plugins/contact-form-7/includes/css/A.styles.css.pagespeed.cf.BWVnRDAE9I.css" type="text/css" media="all">
<link rel="stylesheet" id="stylesheet-css" href="https://azeria-labs.com/wp-content/themes/unicon/style.css" type="text/css" media="all">
<link rel="stylesheet" id="js_composer_front-css" href="https://azeria-labs.com/wp-content/plugins/js_composer/assets/css/js_composer.min.css" type="text/css" media="all">
<link rel="stylesheet" id="shortcodes-css" href="https://azeria-labs.com/wp-content/themes/unicon/framework/css/shortcodes.css" type="text/css" media="all">
<link rel="stylesheet" id="responsive-css" href="https://azeria-labs.com/wp-content/themes/unicon/framework/css/A.responsive.css.pagespeed.cf.OD-Zu4XGUf.css" type="text/css" media="all">
<script type="text/javascript" src="https://azeria-labs.com/wp-includes/js/jquery/jquery.min.js.pagespeed.ce.DoUKabx_0K.js" id="jquery-core-js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800,300italic,400italic,600italic,700italic,800italic%7CMontserrat:400,700%7CAdamina:400&amp;amp;subset=latin"><script type="text/javascript" src="https://azeria-labs.com/wp-includes/js/jquery/jquery-migrate.min.js.pagespeed.ce.XPorSB3m6H.js" id="jquery-migrate-js"></script>
<link rel="https://api.w.org/" href="https://azeria-labs.com/wp-json/"><link rel="alternate" type="application/json" href="https://azeria-labs.com/wp-json/wp/v2/pages/17698"><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://azeria-labs.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://azeria-labs.com/wp-includes/wlwmanifest.xml">
<link rel="canonical" href="https://azeria-labs.com/heap-exploitation-part-1-understanding-the-glibc-heap-implementation/">
<link rel="shortlink" href="https://azeria-labs.com/?p=17698">
<link rel="alternate" type="application/json+oembed" href="https://azeria-labs.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fazeria-labs.com%2Fheap-exploitation-part-1-understanding-the-glibc-heap-implementation%2F">
<link rel="alternate" type="text/xml+oembed" href="https://azeria-labs.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fazeria-labs.com%2Fheap-exploitation-part-1-understanding-the-glibc-heap-implementation%2F&amp;format=xml">
<style type="text/css">body{font:400 13px Open\ Sans,Arial,Helvetica,sans-serif;color:#fff;line-height:1.9}.wrapall,.boxed-layout{background-color:#353535}body.page-template-page-blank-php{background:#353535!important}h1{font:400 28px Adamina,Arial,Helvetica,sans-serif;color:#1cbac8}h2{font:400 24px Adamina,Arial,Helvetica,sans-serif;color:#1cbac8}h3{font:400 20px Adamina,Arial,Helvetica,sans-serif;color:#1cbac8}h4{font:400 16px Adamina,Arial,Helvetica,sans-serif;color:#1cbac8}h5{font:400 16px Adamina,Arial,Helvetica,sans-serif;color:#1cbac8}h6{font:400 16px Adamina,Arial,Helvetica,sans-serif;color:#1cbac8}.title{font-family:'Adamina',Arial,Helvetica,sans-serif}h1 a,h2 a,h3 a,h4 a,h5 a,h6 a{font-weight:inherit;color:inherit}h1 a:hover,h2 a:hover,h3 a:hover,h4 a:hover,h5 a:hover,h6 a:hover,a:hover h1,a:hover h2,a:hover h3,a:hover h4,a:hover h5,a:hover h6{color:#fff}a{color:#1cbac8}a:hover{color:#fff}input[type="text"],input[type="password"],input[type="email"],input[type="tel"],textarea,select{font-family:Open\ Sans,Arial,Helvetica,sans-serif;font-size:13px}#sidebar .widget h3{font:14px Montserrat,Arial,Helvetica,sans-serif;color:#1cbac8}.container .twelve.alt.sidebar-right,.container .twelve.alt.sidebar-left,#sidebar.sidebar-right #sidebar-widgets,#sidebar.sidebar-left #sidebar-widgets{border-color:#efefef}#topbar{background:#f5f5f5;color:#777}#topbar a{color:#999}#topbar a:hover{color:#333}@media only screen and (max-width:767px){#topbar .topbar-col1{background:#f5f5f5}}#navigation>ul>li>a{font:13px Montserrat,Arial,Helvetica,sans-serif;color:#fff}#navigation>ul>li:hover>a,#navigation>ul>li>a:hover{color:#1cbac8}#navigation li.current-menu-item>a:hover,#navigation li.current-page-ancestor>a:hover,#navigation li.current-menu-ancestor>a:hover,#navigation li.current-menu-parent>a:hover,#navigation li.current_page_ancestor>a:hover,#navigation>ul>li.sfHover>a{color:#1cbac8}#navigation li.current-menu-item>a,#navigation li.current-page-ancestor>a,#navigation li.current-menu-ancestor>a,#navigation li.current-menu-parent>a,#navigation li.current_page_ancestor>a{color:#ff5b5b}#navigation ul li:hover{border-color:#1cbac8}#navigation li.current-menu-item,#navigation li.current-page-ancestor,#navigation li.current-menu-ancestor,#navigation li.current-menu-parent,#navigation li.current_page_ancestor{border-color:#ff5b5b}#navigation .sub-menu{background:#262626}#navigation .sub-menu li a{font:13px Open\ Sans,Arial,Helvetica,sans-serif;color:#fff}#navigation .sub-menu li a:hover{color:#1b90c6}#navigation .sub-menu li.current_page_item>a,#navigation .sub-menu li.current_page_item>a:hover,#navigation .sub-menu li.current-menu-item>a,#navigation .sub-menu li.current-menu-item>a:hover,#navigation .sub-menu li.current-page-ancestor>a,#navigation .sub-menu li.current-page-ancestor>a:hover,#navigation .sub-menu li.current-menu-ancestor>a,#navigation .sub-menu li.current-menu-ancestor>a:hover,#navigation .sub-menu li.current-menu-parent>a,#navigation .sub-menu li.current-menu-parent>a:hover,#navigation .sub-menu li.current_page_ancestor>a,#navigation .sub-menu li.current_page_ancestor>a:hover{color:#1b90c6}#navigation .sub-menu li a,#navigation .sub-menu ul li a{border-color:#333}#navigation>ul>li.megamenu>ul.sub-menu{background:#262626;border-color:#1cbac8}#navigation>ul>li.megamenu>ul>li{border-right-color:#333!important}#navigation>ul>li.megamenu ul li a{color:#fff}#navigation>ul>li.megamenu>ul>li>a{color:#ff5b5b}#navigation>ul>li.megamenu>ul ul li a:hover,#header #navigation>ul>li.megamenu>ul ul li.current-menu-item a{color:#1b90c6!important;background-color:#333!important}#search-btn,#shopping-btn,#close-search-btn{color:#ff5b5b}#search-btn:hover,#shopping-btn:hover,#close-search-btn:hover{color:#ff5b5b}#slogan{font:20px Open\ Sans,Arial,Helvetica,sans-serif;color:#777;margin-top:26px}#mobile-navigation{background:#262626}#mobile-navigation ul li a{font:13px Open\ Sans,Arial,Helvetica,sans-serif;color:#fff;border-bottom-color:#333!important}#mobile-navigation ul li a:hover,#mobile-navigation ul li a:hover [class^="fa-"],#mobile-navigation li.open>a,#mobile-navigation ul li.current-menu-item>a,#mobile-navigation ul li.current-menu-ancestor>a{color:#1b90c6}body #mobile-navigation li.open>a [class^="fa-"]{color:#1b90c6}#mobile-navigation form,#mobile-navigation form input{background:#444;color:#1cbac8}#mobile-navigation form:before{color:#1cbac8}#mobile-header{background:#353535;height:90px}#mobile-navigation-btn,#mobile-cart-btn,#mobile-shopping-btn{color:#ff5b5b;line-height:90px}#mobile-navigation-btn:hover,#mobile-cart-btn:hover,#mobile-shopping-btn:hover{color:#ff5b5b}#mobile-header .logo{margin-top:0}#header.header-v1{height:90px;background:#353535}.header-v1 .logo{margin-top:0}.header-v1 #navigation>ul>li{height:90px;padding-top:65px}.header-v1 #navigation .sub-menu{top:90px}.header-v1 .header-icons-divider{line-height:90px;background:#6fbfc6}#header.header-v1 .widget_shopping_cart{top:90px}.header-v1 #search-btn,.header-v1 #close-search-btn,.header-v1 #shopping-btn{line-height:90px}.header-v1 #search-top,.header-v1 #search-top input{height:90px}.header-v1 #search-top input{color:#1cbac8;font-family:Open\ Sans,Arial,Helvetica,sans-serif}#header.header-v3{background:#353535}.header-v3 .navigation-wrap{background:#353535;border-top:1px solid #6fbfc6}.header-v3 .logo{margin-top:30px;margin-bottom:30px}#header.header-v4{background:#353535}.header-v4 .navigation-wrap{background:#353535;border-top:1px solid #6fbfc6}.header-v4 .logo{margin-top:30px;margin-bottom:30px}#transparentimage{padding:90px 0 0 0}.header-is-transparent #mobile-navigation{top:90px}.stuck{background:#353535}.titlebar h1{font:22px Open\ Sans,Arial,Helvetica,sans-serif;color:#777}#fulltitle{background:#f9f9f9;border-bottom:1px solid #efefef}#breadcrumbs{margin-top:6px}#breadcrumbs,#breadcrumbs a{font:13px Open\ Sans,Arial,Helvetica,sans-serif;color:#aaa}#breadcrumbs a:hover{color:#666}#fullimagecenter h1,#transparentimage h1{font:42px Montserrat,Arial,Helvetica,sans-serif;color:#fff;text-transform:uppercase;letter-spacing:1px;text-align:center}#footer .widget h3{font:13px Montserrat,Arial,Helvetica,sans-serif;color:#fff}#footer{color:#1cbac8;border-top:4px none #1cbac8}#footer{background-color:#262626}#footer a,#footer .widget ul li:after{color:#fff}#footer a:hover,#footer .widget ul li:hover:after{color:#fff}#footer .widget ul li{border-bottom-color:#333}#copyright{background:#1b1b1b;color:#1cbac8}#copyright a{color:#fff}#copyright a:hover{color:#1cbac8}.highlight{color:#1cbac8!important}::selection{background:#1cbac8}::-moz-selection{background:#1cbac8}#shopping-btn span{background:#1cbac8}.blog-page .post h1 a:hover,.blog-page .post h2 a:hover{color:#1cbac8}.entry-image .entry-overlay{background:#1cbac8}.entry-quote a:hover{background:#1cbac8}.entry-link a:hover{background:#1cbac8}.blog-single .entry-tags a:hover{color:#1cbac8}.sharebox ul li a:hover{color:#1cbac8}#pagination .current a{background:#1cbac8}#filters ul li a:hover{color:#1cbac8}#filters ul li a.active{color:#1cbac8}#back-to-top a:hover{background-color:#1cbac8}#sidebar .widget ul li a:hover{color:#1cbac8}#sidebar .widget ul li:hover:after{color:#1cbac8}.widget_tag_cloud a:hover,.widget_product_tag_cloud a:hover{background:#1cbac8;border-color:#1cbac8}.widget_portfolio .portfolio-widget-item .portfolio-overlay{background:#1cbac8}#sidebar .widget_nav_menu ul li a:hover{color:#1cbac8}#footer .widget_tag_cloud a:hover,#footer .widget_product_tag_cloud a:hover{background:#1cbac8;border-color:#1cbac8}.box.style-2{border-top-color:#1cbac8}.box.style-4{border-color:#1cbac8}.box.style-6{background:#1cbac8}a.button,input[type="submit"],button,.minti_button{background:#1cbac8;border-color:#1cbac8}a.button.color-2{color:#1cbac8;border-color:#1cbac8}a.button.color-3{background:#1cbac8;border-color:#1cbac8}a.button.color-9{color:#1cbac8}a.button.color-6:hover{background:#1cbac8;border-color:#1cbac8}a.button.color-7:hover{background:#1cbac8;border-color:#1cbac8}.counter-number{color:#1cbac8}.divider-title.align-center:after,.divider-title.align-left:after{background-color:#1cbac8}.divider5{border-bottom-color:#1cbac8}.dropcap.dropcap-circle{background-color:#1cbac8}.dropcap.dropcap-box{background-color:#1cbac8}.dropcap.dropcap-color{color:#1cbac8}.toggle .toggle-title.active,.color-light .toggle .toggle-title.active{background:#1cbac8;border-color:#1cbac8}.iconbox-style-1.icon-color-accent i.boxicon,.iconbox-style-2.icon-color-accent i.boxicon,.iconbox-style-3.icon-color-accent i.boxicon,.iconbox-style-8.icon-color-accent i.boxicon,.iconbox-style-9.icon-color-accent i.boxicon{color:#1cbac8!important}.iconbox-style-4.icon-color-accent i.boxicon,.iconbox-style-5.icon-color-accent i.boxicon,.iconbox-style-6.icon-color-accent i.boxicon,.iconbox-style-7.icon-color-accent i.boxicon,.flip .icon-color-accent.card .back{background:#1cbac8}.latest-blog .blog-item .blog-overlay{background:#1cbac8}.latest-blog .blog-item .blog-pic i{color:#1cbac8}.latest-blog .blog-item h4 a:hover{color:#1cbac8}.progressbar .progress-percentage{background:#1cbac8}.wpb_widgetised_column .widget ul li a:hover{color:#1cbac8}.wpb_widgetised_column .widget ul li:hover:after{color:#1cbac8}.wpb_accordion .wpb_accordion_wrapper .ui-state-active .ui-icon{background-color:#1cbac8}.wpb_accordion .wpb_accordion_wrapper .ui-state-active.wpb_accordion_header a{color:#1cbac8}.wpb_accordion .wpb_accordion_wrapper .wpb_accordion_header a:hover,.wpb_accordion .wpb_accordion_wrapper .wpb_accordion_header a:hover .ui-state-default .ui-icon{color:#1cbac8}.wpb_accordion .wpb_accordion_wrapper .wpb_accordion_header:hover .ui-icon{background-color:#1cbac8!important}.wpb_content_element.wpb_tabs .wpb_tabs_nav li.ui-tabs-active{border-bottom-color:#1cbac8}.portfolio-item h4 a:hover{color:#1cbac8}.portfolio-filters ul li a:hover{color:#1cbac8}.portfolio-filters ul li a.active{color:#1cbac8}.portfolio-overlay-icon .portfolio-overlay{background:#1cbac8}.portfolio-overlay-icon i{color:#1cbac8}.portfolio-overlay-effect .portfolio-overlay{background:#1cbac8}.portfolio-overlay-name .portfolio-overlay{background:#1cbac8}.portfolio-detail-attributes ul li a:hover{color:#1cbac8}a.catimage:hover .catimage-text{background:#1cbac8}.products li h3{font:400 13px Open\ Sans,Arial,Helvetica,sans-serif;color:#fff}.woocommerce .button.checkout-button{background:#1cbac8;border-color:#1cbac8}.woocommerce .products .onsale{background:#1cbac8}.product .onsale{background:#1cbac8}button.single_add_to_cart_button:hover{background:#1cbac8}.woocommerce-tabs>ul>li.active a{color:#1cbac8;border-bottom-color:#1cbac8}p.stars a:hover{background:#1cbac8}p.stars a.active,p.stars a.active:after{background:#1cbac8}.product_list_widget a{color:#1cbac8}.woocommerce .widget_layered_nav li.chosen a{color:#1cbac8!important}.woocommerce .widget_product_categories>ul>li.current-cat>a{color:#1cbac8!important}.woocommerce .widget_product_categories>ul>li.current-cat:after{color:#1cbac8!important}.woocommerce-message{background:#1cbac8}.bbp-topics-front ul.super-sticky .bbp-topic-title:before,.bbp-topics ul.super-sticky .bbp-topic-title:before,.bbp-topics ul.sticky .bbp-topic-title:before,.bbp-forum-content ul.sticky .bbp-topic-title:before{color:#1cbac8!important}#subscription-toggle a:hover{background:#1cbac8}.bbp-pagination-links span.current{background:#1cbac8}div.wpcf7-mail-sent-ok,div.wpcf7-mail-sent-ng,div.wpcf7-spam-blocked,div.wpcf7-validation-errors{background:#1cbac8}.wpcf7-not-valid{border-color:#1cbac8!important}.products .button.add_to_cart_button{color:#1cbac8!important}.minti_list.color-accent li:before{color:#1cbac8!important}.blogslider_text .post-categories li a{background-color:#1cbac8}.minti_zooming_slider .flex-control-nav li .minti_zooming_slider_ghost{background-color:#1cbac8}.minti_carousel.pagination_numbers .owl-dots .owl-dot.active{background-color:#1cbac8}.wpb_content_element.wpb_tour .wpb_tabs_nav li.ui-tabs-active,.color-light .wpb_content_element.wpb_tour .wpb_tabs_nav li.ui-tabs-active{background-color:#1cbac8}.masonry_icon i{color:#1cbac8}.font-special,.button,.counter-title,h6,.wpb_accordion .wpb_accordion_wrapper .wpb_accordion_header a,.pricing-plan .pricing-plan-head h3,a.catimage,.divider-title,button,input[type="submit"],input[type="reset"],input[type="button"],.vc_pie_chart h4,.page-404 h3,.minti_masonrygrid_item h4{font-family:'Montserrat',Arial,Helvetica,sans-serif}.ui-helper-reset{line-height:1.9}.blog-page .post div.entry-wrap div.entry-title h1 a,.blog-page .post div.entry-wrap div.entry-title h2 a,.entry-meta ul li a,#sidebar .widget.widget_recent_entries ul li a,#sidebar .widget.widget_categories ul li a{color:#fff}.blog-page .post div.entry-wrap div.entry-title h1 a:hover,.blog-page .post div.entry-wrap div.entry-title h2 a:hover,.entry-meta ul li a:hover,.entry-meta ul li,#sidebar .widget.widget_recent_entries ul li a:hover,#sidebar .widget.widget_categories ul li a:hover{color:#1cbac8}#header,#mobile-header{border-bottom:1px solid #fff}@media only screen and (max-width:959px){#header,.sticky-wrapper{display:none}#mobile-header{display:inherit}}</style><meta name="generator" content="Powered by WPBakery Page Builder - drag and drop page builder for WordPress.">
<style type="text/css" data-type="vc_custom-css">.wpb_wrapper p,.wpb_wrapper ul>li{text-align:justify}.wpb_wrapper p.wp-caption-text{text-align:center;color:#1cbac8;font-weight:bold}</style><noscript><style>.wpb_animate_when_almost_visible{opacity:1}</style></noscript><style id="fit-vids-style">.fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}</style></head>

<body class="page-template-default page page-id-17698 smooth-scroll wpb-js-composer js-comp-ver-6.9.0 vc_responsive">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-99769710-1', 'auto');
  ga('send', 'pageview');

</script>
	<div class="site-wrapper wrapall">

	<header id="header" class="header header-v3 clearfix">
		
	<div class="container">
		<div class="sixteen columns">

			<div id="logo" class="logo">
									<a href="https://azeria-labs.com/"><img src="https://azeria-labs.com/wp-content/uploads/2017/08/azeria-labs-11.png.pagespeed.ce.Mn8gsglYk_.png" alt="Azeria Labs" class="logo_standard"></a>
					<a href="https://azeria-labs.com/"><img src="https://azeria-labs.com/wp-content/uploads/2017/08/azeria-labs-11.png.pagespeed.ce.Mn8gsglYk_.png" width="378" height="110" alt="Azeria Labs" class="logo_retina"></a>							</div>

			<div id="slogan" class="clearfix">
							</div>

		</div>
	</div>
	
	<div class="navigation-wrap">
		<div class="container">
			<div class="sixteen columns">
				
				<div id="navigation" class="clearfix">
					<ul id="nav" class="menu sf-js-enabled sf-arrows"><li id="menu-item-16543" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-16543"><a href="https://azeria-labs.com/writing-arm-assembly-part-1/" class="sf-with-ul">ARM Assembly</a>
<ul class="sub-menu" style="display: none;">
	<li id="menu-item-16164" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16164"><a href="https://azeria-labs.com/writing-arm-assembly-part-1/">Part 1: Introduction to ARM Assembly</a></li>
	<li id="menu-item-16167" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16167"><a href="https://azeria-labs.com/arm-data-types-and-registers-part-2/">Part 2: ARM Data Types and Registers</a></li>
	<li id="menu-item-16172" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16172"><a href="https://azeria-labs.com/arm-instruction-set-part-3/">Part 3: ARM Instruction Set</a></li>
	<li id="menu-item-16217" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16217"><a href="https://azeria-labs.com/memory-instructions-load-and-store-part-4/">Part 4: Memory Instructions: LDR/STR</a></li>
	<li id="menu-item-16495" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16495"><a href="https://azeria-labs.com/load-and-store-multiple-part-5/">Part 5: Load and Store Multiple</a></li>
	<li id="menu-item-16175" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16175"><a href="https://azeria-labs.com/arm-conditional-execution-and-branching-part-6/">Part 6: Conditional Execution and Branching</a></li>
	<li id="menu-item-16221" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16221"><a href="https://azeria-labs.com/functions-and-the-stack-part-7/">Part 7: Stack and Functions</a></li>
	<li id="menu-item-17135" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17135"><a href="https://azeria-labs.com/assembly-basics-cheatsheet/">Assembly Basics Cheatsheet</a></li>
</ul>
</li>
<li id="menu-item-17846" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17846"><a href="https://azeria-labs.com/azm/">Online Assembler</a></li>
<li id="menu-item-17011" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-ancestor current-menu-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-17011"><a href="https://azeria-labs.com/writing-arm-shellcode/" class="sf-with-ul">Exploitation</a>
<ul class="sub-menu" style="display: none;">
	<li id="menu-item-17012" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17012"><a href="https://azeria-labs.com/writing-arm-shellcode/">Writing ARM Shellcode</a></li>
	<li id="menu-item-17294" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17294"><a href="https://azeria-labs.com/tcp-bind-shell-in-assembly-arm-32-bit/">TCP Bind Shell in Assembly (ARM 32-bit)</a></li>
	<li id="menu-item-17401" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17401"><a href="https://azeria-labs.com/tcp-reverse-shell-in-assembly-arm-32-bit/">TCP Reverse Shell in Assembly (ARM 32-bit)</a></li>
	<li id="menu-item-17071" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17071"><a href="https://azeria-labs.com/process-memory-and-memory-corruption/">Process Memory and Memory Corruption</a></li>
	<li id="menu-item-18087" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-18087"><a href="https://azeria-labs.com/stack-overflow-arm32/">Stack Overflows (Arm32)</a></li>
	<li id="menu-item-18088" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-18088"><a href="https://azeria-labs.com/return-oriented-programming-arm32/">Return Oriented Programming (Arm32)</a></li>
	<li id="menu-item-17212" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17212"><a href="https://azeria-labs.com/part-3-stack-overflow-challenges/">Stack Overflow Challenges</a></li>
	<li id="menu-item-17473" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17473"><a href="https://azeria-labs.com/process-continuation-shellcode/">Process Continuation Shellcode</a></li>
	<li id="menu-item-17774" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-17698 current_page_item menu-item-17774"><a href="https://azeria-labs.com/heap-exploitation-part-1-understanding-the-glibc-heap-implementation/" aria-current="page">Glibc Heap – malloc</a></li>
	<li id="menu-item-17833" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17833"><a href="https://azeria-labs.com/heap-exploitation-part-2-glibc-heap-free-bins/">Glibc Heap – free, bins, tcache</a></li>
	<li id="menu-item-17862" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17862"><a href="https://azeria-labs.com/heap-exploit-development-part-1/">Part 1: Heap Exploit Development</a></li>
	<li id="menu-item-17883" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17883"><a href="https://azeria-labs.com/heap-overflows-and-the-ios-kernel-heap/">Part 2: Heap Overflows and the iOS Kernel</a></li>
	<li id="menu-item-17927" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17927"><a href="https://azeria-labs.com/grooming-the-ios-kernel-heap/">Part 3: Grooming the iOS Kernel Heap</a></li>
</ul>
</li>
<li id="menu-item-16711" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-16711"><a href="https://azeria-labs.com/emulate-raspberry-pi-with-qemu/" class="sf-with-ul">Lab Environment</a>
<ul class="sub-menu" style="display: none;">
	<li id="menu-item-17171" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17171"><a href="https://azeria-labs.com/arm-lab-vm/">ARM Lab VM 1.0</a></li>
	<li id="menu-item-18101" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-18101"><a href="https://azeria-labs.com/lab-vm-2-0/">ARM Lab VM 2.0</a></li>
	<li id="menu-item-16347" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16347"><a href="https://azeria-labs.com/debugging-with-gdb-introduction/">Debugging with GDB and GEF</a></li>
	<li id="menu-item-16064" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16064"><a href="https://azeria-labs.com/emulate-raspberry-pi-with-qemu/">Emulate Raspberry Pi with QEMU</a></li>
	<li id="menu-item-18134" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-18134"><a href="https://azeria-labs.com/arm-on-x86-qemu-user/">Running Arm Binaries on x86 with QEMU-User</a></li>
	<li id="menu-item-18046" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-18046"><a href="https://azeria-labs.com/emulating-arm-firmware/">Emulating Arm Firmware</a></li>
</ul>
</li>
<li id="menu-item-17962" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-17962"><a href="https://azeria-labs.com/trusted-execution-environments-tee-and-trustzone/" class="sf-with-ul">TrustZone Research</a>
<ul class="sub-menu" style="display: none;">
	<li id="menu-item-17963" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17963"><a href="https://azeria-labs.com/trusted-execution-environments-tee-and-trustzone/">TEEs and Arm TrustZone</a></li>
	<li id="menu-item-18019" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-18019"><a href="https://azeria-labs.com/trustonics-kinibi-tee-implementation/">Trustonic’s Kinibi TEE</a></li>
</ul>
</li>
<li id="menu-item-17402" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-17402"><a href="https://azeria-labs.com/the-importance-of-deep-work-the-30-hour-method-for-learning-a-new-skill/" class="sf-with-ul">Self-Improvement</a>
<ul class="sub-menu" style="display: none;">
	<li id="menu-item-17404" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17404"><a href="https://azeria-labs.com/the-importance-of-deep-work-the-30-hour-method-for-learning-a-new-skill/">Deep Work &amp; The 30-Hour Method</a></li>
	<li id="menu-item-17520" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17520"><a href="https://azeria-labs.com/paradox-of-choice/">Paradox of Choice</a></li>
	<li id="menu-item-17676" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17676"><a href="https://azeria-labs.com/the-process-of-mastering-a-skill/">The Process of Mastering a Skill</a></li>
</ul>
</li>
<li id="menu-item-16844" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16844"><a href="https://azeria-labs.com/about/">About</a></li>
</ul>				</div>

				
			</div>
		</div>
	</div>	
	
</header>

<div id="mobile-header">
	<div class="container">
		<div class="sixteen columns">
			<div id="mobile-logo" class="logo">
									<a href="https://azeria-labs.com/"><img src="https://azeria-labs.com/wp-content/uploads/2017/08/azeria-labs-11.png.pagespeed.ce.Mn8gsglYk_.png" alt="Azeria Labs" class="logo_standard"></a>
					<a href="https://azeria-labs.com/"><img src="https://azeria-labs.com/wp-content/uploads/2017/08/azeria-labs-11.png.pagespeed.ce.Mn8gsglYk_.png" width="378" height="110" alt="Azeria Labs" class="logo_retina"></a>							</div>
			<a href="#" id="mobile-navigation-btn"><i class="fa fa-bars"></i></a>
					</div>
	</div>
</div>

<div id="mobile-navigation" style="display: none;">
	<div class="container">
		<div class="sixteen columns">
			<div class="menu-main-container"><ul id="mobile-nav" class="menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-16543 has-ul"><a href="https://azeria-labs.com/writing-arm-assembly-part-1/">ARM Assembly<i class="fa fa-chevron-down"></i></a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16164"><a href="https://azeria-labs.com/writing-arm-assembly-part-1/">Part 1: Introduction to ARM Assembly</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16167"><a href="https://azeria-labs.com/arm-data-types-and-registers-part-2/">Part 2: ARM Data Types and Registers</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16172"><a href="https://azeria-labs.com/arm-instruction-set-part-3/">Part 3: ARM Instruction Set</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16217"><a href="https://azeria-labs.com/memory-instructions-load-and-store-part-4/">Part 4: Memory Instructions: LDR/STR</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16495"><a href="https://azeria-labs.com/load-and-store-multiple-part-5/">Part 5: Load and Store Multiple</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16175"><a href="https://azeria-labs.com/arm-conditional-execution-and-branching-part-6/">Part 6: Conditional Execution and Branching</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16221"><a href="https://azeria-labs.com/functions-and-the-stack-part-7/">Part 7: Stack and Functions</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17135"><a href="https://azeria-labs.com/assembly-basics-cheatsheet/">Assembly Basics Cheatsheet</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17846"><a href="https://azeria-labs.com/azm/">Online Assembler</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page current-menu-ancestor current-menu-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-17011 has-ul"><a href="https://azeria-labs.com/writing-arm-shellcode/">Exploitation<i class="fa fa-chevron-down"></i></a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17012"><a href="https://azeria-labs.com/writing-arm-shellcode/">Writing ARM Shellcode</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17294"><a href="https://azeria-labs.com/tcp-bind-shell-in-assembly-arm-32-bit/">TCP Bind Shell in Assembly (ARM 32-bit)</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17401"><a href="https://azeria-labs.com/tcp-reverse-shell-in-assembly-arm-32-bit/">TCP Reverse Shell in Assembly (ARM 32-bit)</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17071"><a href="https://azeria-labs.com/process-memory-and-memory-corruption/">Process Memory and Memory Corruption</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-18087"><a href="https://azeria-labs.com/stack-overflow-arm32/">Stack Overflows (Arm32)</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-18088"><a href="https://azeria-labs.com/return-oriented-programming-arm32/">Return Oriented Programming (Arm32)</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17212"><a href="https://azeria-labs.com/part-3-stack-overflow-challenges/">Stack Overflow Challenges</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17473"><a href="https://azeria-labs.com/process-continuation-shellcode/">Process Continuation Shellcode</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-17698 current_page_item menu-item-17774"><a href="https://azeria-labs.com/heap-exploitation-part-1-understanding-the-glibc-heap-implementation/" aria-current="page">Glibc Heap – malloc</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17833"><a href="https://azeria-labs.com/heap-exploitation-part-2-glibc-heap-free-bins/">Glibc Heap – free, bins, tcache</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17862"><a href="https://azeria-labs.com/heap-exploit-development-part-1/">Part 1: Heap Exploit Development</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17883"><a href="https://azeria-labs.com/heap-overflows-and-the-ios-kernel-heap/">Part 2: Heap Overflows and the iOS Kernel</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17927"><a href="https://azeria-labs.com/grooming-the-ios-kernel-heap/">Part 3: Grooming the iOS Kernel Heap</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-16711 has-ul"><a href="https://azeria-labs.com/emulate-raspberry-pi-with-qemu/">Lab Environment<i class="fa fa-chevron-down"></i></a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17171"><a href="https://azeria-labs.com/arm-lab-vm/">ARM Lab VM 1.0</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-18101"><a href="https://azeria-labs.com/lab-vm-2-0/">ARM Lab VM 2.0</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16347"><a href="https://azeria-labs.com/debugging-with-gdb-introduction/">Debugging with GDB and GEF</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16064"><a href="https://azeria-labs.com/emulate-raspberry-pi-with-qemu/">Emulate Raspberry Pi with QEMU</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-18134"><a href="https://azeria-labs.com/arm-on-x86-qemu-user/">Running Arm Binaries on x86 with QEMU-User</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-18046"><a href="https://azeria-labs.com/emulating-arm-firmware/">Emulating Arm Firmware</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-17962 has-ul"><a href="https://azeria-labs.com/trusted-execution-environments-tee-and-trustzone/">TrustZone Research<i class="fa fa-chevron-down"></i></a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17963"><a href="https://azeria-labs.com/trusted-execution-environments-tee-and-trustzone/">TEEs and Arm TrustZone</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-18019"><a href="https://azeria-labs.com/trustonics-kinibi-tee-implementation/">Trustonic’s Kinibi TEE</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-17402 has-ul"><a href="https://azeria-labs.com/the-importance-of-deep-work-the-30-hour-method-for-learning-a-new-skill/">Self-Improvement<i class="fa fa-chevron-down"></i></a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17404"><a href="https://azeria-labs.com/the-importance-of-deep-work-the-30-hour-method-for-learning-a-new-skill/">Deep Work &amp; The 30-Hour Method</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17520"><a href="https://azeria-labs.com/paradox-of-choice/">Paradox of Choice</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17676"><a href="https://azeria-labs.com/the-process-of-mastering-a-skill/">The Process of Mastering a Skill</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-16844"><a href="https://azeria-labs.com/about/">About</a></li>
</ul></div>			
				
		</div>
	</div>
</div>

		
			
					<div id="notitlebar"></div>
		


<div id="page-wrap" class="container">

	<div id="content" class="sidebar-right twelve alt columns">
	
		<div class="wpb_row vc_row-fluid standard-section section  section-no-parallax  stretch   " data-speed="1" style=""><div class="col span_12 color-dark left">
	<div class="vc_col-sm-12 wpb_column column_container col no-padding color-dark" style="" data-animation="" data-delay="">
		<div class="wpb_wrapper">
			
	<div class="wpb_text_column wpb_content_element ">
		<div class="wpb_wrapper">
			<h2 class="wp-block-heading" style="text-align: center;">Arm Heap Exploitation</h2>

		</div>
	</div>

		</div> 
	</div> 
</div></div><div class="wpb_row vc_row-fluid standard-section section  section-no-parallax  stretch   " data-speed="1" style=""><div class="col span_12 color-dark left">
	<div class="vc_col-sm-12 wpb_column column_container col no-padding color-dark" style="" data-animation="" data-delay="">
		<div class="wpb_wrapper">
			<div class="spacer" style="height: 20px;"></div><div class="divider-title align-center">Part 1: Understanding the Glibc Heap Implementation</div>
		</div> 
	</div> 
</div></div><div class="wpb_row vc_row-fluid standard-section section  section-no-parallax  stretch   " data-speed="1" style=""><div class="col span_12 color-dark left">
	<div class="vc_col-sm-12 wpb_column column_container col no-padding color-dark" style="" data-animation="" data-delay="">
		<div class="wpb_wrapper">
			
	<div class="wpb_text_column wpb_content_element ">
		<div class="wpb_wrapper">
			<p><span style="font-weight: 400;">In a <a href="https://azeria-labs.com/process-memory-and-memory-corruption/" target="_blank" rel="noopener noreferrer">previous article</a>, I’ve discussed an old (but important) category of memory-corruption vulnerability called “stack buffer overflows”, and how we, as attackers, can exploit these vulnerabilities to take control of a remote program and make it run our shellcode.</span></p>
<p><span style="font-weight: 400;">For applications that make use of an exploit mitigation called “stack canaries”, it turns out that these stack-buffer-overflow vulnerabilities can be harder for attackers to exploit and often require additional vulnerabilities to exploit them reliably. When developers are using various stack-based exploit mitigations, attackers often instead build their exploits using heap-related vulnerabilities such as </span><i><span style="font-weight: 400;">use-after-frees, double-frees,</span></i><span style="font-weight: 400;"> and </span><i><span style="font-weight: 400;">heap-overflows</span></i><span style="font-weight: 400;">. These heap-based vulnerabilities are more difficult to understand than their stack-based counterparts because attack techniques against heap-based vulnerabilities can be very dependent on how the internal implementation of the heap allocator actually works.</span></p>
<p><span style="font-weight: 400;">For this reason, before I write about exploiting heap-based vulnerabilities, I will use the first two parts of this series to talk about how the heap works. This first post will be an introduction into some high-level concepts, and a discussion about how new heap chunks are created. In the next post I will do a deeper dive into the technical implementation of how chunks are freed and recycled.&nbsp;</span></p>
<p><span style="font-weight: 400;">The way the heap works is very platform and implementation specific; lots of different heap implementations exist. For example, Google Chrome’s </span><a href="https://chromium.googlesource.com/chromium/src/+/HEAD/base/allocator/partition_allocator/PartitionAlloc.md" target="_blank" rel="noopener noreferrer"><i><span style="font-weight: 400;">PartitionAlloc</span></i></a><span style="font-weight: 400;"> is very different to the </span><a href="https://github.com/jemalloc/jemalloc/wiki/Background" target="_blank" rel="noopener noreferrer"><i><span style="font-weight: 400;">jemalloc</span></i></a><span style="font-weight: 400;"> heap allocator used in FreeBSD. The default </span><i><span style="font-weight: 400;">glibc </span></i><span style="font-weight: 400;">heap implementation in </span><i><span style="font-weight: 400;">Linux </span></i><span style="font-weight: 400;">is also very different to how the heap works in </span><i><span style="font-weight: 400;">Windows</span></i><span style="font-weight: 400;">. So for this and the next few posts, I’ll be focusing on the </span><a href="https://sourceware.org/glibc/wiki/MallocInternals" target="_blank" rel="noopener noreferrer"><i><span style="font-weight: 400;">glibc </span></i></a><span style="font-weight: 400;">heap allocator, i.e. how heap allocations work for C/C++ programs running on </span><i><span style="font-weight: 400;">Linux </span></i><span style="font-weight: 400;">devices by default. This heap is derived from the </span><a href="http://www.malloc.de/en/" target="_blank" rel="noopener noreferrer"><i><span style="font-weight: 400;">ptmalloc </span></i></a><span style="font-weight: 400;">heap implementation, which is itself derived from the much older </span><a href="http://g.oswego.edu/dl/html/malloc.html" target="_blank" rel="noopener noreferrer"><i><span style="font-weight: 400;">dlmalloc</span></i></a><span style="font-weight: 400;"> (Doug Lea malloc) memory allocator.</span></p>

		</div>
	</div>

		</div> 
	</div> 
</div></div><div class="wpb_row vc_row-fluid standard-section section  section-no-parallax  stretch   " data-speed="1" style=""><div class="col span_12 color-dark left">
	<div class="vc_col-sm-12 wpb_column column_container col no-padding color-dark" style="" data-animation="" data-delay="">
		<div class="wpb_wrapper">
			<div class="spacer" style="height: 40px;"></div><div class="divider-title align-center">What is the heap, and why do people use it?</div>
	<div class="wpb_text_column wpb_content_element ">
		<div class="wpb_wrapper">
			<p><span style="font-weight: 400;">First things first: What is the heap, and what is it for? </span></p>
<p><span style="font-weight: 400;">The </span><i><span style="font-weight: 400;">heap </span></i><span style="font-weight: 400;">is used by C and C++ programmers to manually allocate new regions of process memory during program execution. Programmers ask the heap manager to allocate these regions of memory via calls to heap functions like</span><a href="https://linux.die.net/man/3/malloc" target="_blank" rel="noopener noreferrer"><i><span style="font-weight: 400;"> malloc</span></i></a><span style="font-weight: 400;">. These allocated regions of memory, or “allocations”, can then be used, modified or referenced by the programmer up until the programmer no longer needs it and returns the allocation back to the heap manager via a call to </span><a href="https://linux.die.net/man/3/free" target="_blank" rel="noopener noreferrer"><i><span style="font-weight: 400;">free</span></i></a><span style="font-weight: 400;">. </span><b></b></p>
<p>Here is an example of how a C program might allocate, use, and later free a structure on the heap:</p>
<pre><strong><span style="color: #cc99ff;"><span style="color: #ccffff;">typedef struct</span> </span></strong>
{
    <strong><span style="color: #ccffff;">int</span> </strong>field1;
    <strong><span style="color: #ccffff;">char*</span></strong> field2;
} <span style="color: #cc99ff;">SomeStruct</span>;

<span style="color: #ccffff;"><strong>int</strong></span> main()
{
    <span style="color: #cc99ff;">SomeStruct</span>* myObject = (<span style="color: #cc99ff;">SomeStruct</span>*)malloc(<span style="color: #ccffff;"><strong>sizeof</strong></span>(<span style="color: #cc99ff;">SomeStruct</span>));
    <strong><span style="color: #ccffff;">if</span></strong>(myObject != NULL)
    {
        myObject-&gt;field1 = 1234;
        myObject-&gt;field2 = “Hello World!”;
        do_stuff(myObject);
	free(myObject);
    }
<strong><span style="color: #ccffff;">    return</span></strong> 0;
}
</pre>

		</div>
	</div>

	<div class="wpb_text_column wpb_content_element ">
		<div class="wpb_wrapper">
			<p><span style="font-weight: 400;">So long as the programmer follows a few simple rules, the heap manager ensures that each live allocation won’t overlap any other. This feature makes the heap a very useful, highly used, and therefore very performance-sensitive feature of most C and C++ programs.</span></p>
<p><span style="font-weight: 400;">The following graphic lists some basic rules that programmers must follow when using the heap, alongside some of the vulnerability categories that occur if the programmer violates these rules. In later posts I will discuss all of these heap-related vulnerability classes in more detail, but for now I’ll just show how the heap behaves when it is being used correctly.</span></p>
<p><a href="https://azeria-labs.com/wp-content/uploads/2019/03/heap-rules-CS.png"><img decoding="async" class="aligncenter wp-image-17793 size-full" src="https://azeria-labs.com/wp-content/uploads/2019/03/heap-rules-CS.png.pagespeed.ce.lgpwKF2QNH.png" alt="" width="800" height="621" srcset="https://azeria-labs.com/wp-content/uploads/2019/03/heap-rules-CS.png.pagespeed.ce.lgpwKF2QNH.png 800w, https://azeria-labs.com/wp-content/uploads/2019/03/heap-rules-CS-300x233.png.pagespeed.ce.d2u8-qiXU_.png 300w, https://azeria-labs.com/wp-content/uploads/2019/03/heap-rules-CS-768x596.png.pagespeed.ce.liN4AmhAvs.png 768w" sizes="(max-width: 800px) 100vw, 800px"></a></p>

		</div>
	</div>

		</div> 
	</div> 
</div></div><div class="wpb_row vc_row-fluid standard-section section  section-no-parallax  stretch   " data-speed="1" style=""><div class="col span_12 color-dark left">
	<div class="vc_col-sm-12 wpb_column column_container col no-padding color-dark" style="" data-animation="" data-delay="">
		<div class="wpb_wrapper">
			
	<div class="wpb_text_column wpb_content_element ">
		<div class="wpb_wrapper">
			<p><span style="font-weight: 400;">Of course, </span><i><span style="font-weight: 400;">malloc </span></i><span style="font-weight: 400;">and </span><i><span style="font-weight: 400;">free</span></i><span style="font-weight: 400;"> aren’t the only way C and C++ programmers interact with the heap. C++ developers often instead allocate memory via the C++ operators </span><i><span style="font-weight: 400;">new </span></i><span style="font-weight: 400;">and</span><i><span style="font-weight: 400;"> new[]</span></i><span style="font-weight: 400;">. These allocations must be released using the corresponding C++ operators </span><i><span style="font-weight: 400;">delete</span></i><span style="font-weight: 400;"> and </span><i><span style="font-weight: 400;">delete[] </span></i><span style="font-weight: 400;">rather than using </span><i><span style="font-weight: 400;">free</span></i><span style="font-weight: 400;">. Programmers can also allocate memory via malloc-compatible heap functions like </span><a href="http://man7.org/linux/man-pages/man3/calloc.3p.html" target="_blank" rel="noopener noreferrer"><i><span style="font-weight: 400;">calloc</span></i></a><span style="font-weight: 400;">, </span><a href="http://man7.org/linux/man-pages/man3/realloc.3p.html" target="_blank" rel="noopener noreferrer"><i><span style="font-weight: 400;">realloc</span></i></a><span style="font-weight: 400;"> and </span><a href="https://linux.die.net/man/3/memalign" target="_blank" rel="noopener noreferrer"><i><span style="font-weight: 400;">memalign</span></i></a><span style="font-weight: 400;">, which, like </span><i><span style="font-weight: 400;">malloc</span></i><span style="font-weight: 400;">, are eventually released via </span><i><span style="font-weight: 400;">free</span></i><span style="font-weight: 400;">. </span></p>
<p><span style="font-weight: 400;">For simplicity I’ll initially just discuss </span><i><span style="font-weight: 400;">malloc </span></i><span style="font-weight: 400;">and </span><i><span style="font-weight: 400;">free</span></i><span style="font-weight: 400;">. Later we’ll see that once we understand these two, most of the other heap functions become very easy to understand.</span></p>
<p>Here is an example of how a C++ program might allocate, use, and later free a structure on the heap:</p>
<p>&nbsp;</p>

		</div>
	</div>

		</div> 
	</div> 
</div></div><div class="wpb_row vc_row-fluid standard-section section  section-no-parallax  stretch   " data-speed="1" style=""><div class="col span_12 color-dark left">
	<div class="vc_col-sm-12 wpb_column column_container col no-padding color-dark" style="" data-animation="" data-delay="">
		<div class="wpb_wrapper">
			
	<div class="wpb_text_column wpb_content_element ">
		<div class="wpb_wrapper">
			<pre><strong><span style="color: #ccffff;">class</span></strong> <span style="color: #cc99ff;">SomeClass</span>
{
<span style="color: #ccffff;"><strong>public</strong></span>:
    <span style="color: #ccffff;"><strong>int</strong></span> field1;
    <span style="color: #ccffff;"><strong>char</strong></span>* field2;
};

<span style="color: #ccffff;"><strong>int</strong> </span>main()
{
    <span style="color: #cc99ff;">SomeClass</span>* myObject = <span style="color: #ccffff;"><strong>new</strong></span> <span style="color: #cc99ff;">SomeClass</span>();
    myObject-&gt;field1 = 1234;
    myObject-&gt;field2 = “Hello World!”;
    do_stuff(myObject);
    <span style="color: #ccffff;"><strong>delete</strong></span> myObject;
    <span style="color: #ccffff;"><strong>return</strong></span> 0;
}
</pre>

		</div>
	</div>

		</div> 
	</div> 
</div></div><div class="wpb_row vc_row-fluid standard-section section  section-no-parallax  stretch   " data-speed="1" style=""><div class="col span_12 color-dark left">
	<div class="vc_col-sm-12 wpb_column column_container col no-padding color-dark" style="" data-animation="" data-delay="">
		<div class="wpb_wrapper">
			<div class="spacer" style="height: 40px;"></div><div class="divider-title align-center">Memory chunks and the chunk allocation strategies</div>
	<div class="wpb_text_column wpb_content_element ">
		<div class="wpb_wrapper">
			<p><span style="font-weight: 400;">Suppose a programmer asks for, say, 10 bytes of memory via </span><i><span style="font-weight: 400;">malloc</span></i><span style="font-weight: 400;">. To service this request, the heap manager needs to do more than just find a random 10 byte region that the programmer can write to. The heap manager also needs to store metadata about the allocation. This metadata is stored alongside the 10-byte region that the programmer can use.</span></p>
<p><span style="font-weight: 400;">The heap manager also needs to ensure that the allocation will be 8-byte aligned on 32-bit systems, or 16-byte aligned on 64-bit systems. Alignment of allocations doesn’t matter if the programmer just wants to store some data like a text string or a byte array, but alignment can have a big impact on the correctness and performance of programs if the programmer intends to use the allocation to store more complex data structures. Since </span><i><span style="font-weight: 400;">malloc </span></i><span style="font-weight: 400;">has no way to know what the programmer will store in their allocation, the heap manager must default to making sure all allocations are aligned.</span></p>
<p><span style="font-weight: 400;"><a href="https://azeria-labs.com/wp-content/uploads/2019/03/chunk-allocated-simple-CS.png"><img decoding="async" loading="lazy" class="wp-image-17795 size-full alignright" src="https://azeria-labs.com/wp-content/uploads/2019/03/chunk-allocated-simple-CS.png.pagespeed.ce.4F7IE_9i1S.png" alt="" width="500" height="378" srcset="https://azeria-labs.com/wp-content/uploads/2019/03/chunk-allocated-simple-CS.png.pagespeed.ce.4F7IE_9i1S.png 500w, https://azeria-labs.com/wp-content/uploads/2019/03/chunk-allocated-simple-CS-300x227.png.pagespeed.ce.bYIMlrjhi2.png 300w" sizes="(max-width: 500px) 100vw, 500px"></a>This allocation metadata and alignment-padding bytes is stored alongside the region of memory that </span><i><span style="font-weight: 400;">malloc</span></i><span style="font-weight: 400;"> will give back to the programmer. For this reason, the heap manager internally allocates “chunks” of memory that are slightly bigger than the programmer initially asked for. When the programmer asks for 10 bytes of memory, the heap manager finds or creates a new chunk of memory that is big enough to store the 10-byte space plus the metadata and alignment padding bytes. The heap manager then marks this chunk as “allocated”, and returns a pointer to the aligned 10-byte “user data” region inside the chunk, which the programmer sees as the return value of the </span><i><span style="font-weight: 400;">malloc </span></i><span style="font-weight: 400;">call.</span></p>
<p>&nbsp;</p>

		</div>
	</div>

		</div> 
	</div> 
</div></div><div class="wpb_row vc_row-fluid standard-section section  section-no-parallax  stretch   " data-speed="1" style=""><div class="col span_12 color-dark left">
	<div class="vc_col-sm-12 wpb_column column_container col no-padding color-dark" style="" data-animation="" data-delay="">
		<div class="wpb_wrapper">
			<div class="spacer" style="height: 20px;"></div><div class="divider-title align-center">Chunk allocation: basic strategy</div>
	<div class="wpb_text_column wpb_content_element ">
		<div class="wpb_wrapper">
			<p><span style="font-weight: 400;">So how does the heap manager internally allocate these chunks? </span></p>
<p><span style="font-weight: 400;">First, let’s look at the (heavily simplified) strategy for allocating small chunks of memory, which is the bulk of what the heap manager does. I’ll explain each of these steps in a bit more detail below, and once we’ve done that we can look at the special case of huge allocations.</span></p>
<p><span style="font-weight: 400;">The simplified chunk-allocation strategy for small chunks is this:</span></p>
<ol>
<li><span style="font-weight: 400;">If there is a previously-freed chunk of memory, and that chunk is big enough to service the request, the heap manager will use that freed chunk for the new allocation.</span></li>
<li><span style="font-weight: 400;">Otherwise, if there is available space at the top of the heap, the heap manager will allocate a new chunk out of that available space and use that.</span></li>
<li><span style="font-weight: 400;">Otherwise, the heap manager will ask the kernel to add new memory to the end of the heap, and then allocates a new chunk from this newly allocated space.</span></li>
<li><span style="font-weight: 400;">If all these strategies fail, the allocation can’t be serviced, and </span><i><span style="font-weight: 400;">malloc</span></i><span style="font-weight: 400;"> returns NULL.</span></li>
</ol>
<p>&nbsp;</p>

		</div>
	</div>

		</div> 
	</div> 
</div></div><div class="wpb_row vc_row-fluid standard-section section  section-no-parallax  stretch   " data-speed="1" style=""><div class="col span_12 color-dark left">
	<div class="vc_col-sm-12 wpb_column column_container col no-padding color-dark" style="" data-animation="" data-delay="">
		<div class="wpb_wrapper">
			<div class="spacer" style="height: 40px;"></div><div class="divider-title align-center">Allocating from free’d chunks</div>
	<div class="wpb_text_column wpb_content_element ">
		<div class="wpb_wrapper">
			<p><span style="font-weight: 400;"><a href="https://azeria-labs.com/wp-content/uploads/2019/03/bins-simple.png"><img decoding="async" loading="lazy" class="wp-image-17802 size-full alignleft" src="https://azeria-labs.com/wp-content/uploads/2019/03/bins-simple.png.pagespeed.ce.yShI1r11bf.png" alt="" width="332" height="469" srcset="https://azeria-labs.com/wp-content/uploads/2019/03/bins-simple.png.pagespeed.ce.yShI1r11bf.png 332w, https://azeria-labs.com/wp-content/uploads/2019/03/bins-simple-212x300.png.pagespeed.ce.Dt8ki1YhAj.png 212w" sizes="(max-width: 332px) 100vw, 332px"></a></span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">Conceptually, allocating a previously-freed chunk is very simple. As memory gets passed back to </span><i><span style="font-weight: 400;">free</span></i><span style="font-weight: 400;">, the heap manager tracks these freed chunks in a series of different linked lists called “bins”. When an allocation request is made, the heap manager searches those bins for a free chunk that’s big enough to service the request. If it finds one, it can remove that chunk from the bin, mark it as “allocated”, and then return a pointer to the “user data” region of that chunk to the programmer as the return value of </span><i><span style="font-weight: 400;">malloc</span></i><span style="font-weight: 400;">.</span></p>
<p><span style="font-weight: 400;">For performance reasons, there are several different types of bins, i.e. fast bins, the unsorted bin, small bins, large bins, and the per-thread tcache. I’ll discuss these different types of bins in more detail in the next part of this series.</span></p>
<p>&nbsp;</p>

		</div>
	</div>

		</div> 
	</div> 
</div></div><div class="wpb_row vc_row-fluid standard-section section  section-no-parallax  stretch   " data-speed="1" style=""><div class="col span_12 color-dark left">
	<div class="vc_col-sm-12 wpb_column column_container col no-padding color-dark" style="" data-animation="" data-delay="">
		<div class="wpb_wrapper">
			<div class="spacer" style="height: 40px;"></div><div class="divider-title align-center">Allocating from the top of the heap</div>
	<div class="wpb_text_column wpb_content_element ">
		<div class="wpb_wrapper">
			<p><span style="font-weight: 400;"><a href="https://azeria-labs.com/wp-content/uploads/2019/03/heap-chunks-top.gif"><img decoding="async" loading="lazy" class="alignleft wp-image-17753" src="https://azeria-labs.com/wp-content/uploads/2019/03/heap-chunks-top.gif.pagespeed.ce.-1T8whb15V.gif" alt="" width="161" height="300"></a></span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">If there are no free chunks available that can service the allocation request, the heap manager must instead construct a new chunk from scratch. To do this, the heap manager first looks at the free space at the end of the heap (sometimes called the “top chunk” or “remainder chunk”) to see if there is enough space there. If there is, the heap manager manufactures a new chunk out of this free space.</span></p>

		</div>
	</div>

		</div> 
	</div> 
</div></div><div class="wpb_row vc_row-fluid standard-section section  section-no-parallax  stretch   " data-speed="1" style=""><div class="col span_12 color-dark left">
	<div class="vc_col-sm-12 wpb_column column_container col no-padding color-dark" style="" data-animation="" data-delay="">
		<div class="wpb_wrapper">
			<div class="spacer" style="height: 40px;"></div><div class="divider-title align-center">Asking the kernel for more memory at the top of the heap</div>
	<div class="wpb_text_column wpb_content_element ">
		<div class="wpb_wrapper">
			<p><a href="https://azeria-labs.com/wp-content/uploads/2019/03/process-memory-heap-gif-1.gif"><img decoding="async" loading="lazy" class="alignleft wp-image-17755" src="https://azeria-labs.com/wp-content/uploads/2019/03/process-memory-heap-gif-1.gif.pagespeed.ce.7aWWdu62FM.gif" alt="" width="311" height="500"></a><span style="font-weight: 400;">Once the free space at the top of the heap is used up, the heap manager will have to ask the kernel to add more memory to the end of the heap.</span></p>
<p><span style="font-weight: 400;">On the initial heap, the heap manager asks the kernel to allocate more memory at the end of the heap by calling </span><a href="http://man7.org/linux/man-pages/man2/sbrk.2.html" target="_blank" rel="noopener noreferrer"><i><span style="font-weight: 400;">sbrk</span></i></a><span style="font-weight: 400;">. On most Linux-based systems this function internally uses a system call called “<a href="https://linux.die.net/man/2/brk" target="_blank" rel="noopener noreferrer">brk</a>”. This system call has a pretty confusing name–it originally meant “change the program break location”, which is a complicated way of saying it adds more memory to the region just after where the program gets loaded into memory. Since this is where the heap manager creates the initial heap, the effect of this system call is to allocate more memory at the end of the program’s initial heap.</span></p>
<p><span style="font-weight: 400;">Eventually, expanding the heap with </span><i><span style="font-weight: 400;">sbrk </span></i><span style="font-weight: 400;">will fail–the heap will eventually grow so large that expanding it further would cause it to collide with other things in the process’ address space, such as </span><span style="font-weight: 400;">memory mappings, shared libraries</span><span style="font-weight: 400;">, or a thread’s stack region. Once the heap reaches this point, the heap manager will </span><a href="https://sourceware.org/git/gitweb.cgi?p=glibc.git;a=blob;f=malloc/malloc.c;h=6e766d11bc85b6480fa5c9f2a76559f8acf9deb5;hb=HEAD#l2320" target="_blank" rel="noopener noreferrer"><span style="font-weight: 400;">resort to attaching</span></a><span style="font-weight: 400;"> new non-contiguous memory to the initial program heap using calls to </span><a href="http://man7.org/linux/man-pages/man2/mmap.2.html" target="_blank" rel="noopener noreferrer"><i><span style="font-weight: 400;">mmap</span></i></a><span style="font-weight: 400;">.</span></p>
<p><span style="font-weight: 400;">If </span><i><span style="font-weight: 400;">mmap</span></i><span style="font-weight: 400;"> also fails, then the process simply can’t allocate any more memory, and </span><i><span style="font-weight: 400;">malloc </span></i><span style="font-weight: 400;">returns NULL.</span></p>

		</div>
	</div>

		</div> 
	</div> 
</div></div><div class="wpb_row vc_row-fluid standard-section section  section-no-parallax  stretch   " data-speed="1" style=""><div class="col span_12 color-dark left">
	<div class="vc_col-sm-12 wpb_column column_container col no-padding color-dark" style="" data-animation="" data-delay="">
		<div class="wpb_wrapper">
			<div class="spacer" style="height: 40px;"></div><div class="divider-title align-center">Off-heap allocations via MMAP</div>
	<div class="wpb_text_column wpb_content_element ">
		<div class="wpb_wrapper">
			<p><span style="font-weight: 400;">Very large allocation requests*</span>&nbsp;<a href="https://sourceware.org/git/gitweb.cgi?p=glibc.git;a=blob;f=malloc/malloc.c;h=6e766d11bc85b6480fa5c9f2a76559f8acf9deb5;hb=HEAD#l866" target="_blank" rel="noopener noreferrer"><span style="font-weight: 400;">get special treatment</span></a><span style="font-weight: 400;"> in the heap manager. These large chunks are allocated off-heap using a direct call to </span><i><span style="font-weight: 400;">mmap</span></i><span style="font-weight: 400;">, and this fact is marked using a flag in the chunk metadata. When these huge allocations are later returned to the heap manager via a call to </span><i><span style="font-weight: 400;">free</span></i><span style="font-weight: 400;">, the heap manager releases the entire </span><i><span style="font-weight: 400;">mmap</span></i><span style="font-weight: 400;">ed region back to the system via </span><i><span style="font-weight: 400;">munmap</span></i><span style="font-weight: 400;">.</span></p>
<p><b><span style="font-weight: 400;">*By default </span><a href="https://sourceware.org/git/gitweb.cgi?p=glibc.git;a=blob;f=malloc/malloc.c;h=6e766d11bc85b6480fa5c9f2a76559f8acf9deb5;hb=HEAD#l858" target="_blank" rel="noopener noreferrer"><span style="font-weight: 400;">this threshold is</span></a><span style="font-weight: 400;">&nbsp;128KB up to 512KB on 32-bit systems and 32MB on 64-bit systems, however this threshold </span><a href="https://sourceware.org/git/gitweb.cgi?p=glibc.git;a=blob;f=malloc/malloc.c;h=6e766d11bc85b6480fa5c9f2a76559f8acf9deb5;hb=HEAD#l949" target="_blank" rel="noopener noreferrer"><span style="font-weight: 400;">can also dynamically increase</span></a><span style="font-weight: 400;"> if the heap manager detects that these large allocations are being used transiently.</span></b></p>

		</div>
	</div>

		</div> 
	</div> 
</div></div><div class="wpb_row vc_row-fluid standard-section section  section-no-parallax  stretch   " data-speed="1" style=""><div class="col span_12 color-dark left">
	<div class="vc_col-sm-12 wpb_column column_container col no-padding color-dark" style="" data-animation="" data-delay="">
		<div class="wpb_wrapper">
			<div class="spacer" style="height: 40px;"></div><div class="divider-title align-center">Arenas</div>
	<div class="wpb_text_column wpb_content_element ">
		<div class="wpb_wrapper">
			<p><span style="font-weight: 400;">On multithreaded applications, the heap manager needs to defend internal heap data structures from race conditions that could cause the program to crash. Prior to </span><i><span style="font-weight: 400;">ptmalloc2</span></i><span style="font-weight: 400;">, the heap manager did this by simply using a global mutex before every heap operation to ensure that only one thread could interact with the heap at any given time.</span></p>
<p><span style="font-weight: 400;">Although this strategy works, the heap allocator is so high-usage and performance sensitive that this led to significant performance problems on applications that use lots of threads. In response to this, the </span><i><span style="font-weight: 400;">ptmalloc2 </span></i><span style="font-weight: 400;">heap allocator introduced the concept of “arenas</span><i><span style="font-weight: 400;">”</span></i><span style="font-weight: 400;">. Each arena is essentially an entirely different heap that manages its own chunk allocation and free bins completely separately. Each arena still serializes access to its own internal data structures with a mutex, but threads can safely perform heap operations without stalling each other so long as they are interacting with different arenas.</span></p>
<p><span style="font-weight: 400;">The initial (“main”) arena of the program only contains the heap we’ve already seen, and for single-threaded applications this is the only arena that the heap manager will ever use. However, as new threads join the process, the heap manager allocates and attaches secondary arenas to each new thread in an attempt to reduce the chance that the thread will have to wait around waiting for other thread when it attempts to perform heap operations like </span><i><span style="font-weight: 400;">malloc</span></i><span style="font-weight: 400;"> and </span><i><span style="font-weight: 400;">free</span></i><span style="font-weight: 400;">.</span></p>
<p><span style="font-weight: 400;">With each new thread that joins the process, the heap manager tries to find an arena that no other thread is using and attaches the arena to that thread. Once all available arenas are in use by other threads, the heap manager </span><a href="https://sourceware.org/git/gitweb.cgi?p=glibc.git;a=blob;f=malloc/arena.c;h=efca2bcf682667c618e285b2357888d10d336c5f;hb=HEAD#l872" target="_blank" rel="noopener noreferrer"><span style="font-weight: 400;">creates a new one</span></a><span style="font-weight: 400;">, </span><a href="https://sourceware.org/git/gitweb.cgi?p=glibc.git;a=blob;f=malloc/malloc.c;h=6e766d11bc85b6480fa5c9f2a76559f8acf9deb5;hb=HEAD#l1780" target="_blank" rel="noopener noreferrer"><span style="font-weight: 400;">up to the maximum</span></a><span style="font-weight: 400;"> number of arenas of 2x </span><i><span style="font-weight: 400;">cpu-cores </span></i><span style="font-weight: 400;">in 32-bit processes and 8x </span><i><span style="font-weight: 400;">cpu-cores</span></i><span style="font-weight: 400;"> in 64-bit processes. Once that limit is finally reached, the heap manager gives up and multiple threads will have to share an arena and run the risk that performing heap operations will require one of those threads to wait for the other.</span></p>
<p><span style="font-weight: 400;">But wait a minute! How do these secondary arenas even work? Before we saw that the main heap is located just after where the program is loaded into memory and is expanded using the </span><i><span style="font-weight: 400;">brk</span></i><span style="font-weight: 400;"> system call, but this can’t also be true for secondary arenas! </span></p>
<p><span style="font-weight: 400;">The answer is that these secondary arenas emulate the behavior of the main heap using one or more “</span><a href="https://sourceware.org/git/gitweb.cgi?p=glibc.git;a=blob;f=malloc/arena.c;h=efca2bcf682667c618e285b2357888d10d336c5f;hb=HEAD#l452" target="_blank" rel="noopener noreferrer"><span style="font-weight: 400;">subheaps</span></a><span style="font-weight: 400;">” created using </span><i><span style="font-weight: 400;">mmap</span></i><span style="font-weight: 400;"> and </span><i><span style="font-weight: 400;">mprotect</span></i><span style="font-weight: 400;">.</span></p>

		</div>
	</div>

		</div> 
	</div> 
</div></div><div class="wpb_row vc_row-fluid standard-section section  section-no-parallax  stretch   " data-speed="1" style=""><div class="col span_12 color-dark left">
	<div class="vc_col-sm-12 wpb_column column_container col no-padding color-dark" style="" data-animation="" data-delay="">
		<div class="wpb_wrapper">
			<div class="spacer" style="height: 40px;"></div><div class="divider-title align-center">Subheaps</div>
	<div class="wpb_text_column wpb_content_element ">
		<div class="wpb_wrapper">
			<p><a href="https://azeria-labs.com/wp-content/uploads/2019/03/heap-arenas-0-CS.png"><img decoding="async" loading="lazy" class="wp-image-17797 size-full alignleft" src="https://azeria-labs.com/wp-content/uploads/2019/03/heap-arenas-0-CS.png.pagespeed.ce.j1YQiF517M.png" alt="" width="153" height="400" srcset="https://azeria-labs.com/wp-content/uploads/2019/03/heap-arenas-0-CS.png.pagespeed.ce.j1YQiF517M.png 153w, https://azeria-labs.com/wp-content/uploads/2019/03/heap-arenas-0-CS-115x300.png.pagespeed.ce.1C492Ynx4y.png 115w" sizes="(max-width: 153px) 100vw, 153px"></a><span style="font-weight: 400;">Sub-heaps work mostly the same way as the initial program heap, with two main differences. Recall that the initial heap is located immediately after where the program is loaded into memory, and is dynamically expanded by </span><i><span style="font-weight: 400;">sbrk</span></i><span style="font-weight: 400;">. By contrast, each subheap is positioned into memory using </span><i><span style="font-weight: 400;">mmap</span></i><span style="font-weight: 400;">, and the heap manager manually emulates growing the subheap using </span><i><span style="font-weight: 400;">mprotect</span></i><span style="font-weight: 400;">.</span></p>
<p><span style="font-weight: 400;">When the heap manager wants to create a subheap, it first asks the kernel to reserve a region of memory that the subheap can grow into by calling </span><i><span style="font-weight: 400;">mmap*</span></i><i><span style="font-weight: 400;">. </span></i><span style="font-weight: 400;">Reserving this region does not directly allocate memory into the subheap; it just asks the kernel to refrain from allocating things like thread stacks, mmap regions and other allocations inside this region. </span></p>
<p><span style="font-weight: 400;">*By default, the maximum size of a subheap–and therefore the region of memory reserved for the subheap to grow into–is 1MB on 32-bit processes and 64MB on 64-bit systems.</span></p>
<p><span style="font-weight: 400;">This is done by asking </span><i><span style="font-weight: 400;">mmap</span></i><span style="font-weight: 400;"> for pages that are marked </span><i><span style="font-weight: 400;">PROT_NONE</span></i><span style="font-weight: 400;">, which acts as a hint to the kernel that it only needs to reserve the address range for the region; it doesn’t yet need the kernel to attach memory to it.</span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;"><a href="https://azeria-labs.com/wp-content/uploads/2019/03/heap-arenas-CS.png"><img decoding="async" loading="lazy" class="wp-image-17798 size-full alignright" src="https://azeria-labs.com/wp-content/uploads/2019/03/heap-arenas-CS.png.pagespeed.ce.ASfyKv9TRY.png" alt="" width="428" height="500" srcset="https://azeria-labs.com/wp-content/uploads/2019/03/heap-arenas-CS.png.pagespeed.ce.ASfyKv9TRY.png 428w, https://azeria-labs.com/wp-content/uploads/2019/03/heap-arenas-CS-257x300.png.pagespeed.ce.TL-fj8M3vH.png 257w" sizes="(max-width: 428px) 100vw, 428px"></a>Where the initial heap grew using </span><i><span style="font-weight: 400;">sbrk</span></i><span style="font-weight: 400;">, the heap manager emulates “growing” the subheap into this reserved address range by manually invoking </span><a href="http://man7.org/linux/man-pages/man2/mprotect.2.html" target="_blank" rel="noopener noreferrer"><i><span style="font-weight: 400;">mprotect</span></i></a><span style="font-weight: 400;"> to change pages in the region from PROT_NONE to PROT_READ | PROT_WRITE. This causes the kernel to attach physical memory to those addresses, in effect causing the subheap to slowly grow until the whole </span><i><span style="font-weight: 400;">mmap</span></i><span style="font-weight: 400;"> region is full. Once the entire subheap is exhausted, the arena just allocates another subheap. This allows the secondary arenas to keep growing almost indefinitely, only eventually failing when the kernel runs out of memory, or when the process runs out of address space.</span></p>
<p><span style="font-weight: 400;">To recap: the initial (“main”) arena contains only the main heap which lives just after the where the program binary is loaded into memory, and is expanded using </span><i><span style="font-weight: 400;">sbrk</span></i><span style="font-weight: 400;">. This is the only arena that is used for single-threaded applications. On multithreaded applications, new threads are given secondary arenas from which to allocate. Using arenas speeds up the program by reducing the likelihood that a thread will need to wait on a mutex before being able to perform a heap operation. Unlike the main arena, these secondary arenas allocate chunks from one or more </span><i><span style="font-weight: 400;">subheaps</span></i><span style="font-weight: 400;">, whose location in memory is first established using </span><i><span style="font-weight: 400;">mmap</span></i><span style="font-weight: 400;">, and which grow by using </span><i><span style="font-weight: 400;">mprotect</span></i><span style="font-weight: 400;">.</span></p>

		</div>
	</div>

		</div> 
	</div> 
</div></div><div class="wpb_row vc_row-fluid standard-section section  section-no-parallax  stretch   " data-speed="1" style=""><div class="col span_12 color-dark left">
	<div class="vc_col-sm-12 wpb_column column_container col no-padding color-dark" style="" data-animation="" data-delay="">
		<div class="wpb_wrapper">
			<div class="spacer" style="height: 40px;"></div><div class="divider-title align-center">Chunk metadata</div>
	<div class="wpb_text_column wpb_content_element ">
		<div class="wpb_wrapper">
			<p><span style="font-weight: 400;">Now we finally know all of the different ways that a chunk might get allocated, and that chunks contain not only the “user data” area that will be given to the programmer as the return value of </span><i><span style="font-weight: 400;">malloc</span></i><span style="font-weight: 400;">, but also metadata. But what does this chunk metadata actually record, and where does it live?</span></p>
<p>The <a href="https://sourceware.org/git/gitweb.cgi?p=glibc.git;a=blob;f=malloc/malloc.c;h=6e766d11bc85b6480fa5c9f2a76559f8acf9deb5;hb=HEAD#l1038">exact layout</a> of the chunk metadata in memory can be a bit confusing, because the heap manager source code combines metadata at the end of one chunk with the metadata at the start of the next, and several of the metadata fields exist or are used depending on various characteristics of the chunk.</p>
<p>For now, we’ll just look at live allocations, which have a single <i>size_t*</i>&nbsp;header that is positioned just behind the “user data” region given to the programmer. This field, which the source code calls <i>mchunk_size</i>, is written to during <i>malloc</i>, and later used by <i>free</i> to decide how to handle the release of the allocation.</p>
<p><span style="font-weight: 400;">*A size_t value is an 4 byte integer on a 32-bit system and an 8 byte integer on on a 64-bit system.</span></p>
<p><a href="https://azeria-labs.com/wp-content/uploads/2019/03/chunk-allocated-CS.png"><img decoding="async" loading="lazy" class="aligncenter wp-image-17799 size-full" src="https://azeria-labs.com/wp-content/uploads/2019/03/chunk-allocated-CS.png.pagespeed.ce.izBEpRX-xB.png" alt="" width="600" height="452" srcset="https://azeria-labs.com/wp-content/uploads/2019/03/chunk-allocated-CS.png.pagespeed.ce.izBEpRX-xB.png 600w, https://azeria-labs.com/wp-content/uploads/2019/03/chunk-allocated-CS-300x226.png.pagespeed.ce.l2puzXLukD.png 300w" sizes="(max-width: 600px) 100vw, 600px"></a></p>

		</div>
	</div>

	<div class="wpb_text_column wpb_content_element ">
		<div class="wpb_wrapper">
			<p><span style="font-weight: 400;">The </span><i><span style="font-weight: 400;">mchunk_size</span></i><span style="font-weight: 400;"> stores four pieces of information: the chunk size, and three bits called “A”, “M”, and “P”. These can all be stored in the same </span><i><span style="font-weight: 400;">size_t</span></i><span style="font-weight: 400;"> field because chunk sizes are always 8-byte aligned (or 16-byte aligned on 64-bit), and therefore the low three bits of the chunk size are always zero.</span></p>
<p><span style="font-weight: 400;">The “A” flag is used to tell the heap manager</span><span style="font-weight: 400;"> if </span><span style="font-weight: 400;">the chunk belongs to secondary arena, as opposed to the main arena. During free, the heap manager is only given a pointer to the allocation that the programmer wants to free, and the heap manager needs to work out which arena the pointer belongs to. If the A flag is set in the chunk’s metadata, the heap manager must search each arena and see if the pointer lives within any of that arena’s subheaps. If the flag is not set, the heap manager can short-circuit the search because it knows the chunk came from the initial arena.</span></p>
<p><span style="font-weight: 400;">The “M” flag is used to indicate that the chunk is a huge allocation that was allocated off-heap via </span><i><span style="font-weight: 400;">mmap</span></i><span style="font-weight: 400;">. When this allocation is eventually passed back to </span><i><span style="font-weight: 400;">free</span></i><span style="font-weight: 400;">, the heap manager will return the whole chunk back to the operating system immediately via </span><i><span style="font-weight: 400;">munmap</span></i><span style="font-weight: 400;"> rather than attempting to recycle it. For this reason, freed chunks never have this flag set.</span></p>
<p><span style="font-weight: 400;">The “P” flag is confusing because it really belongs to the </span><i><span style="font-weight: 400;">previous</span></i><span style="font-weight: 400;"> chunk. It indicates that the previous chunk is a </span><i><span style="font-weight: 400;">free</span></i><span style="font-weight: 400;"> chunk. This means when </span><i><span style="font-weight: 400;">this</span></i><span style="font-weight: 400;"> chunk is freed, it can be safely joined onto the previous chunk to create a much larger free chunk.</span></p>
<p><a href="https://azeria-labs.com/wp-content/uploads/2019/03/heap-chunks-coalescing-gif-color.gif"><br><img decoding="async" loading="lazy" class="aligncenter wp-image-17763" src="https://azeria-labs.com/wp-content/uploads/2019/03/heap-chunks-coalescing-gif-color.gif.pagespeed.ce.KsRGry1KEF.gif" alt="" width="500" height="375"></a></p>
<p><span style="font-weight: 400;">In my next post, I’ll talk in more detail about how these free chunks are “coalesced” together, and I’ll discuss how chunks are allocated and recycled using different types of “bins”. After that we’ll look at some different categories of heap vulnerabilities, and how they can be exploited by attackers to remotely take control of vulnerable programs.</span></p>

		</div>
	</div>

		</div> 
	</div> 
</div></div><div class="wpb_row vc_row-fluid standard-section section  section-no-parallax  stretch   " data-speed="1" style=""><div class="col span_12 color-dark left">
	<div class="vc_col-sm-12 wpb_column column_container col no-padding color-dark" style="" data-animation="" data-delay="">
		<div class="wpb_wrapper">
			
	<div class="wpb_text_column wpb_content_element ">
		<div class="wpb_wrapper">
			<p>&nbsp;</p>
<p>There are a couple of nice phrack articles on heaps I would like to share with you in case you want to read more before I publish the next parts.</p>
<ul>
<li><a href="http://phrack.org/issues/57/9.html" target="_blank" rel="noopener noreferrer">Once upon a free()</a></li>
<li><a href="http://phrack.org/issues/66/10.html" target="_blank" rel="noopener noreferrer">Malloc des-maleficarum</a></li>
<li><a href="http://phrack.org/issues/67/8.html" target="_blank" rel="noopener noreferrer">The house of lore</a></li>
<li><a href="http://phrack.org/issues/61/6.html" target="_blank" rel="noopener noreferrer">Advanced Doug Lea’s malloc exploits</a></li>
<li><a href="http://phrack.org/issues/66/6.html" target="_blank" rel="noopener noreferrer">Yet another free() exploitation technique</a></li>
</ul>
<p>&nbsp;</p>
<p><strong>Looking for a comprehensive training on exploit development?</strong></p>
<p>Sign up for my <a href="https://www.blackhat.com/us-19/training/schedule/index.html#azeria-labs-iot-exploit-development-for-arm-14313" target="_blank" rel="noopener noreferrer">upcoming Black Hat USA training</a> in Las Vegas, where I will be teaching a 2-day course on “Arm-based IoT Exploit Development” (3-day training at <a href="https://infiltratecon.com/training/" target="_blank" rel="noopener noreferrer">Infiltrate</a> is Sold Out). If your company is interested in private trainings and wants to save around 50% compared to conference trainings, send a message to azerialabs@gmail [.] com.</p>

		</div>
	</div>

		</div> 
	</div> 
</div></div>
		
		
			</div> <!-- end content -->

		<div id="sidebar" class="sidebar-right alt">
		<div id="sidebar-widgets" class="four columns">

    <div id="nav_menu-20" class="widget widget_nav_menu"><h3>ARM Exploit Development</h3><div class="menu-arm-exploitation-container"><ul id="menu-arm-exploitation" class="menu"><li id="menu-item-17009" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17009"><a href="https://azeria-labs.com/writing-arm-shellcode/">Writing ARM Shellcode</a></li>
<li id="menu-item-17337" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17337"><a href="https://azeria-labs.com/tcp-bind-shell-in-assembly-arm-32-bit/">TCP Bind Shell (ARM 32-bit)</a></li>
<li id="menu-item-17463" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17463"><a href="https://azeria-labs.com/tcp-reverse-shell-in-assembly-arm-32-bit/">TCP Reverse Shell (ARM 32-bit)</a></li>
<li id="menu-item-17072" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17072"><a href="https://azeria-labs.com/process-memory-and-memory-corruption/">Process Memory and Memory Corruption</a></li>
<li id="menu-item-18090" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-18090"><a href="https://azeria-labs.com/stack-overflow-arm32/">Stack Overflows (Arm32)</a></li>
<li id="menu-item-18089" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-18089"><a href="https://azeria-labs.com/return-oriented-programming-arm32/">Return Oriented Programming (Arm32)</a></li>
<li id="menu-item-17221" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17221"><a href="https://azeria-labs.com/part-3-stack-overflow-challenges/">Stack Overflow Challenges</a></li>
<li id="menu-item-17465" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17465"><a href="https://azeria-labs.com/process-continuation-shellcode/">Process Continuation Shellcode</a></li>
<li id="menu-item-17775" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-17698 current_page_item menu-item-17775"><a href="https://azeria-labs.com/heap-exploitation-part-1-understanding-the-glibc-heap-implementation/" aria-current="page">Introduction to Glibc Heap (malloc)</a></li>
<li id="menu-item-17832" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17832"><a href="https://azeria-labs.com/heap-exploitation-part-2-glibc-heap-free-bins/">Introduction to Glibc Heap (free, bins)</a></li>
<li id="menu-item-17872" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17872"><a href="https://azeria-labs.com/heap-exploit-development-part-1/">Heap Exploit Development (Part 1)</a></li>
<li id="menu-item-17888" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17888"><a href="https://azeria-labs.com/heap-overflows-and-the-ios-kernel-heap/">Heap Overflows and iOS Kernel (Part 2)</a></li>
<li id="menu-item-17929" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-17929"><a href="https://azeria-labs.com/grooming-the-ios-kernel-heap/">Grooming the iOS Kernel Heap (Part 3)</a></li>
</ul></div></div><div id="text-12" class="widget widget_text">			<div class="textwidget"><hr>
<span style="color:white">Twitter: </span>
<a href="https://twitter.com/fox0x01">
@Fox0x01</a> <span style="color:white">and</span><a href="https://twitter.com/azeria_labs">
@azeria_labs</a>
<br><br>
<h3 style="color:#ff5b5b">New ARM Assembly Cheat Sheet</h3>
<a href="https://teespring.com/arm32-assembly-cheatsheet-2020" class="button color-2 small" target="_blank" rel="noopener">Poster</a>
<a href="https://gumroad.com/l/Arm-cheatsheet-2020-version" class="button color-2 small" target="_blank" rel="noopener">Digital</a> <br><br>
<img src="http://azeria-labs.com/wp-content/uploads/2020/05/cheatsheet-2020-mini.png" alt="Cheat Sheet"></div>
		</div>
</div>	</div>
	
</div> <!-- end page-wrap -->
	
		
			
		<footer id="footer">
			<div class="container">
				<div class="four columns"></div>
								<div class="four columns"></div>
												<div class="four columns"></div>
												<div class="four columns"></div>	
							</div>
		</footer>
		
		<div id="copyright" class="clearfix">
		<div class="container">
			
			<div class="sixteen columns">

				<div class="copyright-text copyright-col1">
											© 2017-2022 Azeria Labs™ | All Rights Reserved.									</div>
				
				<div class="copyright-col2">
											
<div class="social-icons clearfix">
	<ul>
													<li><a href="https://github.com/azeria-labs" target="_blank" title="Github"><i class="fa fa-github"></i></a></li>
																									<li><a href="https://twitter.com/Fox0x01" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></li>
															</ul>
</div>									</div>

			</div>
			
		</div>
	</div><!-- end copyright -->
			
	</div><!-- end wrapall / boxed -->
	
		<div id="back-to-top"><a href="#"><i class="fa fa-chevron-up"></i></a></div>
		
	<script type="text/html" id="wpb-modifications"></script><script type="text/javascript" src="https://azeria-labs.com/wp-content/plugins/contact-form-7/includes/swv/js/index.js.pagespeed.ce.e-ZawnAkx7.js" id="swv-js"></script>
<script type="text/javascript" id="contact-form-7-js-extra">
/* <![CDATA[ */
var wpcf7 = {"api":{"root":"https:\/\/azeria-labs.com\/wp-json\/","namespace":"contact-form-7\/v1"}};
/* ]]> */
</script>
<script src="https://azeria-labs.com/wp-content/plugins,_contact-form-7,_includes,_js,_index.js+themes,_unicon,_framework,_js,_jquery.easing.min.js+themes,_unicon,_framework,_js,_waypoints.min.js+themes,_unicon,_framework,_js,_waypoints-sticky.min.js+themes,_unicon,_framework,_js,_prettyPhoto.js.pagespeed.jc.5JzarGntSN.js"></script><script>eval(mod_pagespeed_ywBAY$ryOe);</script>
<script>eval(mod_pagespeed_rFGm7RXv88);</script>
<script>eval(mod_pagespeed_Mzr4as6THB);</script>
<script>eval(mod_pagespeed_rDcip3V3y8);</script>
<script>eval(mod_pagespeed_F_oZkq$P_0);</script>
<script type="text/javascript" src="https://azeria-labs.com/wp-content/themes/unicon/framework/js/isotope.pkgd.min.js.pagespeed.ce.9TqWB268we.js" id="minti-isotope-js"></script>
<script type="text/javascript" src="https://azeria-labs.com/wp-content/themes/unicon/framework/js/functions.js.pagespeed.ce.r5dJtCVMsW.js" id="minti-functions-js"></script>
<script src="https://azeria-labs.com/wp-content,_themes,_unicon,_framework,_js,_flexslider.min.js+wp-includes,_js,_comment-reply.min.js.pagespeed.jc.BVipDbzwnB.js"></script><script>eval(mod_pagespeed_mp3NGmTw$c);</script>
<script>eval(mod_pagespeed_aR3dA613tt);</script>
<script type="text/javascript" id="wpb_composer_front_js-js-extra">
/* <![CDATA[ */
var vcData = {"currentTheme":{"slug":"unicon"}};
/* ]]> */
</script>
<script type="text/javascript" src="https://azeria-labs.com/wp-content/plugins/js_composer/assets/js/dist/js_composer_front.min.js" id="wpb_composer_front_js-js"></script>

	<script type="text/javascript">
	jQuery(document).ready(function($){
		"use strict";
	    
		/* PrettyPhoto Options */
		var lightboxArgs = {			
						animation_speed: 'slow',
						overlay_gallery: false,
			autoplay_slideshow: false,
						slideshow: 5000,
									opacity: 0.8,
						show_title: false,
			social_tools: "",			deeplinking: false,
			allow_resize: true,
			allow_expand: false,
			counter_separator_label: '/',
			default_width: 1160,
			default_height: 653
		};
		
				/* Automatic Lightbox */
		$('a[href$=jpg], a[href$=JPG], a[href$=jpeg], a[href$=JPEG], a[href$=png], a[href$=gif], a[href$=bmp]:has(img)').prettyPhoto(lightboxArgs);
					
		/* General Lightbox */
		$('a[class^="prettyPhoto"], a[rel^="prettyPhoto"], .prettyPhoto').prettyPhoto(lightboxArgs);

		/* WooCommerce Lightbox */
		$("a[data-rel^='prettyPhoto']").prettyPhoto({
			hook: 'data-rel',
			social_tools: false,
			deeplinking: false,
			overlay_gallery: false,
			opacity: 0.8,
			allow_expand: false, /* Allow the user to expand a resized image. true/false */
			show_title: false
		});

		
	    
		/* Transparent Header */
	    function transparentHeader() {
			if ($(document).scrollTop() >= 60) {
				$('#header.header-v1').removeClass('header-transparent');
			}
			else {
				$('#header.header-v1.stuck').addClass('header-transparent');
			}
		}
			
		/* Sticky Header */
		if (/Android|BlackBerry|iPhone|iPad|iPod|webOS/i.test(navigator.userAgent) === false) {

			var $stickyHeaders = $('#header.header-v1, #header.header-v3 .navigation-wrap, #header.header-v4 .navigation-wrap');
			$stickyHeaders.waypoint('sticky');
			
			$(window).resize(function() {
				$stickyHeaders.waypoint('unsticky');
				if ($(window).width() < 944) {
					$stickyHeaders.waypoint('unsticky');
				}
				else {
					$stickyHeaders.waypoint('sticky');
				}
			});
			
			if ($("body").hasClass("header-is-transparent")) {
				$(document).scroll(function() { transparentHeader(); });
				transparentHeader();
		    }

		}			
	    
	    
	    	
	    /* Fill rest of page */
	    			    			$('body').css({'background-color' : '#1b1b1b' });
	    			    
	});
	</script>
	


</body></html>